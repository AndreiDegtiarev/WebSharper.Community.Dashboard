(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Community=b.Community||{};d=c.Dashboard=c.Dashboard||{};e=d.Environment=d.Environment||{};f=e.Role=e.Role||{};g=a.StartupCode$WebSharper_Community_Dashboard$Environment=a.StartupCode$WebSharper_Community_Dashboard$Environment||{};h=d.MessageBus=d.MessageBus||{};i=h.Value=h.Value||{};j=h.Message=h.Message||{};k=h.ListenerInfo=h.ListenerInfo||{};l=h.SystemStatus=h.SystemStatus||{};m=h.AgentMessage=h.AgentMessage||{};n=h.AgentState=h.AgentState||{};o=a.StartupCode$WebSharper_Community_Dashboard$MessageBus=a.StartupCode$WebSharper_Community_Dashboard$MessageBus||{};p=d.InPortData=d.InPortData||{};q=d.InPort=d.InPort||{};r=d.OutPort=d.OutPort||{};s=d.WorkerData=d.WorkerData||{};t=d.Worker=d.Worker||{};u=d.Workers=d.Workers||{};v=d.RuleEntry=d.RuleEntry||{};w=d.RuleChain=d.RuleChain||{};x=d.RuleContainer=d.RuleContainer||{};y=d.WorkerItem=d.WorkerItem||{};z=d.Factory=d.Factory||{};A=d.RulesCellItem=d.RulesCellItem||{};B=d.RulesRowItem=d.RulesRowItem||{};C=d.SelectorGroup=d.SelectorGroup||{};D=d.WindowSelector=d.WindowSelector||{};E=d.WidgetItem=d.WidgetItem||{};F=d.EventsGroupItem=d.EventsGroupItem||{};G=d.WidgetsGroupItem=d.WidgetsGroupItem||{};H=d.RulesGroupItem=d.RulesGroupItem||{};I=d.DshData=d.DshData||{};J=d.RulesEditor=d.RulesEditor||{};K=d.DshHelper=d.DshHelper||{};L=d.Dashboard=d.Dashboard||{};M=d.Events=d.Events||{};N=M.RandomEvent=M.RandomEvent||{};O=M.DatabaseEventContext=M.DatabaseEventContext||{};P=M.DatabaseEvent=M.DatabaseEvent||{};Q=M.OpenWeather=M.OpenWeather||{};R=Q.Forecast=Q.Forecast||{};S=M.OpenWeatherEvent=M.OpenWeatherEvent||{};T=M.ClockEvent=M.ClockEvent||{};U=d.Widgets=d.Widgets||{};V=U.TextBoxWidget=U.TextBoxWidget||{};W=U.ChartWidgetContext=U.ChartWidgetContext||{};X=U.ChartWidget=U.ChartWidget||{};Y=U.ButtonWidget=U.ButtonWidget||{};Z=d.AppModelLib=d.AppModelLib||{};_0=d.App=d.App||{};_1=a.StartupCode$WebSharper_Community_Dashboard$AppModelLib=a.StartupCode$WebSharper_Community_Dashboard$AppModelLib||{};_2=d.AppDataHelper=d.AppDataHelper||{};_3=d.AppData=d.AppData||{};_4=a.IntelliFactory;_5=_4&&_4.Runtime;_6=b&&b.Operators;_7=c&&c.Panel;_8=_7&&_7.Helper;_9=a.Date;_=b&&b.List;$=b&&b.Concurrency;ba=b&&b.Remoting;bb=ba&&ba.AjaxRemotingProvider;bc=b&&b.Utils;bd=b&&b.Control;be=bd&&bd.MailboxProcessor;bf=b&&b.Seq;bg=b&&b.UI;bh=bg&&bg.Next;bi=bh&&bh.View;bj=bh&&bh.Var;bk=c&&c.PropertyGrid;bl=bk&&bk.Properties;bm=b&&b.MatchFailureException;bn=a.System;bo=bn&&bn.Guid;bp=bh&&bh.Doc;bq=b&&b.Enumerator;br=bh&&bh.Key;bs=bh&&bh.ListModel;bt=b&&b.Unchecked;bu=bh&&bh.AttrModule;bv=b&&b.Option;bw=_7&&_7.WrapControls;bx=a.console;by=_7&&_7.PanelContainer;bz=_7&&_7.LayoutManagers;bA=_7&&_7.Panel;bB=_7&&_7.TitleButton;bC=_7&&_7.Dialog;bD=bk&&bk.PropertyGrid;bE=b&&b.Random;bF=a.Math;bG=b&&b.Data;bH=bG&&bG.TxtRuntime;bI=a.FSharp;bJ=bI&&bI.Data;bK=bJ&&bJ.Runtime;bL=bK&&bK.IO;bM=a.JSON;bN=b&&b.Arrays;bO=b&&b.DateUtil;bP=b&&b.Charting;bQ=bP&&bP.Renderers;bR=bQ&&bQ.ChartJs;bS=bd&&bd.FSharpEvent;bT=bP&&bP.Chart;bU=bP&&bP.LiveChart;bV=bP&&bP.Pervasives;f.Server={$:1};f.Client={$:0};e.UpdateConfiguration=function(){g.$cctor();return g.UpdateConfiguration;};e.set_UpdateConfiguration=function(bW){g.$cctor();g.UpdateConfiguration=bW;};e.DataDirectory=function(){g.$cctor();return g.DataDirectory;};e.set_DataDirectory=function(bW){g.$cctor();g.DataDirectory=bW;};e.Log=function(){g.$cctor();return g.Log;};e.set_Log=function(bW){g.$cctor();g.Log=bW;};e.Role$1=function(){g.$cctor();return g.Role;};e.set_Role=function(bW){g.$cctor();g.Role=bW;};g.$cctor=function(){g.$cctor=a.ignore;g.Role=f.Server;g.Log=a.ignore;g.DataDirectory="";g.UpdateConfiguration=a.ignore;};i=h.Value=_5.Class({get_trySystem:function(){return this.$==4?{$:1,$0:this.$0}:null;},get_AsSelect:function(){return this.$==3?this.$0:_6.FailWith("MessageBus.Value: unexpected type");},get_AsBoolean:function(){return this.$==2?this.$0:((h.log())("MessageBus.Value: unexpected type"),false);},get_AsString:function(){return this.$==1?this.$0:((h.log())("MessageBus.Value: unexpected type"),"Invalid");},get_AsNumber:function(){return this.$==0?this.$0:((h.log())("MessageBus.Value: unexpected type"),0);}},null,i);j=h.Message=_5.Class({WithTime:function(bW){return j.New(this.Key,bW,this.Value);},WithKey:function(bW){return j.New(bW,this.Time,this.Value);}},null,j);j.Create=function(bW){return j.New(_8.UniqueKey(),_9.now(),bW);};j.New=function(bW,bX,bY){return new j({Key:bW,Time:bX,Value:bY});};k.Create=function(bW,bX,bY){return k.New(bW,bX,bY);};k.New=function(bW,bX,bY){return{Key:bW,Name:bX,CacheSize:bY};};l.Running={$:1};l.Inactive={$:0};m.Start={$:5};m.Stop={$:4};n.get_initListeners=function(){return _.ofArray([[k.Create("system","Configuration",1),function(bW){var bX;bX=bW.Value.get_trySystem();bX==null?void 0:(e.UpdateConfiguration())(bX.$0.$0);},_.T.Empty]]);};n.get_empty=function(){return n.New(l.Inactive,null,n.get_initListeners(),(new _9(1,1-1,1)).getTime());};n.New=function(bW,bX,bY,bZ){return{SystemStatus:bW,ServerCallback:bX,Listeners:bY,LastConfigurationTime:bZ};};h.RunServerRequests=function(){var bW;$.Start((bW=null,$.Delay(function(){return $.While(function(){return true;},$.Delay(function(){return $.Bind($.Sleep(2*1000),function(){return $.Bind(h.Agent().PostAndAsyncReply(function(bX){return{$:8,$0:bX};},null),function(bX){return $.TryWith($.Delay(function(){return $.Bind((new bb.New()).Async("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.MessageBus.GetMessages:214660718",[bX[0],bX[1]]),function(bY){var bZ;_.iter(function(b0){var b1;b1=h.Agent();b1.mailbox.AddLast({$:1,$0:b0});b1.resume();},bY);return bY.get_Length()>0?(_.iter(function(b0){var b1;b1=(((_5.Curried3(function(b2,b3,b4){return b2(bc.toSafe(b3)+" "+bc.toSafe(b4));}))(a.id))(b0.Key))(a.String(b0.Time));(h.log())(b1);},bY),bZ=(function(b0){return function(b1){return b0("Values from server requested messages received:"+a.String(b1));};}(a.id))(bY.get_Length()),(h.log())(bZ),$.Zero()):$.Zero();});}),function(){return $.Zero();});});});}));})),null);};h.Agent=function(){o.$cctor();return o.Agent;};h.CreateMessage=function(bW){return j.New(_8.UniqueKey(),_9.now(),bW);};h.log=function(){o.$cctor();return o.log;};o.$cctor=function(){o.$cctor=a.ignore;o.log=e.Log();o.Agent=be.Start(function(bW){function bX(b2,b3){return bf.fold(function(b4,b5){var b6;return(b6=b5.Time-b2,b6/1000)>0.01?new _.T({$:1,$0:b5,$1:b4}):b4;},_.T.Empty,b3);}function bY(b2,b3){return b2<b3.get_Length()?(_.splitAt(b2,b3))[0]:b3;}function bZ(b2,b3,b4){return b2===1?_.ofArray([b4]):bY(b2,new _.T({$:1,$0:b4,$1:b3}));}function b0(b2,b3){function b4(b5,b6,b7){var b8,b9;b8=a.Array.prototype.slice.call(arguments);if(b5.Key===b2.Key){try{b6(b2);}catch(b_){b9=(function(b$){return function(ca){return b$("Fails send message. It might be that receiver doesn't expect message of this type: "+bc.toSafe(ca));};}(a.id))(b5.Name);(h.log())(b9);}return[b5,b6,bZ(b5.CacheSize,b7,b2)];}else return b8;}return _.map(function(b5){return b4(b5[0],b5[1],b5[2]);},b3);}function b1(b2){var b3;b3=null;return $.Delay(function(){return $.Bind(bW.Receive(null),function(b4){var b5,b6,b7,b8,b9,b_,b$;function ca(ce,cf){function cg(ch,ci,cj){return bX(ce,cj);}return _.sortBy(function(ch){return ch.Time;},bf.fold(function(ch,ci){return!_.contains(ci,ch)?new _.T({$:1,$0:ci,$1:ch}):ch;},_.T.Empty,_.concat(_.map(function(ch){return cg(ch[0],ch[1],ch[2]);},cf))));}function cb(ce,cf,cg){return ce.Key==="system";}function cc(ce,cf,cg){return ce.Key!=="system";}function cd(ce,cf,cg){return cg.$==0?(new _9(1,1-1,1)).getTime():_.maxBy(function(ch){return ch.Time;},cg).Time;}return b4.$==5?b1(n.New(l.Running,b2.ServerCallback,b2.Listeners,b2.LastConfigurationTime)):b4.$==6?(b4.$0(b2.SystemStatus),b1(b2)):b4.$==2?(b5=b4.$0[0],(b6=(((_5.Curried3(function(ce,cf,cg){return ce("RegisterListener:"+bc.toSafe(cf)+" "+bc.toSafe(cg));}))(a.id))(b5.Name))(b5.Key),(h.log())(b6),b1(n.New(b2.SystemStatus,b2.ServerCallback,new _.T({$:1,$0:[b5,b4.$0[1],_.T.Empty],$1:b2.Listeners}),b2.LastConfigurationTime)))):b4.$==3?b1(n.New(b2.SystemStatus,{$:1,$0:b4.$0},b2.Listeners,b2.LastConfigurationTime)):b4.$==7?(b4.$0[2](_.append(ca(b4.$0[0],_.filter(function(ce){return cb(ce[0],ce[1],ce[2]);},b2.Listeners)),ca(b4.$0[1],_.filter(function(ce){return cc(ce[0],ce[1],ce[2]);},b2.Listeners)))),b1(b2)):b4.$==8?(b7=_.map(function(ce){return cd(ce[0],ce[1],ce[2]);},b2.Listeners),(b4.$0([b2.LastConfigurationTime,b7.$==0?(new _9(1,1-1,1)).getTime():_.max(b7)]),b1(b2))):b4.$==1?(b8=b4.$0,(b9=b8.Value.get_trySystem(),b9==null?b1(n.New(b2.SystemStatus,b2.ServerCallback,b0(b8,b2.Listeners),b2.LastConfigurationTime)):$.Combine(((e.UpdateConfiguration())(b9.$0.$0),$.Zero()),$.Delay(function(){return b1(n.New(b2.SystemStatus,b2.ServerCallback,b2.Listeners,b8.Time));})))):b4.$==0?(b_=b4.$0,(b$=b2.ServerCallback,b$==null?void 0:b$.$0(b_),b1(n.New(b2.SystemStatus,b2.ServerCallback,b0(b_,b2.Listeners),b2.LastConfigurationTime)))):b1(n.New(l.Inactive,b2.ServerCallback,n.get_initListeners(),b2.LastConfigurationTime));});});}return b1(n.get_empty());},null);};p=d.InPortData=_5.Class({WithCacheSize:function(bW){return p.New(this.Key,this.Name,this.Value,bW);}},null,p);p.CreateSelect=function(bW,bX){return p.Create(bW,new i({$:3,$0:bX}));};p.CreateBoolean=function(bW,bX){return p.Create(bW,new i({$:2,$0:bX}));};p.CreateString=function(bW,bX){return p.Create(bW,new i({$:1,$0:bX}));};p.CreateNumber=function(bW,bX){return p.Create(bW,new i({$:0,$0:bX}));};p.Create=function(bW,bX){var bY;bY=h.CreateMessage(bX);return p.New(bY.Key,bW,bY.WithTime((new _9(1,1-1,1)).getTime()),1);};p.New=function(bW,bX,bY,bZ){return new p({Key:bW,Name:bX,Value:bY,CacheSize:bZ});};q=d.InPort=_5.Class({get_SelectView:function(){return bi.Map(function(bW){return bW.Value.get_AsSelect();},this.PortValue.v);},get_Select:function(){return this.PortValue.c.Value.get_AsSelect();},get_BooleanView:function(){return bi.Map(function(bW){return bW.Value.get_AsBoolean();},this.PortValue.v);},get_Boolean:function(){return this.PortValue.c.Value.get_AsBoolean();},get_StringView:function(){return bi.Map(function(bW){return bW.Value.get_AsString();},this.PortValue.v);},get_String:function(){return this.PortValue.c.Value.get_AsString();},get_NumberView:function(){return bi.Map(function(bW){return bW.Value.get_AsNumber();},this.PortValue.v);},get_Number:function(){return this.PortValue.c.Value.get_AsNumber();},Receive:function(bW){bj.Set(this.PortValue,bW);},get_Property:function(){var bW,bX,bY,bZ,b0,b1,b2;b1=this;b2=this.PortValue.c.Value;if(b2.$==0){bW=bj.Create$1(this.get_Number());bi.Sink(function(b3){var b4;bj.Set(b1.PortValue,(b4=b1.PortValue.c,j.New(b4.Key,b4.Time,new i({$:0,$0:b3}))));},bW.v);return bl["double"](this.Data.Name,bW);}else if(b2.$==1){bX=bj.Create$1(this.get_String());bi.Sink(function(b3){var b4;bj.Set(b1.PortValue,(b4=b1.PortValue.c,j.New(b4.Key,b4.Time,new i({$:1,$0:b3}))));},bX.v);return bl.string(this.Data.Name,bX);}else if(b2.$==2){bY=bj.Create$1(this.get_Boolean());bi.Sink(function(b3){var b4;bj.Set(b1.PortValue,(b4=b1.PortValue.c,j.New(b4.Key,b4.Time,new i({$:2,$0:b3}))));},bY.v);return bl.check(this.Data.Name,bY);}else if(b2.$==3){bZ=b2.$0[1];b0=bj.Create$1(bZ.get_Item(b2.$0[0]));bi.Sink(function(b3){var b4;bj.Set(b1.PortValue,(b4=b1.PortValue.c,j.New(b4.Key,b4.Time,new i({$:3,$0:[bf.findIndex(function(b5){return b5===b3;},bZ),bZ]}))));},b0.v);return bl.select(this.Data.Name,a.id,bZ,b0);}else throw new bm.New("Port.fs",38,30);},get_Key:function(){return this.Data.Key;},get_Name:function(){return this.Data.Name;}},null,q);q.Clone=function(bW){var bX,bY;return q.New((bX=bW.Data,p.New((bY=bo.NewGuid(),a.String(bY)),bX.Name,bX.Value,bX.CacheSize)),bj.Create$1(bW.PortValue.c));};q.ToData=function(bW){var bX;bX=bW.Data;return p.New(bX.Key,bX.Name,bW.PortValue.c,bX.CacheSize);};q.FromData=function(bW){return q.New(bW,bj.Create$1(bW.Value));};q.New=function(bW,bX){return new q({Data:bW,PortValue:bX});};r=d.OutPort=_5.Class({Trigger:function(bW){var bX,bY;bX={$:0,$0:h.CreateMessage(bW).WithKey(this.Key)};bY=h.Agent();bY.mailbox.AddLast(bX);bY.resume();}},null,r);r.Clone=function(bW){return r.New(_8.UniqueKey(),bW.Name);};r.Create=function(bW){return r.New(_8.UniqueKey(),bW);};r.New=function(bW,bX){return new r({Key:bW,Name:bX});};s.Create=function(bW,bX,bY){return s.New(bW,bX,bY);};s.New=function(bW,bX,bY){return{WorkerName:bW,InPorts:bX,OutPorts:bY};};t=d.Worker=_5.Class({get_Properties:function(){return new _.T({$:1,$0:bl.string("Name",this.Name),$1:_.map(function(bW){return bW.get_Property();},this.InPorts)});},get_Render:function(){var bW;bW=this.Data.WebSharper_Community_Dashboard_IWorkerData$get_Render();return bW==null?bp.Empty():bW.$0(this);},get_Clone:function(){return t.New(_8.UniqueKey(),bj.Create$1(this.Name.c),_.map(q.Clone,this.InPorts),_.map(r.Clone,this.OutPorts),this.Data,bj.Create$1(null));},get_ToData:function(){return s.New(this.Name.c,_.map(q.ToData,this.InPorts),this.OutPorts);},StartRunner:function(){var bW;bW=this.Data.WebSharper_Community_Dashboard_IWorkerData$get_Run();bW==null?void 0:bj.Set(this.RunnerContext,bW.$0(this));},WithKey:function(bW){return t.New(bW,this.Name,this.InPorts,this.OutPorts,this.Data,this.RunnerContext);}},null,t);t.Create=function(bW){return t.New(_8.UniqueKey(),bj.Create$1(bW.WebSharper_Community_Dashboard_IWorkerData$get_Data().WorkerName),_.map(q.FromData,bW.WebSharper_Community_Dashboard_IWorkerData$get_Data().InPorts),bW.WebSharper_Community_Dashboard_IWorkerData$get_Data().OutPorts,bW,bj.Create$1(null));};t.New=function(bW,bX,bY,bZ,b0,b1){return new t({Key:bW,Name:bX,InPorts:bY,OutPorts:bZ,Data:b0,RunnerContext:b1});};u.allInPorts=function(bW){return u.allPorts(bW,function(bX){return bX.InPorts;});};u.allOutPorts=function(bW){return u.allPorts(bW,function(bX){return bX.OutPorts;});};u.allPorts=function(bW,bX){return _.concat(_.map(bX,bW));};v.New=function(bW,bX,bY){return{InPortKey:bW,OutPortKey:bX,WorkerKey:bY};};w.New=function(bW){return{RuleChain:bW};};x=d.RuleContainer=_5.Class({Reconnect:function(bW){var bX,bY,bZ;bX=e.Log();bY=u.allOutPorts(bW);bZ=u.allInPorts(bW);_.iter(function(b0){var b1,b2,b3;b1=_.ofSeq(b0.RuleChain);b2=_.ofSeq(_6.range(1,b1.get_Length()-1));b3=bq.Get(b2);try{while(b3.MoveNext())(function(){var b4,b5,b6,b7,b8,b9,b_,b$;b4=b3.Current();b5=b1.get_Item(b4-1);b6=b1.get_Item(b4);b7=bf.tryFind(function(ca){return ca.Key===b5.OutPortKey;},bY),b7==null?null:{$:1,$0:(b8=b7.$0,(b9=bf.tryFind(function(ca){return ca.Data.Key===b6.InPortKey;},bZ),b9==null?null:{$:1,$0:(b_=b9.$0,(bX("Found inPort"),b_.PortValue.c.Key!==b_.Data.Key?bj.Set(b_.PortValue,b_.PortValue.c.WithKey(b_.Data.Key)):void 0,b$=h.Agent(),b$.mailbox.AddLast({$:2,$0:[k.Create(b8.Key,b8.Name+"->"+b_.get_Name(),b_.Data.CacheSize),function(ca){b_.Receive(ca);}]}),b$.resume()))}))};}());}finally{if("Dispose"in b3)b3.Dispose();}},_.ofSeq(this.RuleContainer));}},null,x);x.New=function(bW){return new x({RuleContainer:bW});};y.Create=function(bW){return y.New(br.Fresh(),bW);};y.New=function(bW,bX){return{Key:bW,Worker:bX};};z=d.Factory=_5.Class({RegisterEvent:function(bW){this.EventItems.Append(y.Create(bW));},RegisterWidget:function(bW){this.WidgetItems.Append(y.Create(bW));}},null,z);z.get_Create=function(){return z.New(bs.Create(function(bW){return bW.Key;},_.T.Empty),bs.Create(function(bW){return bW.Key;},_.T.Empty));};z.New=function(bW,bX){return new z({EventItems:bW,WidgetItems:bX});};A=d.RulesCellItem=_5.Class({Render:function(bW,bX){var bY,bZ,b0,b1,b2;bY=this;bi.Sink(function(b3){var b4,b5,b6,b7,b8;if(b3==null);else{b4=b3.$0;b5=bY.OptInPort.c;b5==null?bj.Set(bY.OptInPort,_.tryHead(b4.Worker.InPorts)):(b6=b5.$0,!_.exists(function(b9){return bt.Equals(b9,b6);},b4.Worker.InPorts)?bj.Set(bY.OptInPort,_.tryHead(b4.Worker.InPorts)):void 0);b7=bY.OptOutPort.c;b7==null?bj.Set(bY.OptOutPort,_.tryHead(b4.Worker.OutPorts)):(b8=b7.$0,!_.exists(function(b9){return bt.Equals(b9,b8);},b4.Worker.OutPorts)?bj.Set(bY.OptOutPort,_.tryHead(b4.Worker.OutPorts)):void 0);bX();}},this.OptWorker.v);bi.Sink(function(){bX();},this.OptInPort.v);bi.Sink(function(){bX();},this.OptOutPort.v);bZ=(b0=bi.Map(function(b3){var b4;return b3==null?_.ofArray([null]):(b4=_.map(function(b5){return{$:1,$0:b5};},b3.$0.Worker.InPorts),b4.get_Length()>0?b4:_.ofArray([null]));},this.OptWorker.v),(b1=bi.Map(function(b3){var b4;return b3==null?_.ofArray([null]):(b4=_.map(function(b5){return{$:1,$0:b5};},b3.$0.Worker.OutPorts),b4.get_Length()>0?b4:_.ofArray([null]));},this.OptWorker.v),(b2=bi.Map(function(b3){return new _.T({$:1,$0:null,$1:_.map(function(b4){return{$:1,$0:b4};},_.ofSeq(b3))});},bW.v),bp.Element("table",[],[bp.Element("tr",[],[bp.Element("td",[],[bp.SelectDyn([bu.Class("form-control")],function(b3){return bv.fold(function(b4,b5){return b5.get_Name();}," ",b3);},b0,this.OptInPort)]),bp.Element("td",[],[bp.SelectDyn([bu.Class("form-control")],function(b3){return bv.fold(function(b4,b5){return b5.Worker.Name.c;}," ",b3);},b2,this.OptWorker)]),bp.Element("td",[],[bp.SelectDyn([bu.Class("form-control")],function(b3){return bv.fold(function(b4,b5){return b5.Name;}," ",b3);},b1,this.OptOutPort)])])]))));return bp.Element("td",[bu.Class("td DshEditorCell")],[bp.Element("div",[bu.Class("div DshEditorCell")],[bp.Element("table",[],[bp.Element("tr",[],[bp.Element("td",[],[bZ])])])])]);}},null,A);A.get_Create=function(){return A.New(br.Fresh(),bj.Create$1(null),bj.Create$1(null),bj.Create$1(null));};A.New=function(bW,bX,bY,bZ){return new A({Key:bW,OptInPort:bX,OptWorker:bY,OptOutPort:bZ});};B=d.RulesRowItem=_5.Class({Render:function(bW,bX){var bY;bY=this;return bp.Element("tr",[],[bp.ConvertBy(function(bZ){return bZ.Key;},function(bZ){return bZ.Render(bW,bX);},this.CellItems.v),_8.IconNormal("add",function(){bY.CellItems.Append(A.get_Create());})]);}},null,B);B.Create=function(bW){return B.New(br.Fresh(),bs.Create(function(bX){return bX.Key;},bW));};B.New=function(bW,bX){return new B({Key:bW,CellItems:bX});};C=d.SelectorGroup=_5.Class({RenderMenu:function(bW,bX,bY){var bZ,b0,b1,b2,b3,b4;function b5(b6){return _.ofArray([_8.IconSmall("keyboard_arrow_down",function(){(b0(true))(b6);(bZ.ItemOnMove(b6))({$:1});}),_8.IconSmall("keyboard_arrow_up",function(){(b0(false))(b6);(bZ.ItemOnMove(b6))({$:0});}),_8.IconSmall("clear",function(){bZ.SelectorItems.Remove(b6);bZ.ItemOnDelete(b6);})]);}bZ=this;b0=(b1=this.SelectorItems,(_5.Curried3(_8.MoveItemInModelList))(b1));b2=(b3=this.ItemCreatator,b3==null?bp.Element("tr",[],[]):(b4=b3.$0,bp.Element("tr",[],[bp.Element("td",[],[bp.Element("div",[bu.Style("margin-left","20px")],[_8.IconSmall("add",function(){var b6;b6=b4();bZ.ItemOnCreated(b6);bZ.SelectorItems.Append(b6);})])])])));return bp.Element("table",[],[bp.ConvertBy(function(b6){return b6.WebSharper_Community_Dashboard_ISelectorItem$get_Key();},function(b6){var b7,b8,b9,b_;b7=bi.Map(function(b$){return bW+b$;},b6.WebSharper_Community_Dashboard_ISelectorItem$get_Name().v);return bp.Element("tr",[],[bp.Element("td",[bu.DynamicStyle("Color",bi.Map(function(b$){return b$==null?"#7D4600":bt.Equals(b$.$0.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),b6.WebSharper_Community_Dashboard_ISelectorItem$get_Key())?"#FB8C00":"#7D4600";},bX.v))],[(b8=bp.Element("div",[bu.Style("margin-left","10px"),bu.Style("margin-right","5px"),bu.Style("cursor","pointer"),bu.Handler("click",function(){return function(){bZ.ItemOnSelected(b6);return bj.Set(bX,{$:1,$0:b6});};})],[bp.TextView(b7)]),(bY?(b9=b5(b6),(b_=_7.WrapControlsAligment.Horizontal,function(b$){return bw.Render(b9,b_,b$);})):a.id)(b8))])]);},this.SelectorItems.v),b2]);},Render:function(bW){return bp.ConvertBy(function(bX){return bX.WebSharper_Community_Dashboard_ISelectorItem$get_Key();},function(bX){return bp.Element("div",[bu.DynamicStyle("display",bi.Map(function(bY){return bY==null?"none":bt.Equals(bY.$0,bX)?"block":"none";},bW.v))],[bX.WebSharper_Community_Dashboard_ISelectorItem$get_Render()]);},this.SelectorItems.v);}},null,C);C.Create=function(bW,bX,bY,bZ,b0,b1,b2){var b3;b3=bs.Create(function(b4){return b4.WebSharper_Community_Dashboard_ISelectorItem$get_Key();},bX);return C.New(br.Fresh(),bj.Create$1(bW),b3,bY,bZ,b0,b1,b2);};C.New=function(bW,bX,bY,bZ,b0,b1,b2,b3){return new C({Key:bW,Name:bX,SelectorItems:bY,ItemCreatator:bZ,ItemOnCreated:b0,ItemOnSelected:b1,ItemOnDelete:b2,ItemOnMove:b3});};D=d.WindowSelector=_5.Class({get_RenderMenu:function(){var bW;bW=this;return this.SelectorGroups.get_Length()===1?_.head(_.ofSeq(this.SelectorGroups)).RenderMenu("",this.OptSelectedItem,this.IsWithControls):bp.Element("div",[],[bp.ConvertBy(function(bX){return bX.Key;},function(bX){return bp.Element("div",[],[bp.Element("div",[bu.Style("cursor","pointer"),bu.Handler("click",function(){return function(){return bW.GroupOnClick(bX);};})],[bp.TextView(bX.Name.v)]),bX.RenderMenu("    ",bW.OptSelectedItem,bW.IsWithControls)]);},this.SelectorGroups.v)]);},get_Render:function(){var bW;bW=this;return bp.Element("div",[],[bp.ConvertBy(function(bX){return bX.Key;},function(bX){return bX.Render(bW.OptSelectedItem);},this.SelectorGroups.v)]);},GroupByIndex:function(bW){return bf.nth(bW,_.ofSeq(this.SelectorGroups));},get_SelectedIndex:function(){var bW;bW=this;return bf.findIndex(function(bX){return bt.Equals(bX.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bW.get_SelectedItem().WebSharper_Community_Dashboard_ISelectorItem$get_Key());},_.concat(_.map(function(bX){return _.ofSeq(bX.SelectorItems);},_.ofSeq(this.SelectorGroups))));},get_SelectedIndexInGroup:function(){var bW;bW=this;return bf.findIndex(function(bX){return bt.Equals(bX.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bW.get_SelectedItem().WebSharper_Community_Dashboard_ISelectorItem$get_Key());},_.ofSeq(this.get_SelectedGroup().SelectorItems));},get_SelectedGroupIndex:function(){var bW;bW=this;return bf.findIndex(function(bX){return bt.Equals(bX.Key,bW.get_SelectedGroup().Key);},_.ofSeq(this.SelectorGroups));},get_SelectedGroup:function(){return this.GroupFromItem(this.get_SelectedItem());},GroupFromItem:function(bW){return bf.find(function(bX){return _.exists(function(bY){return bt.Equals(bY.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bW.WebSharper_Community_Dashboard_ISelectorItem$get_Key());},_.ofSeq(bX.SelectorItems));},_.ofSeq(this.SelectorGroups));},AppenGroup:function(bW,bX,bY){var bZ;bZ=this.SelectorGroups.get_Length();this.SelectorGroups.Append(C.Create(bW,bX,bY,this.ItemOnCreated(bZ),this.ItemOnSelected,this.ItemOnDeleted(bZ),this.ItemOnMove(bZ)));},get_SelectedItem:function(){var bW;bW=this.OptSelectedItem.c;return bW==null?_6.FailWith("Something really wrong with WindowSelector"):bW.$0;},ClearGroups:function(){bj.Set(this.OptSelectedItem,null);_.iter(function(bW){bW.SelectorItems.Clear();},_.ofSeq(this.SelectorGroups));},WithControls:function(bW){return D.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,bW);},WithItemOnMove:function(bW){return D.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,bW,this.IsWithControls);},WithItemOnDeleted:function(bW){return D.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,bW,this.ItemOnMove,this.IsWithControls);},WithItemOnSelected:function(bW){return D.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,bW,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);},WithGroupOnClick:function(bW){return D.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,bW,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);},WithItemOnCreated:function(bW){return D.New(this.OptSelectedItem,this.SelectorGroups,bW,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);}},null,D);D.get_Create=function(){var bW;bW=bs.Create(function(bX){return bX.Key;},_.T.Empty);return D.New(bj.Create$1(null),bW,function(){return function(){return null;};},a.ignore,a.ignore,function(){return function(){return null;};},_5.Curried3(function(bX,bY,bZ){return null;}),false);};D.New=function(bW,bX,bY,bZ,b0,b1,b2,b3){return new D({OptSelectedItem:bW,SelectorGroups:bX,ItemOnCreated:bY,GroupOnClick:bZ,ItemOnSelected:b0,ItemOnDeleted:b1,ItemOnMove:b2,IsWithControls:b3});};E.Create=function(bW,bX){return E.New(br.Fresh(),bW,bX);};E.New=function(bW,bX,bY){return{Key:bW,Panel:bX,Widget:bY};};F=d.EventsGroupItem=_5.Class({get_Render:function(){var bW,bX,bY;function bZ(b0){return _.ofArray([_8.IconSmall("keyboard_arrow_down",function(){(bX(true))(b0);}),_8.IconSmall("keyboard_arrow_up",function(){(bX(false))(b0);}),_8.IconSmall("clear",function(){bW.EventItems.Remove(b0);})]);}bW=this;bX=(bY=this.EventItems,(_5.Curried3(_8.MoveItemInModelList))(bY));return bp.Element("table",[],[bp.ConvertBy(function(b0){return b0.Key;},function(b0){var b1;return bp.Element("tr",[],[(b1=bp.Element("div",_8.AttrsClick(function(){bW.PropertyGrid.Edit(b0.Worker.get_Properties());}),[bp.TextView(b0.Worker.Name.v)]),bw.Render(bZ(b0),_7.WrapControlsAligment.Horizontal,b1))]);},this.EventItems.v)]);},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,F);F.Create=function(bW,bX){return F.New(br.Fresh(),bj.Create$1(bW),bs.Create(function(bY){return bY.Key;},_.T.Empty),bX);};F.New=function(bW,bX,bY,bZ){return new F({Key:bW,Name:bX,EventItems:bY,PropertyGrid:bZ});};G=d.WidgetsGroupItem=_5.Class({get_Render:function(){return this.PanelContainer.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,G);G.Create=function(bW,bX){return G.New(br.Fresh(),bj.Create$1(bW),bs.Create(function(bY){return bY.Key;},_.T.Empty),bX);};G.New=function(bW,bX,bY,bZ){return new G({Key:bW,Name:bX,WidgetItems:bY,PanelContainer:bZ});};H=d.RulesGroupItem=_5.Class({Equals:function(bW){return bW instanceof H&&bt.Equals(this.Key,bW.Key);},get_Render:function(){return this.Renderer(this.RulesRowItems);},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,H);H.Create=function(bW,bX){return H.New(br.Fresh(),bj.Create$1(bW),bs.Create(function(bY){return bY.Key;},_.T.Empty),bX);};H.New=function(bW,bX,bY,bZ){return new H({Key:bW,Name:bX,RulesRowItems:bY,Renderer:bZ});};I=d.DshData=_5.Class({RegisterWidget:function(bW,bX,bY,bZ){var b0;b0=bZ.WithKey(bW);bX.WidgetItems.Append(E.Create(bY,b0));this.WorkItems.Append(y.Create(b0));},RegisterEvent:function(bW,bX,bY){var bZ;bZ=y.Create(bY.WithKey(bW));bX.EventItems.Append(bZ);this.WorkItems.Append(bZ);},get_Clear:function(){this.WorkItems.Clear();this.WidgetGroups.Clear();this.EventGroups.Clear();this.RulesGroups.Clear();}},null,I);I.get_Create=function(){return I.New(bs.Create(function(bW){return bW.Key;},_.T.Empty),bs.Create(function(bW){return bW.Key;},_.T.Empty),bs.Create(function(bW){return bW.Key;},_.T.Empty),bs.Create(function(bW){return bW.Key;},_.T.Empty));};I.New=function(bW,bX,bY,bZ){return new I({WorkItems:bW,WidgetGroups:bX,EventGroups:bY,RulesGroups:bZ});};J.Render=function(bW,bX){function bY(b1,b2){return _8.MoveItemInModelList(bX,b1,b2);}function bZ(b1){return _.ofArray([_8.IconSmall("keyboard_arrow_down",function(){bY(true,b1);}),_8.IconSmall("keyboard_arrow_up",function(){bY(false,b1);}),_8.IconSmall("clear",function(){bX.Remove(b1);})]);}function b0(){var b1;$.Start((b1=null,$.Delay(function(){return $.Bind(h.Agent().PostAndAsyncReply(function(b2){return{$:6,$0:b2};},null),function(b2){var b3,b4,b5;return b2.$==1?(b3=h.Agent(),b3.mailbox.AddLast(m.Stop),b3.resume(),b4=_.map(function(b6){return b6.Worker;},_.ofSeq(bW.WorkItems)),J.CopyToRules(bX).Reconnect(b4),b5=h.Agent(),b5.mailbox.AddLast(m.Start),b5.resume(),$.Zero()):$.Zero();});})),null);}return bp.Element("table",[],[bp.ConvertBy(function(b1){return b1.Key;},function(b1){var b2;return bp.Element("tr",[],[(b2=b1.Render(bW.WorkItems,function(){b0();}),bw.Render(bZ(b1),_7.WrapControlsAligment.Horizontal,b2))]);},bX.v)]);};J.Restore=function(bW,bX,bY){var bZ,b0,b1;bX.Clear();bZ=_.map(function(b2){return b2.Worker;},_.ofSeq(bW.WorkItems));b0=u.allOutPorts(bZ);b1=u.allInPorts(bZ);_.iter(function(b2){var b3;b3=B.Create([]);_.iter(function(b4){var b5;b5=A.get_Create();bj.Set(b5.OptWorker,bf.tryFind(function(b6){return b6.Worker.Key===b4.WorkerKey;},_.ofSeq(bW.WorkItems)));bj.Set(b5.OptInPort,bf.tryFind(function(b6){return b6.get_Key()===b4.InPortKey;},b1));bj.Set(b5.OptOutPort,bf.tryFind(function(b6){return b6.Key===b4.OutPortKey;},b0));b3.CellItems.Append(b5);},b2.RuleChain);bX.Append(b3);},bY.RuleContainer);};J.CopyToRules=function(bW){return x.New(_.map(function(bX){return w.New(_.map(function(bY){var bZ,b0,b1;return v.New((bZ=bY.OptInPort.c,bZ==null?"":bZ.$0.get_Key()),(b0=bY.OptOutPort.c,b0==null?"":b0.$0.Key),(b1=bY.OptWorker.c,b1==null?"":b1.$0.Worker.Key));},_.ofSeq(bX.CellItems)));},_.ofSeq(bW)));};K.RulesGroupCreator=function(bW,bX){var bY;bY=H.Create("rules"+a.String(_.length(_.ofSeq(bW.RulesGroups))+1),function(bZ){return J.Render(bW,bZ);});bW.RulesGroups.Append(bY);return bY;};K.EventsGroupCreator=function(bW,bX,bY){var bZ;bZ=F.Create("event"+a.String(_.length(_.ofSeq(bW.EventGroups))+1),bX);bW.EventGroups.Append(bZ);return bZ;};K.PanelGroupCreator=function(bW,bX,bY){var bZ;bZ=G.Create("panel"+a.String(_.length(_.ofSeq(bW.WidgetGroups))+1),bX());bW.WidgetGroups.Append(bZ);return bZ;};L=d.Dashboard=_5.Class({Render:function(bW){var bX;bX=this;return bp.EmbedView(bi.Map(function(bY){return bY.$==1?bp.Element("div",[],[bp.Element("table",[bu.Style("White-space","nowrap")],[bp.Element("tr",[],[bp.Element("td",[bu.Style("vertical-align","top")],[bp.Element("table",[],bf.concat([_.ofArray([bp.Element("tr",[],[bp.Element("td",[],[_8.IconNormal("dehaze",function(){bj.Set(bX.PanelTitleVisibility,false);bj.Set(bX.Mode,{$:0});})])])]),_.ofArray([bX.EditorSelectorEdit.get_RenderMenu()]),_.ofArray([bp.Element("tr",[],[bp.Element("td",[],[])]),bp.Element("tr",[],[bp.Element("td",[],[bX.PropertyGrid.get_Render()])])])]))]),bp.Element("td",[bu.Style("vertical-align","top")],[bW,_8.IconNormal("add",function(){var bZ,b0,b1,b2,b3;bZ=bX.EditorSelectorEdit.get_SelectedGroupIndex();bZ===1?(b0=_.ofSeq(bX.Factory.EventItems),b1=bj.Create$1(_.head(b0)),bX.Dialog.ShowDialog("Select source",bp.Element("div",[],[bp.Select([bu.Class("form-control")],function(b4){return b4.Worker.Name.c;},b0,b1)]),function(){var b4,b5,b6;b4=b1.c.Worker.get_Clone();b4.StartRunner();b5=(b6=_.ofSeq(bX.Data.EventGroups),bf.nth(bX.EditorSelectorEdit.get_SelectedIndexInGroup(),b6));bX.Data.RegisterEvent(_8.UniqueKey(),b5,b4);})):bZ===0?bj.Set(bX.CreatePanel((b2=_.ofSeq(bX.Data.WidgetGroups),bf.nth(bX.EditorSelectorEdit.get_SelectedIndexInGroup(),b2)),"Panel",null).IsWithInitialAutoLayout,true):bZ===2?(b3=_.ofSeq(bX.Data.RulesGroups),bf.nth(bX.EditorSelectorEdit.get_SelectedIndexInGroup(),b3)).RulesRowItems.Append(B.Create([A.get_Create(),A.get_Create()])):void 0;}),bX.EditorSelectorEdit.get_Render()])])]),bp.Element("div",[],[bX.Dialog.get_Render()])]):bp.Element("div",[],[bp.Element("table",[bu.Style("White-space","nowrap")],[bp.Element("tr",[],[bp.Element("td",[bu.Style("vertical-align","top")],[_8.IconNormal("dehaze",function(){bj.Set(bX.PanelTitleVisibility,true);bj.Set(bX.Mode,{$:1});}),bX.EditorSelectorRun.get_RenderMenu()]),bp.Element("td",[],[bX.EditorSelectorRun.get_Render()])])])]);},this.Mode.v));},Restore:function(bW,bX,bY,bZ){var b0,b1,b2,b3,b4,b5,b6,b7;function b8(b9,b_){b_.Reconnect(b6);}b0=this;b1=h.Agent();b1.mailbox.AddLast(m.Stop);b1.resume();this.EditorSelectorRun.ClearGroups();this.EditorSelectorEdit.ClearGroups();this.Data.get_Clear();this.PropertyGrid.Edit(_.T.Empty);b2=this.EditorSelectorRun.GroupByIndex(0);b3=this.EditorSelectorEdit.GroupByIndex(0);b4=this.EditorSelectorEdit.GroupByIndex(1);b5=this.EditorSelectorEdit.GroupByIndex(2);_.iteri(function(b9,b_){var b$,ca;function cb(cc,cd,ce){b0.RegisterWidget(cc,ca,cd,bf.find(function(cf){return cf.Key===cd;},_.ofSeq(ca.PanelContainer.PanelItems)).Children,(ce.StartRunner(),ce));}b$=K.PanelGroupCreator(b0.Data,bW,null);bj.Set(b$.WebSharper_Community_Dashboard_ISelectorItem$get_Name(),b_[0]);b3.SelectorItems.Append(b$);b2.SelectorItems.Append(b$);ca=bf.nth(b9,_.ofSeq(b0.Data.WidgetGroups));_.iter(function(cc){var cd;cd=b0.CreatePanel(ca,"Panel",{$:1,$0:cc.Key});bj.Set(cd.Left,cc.Left);bj.Set(cd.Top,cc.Top);},b_[1]);return _.iter(function(cc){return cb(cc[0],cc[1],cc[2]);},b_[2]);},bY);bx.log("Widgets restored");_.iteri(function(b9,b_){var b$,ca;function cb(cc,cd){b0.Data.RegisterEvent(cc,ca,cd);}b$=K.EventsGroupCreator(b0.Data,b0.PropertyGrid,null);bj.Set(b$.WebSharper_Community_Dashboard_ISelectorItem$get_Name(),b_[0]);b4.SelectorItems.Append(b$);ca=bf.nth(b9,_.ofSeq(b0.Data.EventGroups));return _.iter(function(cc){return cb(cc[0],cc[1]);},b_[1]);},bX);bx.log("Events restored");_.iteri(function(b9,b_){var b$;b$=K.RulesGroupCreator(b0.Data,null);bj.Set(b$.WebSharper_Community_Dashboard_ISelectorItem$get_Name(),b_[0]);b5.SelectorItems.Append(b$);return J.Restore(b0.Data,bf.nth(b9,_.ofSeq(b0.Data.RulesGroups)).RulesRowItems,b_[1]);},bZ);this.Data.WidgetGroups.get_Length()>0?(bj.Set(this.EditorSelectorEdit.OptSelectedItem,{$:1,$0:_.head(_.ofSeq(this.EditorSelectorEdit.GroupByIndex(0).SelectorItems))}),bj.Set(this.EditorSelectorRun.OptSelectedItem,{$:1,$0:_.head(_.ofSeq(this.EditorSelectorRun.GroupByIndex(0).SelectorItems))})):(bj.Set(this.EditorSelectorEdit.OptSelectedItem,null),bj.Set(this.EditorSelectorRun.OptSelectedItem,null));b6=_.map(function(b9){return b9.Worker;},_.ofSeq(this.Data.WorkItems));_.iter(function(b9){return b8(b9[0],b9[1]);},bZ);b7=h.Agent();b7.mailbox.AddLast(m.Start);b7.resume();bx.log("Connectors restored");return[_.concat(_.map(function(b9){return _.map(function(b_){return b_.Worker;},_.ofSeq(b9.EventItems));},_.ofSeq(this.Data.EventGroups))),_.concat(_.map(function(b9){return _.map(function(b_){return b_.Widget;},_.ofSeq(b9.WidgetItems));},_.ofSeq(this.Data.WidgetGroups)))];},Store:function(bW){function bX(bZ,b0){var b1;b1=bW(b0);return b1==null?bZ:new _.T({$:1,$0:[b0.Key,b1.$0],$1:bZ});}function bY(bZ,b0,b1){var b2;b2=bW(b1);return b2==null?bZ:new _.T({$:1,$0:[b1.Key,b0,b2.$0],$1:bZ});}return[_.map(function(bZ){return[bZ.Name.c,_.rev(bf.fold(function(b0,b1){return bX(b0,b1.Worker);},_.T.Empty,_.ofSeq(bZ.EventItems)))];},_.ofSeq(this.Data.EventGroups)),_.map(function(bZ){return[bZ.Name.c,_.map(function(b0){return b0.get_PanelData();},_.ofSeq(bZ.PanelContainer.PanelItems)),_.rev(bf.fold(function(b0,b1){return bY(b0,b1.Panel,b1.Widget);},_.T.Empty,_.ofSeq(bZ.WidgetItems)))];},_.ofSeq(this.Data.WidgetGroups)),_.map(function(bZ){return[bZ.Name.c,J.CopyToRules(bZ.RulesRowItems)];},_.ofSeq(this.Data.RulesGroups))];},CreatePanel:function(bW,bX,bY){var bZ,b0,b1,b2,b3,b4;bZ=this;bp.ConvertBy(bW.WidgetItems.key,function(b5){return bp.Element("div",[],[bp.TextView(b5.Widget.Name.v)]);},bW.WidgetItems.v);b0=(b1=(b2=bo.NewGuid(),a.String(b2)),bY==null?b1:bY.$0);b3=by.get_Create().WithLayoutManager(bz.StackPanelLayoutManager()).WithAttributes([bu.Style("border","1px solid white"),bu.Style("display","flex")]);b4=bA.get_Create().WithKey(b0).WithPannelAttrs([bu.Style("position","absolute")]).WithTitle(this.PanelTitleVisibility).WithTitleContent(bp.TextNode(bX)).WithTitleButtons(_.ofArray([bB.New("add",function(b5){var b6,b7;b6=_.ofSeq(bZ.Factory.WidgetItems);b7=bj.Create$1(_.head(b6));bZ.Dialog.ShowDialog("Select widget",bp.Element("div",[],[bp.Select([bu.Class("form-control")],function(b8){return b8.Worker.Name.c;},b6,b7)]),function(){var b8;bx.log("Dialog.IsOK");b8=b7.c.Worker.get_Clone();b8.StartRunner();bZ.RegisterWidget(_8.UniqueKey(),bW,b5.Key,b5.Children,b8);});}),bB.New("edit",function(b5){bx.log("Edit");bZ.PropertyGrid.Edit(_.concat(_.map(function(b6){return b6.Widget.get_Properties();},_.filter(function(b6){return b6.Panel===b5.Key;},_.ofSeq(bW.WidgetItems)))));}),bB.New("clear",function(b5){bW.PanelContainer.PanelItems.Remove(bW.PanelContainer.FindPanelItem(b5));bW.WidgetItems.RemoveBy(function(b6){return b6.Panel===b5.Key;});})])).WithChildPanelContainer(b3);bW.PanelContainer.AddPanel(b4);return b4;},RegisterWidget:function(bW,bX,bY,bZ,b0){var b1;this.Data.RegisterWidget(bW,bX,bY,b0);b1=bA.get_Create().WithPanelContent(b0.get_Render());bj.Set(b1.IsWithTitle,false);bZ.AddPanel(b1);}},null,L);L.Create=function(bW){var bX,bY,bZ,b0,b1,b2;function b3(){return K.PanelGroupCreator(bY,bW,void 0);}function b4(){return K.EventsGroupCreator(bY,bZ,void 0);}function b5(){return K.RulesGroupCreator(bY,void 0);}bX=bC.get_Create();bY=I.get_Create();bZ=bD.get_Create();b0=D.get_Create();b1=D.get_Create().WithGroupOnClick(function(b6){bZ.Edit(_.mapi(function(b7,b8){var b9;return bl.string((b9=b7+1,a.String(b9)),b8.WebSharper_Community_Dashboard_ISelectorItem$get_Name());},_.ofSeq(b6.SelectorItems)));}).WithItemOnSelected(function(){bZ.Edit(_.T.Empty);}).WithItemOnCreated(function(b6){return function(b7){return b6===0?_.head(_.ofSeq(b0.SelectorGroups)).SelectorItems.Append(b7):null;};}).WithItemOnDeleted(function(){return function(){return null;};}).WithItemOnDeleted(function(b6){return function(b7){b7 instanceof G?bY.WidgetGroups.Remove(b7):b7 instanceof F?bY.EventGroups.Remove(b7):b7 instanceof H?bY.RulesGroups.Remove(b7):_6.FailWith("WithItemOnDeleted, type unknown");return b6===0?_.head(_.ofSeq(b0.SelectorGroups)).SelectorItems.Remove(b7):null;};}).WithItemOnMove(_5.Curried3(function(b6,b7,b8){var b9;b9=b8.$==1&&true;return b7 instanceof G?(_8.MoveItemInModelList(bY.WidgetGroups,b9,b7),_8.MoveItemInModelList(_.head(_.ofSeq(b0.SelectorGroups)).SelectorItems,b9,b7)):b7 instanceof F?_8.MoveItemInModelList(bY.EventGroups,b9,b7):b7 instanceof H?_8.MoveItemInModelList(bY.RulesGroups,b9,b7):_6.FailWith("WithItemOnDeleted, type unknown");})).WithControls(true);b2=b3();b1.AppenGroup("Panels",_.ofArray([b2]),{$:1,$0:b3});b0.AppenGroup("Panels",_.ofArray([b2]),null);b1.AppenGroup("Events",_.ofArray([b4()]),{$:1,$0:b4});b1.AppenGroup("Rules",_.ofArray([b5()]),{$:1,$0:b5});bj.Set(b1.OptSelectedItem,{$:1,$0:_.head(_.ofSeq(b1.GroupByIndex(0).SelectorItems))});bj.Set(b0.OptSelectedItem,{$:1,$0:_.head(_.ofSeq(b0.GroupByIndex(0).SelectorItems))});return L.New(z.get_Create(),bY,bZ,bX,b0,b1,bj.Create$1({$:0}),bj.Create$1(false));};L.New=function(bW,bX,bY,bZ,b0,b1,b2,b3){return new L({Factory:bW,Data:bX,PropertyGrid:bY,Dialog:bZ,EditorSelectorRun:b0,EditorSelectorEdit:b1,Mode:b2,PanelTitleVisibility:b3});};N=M.RandomEvent=_5.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bW){var bX;new bE.New();$.Start((bX=null,$.Delay(function(){return $.While(function(){return true;},$.Delay(function(){return $.Bind($.Sleep(bW.InPorts.get_Item(2).get_Number()*1000>>0),function(){var bY,bZ,b0;bY=bW.InPorts.get_Item(0).get_Number();bZ=bW.InPorts.get_Item(1).get_Number();b0=bF.random()*bZ+bY;bW.OutPorts.get_Item(0).Trigger(new i({$:0,$0:b0}));return $.Zero();});}));})),null);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.RandomEventData;}},null,N);N.get_FromWorker=function(){return function(bW){return N.New(bW.get_ToData());};};N.get_Create=function(){return N.New(s.Create("Random",_.ofArray([p.CreateNumber("Middle value",100),p.CreateNumber("Dispersion",10),p.CreateNumber("Delay sec.",2)]),_.ofArray([r.Create("Random value")])));};N.New=function(bW){return new N({RandomEventData:bW});};O.New=function(bW){return{DatabaseEventRun:bW};};P=M.DatabaseEvent=_5.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bW){var bX,bY;bX=true;bY=bW.InPorts.get_Item(0).PortValue.c.Time;bi.Sink(function(bZ){var b0;b0=bW.InPorts.get_Item(1).get_String();bX?(_.iter(function(b1){var b2;b2=h.Agent();b2.mailbox.AddLast({$:0,$0:b1});b2.resume();},(new bb.New()).Sync("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.Events.ServerDatabase.ReadAllMessages:965639103",[b0])),bX=false):bZ.Time>bY?(new bb.New()).Send("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.Events.ServerDatabase.WriteMessage:-353093100",[b0,bZ]):void 0;},bW.InPorts.get_Item(0).PortValue.v);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.DatabaseEventData;}},null,P);P.get_FromWorker=function(){return function(bW){return P.New(bW.get_ToData());};};P.get_Create=function(){return P.New(s.Create("Database",_.ofArray([p.CreateNumber(" in Value",100),p.CreateString("Database name","Database.txt")]),_.T.Empty));};P.New=function(bW){return new P({DatabaseEventData:bW});};R.New=function(bW,bX,bY,bZ,b0){return{Title:bW,Description:bX,ImageUrl:bY,Temperature:bZ,TemparatureMinMax:b0};};Q.get=function(bW,bX){var bY;bY=null;return $.Delay(function(){var bZ;bZ=(((_5.Curried3(function(b0,b1,b2){return b0("http://api.openweathermap.org/data/2.5/weather?q="+bc.toSafe(b1)+"&units=metric&appid="+bc.toSafe(b2));}))(a.id))(bX))(bW);(e.Log())("get key city "+bZ);return $.TryWith($.Delay(function(){return $.Bind(bH.AsyncMap(bL.asyncReadTextAtRuntime(false,"C:\\Users\\jaipr\\Source\\Repos\\WebSharper.Community.Dashboard\\WebSharper.Community.Dashboard","","JSON","",bZ),function(b0){return bt.Equals(typeof b0,"string")?bM.parse(b0):b0;}),function(b0){var b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl;(e.Log())("get key city 2");return $.Return((b1=bN.tryHead(b0.weather),b1==null?null:{$:1,$0:(b2=b1.$0,R.New((((_5.Curried3(function(cm,cn,co){return cm(bc.toSafe(cn)+", "+bc.toSafe(co));}))(a.id))((b4=(b3="name",b3 in b0?{$:1,$0:b0[b3]}:null),b4==null?null:b4.$0)))((b7=(b5=b0.sys,(b6="country",b6 in b5?{$:1,$0:b5[b6]}:null)),b7==null?null:b7.$0)),(b9=(b8="main",b8 in b2?{$:1,$0:b2[b8]}:null),b9==null?null:b9.$0),(function(cm){return function(cn){return cm("http://openweathermap.org/img/w/"+bc.toSafe(cn)+".png");};}(a.id))((b$=(b_="icon",b_ in b2?{$:1,$0:b2[b_]}:null),b$==null?null:b$.$0)),(ca=(cb=b0.main,(cc="temp",cc in cb?{$:1,$0:cb[cc]}:null)),(cd=ca==null?null:{$:1,$0:1*ca.$0},cd==null?null:cd.$0)),[(ce=(cf=b0.main,(cg="temp_min",cg in cf?{$:1,$0:cf[cg]}:null)),(ch=ce==null?null:{$:1,$0:1*ce.$0},ch==null?null:ch.$0)),(ci=(cj=b0.main,(ck="temp_max",ck in cj?{$:1,$0:cj[ck]}:null)),(cl=ci==null?null:{$:1,$0:1*ci.$0},cl==null?null:cl.$0))]))}));});}),function(b0){(e.Log())(b0.message);return $.Return(null);});});};S=M.OpenWeatherEvent=_5.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bW){var bX;$.Start((bX=null,$.Delay(function(){return $.While(function(){return true;},$.Delay(function(){var bY,bZ,b0;bY=bW.InPorts.get_Item(0);bZ=bW.InPorts.get_Item(1);b0=bW.OutPorts.get_Item(0);return $.Bind(Q.get(bZ.get_String(),bY.get_String()),function(b1){return $.Combine(b1==null?$.Zero():((e.Log())("Value generated:"+b1.$0.Title),b0.Trigger(new i({$:0,$0:+b1.$0.Temperature})),$.Zero()),$.Delay(function(){return $.Bind($.Sleep(1000*15),function(){return $.Return(null);});}));});}));})),null);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.OpenWeatherEventData;}},null,S);S.get_FromWorker=function(){return function(bW){return S.New(bW.get_ToData());};};S.Create=function(bW,bX){return S.New(s.Create("OpenWeatherMap",_.ofArray([p.CreateString("City",bW),p.CreateString("ApiKey",bX)]),_.ofArray([r.Create("Temperature")])));};S.New=function(bW){return new S({OpenWeatherEventData:bW});};T=M.ClockEvent=_5.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bW){var bX;$.Start((bX=null,$.Delay(function(){return $.While(function(){return true;},$.Delay(function(){var bY,bZ,b0;bY=(bW.InPorts.get_Item(0).PortValue.c.Value.get_AsSelect())[0];bZ=_9.now();b0=bY===0?bO.LongTime(bZ):bY===1?bO.ShortTime(bZ):bY===2?bO.LongDate(bZ):bY===3?(new _9(bZ)).toLocaleDateString():"";bW.OutPorts.get_Item(0).Trigger(new i({$:1,$0:b0}));return $.Bind($.Sleep(bW.InPorts.get_Item(1).get_Number()*1000>>0),function(){return $.Return(null);});}));})),null);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.ClockEventData;}},null,T);T.get_FromWorker=function(){return function(bW){return T.New(bW.get_ToData());};};T.get_Create=function(){return T.New(s.Create("Clock",_.ofArray([p.CreateSelect("Format",[0,_.ofArray(["long time","short time","long date","short date"])]),p.CreateNumber("Delay sec.",1)]),_.ofArray([r.Create("Date Time")])));};T.New=function(bW){return new T({ClockEventData:bW});};V=U.TextBoxWidget=_5.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bW){var bX,bY,bZ,b0;bX=bi.Map(function(b1){var b2,b3;b2=b1.Value;return b2.$==0?(b3=b2.$0>>0,a.String(b3)):b2.$==1?b2.$0:b2.$==2?a.String(b2.$0):"Wrong port value format";},bW.InPorts.get_Item(0).PortValue.v);bY=bi.Map(function(b1){var b2;return(b2=b1.Value.get_AsNumber(),a.String(b2))+"px";},bW.InPorts.get_Item(1).PortValue.v);bZ=bi.Map(function(b1){var b2;return(b2=b1.Value.get_AsNumber(),a.String(b2))+"px";},bW.InPorts.get_Item(2).PortValue.v);b0=bi.Map(function(b1){var b2;b2=b1.Value.get_AsSelect();return b2[1].get_Item(b2[0]);},bW.InPorts.get_Item(3).PortValue.v);return bp.Element("div",[bu.Class("bigvalue"),bu.DynamicStyle("width",bY),bu.DynamicStyle("font-size",bZ),bu.DynamicStyle("font-family",b0)],[bp.TextView(bX)]);}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.TextBoxWidgetData;}},null,V);V.get_FromWorker=function(){return function(bW){return V.New(bW.get_ToData());};};V.get_Create=function(){return V.New(s.Create("Text",_.ofArray([p.CreateString("in Text","txt"),p.CreateNumber("Width",200),p.CreateNumber("Font-Size",100),p.CreateSelect("Font-Family",[0,_.ofArray(["Times New Roman","Courier New","Arial","Freestyle Script"])])]),_.T.Empty));};V.New=function(bW){return new V({TextBoxWidgetData:bW});};W.New=function(bW,bX){return{LineChart:bW,Sources:bX};};X=U.ChartWidget=_5.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bW){var bX,bY,bZ,b0,b1,b2,b3,b4,b5;(e.Log())("Chart Render");bX=bW.InPorts.get_Item(3).get_Number()>>0;bY=bW.RunnerContext.c.$0;bZ=(b0={},b0.title=(b1={},b1.display=false,b1),b0.legend=(b2={},b2.display=false,b2),b0.elements=(b3={},b3.point=(b4={},b4.radius=0,b4),b3.line=(b5={},b5.borderWidth=1,b5),b3),b0);return bR.Render$2(bY.LineChart,{$:1,$0:{$:0,$0:bW.InPorts.get_Item(1).get_Number()>>0,$1:bW.InPorts.get_Item(2).get_Number()>>0}},{$:1,$0:bZ},{$:1,$0:bX});}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){var bW;bW=this;return{$:1,$0:function(bX){var bY,bZ,b0,b1;function b2(b3,b4){var b5,b6,b7;b5=(bX.InPorts.get_Item(4).PortValue.c.Value.get_AsSelect())[0];b6=(b7=b4.Time,b5===0?bO.LongTime(b7):b5===1?bO.ShortTime(b7):b5===2?bO.LongDate(b7):b5===3?(new _9(b7)).toLocaleDateString():"");(e.Log())("Chart observe "+b6);return bY.get_Item(bf.findIndex(function(b8){return bt.Equals(b8,b3);},b0)).event.Trigger([b6,b4.Value.get_AsNumber()]);}(e.Log())("Chart run");bX.InPorts.get_Item(3).get_Number();bY=_.init((bW.ChartWidgetData.InPorts.get_Item(5).Value.Value.get_AsNumber()>>0)+1,function(){return new bS.New();});bZ=(_.splitAt(6,bX.InPorts))[1];b0=new _.T({$:1,$0:bX.InPorts.get_Item(0),$1:bZ});b1=bT.Combine(_.ofSeq(bf.delay(function(){return bf.map(function(b3){return bU.Line$1(b3.event).WithFill(false).__WithStrokeColor(new bV.Color({$:1,$0:"#FB8C00"})).__WithPointColor(new bV.Color({$:2,$0:"black"}));},bY);})));_.iter(function(b3){bi.Sink(function(b4){return b2(b3,b4);},b3.PortValue.v);},b0);return{$:1,$0:W.New(b1,bY)};}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){var bW,bX,bY,bZ,b0;bW=this;bX=this.ChartWidgetData.InPorts.get_Item(3).Value.Value.get_AsNumber()>>0;bY=(this.ChartWidgetData.InPorts.get_Item(5).Value.Value.get_AsNumber()>>0)+6;b0=this.ChartWidgetData;return s.New(b0.WorkerName,_.mapi(function(b1,b2){return b1===0||b1>5?b2.WithCacheSize(bX):b2;},bY<this.ChartWidgetData.InPorts.get_Length()?(_.splitAt(bY,this.ChartWidgetData.InPorts))[0]:bY>this.ChartWidgetData.InPorts.get_Length()?(bZ=this.ChartWidgetData.InPorts.get_Length()-6+1,_.append(this.ChartWidgetData.InPorts,_.ofSeq(bf.delay(function(){return bf.map(function(b1){var b2;return p.CreateNumber(" in Value "+(b2=bZ+b1,a.String(b2)),0).WithCacheSize(bX);},_6.range(0,bY-bW.ChartWidgetData.InPorts.get_Length()-1));})))):this.ChartWidgetData.InPorts),b0.OutPorts);}},null,X);X.get_FromWorker=function(){return function(bW){return X.New(bW.get_ToData());};};X.get_Create=function(){var bW;bW=20;return X.New(s.Create("Chart",_.ofArray([p.CreateNumber(" in Value",100).WithCacheSize(bW),p.CreateNumber("cx",300),p.CreateNumber("cy",150),p.CreateNumber("BufferSize",bW),p.CreateSelect("X-Axis",[0,_.ofArray(["long time","short time","long date","short date"])]),p.CreateNumber("Number of additional ports",0)]),_.T.Empty));};X.New=function(bW){return new X({ChartWidgetData:bW});};Y=U.ButtonWidget=_5.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bW){return bp.ButtonView(bW.InPorts.get_Item(0).get_String(),[],bW.InPorts.get_Item(1).get_BooleanView(),function(bX){bW.OutPorts.get_Item(0).Trigger(new i({$:2,$0:bX}));});}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.ButtonWidgetData;}},null,Y);Y.get_FromWorker=function(){return function(bW){return Y.New(bW.get_ToData());};};Y.get_Create=function(){return Y.New(s.Create("Button",_.ofArray([p.CreateString("Caption","Button"),p.CreateNumber("State",0)]),_.ofArray([r.Create("Button value")])));};Y.New=function(bW){return new Y({ButtonWidgetData:bW});};Z.FromWorker=function(bW){var bX;bX=bW.Data;return bX instanceof N?{$:1,$0:{$:0,$0:(N.get_FromWorker())(bW)}}:bX instanceof T?{$:1,$0:{$:1,$0:(T.get_FromWorker())(bW)}}:bX instanceof S?{$:1,$0:{$:2,$0:(S.get_FromWorker())(bW)}}:bX instanceof P?{$:1,$0:{$:3,$0:(P.get_FromWorker())(bW)}}:bX instanceof V?{$:1,$0:{$:4,$0:(V.get_FromWorker())(bW)}}:bX instanceof X?{$:1,$0:{$:5,$0:(X.get_FromWorker())(bW)}}:bX instanceof Y?{$:1,$0:{$:6,$0:(Y.get_FromWorker())(bW)}}:null;};Z.ToWorker=function(bW){return bW.$==1?t.Create(bW.$0):bW.$==2?t.Create(bW.$0):bW.$==3?t.Create(bW.$0):bW.$==4?t.Create(bW.$0):bW.$==5?t.Create(bW.$0):bW.$==6?t.Create(bW.$0):t.Create(bW.$0);};_0.CreateDashboard=function(){_1.$cctor();return _1.CreateDashboard;};_0.PanelContainerCreator=function(bW){return by.get_Create().WithLayoutManager(bz.FloatingPanelLayoutManager(5)).WithWidth(2800).WithHeight(2420).WithAttributes([]);};_0.RegisterAppModelLib=function(bW){function bX(bZ){_0.RegisterEventGeneral(bW,bZ);}function bY(bZ){_0.RegisterWidgetGeneral(bW,bZ);}bX(S.Create("London",""));bX(N.get_Create());bX(T.get_Create());bX(P.get_Create());bY(V.get_Create());bY(X.get_Create());bY(Y.get_Create());return bW;};_0.RegisterWidgetGeneral=function(bW,bX){var bY;_0.Register((bY=bW.Factory,function(bZ){bY.RegisterWidget(bZ);}),bX);};_0.RegisterEventGeneral=function(bW,bX){var bY;_0.Register((bY=bW.Factory,function(bZ){bY.RegisterEvent(bZ);}),bX);};_0.Register=function(bW,bX){return bW(t.Create(bX));};_1.$cctor=function(){_1.$cctor=a.ignore;_1.CreateDashboard=_0.RegisterAppModelLib(L.Create(function(){return _0.PanelContainerCreator();}));};_2.RecreatWidgetsOnServer=function(bW,bX){function bY(b0,b1,b2){return b2;}function bZ(b0,b1,b2){return b2;}return _.map(function(b0){return bY(b0[0],b0[1],b0[2]);},_.concat(_.map(function(b0){return bZ(b0[0],b0[1],b0[2]);},_2.RecreateWidgets(bW,bX))));};_2.RecreateEventsOnServer=function(bW,bX){function bY(b0,b1){return b1;}function bZ(b0,b1){return b1;}return _.map(function(b0){return bY(b0[0],b0[1]);},_.concat(_.map(function(b0){return bZ(b0[0],b0[1]);},_2.RecreateEvents(bW,bX))));};_2.RecreateOnClient=function(bW,bX,bY,bZ,b0,b1,b2){var b3;e.set_Role(f.Client);b3=h.Agent();b3.mailbox.AddLast({$:3,$0:function(b4){(new bb.New()).Send("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.MessageBus.SendToServer:-1358505674",[b4]);}});b3.resume();_.iter(bW,(bX.Restore(bY,_2.RecreateEvents(bZ,b0),_2.RecreateWidgets(bZ,b1),b2))[0]);};_2.RecreateWidgets=function(bW,bX){function bY(bZ,b0,b1){function b2(b3,b4,b5){return[b3,b4,bW(b5)];}return[bZ,b0,_.map(function(b3){return b2(b3[0],b3[1],b3[2]);},b1)];}return _.map(function(bZ){return bY(bZ[0],bZ[1],bZ[2]);},bX);};_2.RecreateEvents=function(bW,bX){function bY(bZ,b0){function b1(b2,b3){return[b2,bW(b3)];}return[bZ,_.map(function(b2){return b1(b2[0],b2[1]);},b0)];}return _.map(function(bZ){return bY(bZ[0],bZ[1]);},bX);};_3=d.AppData=_5.Class({RecreateOnServer:function(bW,bX){var bY,bZ,b0;function b1(b2,b3){b3.Reconnect(bY);}bY=_.append(_2.RecreateEventsOnServer(bX,this.Events),_2.RecreatWidgetsOnServer(bX,this.Widgets));_.iter(function(b2){return b1(b2[0],b2[1]);},this.Rules);_.iter(function(b2){b2.StartRunner();},bY);bZ={$:0,$0:h.CreateMessage(new i({$:4,$0:{$:0,$0:bW}})).WithKey("system")};b0=h.Agent();b0.mailbox.AddLast(bZ);b0.resume();return bY;},RecreateOnClientEventsRunning:function(bW,bX,bY){_2.RecreateOnClient(function(bZ){bZ.StartRunner();},bW,bX,bY,this.Events,this.Widgets,this.Rules);},RecreateOnClientEventsNotRunning:function(bW,bX,bY){_2.RecreateOnClient(a.ignore,bW,bX,bY,this.Events,this.Widgets,this.Rules);}},null,_3);_3.Create=function(bW,bX){var bY;bY=bW.Store(bX);return _3.New(bY[0],bY[1],bY[2]);};_3.empty=function(){return _3.New(_.T.Empty,_.T.Empty,_.T.Empty);};_3.New=function(bW,bX,bY){return new _3({Events:bW,Widgets:bX,Rules:bY});};}());
