(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn;a=window.WebSharper=window.WebSharper||{};b=a.Community=a.Community||{};c=b.Dashboard=b.Dashboard||{};d=c.EmptyTrigger=c.EmptyTrigger||{};e=c.NumberTrigger=c.NumberTrigger||{};f=c.NumberValue=c.NumberValue||{};g=c.StringValue=c.StringValue||{};h=c.InPort=c.InPort||{};i=c.OutPort=c.OutPort||{};j=c.PortConnector=c.PortConnector||{};k=c.Ports=c.Ports||{};l=c.Worker=c.Worker||{};m=c.RandomRunner=c.RandomRunner||{};n=c.OpenWeather=c.OpenWeather||{};o=n.Forecast=n.Forecast||{};p=c.OpenWeatherRunner=c.OpenWeatherRunner||{};q=c.ChartRunnerContext=c.ChartRunnerContext||{};r=c.ChartRenderer=c.ChartRenderer||{};s=c.TextBoxRenderer=c.TextBoxRenderer||{};t=c.WorkerItem=c.WorkerItem||{};u=c.Factory=c.Factory||{};v=c.PortConnectorItem=c.PortConnectorItem||{};w=c.WidgetItem=c.WidgetItem||{};x=c.DshData=c.DshData||{};y=c.DshEditorCellItem=c.DshEditorCellItem||{};z=c.DshEditorRowItem=c.DshEditorRowItem||{};A=c.DshEditor=c.DshEditor||{};B=c.DshEditorCellData=c.DshEditorCellData||{};C=c.DshEditorRowData=c.DshEditorRowData||{};D=c.DshEditorData=c.DshEditorData||{};E=c.Dashboard=c.Dashboard||{};F=window.IntelliFactory;G=F&&F.Runtime;H=a&&a.Guid;I=a&&a.Operators;J=b&&b.PropertyGrid;K=J&&J.Properties;L=a&&a.UI;M=L&&L.Next;N=M&&M.Var;O=a&&a.Control;P=O&&O.FSharpEvent;Q=window.console;R=a&&a.Unchecked;S=a&&a.List;T=M&&M.Doc;U=b&&b.Panel;V=U&&U.Helper;W=a&&a.Random;X=a&&a.Concurrency;Y=window.Math;Z=a&&a.PrintfHelpers;_0=a&&a.Data;_1=_0&&_0.TxtRuntime;_2=window.FSharp;_3=_2&&_2.Data;_4=_3&&_3.Runtime;_5=_4&&_4.IO;_6=window.JSON;_7=a&&a.Arrays;_8=a&&a.Charting;_9=_8&&_8.Renderers;_=_9&&_9.ChartJs;$=a&&a.Seq;ba=_8&&_8.Chart;bb=_8&&_8.Pervasives;bc=M&&M.View;bd=M&&M.AttrModule;be=M&&M.Key;bf=M&&M.ListModel;bg=a&&a.Option;bh=a&&a.Enumerator;bi=U&&U.PanelContainer;bj=U&&U.LayoutManagers;bk=U&&U.Panel;bl=U&&U.TitleButton;bm=U&&U.Dialog;bn=J&&J.PropertyGrid;d.New=function(bo){return{EmptyTrigger:bo};};e=c.NumberTrigger=G.Class({Trigger:function(bo){this.NumberEvent.event.Trigger(bo);}},null,e);e.New=function(bo){return new e({NumberEvent:bo});};f.Create=function(bo){var bp;return f.New((bp=H.NewGuid(),window.String(bp)),bo);};f.New=function(bo,bp){return{Key:bo,NumberValue:bp};};g.Create=function(bo){var bp;return g.New((bp=H.NewGuid(),window.String(bp)),bo);};g.New=function(bo,bp){return{Key:bo,StringValue:bp};};h=c.InPort=G.Class({Equals:function(bo){return bo instanceof h&&this.Name===bo.Name;},get_StringValue:function(){var bo;bo=this;return this.ExtractPortStringValue(function(bp){return g.New(bo.Key,bp.c);});},get_StringVar:function(){return this.ExtractPortStringValue(window.id);},get_String:function(){return this.ExtractPortStringValue(function(bo){return bo.c;});},ExtractPortStringValue:function(bo){var bp;bp=this.PortValue;return bp.$==2?bo(bp.$0.StrValue):I.FailWith("unexpected type");},get_NumberValue:function(){var bo;bo=this;return this.ExtractPortNumberValue(function(bp){return f.New(bo.Key,bp.c);});},get_NumberVar:function(){return this.ExtractPortNumberValue(window.id);},get_Number:function(){return this.ExtractPortNumberValue(function(bo){return bo.c;});},ExtractPortNumberValue:function(bo){var bp;bp=this.PortValue;return bp.$==1?bo(bp.$0.NumValue):I.FailWith("unexpected type");},get_Property:function(){var bo;bo=this.PortValue;return bo.$==1?K["double"](this.Name,bo.$0.NumValue):bo.$==2?K.string(this.Name,bo.$0.StrValue):K.group(this.Name);},get_Clone:function(){var bo,bp;return h.New((bo=H.NewGuid(),window.String(bo)),this.Name,this.Disconnector,this.Disconnect,this.OutPort,(bp=this.PortValue,bp.$==1?{$:1,$0:{NumValue:N.Create$1(bp.$0.NumValue.c)}}:bp.$==2?{$:2,$0:{StrValue:N.Create$1(bp.$0.StrValue.c)}}:{$:0,$0:bp.$0}));}},null,h);h.New=function(bo,bp,bq,br,bs,bt){return new h({Key:bo,Name:bp,Disconnector:bq,Disconnect:br,OutPort:bs,PortValue:bt});};i=c.OutPort=G.Class({Equals:function(bo){return bo instanceof i&&this.Name===bo.Name;}},null,i);i.New=function(bo,bp,bq,br,bs){return new i({Key:bo,Name:bp,IsCompatible:bq,Connect:br,Trigger:bs});};j.Create=function(bo,bp){return j.New(bo.Name+"->"+bp.Name,bp,bo,bo.Connect(bp));};j.New=function(bo,bp,bq,br){return{Name:bo,InPort:bp,OutPort:bq,Disconnect:br};};k.Clone=function(bo){var bp;return bo.Trigger.$==1?k.OutPortNum((bp=H.NewGuid(),window.String(bp)),bo.Name):k.BaseOutPort((bp=H.NewGuid(),window.String(bp)),bo.Name);};k.OutPortNum=function(bo,bp){var bq,br;bq=new P.New();br=k.BaseOutPort(bo,bp);return i.New(br.Key,br.Name,function(bs){return bs.PortValue.$==1&&true;},function(bs){var bt,bu,bv;bt=bs.PortValue;return bt.$==1?(bu=bt.$0,(bs.Disconnect(),bv=function(bw,bx){return N.Set(bu.NumValue,bx);},bq.event.AddHandler(bv),Q.log("Port "+bp+" connected with "+bs.Name),function(){bq.event.RemoveHandler(bv);})):I.FailWith("Unexpected type");},{$:1,$0:e.New(bq)});};k.InPortStr=function(bo,bp){var bq;bq=k.BaseInPort(bp.Key,bo);return h.New(bq.Key,bq.Name,bq.Disconnector,bq.Disconnect,bq.OutPort,{$:2,$0:{StrValue:N.Create$1(bp.StringValue)}});};k.InPortNum=function(bo,bp){var bq;bq=k.BaseInPort(bp.Key,bo);return h.New(bq.Key,bq.Name,bq.Disconnector,bq.Disconnect,bq.OutPort,{$:1,$0:{NumValue:N.Create$1(bp.NumberValue)}});};k.BaseInPort=function(bo,bp){return h.New(bo,bp,function(){},function(){Q.log("Port "+bp+" disconnected");},k.BaseOutPort("","Empty"),{$:0,$0:{Nothing:""}});};k.BaseOutPort=function(bo,bp){return i.New(bo,bp,function(){return false;},function(){return function(){return null;};},{$:0,$0:d.New("")});};k.NumTrigger=function(bo){var bp,bq;bp=bo.Trigger;return bp.$==1?(bq=bp.$0,function(br){bq.Trigger(br);}):I.FailWith("unexpected type");};l=c.Worker=G.Class({Equals:function(bo){return bo instanceof l&&R.Equals(this.Name,bo.Name);},get_Properties:function(){return new S.T({$:1,$0:K.string("Name",this.Name),$1:S.map(function(bo){return bo.get_Property();},this.InPorts)});},get_Render:function(){var bo;bo=this.Renderer;return bo==null?T.Empty():(bo.$0.WebSharper_Community_Dashboard_IRenderer$get_Render())(this);},get_CloneAndRun:function(){var bo,bp,bq;bo=N.Create$1(this.Name.c);bp=S.map(function(br){return br.get_Clone();},this.InPorts);bq=S.map(k.Clone,this.OutPorts);return l.New(V.UniqueKey(),bo,bp,bq,this.Runner,this.Renderer,this.DataContext,null).WithStartRunner();},WithStartRunner:function(){var bo;bo=this.Runner;return bo==null?this:l.New(this.Key,this.Name,this.InPorts,this.OutPorts,this.Runner,this.Renderer,this.DataContext,(bo.$0.WebSharper_Community_Dashboard_IRunner$get_Run())(this));},WithRenderer:function(bo){return l.New(this.Key,this.Name,this.InPorts,this.OutPorts,this.Runner,{$:1,$0:bo},this.DataContext,this.RunnerContext);},WithRunner:function(bo){return l.New(this.Key,this.Name,this.InPorts,this.OutPorts,{$:1,$0:bo},this.Renderer,this.DataContext,this.RunnerContext);},WithKey:function(bo){return l.New(bo,this.Name,this.InPorts,this.OutPorts,this.Runner,this.Renderer,this.DataContext,this.RunnerContext);}},null,l);l.Create=function(bo){var bp;return l.New((bp=H.NewGuid(),window.String(bp)),N.Create$1(bo.WebSharper_Community_Dashboard_IWorkerContext$get_Name()),bo.WebSharper_Community_Dashboard_IWorkerContext$get_InPorts(),bo.WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts(),null,null,bo,null);};l.New=function(bo,bp,bq,br,bs,bt,bu,bv){return new l({Key:bo,Name:bp,InPorts:bq,OutPorts:br,Runner:bs,Renderer:bt,DataContext:bu,RunnerContext:bv});};m=c.RandomRunner=G.Class({WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bo){var bp;new W.New();X.Start((bp=null,X.Delay(function(){return X.While(function(){return true;},X.Delay(function(){return X.Bind(X.Sleep(600),function(){var bq,br,bs;bq=bo.InPorts.get_Item(1).get_Number();br=bo.InPorts.get_Item(0).get_Number();bs=Y.random()*bq+br;(k.NumTrigger(bo.OutPorts.get_Item(0)))(bs);Q.log("Value generated");return X.Zero();});}));})),null);return null;};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return S.ofArray([k.OutPortNum(this.OutPortKey,"Random value")]);},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return S.ofArray([k.InPortNum("Middle value",this.MiddleValue),k.InPortNum("Dispersion",this.Dispersion)]);},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return this.Name;}},null,m);m.get_FromPorts=function(){return function(bo){return m.New(bo.Name.c,bo.InPorts.get_Item(0).get_NumberValue(),bo.InPorts.get_Item(1).get_NumberValue(),bo.OutPorts.get_Item(0).Key);};};m.Create=function(bo,bp){var bq;return m.New("Random",f.Create(bo),f.Create(bp),(bq=H.NewGuid(),window.String(bq)));};m.New=function(bo,bp,bq,br){return new m({Name:bo,MiddleValue:bp,Dispersion:bq,OutPortKey:br});};o.New=function(bo,bp,bq,br,bs){return{Title:bo,Description:bp,ImageUrl:bq,Temperature:br,TemparatureMinMax:bs};};n.get=function(bo,bp){var bq;bq=null;return X.Delay(function(){var br;br=(((G.Curried3(function(bs,bt,bu){return bs("http://api.openweathermap.org/data/2.5/weather?q="+Z.toSafe(bt)+"&units=metric&appid="+Z.toSafe(bu));}))(window.id))(bp))(bo);Q.log("get key city "+br);return X.TryWith(X.Delay(function(){return X.Bind(_1.AsyncMap(_5.asyncReadTextAtRuntime(false,"C:\\Users\\Andrey\\Private\\VS_Projects\\WebSharper.Community.Dashboard\\WebSharper.Community.Dashboard","","JSON","",br),function(bs){return R.Equals(typeof bs,"string")?_6.parse(bs):bs;}),function(bs){var bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP;Q.log("get key city 2");return X.Return((bt=_7.tryHead(bs.weather),bt==null?null:{$:1,$0:(bu=bt.$0,o.New((((G.Curried3(function(bQ,bR,bS){return bQ(Z.toSafe(bR)+", "+Z.toSafe(bS));}))(window.id))((bw=(bv="name",bv in bs?{$:1,$0:bs[bv]}:null),bw==null?null:bw.$0)))((bz=(bx=bs.sys,(by="country",by in bx?{$:1,$0:bx[by]}:null)),bz==null?null:bz.$0)),(bB=(bA="main",bA in bu?{$:1,$0:bu[bA]}:null),bB==null?null:bB.$0),(function(bQ){return function(bR){return bQ("http://openweathermap.org/img/w/"+Z.toSafe(bR)+".png");};}(window.id))((bD=(bC="icon",bC in bu?{$:1,$0:bu[bC]}:null),bD==null?null:bD.$0)),(bE=(bF=bs.main,(bG="temp",bG in bF?{$:1,$0:bF[bG]}:null)),(bH=bE==null?null:{$:1,$0:1*bE.$0},bH==null?null:bH.$0)),[(bI=(bJ=bs.main,(bK="temp_min",bK in bJ?{$:1,$0:bJ[bK]}:null)),(bL=bI==null?null:{$:1,$0:1*bI.$0},bL==null?null:bL.$0)),(bM=(bN=bs.main,(bO="temp_max",bO in bN?{$:1,$0:bN[bO]}:null)),(bP=bM==null?null:{$:1,$0:1*bM.$0},bP==null?null:bP.$0))]))}));});}),function(bs){Q.log(bs.message);return X.Return(null);});});};p=c.OpenWeatherRunner=G.Class({WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bo){var bp;X.Start((bp=null,X.Delay(function(){return X.While(function(){return true;},X.Delay(function(){var bq,br,bs;bq=bo.InPorts.get_Item(0);br=bo.InPorts.get_Item(1);bs=bo.OutPorts.get_Item(0);return X.Bind(n.get(br.get_String(),bq.get_String()),function(bt){return X.Combine(bt==null?X.Zero():(Q.log("Value generated:"+bt.$0.Title),(k.NumTrigger(bs))(+bt.$0.Temperature),X.Zero()),X.Delay(function(){return X.Bind(X.Sleep(1000*15),function(){return X.Return(null);});}));});}));})),null);return null;};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return S.ofArray([k.OutPortNum(this.OutPortKey,"Temperature")]);},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return S.ofArray([k.InPortStr("City",this.OpenWeatherCity),k.InPortStr("ApiKey",this.OpenWeatherApiKey)]);},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return this.Name;}},null,p);p.get_FromPorts=function(){return function(bo){return p.New(bo.Name.c,bo.InPorts.get_Item(0).get_StringValue(),bo.InPorts.get_Item(1).get_StringValue(),bo.OutPorts.get_Item(0).Key);};};p.Create=function(bo,bp){var bq;return p.New("OpenWeatherMap",g.Create(bo),g.Create(bp),(bq=H.NewGuid(),window.String(bq)));};p.New=function(bo,bp,bq,br){return new p({Name:bo,OpenWeatherCity:bp,OpenWeatherApiKey:bq,OutPortKey:br});};q.New=function(bo){return{LineChart:bo};};r=c.ChartRenderer=G.Class({WebSharper_Community_Dashboard_IRenderer$get_Render:function(){return function(bo){return _.Render$8(bo.RunnerContext.$0.LineChart,{$:1,$0:{$:0,$0:bo.InPorts.get_Item(1).get_Number()<<0,$1:bo.InPorts.get_Item(2).get_Number()<<0}},null,null);};},WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bo){var bp,bq,br,bs,bt;bp=bo.InPorts.get_Item(3).get_Number()<<0;bq=S.ofSeq($.delay(function(){return $.map(function(){return 0;},I.range(0,bp-1));}));br=(bs=[],($.iter(function(bu){bs.push(bu);},bq),bs));bt=ba.Line(bq).__WithFillColor(new bb.Color({$:2,$0:"white"}));bc.Sink(function(bu){br.push(bu);br.length>bp?br.shift():void 0;$.iteri(function(bv,bw){return bt.__UpdateData(bv,function(){return bw;});},br);},bo.InPorts.get_Item(0).get_NumberVar().v);return{$:1,$0:q.New(bt)};};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return S.T.Empty;},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return S.ofArray([k.InPortNum("in Value",f.Create(0)),k.InPortNum("cx",this.Cx),k.InPortNum("cy",this.Cy),k.InPortNum("BufferSize",this.ChartBufferSize)]);},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return"Chart";}},null,r);r.get_FromPorts=function(){return function(bo){return r.New(bo.InPorts.get_Item(1).get_NumberValue(),bo.InPorts.get_Item(1).get_NumberValue(),bo.InPorts.get_Item(2).get_NumberValue(),bo.InPorts.get_Item(3).get_NumberValue());};};r.Create=function(bo,bp,bq){return r.New(f.Create(0),f.Create(bo),f.Create(bp),f.Create(bq));};r.New=function(bo,bp,bq,br){return new r({Number:bo,Cx:bp,Cy:bq,ChartBufferSize:br});};s=c.TextBoxRenderer=G.Class({WebSharper_Community_Dashboard_IRenderer$get_Render:function(){return function(bo){var bp;bp=bc.Map(function(bq){var br;br=bq<<0;return window.String(br);},bo.InPorts.get_Item(0).get_NumberVar().v);return T.Element("div",[bd.Class("bigvalue")],[T.TextView(bp)]);};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return S.T.Empty;},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return S.ofArray([k.InPortNum("in Value",this.TextBoxValue)]);},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return"Text";}},null,s);s.get_FromPorts=function(){return function(bo){return s.New(bo.InPorts.get_Item(0).get_NumberValue());};};s.get_Create=function(){return s.New(f.Create(0));};s.New=function(bo){return new s({TextBoxValue:bo});};t.Create=function(bo){return t.New(be.Fresh(),bo);};t.New=function(bo,bp){return{Key:bo,Worker:bp};};u=c.Factory=G.Class({RegisterEvent:function(bo){this.EventItems.Append(t.Create(bo));},RegisterWidget:function(bo){this.WidgetItems.Append(t.Create(bo));}},null,u);u.get_Create=function(){return u.New(bf.Create(function(bo){return bo.Key;},S.T.Empty),bf.Create(function(bo){return bo.Key;},S.T.Empty));};u.New=function(bo,bp){return new u({EventItems:bo,WidgetItems:bp});};v.Create=function(bo){return v.New(be.Fresh(),bo);};v.New=function(bo,bp){return{Key:bo,PortConnector:bp};};w.Create=function(bo,bp){return w.New(be.Fresh(),bo,bp);};w.New=function(bo,bp,bq){return{Key:bo,Panel:bp,Widget:bq};};x=c.DshData=G.Class({ConnectPorts:function(bo,bp){Q.log("Connect ports:"+bo.Name+" "+bp.Name);this.PortConnectorItems.Append(v.Create(j.Create(bo,bp)));},RegisterWidget:function(bo,bp,bq){var br;br=bq.WithKey(bo);this.WidgetItems.Append(w.Create(bp,br));this.WorkItems.Append(t.Create(br));},RegisterEvent:function(bo,bp){var bq;bq=t.Create(bp.WithKey(bo));this.EventItems.Append(bq);this.WorkItems.Append(bq);},get_Clear:function(){this.WorkItems.Clear();this.WidgetItems.Clear();this.EventItems.Clear();this.PortConnectorItems.Clear();}},null,x);x.get_Create=function(){return x.New(bf.Create(function(bo){return bo.Key;},S.T.Empty),bf.Create(function(bo){return bo.Key;},S.T.Empty),bf.Create(function(bo){return bo.Key;},S.T.Empty),bf.Create(function(bo){return bo.Key;},S.T.Empty));};x.New=function(bo,bp,bq,br){return new x({WorkItems:bo,WidgetItems:bp,EventItems:bq,PortConnectorItems:br});};y=c.DshEditorCellItem=G.Class({Render:function(bo,bp){var bq,br,bs,bt,bu;bq=this;bc.Sink(function(bv){var bw;if(bv==null);else{bw=bv.$0;Q.log("Workitem selected");N.Set(bq.OptInPort,S.tryHead(bw.Worker.InPorts));N.Set(bq.OptOutPort,S.tryHead(bw.Worker.OutPorts));bp();}},this.OptWorker.v);bc.Sink(function(){bp();},this.OptInPort.v);bc.Sink(function(){bp();},this.OptOutPort.v);br=(bs=bc.Map(function(bv){var bw;return bv==null?S.ofArray([null]):(bw=S.map(function(bx){return{$:1,$0:bx};},bv.$0.Worker.InPorts),bw.get_Length()>0?bw:S.ofArray([null]));},this.OptWorker.v),(bt=bc.Map(function(bv){var bw;return bv==null?S.ofArray([null]):(bw=S.map(function(bx){return{$:1,$0:bx};},bv.$0.Worker.OutPorts),bw.get_Length()>0?bw:S.ofArray([null]));},this.OptWorker.v),(bu=bc.Map(function(bv){return new S.T({$:1,$0:null,$1:S.map(function(bw){return{$:1,$0:bw};},S.ofSeq(bv))});},bo.WorkItems.v),T.Element("table",[],[T.Element("tr",[],[T.Element("td",[],[T.SelectDyn([bd.Class("form-control")],function(bv){return bg.fold(function(bw,bx){return bx.Name;}," ",bv);},bs,this.OptInPort)]),T.Element("td",[],[T.SelectDyn([bd.Class("form-control")],function(bv){return bg.fold(function(bw,bx){return bx.Worker.Name.c;}," ",bv);},bu,this.OptWorker)]),T.Element("td",[],[T.SelectDyn([bd.Class("form-control")],function(bv){return bg.fold(function(bw,bx){return bx.Name;}," ",bv);},bt,this.OptOutPort)])])]))));return T.Element("td",[bd.Class("td DshEditorCell")],[T.Element("div",[bd.Class("div DshEditorCell")],[T.Element("table",[],[T.Element("tr",[],[T.Element("td",[],[V.IconNormal("add",function(){})]),T.Element("td",[],[br])])])])]);}},null,y);y.get_Create=function(){return y.New(be.Fresh(),N.Create$1(null),N.Create$1(null),N.Create$1(null));};y.New=function(bo,bp,bq,br){return new y({Key:bo,OptInPort:bp,OptWorker:bq,OptOutPort:br});};z=c.DshEditorRowItem=G.Class({Render:function(bo,bp){var bq;bq=this;return T.Element("tr",[],[T.ConvertBy(function(br){return br.Key;},function(br){return br.Render(bo,bp);},this.CellItems.v),V.IconNormal("add",function(){bq.CellItems.Append(y.get_Create());})]);}},null,z);z.get_Create=function(){return z.New(be.Fresh(),bf.Create(function(bo){return bo.Key;},S.T.Empty));};z.New=function(bo,bp){return new z({Key:bo,CellItems:bp});};A=c.DshEditor=G.Class({Render:function(bo){var bp;bp=this;return T.Element("table",[],[T.ConvertBy(function(bq){return bq.Key;},function(bq){return T.Element("tr",[],[bq.Render(bo,function(){bp.Reconnect(bo);})]);},this.RowItems.v),T.Element("tr",[],[T.Element("td",[],[V.IconNormal("add",function(){bp.RowItems.Append(z.get_Create());})])])]);},Recreate:function(bo){this.RowItems.Clear();},Restore:function(bo,bp){var bq,br,bs;function bt(bu){return S.concat(S.map(function(bv){return bu(bv.Worker);},S.ofSeq(bo.WorkItems)));}bq=this;this.RowItems.Clear();br=bt(function(bu){return bu.OutPorts;});bs=bt(function(bu){return bu.InPorts;});S.iter(function(bu){var bv;bv=z.get_Create();S.iter(function(bw){var bx;bx=y.get_Create();N.Set(bx.OptWorker,$.tryFind(function(by){return by.Worker.Key===bw.CellWorkerKey;},S.ofSeq(bo.WorkItems)));N.Set(bx.OptInPort,$.tryFind(function(by){return by.Key===bw.CellInPortKey;},bs));N.Set(bx.OptOutPort,$.tryFind(function(by){return by.Key===bw.CellOutPortKey;},br));bv.CellItems.Append(bx);},bu.DshEditorCells);bq.RowItems.Append(bv);},bp.DshEditorRows);this.Reconnect(bo);},Reconnect:function(bo){$.iter(function(bp){bp.PortConnector.Disconnect();},bo.PortConnectorItems);bo.PortConnectorItems.Clear();S.iter(function(bp){var bq,br,bs;bq=S.ofSeq(bp.CellItems);br=S.ofSeq(I.range(1,bq.get_Length()-1));bs=bh.Get(br);try{while(bs.MoveNext())(function(){var bt,bu,bv,bw,bx;bt=bs.Current();bu=bq.get_Item(bt-1);bv=bq.get_Item(bt);bw=bu.OptOutPort.c,bw==null?null:{$:1,$0:(bx=bv.OptInPort.c,bx==null?null:{$:1,$0:bo.ConnectPorts(bw.$0,bx.$0)})};}());}finally{if("Dispose"in bs)bs.Dispose();}},S.ofSeq(this.RowItems));}},null,A);A.get_Create=function(){return A.New(bf.Create(function(bo){return bo.Key;},S.T.Empty));};A.New=function(bo){return new A({RowItems:bo});};B.New=function(bo,bp,bq){return{CellInPortKey:bo,CellOutPortKey:bp,CellWorkerKey:bq};};C.New=function(bo){return{DshEditorCells:bo};};D.Create=function(bo){return D.New(S.map(function(bp){return C.New(S.map(function(bq){var br,bs,bt;return B.New((br=bq.OptInPort.c,br==null?"":br.$0.Key),(bs=bq.OptOutPort.c,bs==null?"":bs.$0.Key),(bt=bq.OptWorker.c,bt==null?"":bt.$0.Worker.Key));},S.ofSeq(bp.CellItems)));},S.ofSeq(bo.RowItems)));};D.New=function(bo){return{DshEditorRows:bo};};E=c.Dashboard=G.Class({get_Render:function(){var bo,bp,bq,br,bs,bt,bu;function bv(bw,bx){var by;by=N.Create$1(bw);return[by,T.Element("div",[bd.DynamicStyle("display",bc.Map(function(bz){return bz?"initial":"none";},by.v))],[bx])];}bo=this;bp=T.Element("table",[],[T.ConvertBy(function(bw){return bw.Key;},function(bw){return T.Element("tr",[],[T.Element("i",V.AttrsClick(function(){bo.PropertyGrid.Edit(bw.Worker.get_Properties());}),[T.TextView(bw.Worker.Name.v)])]);},this.Data.EventItems.v)]);bq=S.ofArray([["Board",bv(true,this.PanelContainer.get_Render())],["Events",bv(false,bp)],["Rules",bv(false,this.Editor.Render(this.Data))]]);br=(bs=function(bw,bx){var by;by=bx[0];return T.Element("tr",[],[T.Element("td",[bd.DynamicStyle("Color",bc.Map(function(bz){return bz?"#FB8C00":"#7D4600";},by.v)),bd.Style("cursor","pointer"),bd.Handler("click",function(){return function(){var bz;bo.PropertyGrid.Edit(S.T.Empty);bz=function(bA,bB){var bC;bC=bB[0];!R.Equals(bC,by)?N.Set(bC,false):N.Set(bC,true);};return S.iter(function(bA){return bz(bA[0],bA[1]);},bq);};})],[T.TextNode(bw)])]);},S.map(function(bw){return bs(bw[0],bw[1]);},bq));bt=(bu=function(bw,bx){return bx[1];},S.map(function(bw){return bu(bw[0],bw[1]);},bq));return T.Element("div",[],[T.Element("table",[],[T.Element("tr",[],[T.Element("td",[bd.Style("vertical-align","top")],[T.Element("table",[],$.concat([S.ofArray([T.Element("tr",[],[T.Element("td",[],[V.IconNormal("dehaze",function(){})])]),T.Element("tr",[],[T.Element("td",[],[V.IconNormal("add",function(){var bw,bx,by;bw=(bq.get_Item(0))[1][0];(bq.get_Item(1))[1][0].c?(bx=S.ofSeq(bo.Factory.EventItems),by=N.Create$1(S.head(bx)),bo.Dialog.ShowDialog("Select source",T.Element("div",[],[T.Select([bd.Class("form-control")],function(bz){return bz.Worker.Name.c;},bx,by)]),function(){var bz;bz=by.c.Worker.get_CloneAndRun();bo.Data.RegisterEvent(V.UniqueKey(),bz);})):bw.c?bo.CreatePanel("Panel",700,null):void 0;})])]),T.Element("tr",[],[T.Element("td",[],[])]),T.Element("tr",[],[T.Element("td",[],[this.PropertyGrid.get_Render()])])]),br]))]),T.Element("td",[],bt)])]),T.Element("div",[],[this.Dialog.get_Render()])]);},Restore:function(bo,bp,bq,br){var bs,bt,bu;bs=this;this.PanelContainer.PanelItems.Clear();this.Data.get_Clear();S.iter(function(bv){var bw;bw=bs.CreatePanel("Panel",700,{$:1,$0:bv.Key});N.Set(bw.Left,bv.Left);N.Set(bw.Top,bv.Top);},bo);bt=function(bv,bw){bs.Data.RegisterEvent(bv,bw.WithStartRunner());};S.iter(function(bv){return bt(bv[0],bv[1]);},bp);Q.log("Events restored");bu=function(bv,bw,bx){bs.RegisterWidget(bv,bw,$.find(function(by){return by.Key===bw;},S.ofSeq(bs.PanelContainer.PanelItems)).Children,bx.WithStartRunner());};S.iter(function(bv){return bu(bv[0],bv[1],bv[2]);},bq);Q.log("Widgets restored");this.Editor.Restore(this.Data,br);Q.log("Connectors restored");S.iter(function(bv){var bw;bw=bv.Worker.Runner;bw==null?void 0:(bw.$0.WebSharper_Community_Dashboard_IRunner$get_Run())(bv.Worker);},S.ofSeq(this.Data.WorkItems));},CreatePanel:function(bo,bp,bq){var br,bs,bt,bu,bv,bw;br=this;T.ConvertBy(this.Data.WidgetItems.key,function(bx){return T.Element("div",[],[T.TextView(bx.Widget.Name.v)]);},this.Data.WidgetItems.v);bs=(bt=(bu=H.NewGuid(),window.String(bu)),bq==null?bt:bq.$0);bv=bi.get_Create().WithLayoutManager(bj.StackPanelLayoutManager()).WithAttributes([bd.Style("border","1px solid white"),bd.Style("display","flex")]);bw=bk.get_Create().WithKey(bs).WithPannelAttrs([bd.Style("Width",window.String(bp)+"px"),bd.Style("position","absolute")]).WithTitleContent(T.TextNode(bo)).WithTitleButtons(S.ofArray([bl.New("add",function(bx){var by,bz;by=S.ofSeq(br.Factory.WidgetItems);bz=N.Create$1(S.head(by));br.Dialog.ShowDialog("Select widget",T.Element("div",[],[T.Select([bd.Class("form-control")],function(bA){return bA.Worker.Name.c;},by,bz)]),function(){Q.log("Dialog.IsOK");br.RegisterWidget(V.UniqueKey(),bx.Key,bx.Children,bz.c.Worker.get_CloneAndRun());});}),bl.New("edit",function(bx){Q.log("Edit");bx.EditProperties(br.PropertyGrid);}),bl.New("clear",function(bx){br.PanelContainer.PanelItems.Remove(br.PanelContainer.FindPanelItem(bx));})])).WithChildPanelContainer(bv);this.PanelContainer.AddPanel(bw);return bw;},RegisterWidget:function(bo,bp,bq,br){this.Data.RegisterWidget(bo,bp,br);bq.AddPanel(bk.get_Create().WithTitle(false).WithPanelContent(br.get_Render()));}},null,E);E.Create=function(bo){var bp;bp=bm.get_Create();return E.New(u.get_Create(),x.get_Create(),bo,A.get_Create(),bn.get_Create(),bp);};E.New=function(bo,bp,bq,br,bs,bt){return new E({Factory:bo,Data:bp,PanelContainer:bq,Editor:br,PropertyGrid:bs,Dialog:bt});};}());
