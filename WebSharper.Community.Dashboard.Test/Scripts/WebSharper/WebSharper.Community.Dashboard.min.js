(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Community=b.Community||{};d=c.Dashboard=c.Dashboard||{};e=d.MessageBus=d.MessageBus||{};f=e.Role=e.Role||{};g=e.Value=e.Value||{};h=e.Message=e.Message||{};i=e.ListenerInfo=e.ListenerInfo||{};j=e.AgentMessage=e.AgentMessage||{};k=e.AgentState=e.AgentState||{};l=a.StartupCode$WebSharper_Community_Dashboard$MessageBus=a.StartupCode$WebSharper_Community_Dashboard$MessageBus||{};m=d.InPort=d.InPort||{};n=d.OutPortType=d.OutPortType||{};o=d.OutPort=d.OutPort||{};p=d.Ports=d.Ports||{};q=d.Worker=d.Worker||{};r=d.Workers=d.Workers||{};s=d.RandomRunner=d.RandomRunner||{};t=d.OpenWeather=d.OpenWeather||{};u=t.Forecast=t.Forecast||{};v=d.OpenWeatherRunner=d.OpenWeatherRunner||{};w=d.DatabaseRunner=d.DatabaseRunner||{};x=d.ChartRunnerContext=d.ChartRunnerContext||{};y=d.ChartRenderer=d.ChartRenderer||{};z=d.TextBoxRenderer=d.TextBoxRenderer||{};A=d.ButtonRenderer=d.ButtonRenderer||{};B=d.RuleEntry=d.RuleEntry||{};C=d.RuleChain=d.RuleChain||{};D=d.RuleContainer=d.RuleContainer||{};E=d.WorkerItem=d.WorkerItem||{};F=d.Factory=d.Factory||{};G=d.SelectorItem=d.SelectorItem||{};H=d.SelectorGroup=d.SelectorGroup||{};I=d.WindowSelector=d.WindowSelector||{};J=d.RulesCellItem=d.RulesCellItem||{};K=d.RulesRowItem=d.RulesRowItem||{};L=d.WidgetItem=d.WidgetItem||{};M=d.EventsGroupItem=d.EventsGroupItem||{};N=d.WidgetsGroupItem=d.WidgetsGroupItem||{};O=d.RulesGroupItem=d.RulesGroupItem||{};P=d.DshData=d.DshData||{};Q=d.EventsEditor=d.EventsEditor||{};R=d.RulesEditor=d.RulesEditor||{};S=d.DshHelper=d.DshHelper||{};T=d.Dashboard=d.Dashboard||{};U=d.AppModelLib=d.AppModelLib||{};V=d.App=d.App||{};W=a.StartupCode$WebSharper_Community_Dashboard$AppModelLib=a.StartupCode$WebSharper_Community_Dashboard$AppModelLib||{};X=a.IntelliFactory;Y=X&&X.Runtime;Z=b&&b.Operators;_0=c&&c.Panel;_1=_0&&_0.Helper;_2=a.Date;_3=b&&b.List;_4=b&&b.Concurrency;_5=b&&b.Remoting;_6=_5&&_5.AjaxRemotingProvider;_7=b&&b.Control;_8=_7&&_7.MailboxProcessor;_9=b&&b.Seq;_=b&&b.PrintfHelpers;$=b&&b.UI;ba=$&&$.Next;bb=ba&&ba.Var;bc=c&&c.PropertyGrid;bd=bc&&bc.Properties;be=b&&b.Guid;bf=b&&b.Unchecked;bg=ba&&ba.Doc;bh=b&&b.Random;bi=a.Math;bj=a.console;bk=b&&b.Data;bl=bk&&bk.TxtRuntime;bm=a.FSharp;bn=bm&&bm.Data;bo=bn&&bn.Runtime;bp=bo&&bo.IO;bq=a.JSON;br=b&&b.Arrays;bs=ba&&ba.View;bt=b&&b.Charting;bu=bt&&bt.Renderers;bv=bu&&bu.ChartJs;bw=bt&&bt.Chart;bx=bt&&bt.Pervasives;by=ba&&ba.AttrModule;bz=b&&b.Enumerator;bA=ba&&ba.Key;bB=ba&&ba.ListModel;bC=b&&b.Option;bD=_0&&_0.PanelContainer;bE=_0&&_0.LayoutManagers;bF=_0&&_0.Panel;bG=_0&&_0.TitleButton;bH=_0&&_0.Dialog;bI=bc&&bc.PropertyGrid;f.Server={$:1};f.Client={$:0};g=e.Value=Y.Class({get_AsNumber:function(){return this.$==0?this.$0:Z.FailWith("MessageBus.Value: unexpected type");}},null,g);h.Create=function(bJ){return h.New(_1.UniqueKey(),_2.now(),bJ);};h.New=function(bJ,bK,bL){return{Key:bJ,Time:bK,Value:bL};};i.Create=function(bJ,bK,bL){return i.New(bJ,bK,bL);};i.New=function(bJ,bK,bL){return{Key:bJ,Name:bK,CacheSize:bL};};j.Clear={$:4};k.get_empty=function(){return k.New(null,_3.T.Empty);};k.New=function(bJ,bK){return{ServerCallback:bJ,Listeners:bK};};e.RunServerRequests=function(){var bJ;_4.Start((bJ=null,_4.Delay(function(){return _4.While(function(){return true;},_4.Delay(function(){return _4.Bind(_4.Sleep(2*1000),function(){return _4.Bind(e.Agent().PostAndAsyncReply(function(bK){return{$:6,$0:bK};},null),function(bK){return _4.Bind((new _6.New()).Async("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.MessageBus.GetMessages:1550733476",[bK]),function(bL){_3.iter(function(bM){var bN;bN=e.Agent();bN.mailbox.AddLast({$:1,$0:bM});bN.resume();},bL);(e.Log())((function(bM){return function(bN){return bM("Values from server requested messages received:"+a.String(bN));};}(a.id))(bL.get_Length()));return _4.Zero();});});});}));})),null);};e.Agent=function(){l.$cctor();return l.Agent;};e.CreateString=function(bJ){return e.CreateStrPair(_1.UniqueKey(),bJ);};e.CreateNumber=function(bJ){return e.CreateNumPair(_1.UniqueKey(),bJ);};e.CreateBooleanPair=function(bJ,bK){return e.CreateKeyValue(bJ,new g({$:2,$0:bK}));};e.CreateStrPair=function(bJ,bK){return e.CreateKeyValue(bJ,new g({$:1,$0:bK}));};e.CreateNumPair=function(bJ,bK){return e.CreateKeyValue(bJ,new g({$:0,$0:bK}));};e.CreateKeyValue=function(bJ,bK){return h.New(bJ,_2.now(),bK);};e.Log=function(){l.$cctor();return l.Log;};e.set_Log=function(bJ){l.$cctor();l.Log=bJ;};e.Role$1=function(){l.$cctor();return l.Role;};e.set_Role=function(bJ){l.$cctor();l.Role=bJ;};l.$cctor=Y.Cctor(function(){l.Role=f.Server;l.Log=a.ignore;l.Agent=_8.Start(function(bJ){function bK(bP,bQ){return _9.fold(function(bR,bS){return bS.Time>=bP?new _3.T({$:1,$0:bS,$1:bR}):bR;},_3.T.Empty,bQ);}function bL(bP,bQ){return bP<bQ.get_Length()?(_3.splitAt(bP,bQ))[0]:bQ;}function bM(bP,bQ,bR){return bP===1?_3.ofArray([bR]):bL(bP,new _3.T({$:1,$0:bR,$1:bQ}));}function bN(bP,bQ){function bR(bS,bT,bU){var bV;bV=a.Array.prototype.slice.call(arguments);return bS.Key===bP.Key?(bT(bP),[bS,bT,bM(bS.CacheSize,bU,bP)]):bV;}return _3.map(function(bS){return bR(bS[0],bS[1],bS[2]);},bQ);}function bO(bP){var bQ;bQ=null;return _4.Delay(function(){return _4.Bind(bJ.Receive(null),function(bR){var bS,bT,bU,bV,bW;function bX(bZ,b0,b1){return bK(bT,b1);}function bY(bZ,b0,b1){return b1.$==0?(new _2(0,0-1,0)).getTime():_3.maxBy(function(b2){return b2.Time;},b1).Time;}return bR.$==2?(bS=bR.$0[0],((e.Log())((function(bZ){return function(b0){return bZ("RegisterListener:"+_.toSafe(b0));};}(a.id))(bS.Name)),bO(k.New(bP.ServerCallback,new _3.T({$:1,$0:[bS,bR.$0[2],_3.T.Empty],$1:bP.Listeners}))))):bR.$==3?bO(k.New({$:1,$0:bR.$0},bP.Listeners)):bR.$==5?(bT=bR.$0[0],(bR.$0[1](_9.fold(function(bZ,b0){return!_3.contains(b0,bZ)?new _3.T({$:1,$0:b0,$1:bZ}):bZ;},_3.T.Empty,_3.concat(_3.map(function(bZ){return bX(bZ[0],bZ[1],bZ[2]);},bP.Listeners)))),bO(bP))):bR.$==6?(bU=_3.map(function(bZ){return bY(bZ[0],bZ[1],bZ[2]);},bP.Listeners),(bR.$0(bU.$==0?(new _2(0,0-1,0)).getTime():_3.max(bU)),bO(bP))):bR.$==1?bO(k.New(bP.ServerCallback,bN(bR.$0,bP.Listeners))):bR.$==0?(bV=bR.$0,(bW=bP.ServerCallback,bW==null?void 0:bW.$0(bV),bO(k.New(bP.ServerCallback,bN(bV,bP.Listeners))))):bO(k.get_empty());});});}return bO(k.get_empty());},null);l.$cctor=a.ignore;});m=d.InPort=Y.Class({Equals:function(bJ){return bJ instanceof m&&this.Name===bJ.Name;},get_BooleanValue:function(){var bJ;bJ=this;return this.ExtractPortBooleanValue(function(bK){return e.CreateBooleanPair(bJ.Key,bK.c);});},get_BooleanVar:function(){return this.ExtractPortBooleanValue(a.id);},get_Boolean:function(){return this.ExtractPortBooleanValue(function(bJ){return bJ.c;});},ExtractPortBooleanValue:function(bJ){var bK;bK=this.PortValue;return bK.$==2?bJ(bK.$0[1]):Z.FailWith("unexpected type");},get_StringValue:function(){var bJ;bJ=this;return this.ExtractPortStringValue(function(bK){return e.CreateStrPair(bJ.Key,bK.c);});},get_StringVar:function(){return this.ExtractPortStringValue(a.id);},get_String:function(){return this.ExtractPortStringValue(function(bJ){return bJ.c;});},ExtractPortStringValue:function(bJ){var bK;bK=this.PortValue;return bK.$==1?bJ(bK.$0[1]):Z.FailWith("unexpected type");},get_NumberValue:function(){var bJ;bJ=this;return this.ExtractPortNumberValue(function(bK){return e.CreateNumPair(bJ.Key,bK.c);});},get_NumberVar:function(){return this.ExtractPortNumberValue(a.id);},get_Number:function(){return this.ExtractPortNumberValue(function(bJ){return bJ.c;});},ExtractPortNumberValue:function(bJ){var bK;bK=this.PortValue;return bK.$==0?bJ(bK.$0[1]):Z.FailWith("unexpected type");},Receive:function(bJ){var bK,bL,bM,bN;bK=this.PortValue;bK.$==1?(bL=bJ.Value,bL.$==1?bb.Set(bK.$0[1],bL.$0):Z.FailWith("incompatible types")):bK.$==2?(bM=bJ.Value,bM.$==2?bb.Set(bK.$0[1],bM.$0):Z.FailWith("incompatible types")):(bN=bJ.Value,bN.$==0?bb.Set(bK.$0[1],bN.$0):Z.FailWith("incompatible types"));},get_KeyValueVar:function(){var bJ;bJ=this.PortValue;return bJ.$==1?bJ.$0[0]:bJ.$==2?bJ.$0[0]:bJ.$0[0];},get_Property:function(){var bJ;bJ=this.PortValue;return bJ.$==1?bd.string(this.Name,bJ.$0[1]):bJ.$==2?bd.check(this.Name,bJ.$0[1]):bd["double"](this.Name,bJ.$0[1]);},get_Clone:function(){var bJ,bK;return m.New((bJ=be.NewGuid(),a.String(bJ)),this.Name,(bK=this.PortValue,bK.$==1?{$:1,$0:[bb.Create$1(bK.$0[0].c),bb.Create$1(bK.$0[1].c)]}:bK.$==2?{$:2,$0:[bb.Create$1(bK.$0[0].c),bb.Create$1(bK.$0[1].c)]}:{$:0,$0:[bb.Create$1(bK.$0[0].c),bb.Create$1(bK.$0[1].c)]}),this.CacheSize);}},null,m);m.Create=function(bJ,bK,bL,bM){return m.New(bJ,bK,bL,bM);};m.New=function(bJ,bK,bL,bM){return new m({Key:bJ,Name:bK,PortValue:bL,CacheSize:bM});};n=d.OutPortType=Y.Class({IsCompatible:function(bJ){return this.$==1?bJ.PortValue.$==1&&true:this.$==2?bJ.PortValue.$==2&&true:bJ.PortValue.$==0&&true;}},null,n);n.BooleanOutPort=new n({$:2});n.StringOutPort=new n({$:1});n.NumberOutPort=new n({$:0});o=d.OutPort=Y.Class({Equals:function(bJ){return bJ instanceof o&&this.Name===bJ.Name;},TriggerWithKey:function(bJ){var bK;bK=e.Agent();bK.mailbox.AddLast({$:0,$0:bJ});bK.resume();},Trigger:function(bJ){var bK;bK=e.Agent();bK.mailbox.AddLast({$:0,$0:e.CreateKeyValue(this.Key,bJ)});bK.resume();},get_Clone:function(){return o.New(_1.UniqueKey(),this.Name,this.Type);}},null,o);o.CreateString=function(bJ,bK){return o.Create(bJ,bK,n.StringOutPort);};o.CreateNumber=function(bJ,bK){return o.Create(bJ,bK,n.NumberOutPort);};o.Create=function(bJ,bK,bL){return o.New(bJ,bK,bL);};o.New=function(bJ,bK,bL){return new o({Key:bJ,Name:bK,Type:bL});};p.Create=function(bJ){function bK(bL,bM){return[bL,bM,1];}return p.CreateWithCache(_3.map(function(bL){return bK(bL[0],bL[1]);},bJ));};p.CreateWithCache=function(bJ){function bK(bL,bM,bN){var bO,bP,bQ,bR;bO=bM.Value;return bO.$==1?(bP=bO.$0,m.Create(bM.Key,bL,{$:1,$0:[bb.Create$1(h.Create(new g({$:1,$0:bP}))),bb.Create$1(bP)]},bN)):bO.$==2?(bQ=bO.$0,m.Create(bM.Key,bL,{$:2,$0:[bb.Create$1(h.Create(new g({$:2,$0:bQ}))),bb.Create$1(bQ)]},bN)):(bR=bO.$0,m.Create(bM.Key,bL,{$:0,$0:[bb.Create$1(h.Create(new g({$:0,$0:bR}))),bb.Create$1(bR)]},bN));}return _3.map(function(bL){return bK(bL[0],bL[1],bL[2]);},bJ);};q=d.Worker=Y.Class({Equals:function(bJ){return bJ instanceof q&&bf.Equals(this.Name,bJ.Name);},get_Properties:function(){return new _3.T({$:1,$0:bd.string("Name",this.Name),$1:_3.map(function(bJ){return bJ.get_Property();},this.InPorts)});},get_Render:function(){var bJ;bJ=this.Renderer;return bJ==null?bg.Empty():(bJ.$0.WebSharper_Community_Dashboard_IRenderer$get_Render())(this);},get_CloneAndRun:function(){var bJ,bK,bL;bJ=bb.Create$1(this.Name.c);bK=_3.map(function(bM){return bM.get_Clone();},this.InPorts);bL=_3.map(function(bM){return bM.get_Clone();},this.OutPorts);return q.New(_1.UniqueKey(),bJ,bK,bL,this.Runner,this.Renderer,this.DataContext,null).WithStartRunner();},WithStartRunner:function(){var bJ;bJ=this.Runner;return bJ==null?this:q.New(this.Key,this.Name,this.InPorts,this.OutPorts,this.Runner,this.Renderer,this.DataContext,(bJ.$0.WebSharper_Community_Dashboard_IRunner$get_Run())(this));},WithRenderer:function(bJ){return q.New(this.Key,this.Name,this.InPorts,this.OutPorts,this.Runner,{$:1,$0:bJ},this.DataContext,this.RunnerContext);},WithRunner:function(bJ){return q.New(this.Key,this.Name,this.InPorts,this.OutPorts,{$:1,$0:bJ},this.Renderer,this.DataContext,this.RunnerContext);},WithKey:function(bJ){return q.New(bJ,this.Name,this.InPorts,this.OutPorts,this.Runner,this.Renderer,this.DataContext,this.RunnerContext);}},null,q);q.CreateWithRenderer=function(bJ){return q.Create(bJ).WithRenderer(bJ);};q.CreateWithRunner=function(bJ){return q.Create(bJ).WithRunner(bJ);};q.Create=function(bJ){return q.New(_1.UniqueKey(),bb.Create$1(bJ.WebSharper_Community_Dashboard_IWorkerContext$get_Name()),bJ.WebSharper_Community_Dashboard_IWorkerContext$get_InPorts(),bJ.WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts(),null,null,bJ,null);};q.New=function(bJ,bK,bL,bM,bN,bO,bP,bQ){return new q({Key:bJ,Name:bK,InPorts:bL,OutPorts:bM,Runner:bN,Renderer:bO,DataContext:bP,RunnerContext:bQ});};r.allInPorts=function(bJ){return r.allPorts(bJ,function(bK){return bK.InPorts;});};r.allOutPorts=function(bJ){return r.allPorts(bJ,function(bK){return bK.OutPorts;});};r.allPorts=function(bJ,bK){return _3.concat(_3.map(bK,bJ));};s=d.RandomRunner=Y.Class({WithMiddleValue:function(bJ){return s.New(this.Name,e.CreateNumber(bJ),this.Dispersion,this.OutPortKey);},WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bJ){var bK;new bh.New();_4.Start((bK=null,_4.Delay(function(){return _4.While(function(){return true;},_4.Delay(function(){return _4.Bind(_4.Sleep(600),function(){var bL,bM,bN;bL=bJ.InPorts.get_Item(1).get_Number();bM=bJ.InPorts.get_Item(0).get_Number();bN=bi.random()*bL+bM;bJ.OutPorts.get_Item(0).Trigger(new g({$:0,$0:bN}));return _4.Zero();});}));})),null);return null;};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return _3.ofArray([o.CreateNumber(this.OutPortKey,"Random value")]);},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return p.Create(_3.ofArray([["Middle value",this.MiddleValue],["Dispersion",this.Dispersion]]));},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return this.Name;}},null,s);s.get_FromPorts=function(){return function(bJ){return s.New(bJ.Name.c,bJ.InPorts.get_Item(0).get_NumberValue(),bJ.InPorts.get_Item(1).get_NumberValue(),bJ.OutPorts.get_Item(0).Key);};};s.Create=function(bJ,bK){return s.New("Random",e.CreateNumber(bJ),e.CreateNumber(bK),_1.UniqueKey());};s.New=function(bJ,bK,bL,bM){return new s({Name:bJ,MiddleValue:bK,Dispersion:bL,OutPortKey:bM});};u.New=function(bJ,bK,bL,bM,bN){return{Title:bJ,Description:bK,ImageUrl:bL,Temperature:bM,TemparatureMinMax:bN};};t.get=function(bJ,bK){var bL;bL=null;return _4.Delay(function(){var bM;bM=(((Y.Curried3(function(bN,bO,bP){return bN("http://api.openweathermap.org/data/2.5/weather?q="+_.toSafe(bO)+"&units=metric&appid="+_.toSafe(bP));}))(a.id))(bK))(bJ);bj.log("get key city "+bM);return _4.TryWith(_4.Delay(function(){return _4.Bind(bl.AsyncMap(bp.asyncReadTextAtRuntime(false,"C:\\AEAFrame\\WebSharper.Community.Dashboard\\WebSharper.Community.Dashboard","","JSON","",bM),function(bN){return bf.Equals(typeof bN,"string")?bq.parse(bN):bN;}),function(bN){var bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_;bj.log("get key city 2");return _4.Return((bO=br.tryHead(bN.weather),bO==null?null:{$:1,$0:(bP=bO.$0,u.New((((Y.Curried3(function(b$,ca,cb){return b$(_.toSafe(ca)+", "+_.toSafe(cb));}))(a.id))((bR=(bQ="name",bQ in bN?{$:1,$0:bN[bQ]}:null),bR==null?null:bR.$0)))((bU=(bS=bN.sys,(bT="country",bT in bS?{$:1,$0:bS[bT]}:null)),bU==null?null:bU.$0)),(bW=(bV="main",bV in bP?{$:1,$0:bP[bV]}:null),bW==null?null:bW.$0),(function(b$){return function(ca){return b$("http://openweathermap.org/img/w/"+_.toSafe(ca)+".png");};}(a.id))((bY=(bX="icon",bX in bP?{$:1,$0:bP[bX]}:null),bY==null?null:bY.$0)),(bZ=(b0=bN.main,(b1="temp",b1 in b0?{$:1,$0:b0[b1]}:null)),(b2=bZ==null?null:{$:1,$0:1*bZ.$0},b2==null?null:b2.$0)),[(b3=(b4=bN.main,(b5="temp_min",b5 in b4?{$:1,$0:b4[b5]}:null)),(b6=b3==null?null:{$:1,$0:1*b3.$0},b6==null?null:b6.$0)),(b7=(b8=bN.main,(b9="temp_max",b9 in b8?{$:1,$0:b8[b9]}:null)),(b_=b7==null?null:{$:1,$0:1*b7.$0},b_==null?null:b_.$0))]))}));});}),function(bN){bj.log(bN.message);return _4.Return(null);});});};v=d.OpenWeatherRunner=Y.Class({WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bJ){var bK;_4.Start((bK=null,_4.Delay(function(){return _4.While(function(){return true;},_4.Delay(function(){var bL,bM,bN;bL=bJ.InPorts.get_Item(0);bM=bJ.InPorts.get_Item(1);bN=bJ.OutPorts.get_Item(0);return _4.Bind(t.get(bM.get_String(),bL.get_String()),function(bO){return _4.Combine(bO==null?_4.Zero():(bj.log("Value generated:"+bO.$0.Title),bN.Trigger(new g({$:0,$0:+bO.$0.Temperature})),_4.Zero()),_4.Delay(function(){return _4.Bind(_4.Sleep(1000*15),function(){return _4.Return(null);});}));});}));})),null);return null;};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return _3.ofArray([o.CreateNumber(this.OutPortKey,"Temperature")]);},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return p.Create(_3.ofArray([["City",this.OpenWeatherCity],["ApiKey",this.OpenWeatherApiKey]]));},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return this.Name;}},null,v);v.get_FromPorts=function(){return function(bJ){return v.New(bJ.Name.c,bJ.InPorts.get_Item(0).get_StringValue(),bJ.InPorts.get_Item(1).get_StringValue(),bJ.OutPorts.get_Item(0).Key);};};v.Create=function(bJ,bK){var bL;return v.New("OpenWeatherMap",e.CreateString(bJ),e.CreateString(bK),(bL=be.NewGuid(),a.String(bL)));};v.New=function(bJ,bK,bL,bM){return new v({Name:bJ,OpenWeatherCity:bK,OpenWeatherApiKey:bL,OutPortKey:bM});};w=d.DatabaseRunner=Y.Class({WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bJ){bs.Sink(function(bK){var bL;bL=((((Y.Curried(function(bM,bN,bO,bP){return bM(_.toSafe(bN)+" "+_.toSafe(bO)+" "+bP.toFixed(6));},4))(a.id))(bK.Key))(a.String(bK.Time)))(bK.Value.get_AsNumber());(new _6.New()).Send("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.ServerDatabase.WriteLine:2078881569",[bJ.InPorts.get_Item(1).get_String(),bL]);bJ.OutPorts.get_Item(0).TriggerWithKey(bK);},bJ.InPorts.get_Item(0).get_KeyValueVar().v);return null;};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return _3.ofArray([o.CreateNumber(this.OutPortKey,"Number value")]);},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return p.Create(_3.ofArray([[" in Value",this.InValue],["Database name",this.DatabaseName]]));},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return this.Name;}},null,w);w.get_FromPorts=function(){return function(bJ){var bK;bK=bJ.InPorts.get_Item(0).get_NumberValue();return w.New(bJ.Name.c,bJ.InPorts.get_Item(1).get_StringValue(),bK,bJ.OutPorts.get_Item(0).Key);};};w.get_Create=function(){return w.New("Database",e.CreateString("Database.txt"),e.CreateNumber(0),_1.UniqueKey());};w.New=function(bJ,bK,bL,bM){return new w({Name:bJ,DatabaseName:bK,InValue:bL,OutPortKey:bM});};x.New=function(bJ,bK){return{LineChart:bJ,Queue:bK};};y=d.ChartRenderer=Y.Class({WebSharper_Community_Dashboard_IRenderer$get_Render:function(){return function(bJ){var bK,bL;bK=bJ.InPorts.get_Item(3).get_Number()<<0;bL=bJ.RunnerContext.$0;bs.Sink(function(bM){bL.Queue.push(bM);bL.Queue.length>bK?bL.Queue.shift():void 0;_9.iteri(function(bN,bO){return bL.LineChart.__UpdateData(bN,function(){return bO;});},bL.Queue);},bJ.InPorts.get_Item(0).get_NumberVar().v);return bv.Render$8(bJ.RunnerContext.$0.LineChart,{$:1,$0:{$:0,$0:bJ.InPorts.get_Item(1).get_Number()<<0,$1:bJ.InPorts.get_Item(2).get_Number()<<0}},null,null);};},WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bJ){var bK,bL,bM,bN;bK=bJ.InPorts.get_Item(3).get_Number()<<0;bL=_3.ofSeq(_9.delay(function(){return _9.map(function(){return 0;},Z.range(0,bK-1));}));bM=(bN=[],(_9.iter(function(bO){bN.push(bO);},bL),bN));return{$:1,$0:x.New(bw.Line(bL).__WithFillColor(new bx.Color({$:2,$0:"white"})),bM)};};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return _3.T.Empty;},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return p.CreateWithCache(_3.ofArray([[" in Value",this.Number,this.ChartBufferSize.Value.get_AsNumber()<<0],["cx",this.Cx,1],["cy",this.Cy,1],["BufferSize",this.ChartBufferSize,1]]));},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return this.Name;}},null,y);y.get_FromPorts=function(){return function(bJ){return y.New(bJ.Name.c,bJ.InPorts.get_Item(0).get_NumberValue(),bJ.InPorts.get_Item(1).get_NumberValue(),bJ.InPorts.get_Item(2).get_NumberValue(),bJ.InPorts.get_Item(3).get_NumberValue());};};y.Create=function(bJ,bK,bL){return y.New("Chart",e.CreateNumber(0),e.CreateNumber(bJ),e.CreateNumber(bK),e.CreateNumber(bL));};y.New=function(bJ,bK,bL,bM,bN){return new y({Name:bJ,Number:bK,Cx:bL,Cy:bM,ChartBufferSize:bN});};z=d.TextBoxRenderer=Y.Class({WebSharper_Community_Dashboard_IRenderer$get_Render:function(){return function(bJ){var bK;bK=bs.Map(function(bL){var bM;bM=bL<<0;return a.String(bM);},bJ.InPorts.get_Item(0).get_NumberVar().v);return bg.Element("div",[by.Class("bigvalue")],[bg.TextView(bK)]);};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return _3.T.Empty;},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return p.Create(_3.ofArray([["in Value",this.TextBoxValue]]));},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return this.Name;}},null,z);z.get_FromPorts=function(){return function(bJ){return z.New(bJ.Name.c,bJ.InPorts.get_Item(0).get_NumberValue());};};z.get_Create=function(){return z.New("Text",e.CreateNumber(0));};z.New=function(bJ,bK){return new z({Name:bJ,TextBoxValue:bK});};A=d.ButtonRenderer=Y.Class({WebSharper_Community_Dashboard_IRenderer$get_Render:function(){return function(bJ){return bg.ButtonView(bJ.InPorts.get_Item(0).get_String(),[],bJ.InPorts.get_Item(1).get_BooleanVar().v,function(bK){bJ.OutPorts.get_Item(0).Trigger(new g({$:2,$0:bK}));});};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return _3.ofArray([o.CreateNumber(this.OutPortKey,"Button value")]);},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return p.Create(_3.ofArray([["Caption",this.ButtonName],["State",this.State]]));},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return this.Name;}},null,A);A.get_FromPorts=function(){return function(bJ){return A.New(bJ.Name.c,bJ.InPorts.get_Item(0).get_StringValue(),bJ.InPorts.get_Item(1).get_BooleanValue(),bJ.OutPorts.get_Item(0).Key);};};A.get_Create=function(){return A.New("Button",e.CreateString("Button"),e.CreateNumber(0),_1.UniqueKey());};A.New=function(bJ,bK,bL,bM){return new A({Name:bJ,ButtonName:bK,State:bL,OutPortKey:bM});};B.New=function(bJ,bK,bL){return{InPortKey:bJ,OutPortKey:bK,WorkerKey:bL};};C.New=function(bJ){return{RuleChain:bJ};};D=d.RuleContainer=Y.Class({Reconnect:function(bJ){var bK,bL,bM;bK=r.allOutPorts(bJ);bL=r.allInPorts(bJ);_3.iter(function(bN){(e.Log())((((Y.Curried3(function(bO,bP,bQ){return bO(_.toSafe(bP)+" "+_.toSafe(bQ));}))(a.id))(bN.Name))(bN.Key));},bL);bM=e.Agent();bM.mailbox.AddLast(j.Clear);bM.resume();_3.iter(function(bN){var bO,bP,bQ;bO=_3.ofSeq(bN.RuleChain);bP=_3.ofSeq(Z.range(1,bO.get_Length()-1));bQ=bz.Get(bP);try{while(bQ.MoveNext())(function(){var bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0;bR=bQ.Current();bS=bO.get_Item(bR-1);bT=bO.get_Item(bR);{bU=_9.tryFind(function(b1){return b1.Key===bS.OutPortKey;},bK),bU==null?null:{$:1,$0:(bV=bU.$0,((e.Log())((function(b1){return function(b2){return b1("Found out port "+_.toSafe(b2));};}(a.id))(bT.InPortKey)),bW=_9.tryFind(function(b1){return b1.Key===bT.InPortKey;},bL),bW==null?null:{$:1,$0:(bX=bW.$0,((e.Log())("Found int port"),bY=(bZ=bX.PortValue,bZ.$==1?h.Create(new g({$:1,$0:""})):bZ.$==2?h.Create(new g({$:2,$0:false})):h.Create(new g({$:0,$0:0}))),b0=e.Agent(),b0.mailbox.AddLast({$:2,$0:[i.Create(bV.Key,bV.Name+"->"+bX.Name,bX.CacheSize),bY,function(b1){bX.Receive(b1);}]}),b0.resume()))}))};return;}}());}finally{if("Dispose"in bQ)bQ.Dispose();}},_3.ofSeq(this.RuleContainer));}},null,D);D.New=function(bJ){return new D({RuleContainer:bJ});};E.Create=function(bJ){return E.New(bA.Fresh(),bJ);};E.New=function(bJ,bK){return{Key:bJ,Worker:bK};};F=d.Factory=Y.Class({RegisterEvent:function(bJ){this.EventItems.Append(E.Create(bJ));},RegisterWidget:function(bJ){this.WidgetItems.Append(E.Create(bJ));}},null,F);F.get_Create=function(){return F.New(bB.Create(function(bJ){return bJ.Key;},_3.T.Empty),bB.Create(function(bJ){return bJ.Key;},_3.T.Empty));};F.New=function(bJ,bK){return new F({EventItems:bJ,WidgetItems:bK});};G.Create=function(bJ,bK){return G.New(bA.Fresh(),bJ,bK);};G.New=function(bJ,bK,bL){return{Key:bJ,Name:bK,SelectorRenderer:bL};};H=d.SelectorGroup=Y.Class({RenderMenu:function(bJ,bK){var bL,bM,bN,bO;bL=this;bM=(bN=this.ChildCreatator,bN==null?bg.Element("tr",[],[]):(bO=bN.$0,bg.Element("tr",[],[bg.Element("td",[],[bg.Element("div",[by.Style("margin-left","20px")],[_1.IconSmall("add",function(){var bP,bQ;bP=bO();bQ=G.Create(bP[0],bP[1]);bL.ItemOnCreated(bQ);bL.SelectorItems.Append(bQ);})])])])));return bg.Element("table",[],[bg.ConvertBy(function(bP){return bP.Key;},function(bP){var bQ;bQ=bs.Map(function(bR){return bJ+bR;},bP.Name.v);return bg.Element("tr",[],[bg.Element("td",[by.DynamicStyle("Color",bs.Map(function(bR){return bR==null?"#7D4600":bf.Equals(bR.$0.Key,bP.Key)?"#FB8C00":"#7D4600";},bK.v)),by.Style("cursor","pointer"),by.Handler("click",function(){return function(){bL.ItemOnSelected(bP);return bb.Set(bK,{$:1,$0:bP});};})],[bg.Element("div",[by.Style("margin-left","10px"),by.Style("margin-right","5px")],[bg.TextView(bQ)])])]);},this.SelectorItems.v),bM]);}},null,H);H.Create=function(bJ,bK,bL,bM,bN){var bO;bO=bB.Create(function(bP){return bP.Key;},_3.map(function(bP){return G.Create(bP[0],bP[1]);},bK));return H.New(bA.Fresh(),bb.Create$1(bJ),bO,bL,bM,bN);};H.New=function(bJ,bK,bL,bM,bN,bO){return new H({Key:bJ,Name:bK,SelectorItems:bL,ChildCreatator:bM,ItemOnCreated:bN,ItemOnSelected:bO});};I=d.WindowSelector=Y.Class({get_RenderMenu:function(){var bJ;bJ=this;return this.SelectorGroups.get_Length()===1?_3.head(_3.ofSeq(this.SelectorGroups)).RenderMenu("",this.OptSelectedItem):bg.Element("div",[],[bg.ConvertBy(function(bK){return bK.Key;},function(bK){return bg.Element("div",[],[bg.Element("div",[by.Style("cursor","pointer"),by.Handler("click",function(){return function(){return bJ.GroupOnClick(bK);};})],[bg.TextView(bK.Name.v)]),bK.RenderMenu("    ",bJ.OptSelectedItem)]);},this.SelectorGroups.v)]);},get_Render:function(){return bg.Element("div",[],[bg.BindView(function(bJ){return bJ==null?bg.Empty():bJ.$0.SelectorRenderer;},this.OptSelectedItem.v)]);},GroupByIndex:function(bJ){return _9.nth(bJ,_3.ofSeq(this.SelectorGroups));},get_SelectedIndex:function(){var bJ;bJ=this;return _9.findIndex(function(bK){return bf.Equals(bK.Key,bJ.get_SelectedItem().Key);},_3.concat(_3.map(function(bK){return _3.ofSeq(bK.SelectorItems);},_3.ofSeq(this.SelectorGroups))));},get_SelectedIndexInGroup:function(){var bJ;bJ=this;return _9.findIndex(function(bK){return bf.Equals(bK.Key,bJ.get_SelectedItem().Key);},_3.ofSeq(this.get_SelectedGroup().SelectorItems));},get_SelectedGroupIndex:function(){var bJ;bJ=this;return _9.findIndex(function(bK){return bf.Equals(bK.Key,bJ.get_SelectedGroup().Key);},_3.ofSeq(this.SelectorGroups));},get_SelectedGroup:function(){return this.GroupFromItem(this.get_SelectedItem());},GroupFromItem:function(bJ){return _9.find(function(bK){return _3.exists(function(bL){return bf.Equals(bL.Key,bJ.Key);},_3.ofSeq(bK.SelectorItems));},_3.ofSeq(this.SelectorGroups));},AppenGroup:function(bJ,bK,bL){this.SelectorGroups.Append(H.Create(bJ,bK,bL,this.ItemOnCreated(this.SelectorGroups.get_Length()),this.ItemOnSelected));},get_SelectedItem:function(){var bJ;bJ=this.OptSelectedItem.c;return bJ==null?Z.FailWith("Something really wrong with WindowSelector"):bJ.$0;},ClearGroups:function(){bb.Set(this.OptSelectedItem,null);_3.iter(function(bJ){bJ.SelectorItems.Clear();},_3.ofSeq(this.SelectorGroups));},WithItemOnSelected:function(bJ){return I.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,bJ);},WithGroupOnClick:function(bJ){return I.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,bJ,this.ItemOnSelected);},WithItemOnCreated:function(bJ){return I.New(this.OptSelectedItem,this.SelectorGroups,bJ,this.GroupOnClick,this.ItemOnSelected);}},null,I);I.get_Create=function(){var bJ;bJ=bB.Create(function(bK){return bK.Key;},_3.T.Empty);return I.New(bb.Create$1(null),bJ,function(){return function(){return null;};},a.ignore,a.ignore);};I.New=function(bJ,bK,bL,bM,bN){return new I({OptSelectedItem:bJ,SelectorGroups:bK,ItemOnCreated:bL,GroupOnClick:bM,ItemOnSelected:bN});};J=d.RulesCellItem=Y.Class({Render:function(bJ,bK){var bL,bM,bN,bO,bP;bL=this;bs.Sink(function(bQ){var bR;if(bQ==null);else{bR=bQ.$0;bj.log("Workitem selected");bb.Set(bL.OptInPort,_3.tryHead(bR.Worker.InPorts));bb.Set(bL.OptOutPort,_3.tryHead(bR.Worker.OutPorts));bK();}},this.OptWorker.v);bs.Sink(function(){bK();},this.OptInPort.v);bs.Sink(function(){bK();},this.OptOutPort.v);bM=(bN=bs.Map(function(bQ){var bR;return bQ==null?_3.ofArray([null]):(bR=_3.map(function(bS){return{$:1,$0:bS};},bQ.$0.Worker.InPorts),bR.get_Length()>0?bR:_3.ofArray([null]));},this.OptWorker.v),(bO=bs.Map(function(bQ){var bR;return bQ==null?_3.ofArray([null]):(bR=_3.map(function(bS){return{$:1,$0:bS};},bQ.$0.Worker.OutPorts),bR.get_Length()>0?bR:_3.ofArray([null]));},this.OptWorker.v),(bP=bs.Map(function(bQ){return new _3.T({$:1,$0:null,$1:_3.map(function(bR){return{$:1,$0:bR};},_3.ofSeq(bQ))});},bJ.v),bg.Element("table",[],[bg.Element("tr",[],[bg.Element("td",[],[bg.SelectDyn([by.Class("form-control")],function(bQ){return bC.fold(function(bR,bS){return bS.Name;}," ",bQ);},bN,this.OptInPort)]),bg.Element("td",[],[bg.SelectDyn([by.Class("form-control")],function(bQ){return bC.fold(function(bR,bS){return bS.Worker.Name.c;}," ",bQ);},bP,this.OptWorker)]),bg.Element("td",[],[bg.SelectDyn([by.Class("form-control")],function(bQ){return bC.fold(function(bR,bS){return bS.Name;}," ",bQ);},bO,this.OptOutPort)])])]))));return bg.Element("td",[by.Class("td DshEditorCell")],[bg.Element("div",[by.Class("div DshEditorCell")],[bg.Element("table",[],[bg.Element("tr",[],[bg.Element("td",[],[bM])])])])]);}},null,J);J.get_Create=function(){return J.New(bA.Fresh(),bb.Create$1(null),bb.Create$1(null),bb.Create$1(null));};J.New=function(bJ,bK,bL,bM){return new J({Key:bJ,OptInPort:bK,OptWorker:bL,OptOutPort:bM});};K=d.RulesRowItem=Y.Class({Render:function(bJ,bK){var bL;bL=this;return bg.Element("tr",[],[bg.ConvertBy(function(bM){return bM.Key;},function(bM){return bM.Render(bJ,bK);},this.CellItems.v),_1.IconNormal("add",function(){bL.CellItems.Append(J.get_Create());})]);}},null,K);K.Create=function(bJ){return K.New(bA.Fresh(),bB.Create(function(bK){return bK.Key;},bJ));};K.New=function(bJ,bK){return new K({Key:bJ,CellItems:bK});};L.Create=function(bJ,bK){return L.New(bA.Fresh(),bJ,bK);};L.New=function(bJ,bK,bL){return{Key:bJ,Panel:bK,Widget:bL};};M.Create=function(bJ){return M.New(bA.Fresh(),bb.Create$1(bJ),bB.Create(function(bK){return bK.Key;},_3.T.Empty));};M.New=function(bJ,bK,bL){return{Key:bJ,Name:bK,EventItems:bL};};N.Create=function(bJ,bK){return N.New(bA.Fresh(),bb.Create$1(bJ),bB.Create(function(bL){return bL.Key;},_3.T.Empty),bK);};N.New=function(bJ,bK,bL,bM){return{Key:bJ,Name:bK,WidgetItems:bL,PanelContainer:bM};};O.Create=function(bJ){return O.New(bA.Fresh(),bb.Create$1(bJ),bB.Create(function(bK){return bK.Key;},_3.T.Empty));};O.New=function(bJ,bK,bL){return{Key:bJ,Name:bK,RulesRowItems:bL};};P=d.DshData=Y.Class({RegisterWidget:function(bJ,bK,bL,bM){var bN;bN=bM.WithKey(bJ);bK.WidgetItems.Append(L.Create(bL,bN));this.WorkItems.Append(E.Create(bN));},RegisterEvent:function(bJ,bK,bL){var bM;bM=E.Create(bL.WithKey(bJ));bK.EventItems.Append(bM);this.WorkItems.Append(bM);},get_Clear:function(){this.WorkItems.Clear();this.WidgetGroups.Clear();this.EventGroups.Clear();this.RulesGroups.Clear();}},null,P);P.get_Create=function(){return P.New(bB.Create(function(bJ){return bJ.Key;},_3.T.Empty),bB.Create(function(bJ){return bJ.Key;},_3.T.Empty),bB.Create(function(bJ){return bJ.Key;},_3.T.Empty),bB.Create(function(bJ){return bJ.Key;},_3.T.Empty));};P.New=function(bJ,bK,bL,bM){return new P({WorkItems:bJ,WidgetGroups:bK,EventGroups:bL,RulesGroups:bM});};Q.Render=function(bJ,bK){return bg.Element("table",[],[bg.ConvertBy(function(bL){return bL.Key;},function(bL){return bg.Element("tr",[],[bg.Element("i",_1.AttrsClick(function(){bK.Edit(bL.Worker.get_Properties());}),[bg.TextView(bL.Worker.Name.v)])]);},bJ.v)]);};R.Render=function(bJ,bK){function bL(){var bM;bM=_3.map(function(bN){return bN.Worker;},_3.ofSeq(bJ.WorkItems));R.CopyToRules(bK).Reconnect(bM);}return bg.Element("table",[],[bg.ConvertBy(function(bM){return bM.Key;},function(bM){return bg.Element("tr",[],[bM.Render(bJ.WorkItems,function(){bL();})]);},bK.v)]);};R.Restore=function(bJ,bK,bL){var bM,bN,bO;bK.Clear();bM=_3.map(function(bP){return bP.Worker;},_3.ofSeq(bJ.WorkItems));bN=r.allOutPorts(bM);bO=r.allInPorts(bM);_3.iter(function(bP){var bQ;bQ=K.Create([]);_3.iter(function(bR){var bS;bS=J.get_Create();bb.Set(bS.OptWorker,_9.tryFind(function(bT){return bT.Worker.Key===bR.WorkerKey;},_3.ofSeq(bJ.WorkItems)));bb.Set(bS.OptInPort,_9.tryFind(function(bT){return bT.Key===bR.InPortKey;},bO));bb.Set(bS.OptOutPort,_9.tryFind(function(bT){return bT.Key===bR.OutPortKey;},bN));bQ.CellItems.Append(bS);},bP.RuleChain);bK.Append(bQ);},bL.RuleContainer);bL.Reconnect(bM);};R.CopyToRules=function(bJ){return D.New(_3.map(function(bK){return C.New(_3.map(function(bL){var bM,bN,bO;return B.New((bM=bL.OptInPort.c,bM==null?"":bM.$0.Key),(bN=bL.OptOutPort.c,bN==null?"":bN.$0.Key),(bO=bL.OptWorker.c,bO==null?"":bO.$0.Worker.Key));},_3.ofSeq(bK.CellItems)));},_3.ofSeq(bJ)));};S.RulesGroupCreator=function(bJ,bK){var bL;bL=O.Create("rules"+a.String(_3.length(_3.ofSeq(bJ.RulesGroups))+1));bJ.RulesGroups.Append(bL);return[bL.Name,R.Render(bJ,bL.RulesRowItems)];};S.EventsGroupCreator=function(bJ,bK,bL){var bM;bM=M.Create("event"+a.String(_3.length(_3.ofSeq(bJ.EventGroups))+1));bJ.EventGroups.Append(bM);return[bM.Name,Q.Render(bM.EventItems,bK)];};S.PanelGroupCreator=function(bJ,bK,bL){var bM,bN,bO;bM=_3.length(_3.ofSeq(bJ.WidgetGroups))+1;bN=bK();bO=N.Create("panel"+a.String(bM),bN);bJ.WidgetGroups.Append(bO);return[bO.Name,bN.get_Render()];};T=d.Dashboard=Y.Class({get_Render:function(){var bJ;bJ=this;return bg.EmbedView(bs.Map(function(bK){return bK.$==1?bg.Element("div",[],[bg.Element("table",[],[bg.Element("tr",[],[bg.Element("td",[by.Style("vertical-align","top")],[bg.Element("table",[],_9.concat([_3.ofArray([bg.Element("tr",[],[bg.Element("td",[],[_1.IconNormal("dehaze",function(){bb.Set(bJ.PanelTitleVisibility,false);bb.Set(bJ.Mode,{$:0});})])]),bg.Element("tr",[],[bg.Element("td",[],[_1.IconNormal("add",function(){var bL,bM,bN,bO,bP;bL=bJ.EditorSelectorEdit.get_SelectedGroupIndex();bL===1?(bM=_3.ofSeq(bJ.Factory.EventItems),bN=bb.Create$1(_3.head(bM)),bJ.Dialog.ShowDialog("Select source",bg.Element("div",[],[bg.Select([by.Class("form-control")],function(bQ){return bQ.Worker.Name.c;},bM,bN)]),function(){var bQ,bR,bS;bQ=bN.c.Worker.get_CloneAndRun();bR=(bS=_3.ofSeq(bJ.Data.EventGroups),_9.nth(bJ.EditorSelectorEdit.get_SelectedIndexInGroup(),bS));bJ.Data.RegisterEvent(_1.UniqueKey(),bR,bQ);})):bL===0?bJ.CreatePanel((bO=_3.ofSeq(bJ.Data.WidgetGroups),_9.nth(bJ.EditorSelectorEdit.get_SelectedIndexInGroup(),bO)),"Panel",700,null):bL===2?(bP=_3.ofSeq(bJ.Data.RulesGroups),_9.nth(bJ.EditorSelectorEdit.get_SelectedIndexInGroup(),bP)).RulesRowItems.Append(K.Create([J.get_Create(),J.get_Create()])):void 0;})])])]),_3.ofArray([bJ.EditorSelectorEdit.get_RenderMenu()]),_3.ofArray([bg.Element("tr",[],[bg.Element("td",[],[])]),bg.Element("tr",[],[bg.Element("td",[],[bJ.PropertyGrid.get_Render()])])])]))]),bg.Element("td",[],[bJ.EditorSelectorEdit.get_Render()])])]),bg.Element("div",[],[bJ.Dialog.get_Render()])]):bg.Element("div",[],[bg.Element("table",[],[bg.Element("tr",[],[bg.Element("td",[by.Style("vertical-align","top")],[_1.IconNormal("dehaze",function(){bb.Set(bJ.PanelTitleVisibility,true);bb.Set(bJ.Mode,{$:1});}),bJ.EditorSelectorRun.get_RenderMenu()]),bg.Element("td",[],[bJ.EditorSelectorRun.get_Render()])])])]);},this.Mode.v));},Restore:function(bJ,bK,bL,bM){var bN,bO,bP,bQ,bR;bN=this;this.EditorSelectorRun.ClearGroups();this.EditorSelectorEdit.ClearGroups();this.Data.get_Clear();bO=this.EditorSelectorRun.GroupByIndex(0);bP=this.EditorSelectorEdit.GroupByIndex(0);bQ=this.EditorSelectorEdit.GroupByIndex(1);bR=this.EditorSelectorEdit.GroupByIndex(2);_3.iteri(function(bS,bT){var bU,bV,bW,bX;function bY(bZ,b0,b1){bN.RegisterWidget(bZ,bX,b0,_9.find(function(b2){return b2.Key===b0;},_3.ofSeq(bX.PanelContainer.PanelItems)).Children,b1.WithStartRunner());}bU=S.PanelGroupCreator(bN.Data,bJ,null);bV=bU[1];bW=bU[0];bb.Set(bW,bT[0]);bP.SelectorItems.Append(G.Create(bW,bV));bO.SelectorItems.Append(G.Create(bW,bV));bX=_9.nth(bS,_3.ofSeq(bN.Data.WidgetGroups));_3.iter(function(bZ){var b0;b0=bN.CreatePanel(bX,"Panel",700,{$:1,$0:bZ.Key});bb.Set(b0.Left,bZ.Left);bb.Set(b0.Top,bZ.Top);},bT[1]);return _3.iter(function(bZ){return bY(bZ[0],bZ[1],bZ[2]);},bT[2]);},bL);bj.log("Widgets restored");_3.iteri(function(bS,bT){var bU,bV,bW;function bX(bY,bZ){bN.Data.RegisterEvent(bY,bW,bZ);}bU=S.EventsGroupCreator(bN.Data,bN.PropertyGrid,null);bV=bU[0];bb.Set(bV,bT[0]);bQ.SelectorItems.Append(G.Create(bV,bU[1]));bW=_9.nth(bS,_3.ofSeq(bN.Data.EventGroups));return _3.iter(function(bY){return bX(bY[0],bY[1]);},bT[1]);},bK);bj.log("Events restored");_3.iteri(function(bS,bT){var bU,bV;bU=S.RulesGroupCreator(bN.Data,null);bV=bU[0];bb.Set(bV,bT[0]);bR.SelectorItems.Append(G.Create(bV,bU[1]));return R.Restore(bN.Data,_9.nth(bS,_3.ofSeq(bN.Data.RulesGroups)).RulesRowItems,bT[1]);},bM);bb.Set(this.EditorSelectorEdit.OptSelectedItem,{$:1,$0:_3.head(_3.ofSeq(this.EditorSelectorEdit.GroupByIndex(0).SelectorItems))});bb.Set(this.EditorSelectorRun.OptSelectedItem,{$:1,$0:_3.head(_3.ofSeq(this.EditorSelectorRun.GroupByIndex(0).SelectorItems))});bj.log("Connectors restored");},Store:function(bJ){return[_3.map(function(bK){return[bK.Name.c,_3.map(function(bL){return[bL.Worker.Key,bJ(bL.Worker)];},_3.ofSeq(bK.EventItems))];},_3.ofSeq(this.Data.EventGroups)),_3.map(function(bK){return[bK.Name.c,_3.map(function(bL){return bL.get_PanelData();},_3.ofSeq(bK.PanelContainer.PanelItems)),_3.map(function(bL){return[bL.Widget.Key,bL.Panel,bJ(bL.Widget)];},_3.ofSeq(bK.WidgetItems))];},_3.ofSeq(this.Data.WidgetGroups)),_3.map(function(bK){return[bK.Name.c,R.CopyToRules(bK.RulesRowItems)];},_3.ofSeq(this.Data.RulesGroups))];},CreatePanel:function(bJ,bK,bL,bM){var bN,bO,bP,bQ,bR,bS;bN=this;bg.ConvertBy(bJ.WidgetItems.key,function(bT){return bg.Element("div",[],[bg.TextView(bT.Widget.Name.v)]);},bJ.WidgetItems.v);bO=(bP=(bQ=be.NewGuid(),a.String(bQ)),bM==null?bP:bM.$0);bR=bD.get_Create().WithLayoutManager(bE.StackPanelLayoutManager()).WithAttributes([by.Style("border","1px solid white"),by.Style("display","flex")]);bS=bF.get_Create().WithKey(bO).WithPannelAttrs([by.Style("Width",a.String(bL)+"px"),by.Style("position","absolute")]).WithTitle(this.PanelTitleVisibility).WithTitleContent(bg.TextNode(bK)).WithTitleButtons(_3.ofArray([bG.New("add",function(bT){var bU,bV;bU=_3.ofSeq(bN.Factory.WidgetItems);bV=bb.Create$1(_3.head(bU));bN.Dialog.ShowDialog("Select widget",bg.Element("div",[],[bg.Select([by.Class("form-control")],function(bW){return bW.Worker.Name.c;},bU,bV)]),function(){bj.log("Dialog.IsOK");bN.RegisterWidget(_1.UniqueKey(),bJ,bT.Key,bT.Children,bV.c.Worker.get_CloneAndRun());});}),bG.New("edit",function(bT){bj.log("Edit");bN.PropertyGrid.Edit(_3.concat(_3.map(function(bU){return bU.Widget.get_Properties();},_3.filter(function(bU){return bU.Panel===bT.Key;},_3.ofSeq(bJ.WidgetItems)))));}),bG.New("clear",function(bT){bJ.PanelContainer.PanelItems.Remove(bJ.PanelContainer.FindPanelItem(bT));})])).WithChildPanelContainer(bR);bJ.PanelContainer.AddPanel(bS);return bS;},RegisterWidget:function(bJ,bK,bL,bM,bN){var bO;this.Data.RegisterWidget(bJ,bK,bL,bN);bO=bF.get_Create().WithPanelContent(bN.get_Render());bb.Set(bO.IsWithTitle,false);bM.AddPanel(bO);}},null,T);T.Create=function(bJ){var bK,bL,bM,bN,bO,bP;function bQ(){return S.PanelGroupCreator(bL,bJ,void 0);}function bR(){return S.EventsGroupCreator(bL,bM,void 0);}function bS(){return S.RulesGroupCreator(bL,void 0);}bK=bH.get_Create();bL=P.get_Create();bM=bI.get_Create();bN=I.get_Create();bO=I.get_Create().WithGroupOnClick(function(bT){(e.Log())("WithGroupOnClick");bM.Edit(_3.mapi(function(bU,bV){var bW;return bd.string((bW=bU+1,a.String(bW)),bV.Name);},_3.ofSeq(bT.SelectorItems)));}).WithItemOnSelected(function(){(e.Log())("WithItemOnSelected");bM.Edit(_3.T.Empty);}).WithItemOnCreated(function(bT){return function(bU){return bT===0?_3.head(_3.ofSeq(bN.SelectorGroups)).SelectorItems.Append(bU):null;};});bP=bQ();bO.AppenGroup("Panels",_3.ofArray([bP]),{$:1,$0:bQ});bN.AppenGroup("Panels",_3.ofArray([bP]),null);bO.AppenGroup("Events",_3.ofArray([bR()]),{$:1,$0:bR});bO.AppenGroup("Rules",_3.ofArray([bS()]),{$:1,$0:bS});bb.Set(bO.OptSelectedItem,{$:1,$0:_3.head(_3.ofSeq(bO.GroupByIndex(0).SelectorItems))});bb.Set(bN.OptSelectedItem,{$:1,$0:_3.head(_3.ofSeq(bN.GroupByIndex(0).SelectorItems))});return T.New(F.get_Create(),bL,bM,bK,bN,bO,bb.Create$1({$:0}),bb.Create$1(false));};T.New=function(bJ,bK,bL,bM,bN,bO,bP,bQ){return new T({Factory:bJ,Data:bK,PropertyGrid:bL,Dialog:bM,EditorSelectorRun:bN,EditorSelectorEdit:bO,Mode:bP,PanelTitleVisibility:bQ});};U=d.AppModelLib=Y.Class({get_Worker:function(){var bJ;return this.$==1?q.CreateWithRunner(this.$0):this.$==2?q.CreateWithRunner(this.$0):this.$==3?q.CreateWithRenderer(this.$0):this.$==4?(bJ=this.$0,q.Create(bJ).WithRunner(bJ).WithRenderer(bJ)):this.$==5?q.CreateWithRenderer(this.$0):q.CreateWithRunner(this.$0);}},null,U);U.FromWorker=function(bJ){var bK;bK=bJ.DataContext;return bK instanceof s?{$:1,$0:new U({$:0,$0:(s.get_FromPorts())(bJ)})}:bK instanceof v?{$:1,$0:new U({$:1,$0:(v.get_FromPorts())(bJ)})}:bK instanceof w?{$:1,$0:new U({$:2,$0:(w.get_FromPorts())(bJ)})}:bK instanceof z?{$:1,$0:new U({$:3,$0:(z.get_FromPorts())(bJ)})}:bK instanceof y?{$:1,$0:new U({$:4,$0:(y.get_FromPorts())(bJ)})}:bK instanceof A?{$:1,$0:new U({$:5,$0:(A.get_FromPorts())(bJ)})}:null;};U.FromDataContext=function(bJ){return bJ instanceof s?{$:1,$0:new U({$:0,$0:bJ})}:bJ instanceof v?{$:1,$0:new U({$:1,$0:bJ})}:bJ instanceof w?{$:1,$0:new U({$:2,$0:bJ})}:bJ instanceof z?{$:1,$0:new U({$:3,$0:bJ})}:bJ instanceof y?{$:1,$0:new U({$:4,$0:bJ})}:bJ instanceof A?{$:1,$0:new U({$:5,$0:bJ})}:null;};V.CreateDashboard=function(){W.$cctor();return W.CreateDashboard;};V.PanelContainerCreator=function(bJ){return bD.get_Create().WithLayoutManager(bE.FloatingPanelLayoutManager(5)).WithWidth(800).WithHeight(420).WithAttributes([by.Style("border","1px solid white")]);};V.Register=function(bJ){function bK(bN,bO){var bP;{bP=U.FromDataContext(bO),bP==null?null:{$:1,$0:bN(bP.$0.get_Worker())};return;}}function bL(bN){var bO;bK((bO=bJ.Factory,function(bP){bO.RegisterEvent(bP);}),bN);}function bM(bN){var bO;bK((bO=bJ.Factory,function(bP){bO.RegisterWidget(bP);}),bN);}bL(v.Create("London",""));bL(s.Create(50,5));bL(w.get_Create());bM(z.get_Create());bM(y.Create(300,100,50));bM(A.get_Create());};W.$cctor=Y.Cctor(function(){var bJ;W.CreateDashboard=(bJ=T.Create(function(){return V.PanelContainerCreator();}),(V.Register(bJ),bJ));W.$cctor=a.ignore;});}());
