(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;a=window.WebSharper=window.WebSharper||{};b=a.Community=a.Community||{};c=b.Panel=b.Panel||{};d=c.Helper=c.Helper||{};e=c.TitleButton=c.TitleButton||{};f=c.Panel=c.Panel||{};g=c.PanelContainer=c.PanelContainer||{};h=c.Rect=c.Rect||{};i=c.LayoutManagers=c.LayoutManagers||{};j=window.StartupCode$WebSharper_Community_Panel$LayoutManagers=window.StartupCode$WebSharper_Community_Panel$LayoutManagers||{};k=c.Dialog=c.Dialog||{};l=a&&a.UI;m=l&&l.Next;n=m&&m.Doc;o=a&&a.List;p=m&&m.AttrModule;q=window.IntelliFactory;r=q&&q.Runtime;s=m&&m.Var;t=a&&a.Unchecked;u=m&&m.View;v=m&&m.Input;w=v&&v.Mouse;x=a&&a.Seq;y=m&&m.Key;z=m&&m.ListModel;A=window.console;d.IconSmall=function(B,C){return d.Icon("material-icons orange600 small",B,C);};d.IconNormal=function(B,C){return d.Icon("material-icons orange600",B,C);};d.Icon=function(B,C,D){return n.Element("i",new o.T({$:1,$0:p.Class(B),$1:d.AttrsClick(D)}),[n.TextNode(C)]);};d.AttrsClick=function(B){return o.ofArray([p.Style("Color","#FB8C00"),p.Style("cursor","pointer"),p.Handler("click",function(){return function(){return B();};})]);};e=c.TitleButton=r.Class({Render:function(B){var C;C=this;return d.IconSmall(this.Icon,function(){C.Action(B);});}},null,e);e.New=function(B,C){return new e({Icon:B,Action:C});};f=c.Panel=r.Class({get_Render:function(){var B,C,D,E,F,G,H,I,J,K,L,M,N;B=this;C=s.Create$1(false);D=s.Create$1(false);E=s.Create$1(0);F=s.Create$1(0);G=(H=function(O,P){var Q,R,S,T,U,V,W,X,Y,Z,_0,_1;return C.c?(Q=B.Element.c.getBoundingClientRect(),(R=B.Element.c.parentElement.getBoundingClientRect(),(S=R.width-Q.width,(T=R.height-Q.height,(U=(V=(W=0,(X=+O-E.c,t.Compare(W,X)===1?W:X)),t.Compare(S,V)===-1?S:V),(Y=(Z=(_0=0,(_1=+P-F.c,t.Compare(_0,_1)===1?_0:_1)),t.Compare(T,Z)===-1?T:Z),(s.Set(B.Left,U),s.Set(B.Top,Y),B.Relayout(B),[U,Y]))))))):[B.Left.c,B.Top.c];},u.Map(function(O){return H(O[0],O[1]);},u.UpdateWhile([0,0],u.Map(function(O){return O&&C.c;},w.get_LeftPressed()),w.get_Position())));I=x.concat([this.TitleAttrs,o.ofArray([p.Style("cursor","grab"),p.Handler("mouseenter",function(){return function(){return s.Set(D,true);};}),p.Handler("mouseleave",function(){return function(){return!C.c?s.Set(D,false):null;};}),p.Handler("mouseup",function(){return function(){s.Set(D,false);return s.Set(C,false);};}),p.Handler("mousedown",function(){return function(O){D.c&&!t.Equals(B.Element.c.parentElement,null)&&!t.Equals(B.Element.c.parentElement.parentElement,null)?s.Set(C,true):void 0;s.Set(E,+O.clientX-B.Left.c);return s.Set(F,+O.clientY-B.Top.c);};})])]);J=n.Element("table",[p.Style("width","100%")],[n.Element("tr",[],[n.Element("td",[],[this.TitleContent]),n.Element("td",[p.Style("text-align","right"),p.Style("vertical-align","middle")],o.map(function(O){return O.Render(B);},this.TitleButtons))])]);K=this.Width>0?o.ofArray([p.Style("width",(function(O){return function(P){return O(P.toFixed(6)+"px");};}(window.id))(this.Width))]):o.T.Empty;L=n.Element("div",x.concat([this.PannelAttrs,x.concat([K,this.Height>0?o.ofArray([p.Style("height",(function(O){return function(P){return O(P.toFixed(6)+"px");};}(window.id))(this.Height))]):o.T.Empty]),o.ofArray([p.DynamicStyle("left",u.Map(function(O){return(function(P){return function(Q){return P(Q.toFixed(6)+"px");};}(window.id))(O);},this.Left.v)),p.DynamicStyle("left",(M=function(O){return(function(P){return function(Q){return P(Q.toFixed(6)+"px");};}(window.id))(O);},u.Map(function(O){return M(O[0],O[1]);},G))),p.DynamicStyle("top",(N=function(O,P){return(function(Q){return function(R){return Q(R.toFixed(6)+"px");};}(window.id))(P);},u.Map(function(O){return N(O[0],O[1]);},G))),p.DynamicStyle("top",u.Map(function(O){return(function(P){return function(Q){return P(Q.toFixed(6)+"px");};}(window.id))(O);},this.Top.v))])]),[n.Element("table",[],[n.Element("tr",[],[n.Element("td",K,[this.IsWithTitle?n.Element("div",I,[J]):n.Element("div",[],[])])]),n.Element("tr",[],[n.Element("td",[],[this.PanelContent,this.Children.get_Render()])])])]);s.Set(this.Element,L.elt);return L.OnAfterRender(function(){B.onAfterRender(B);});},EditProperties:function(B){B.Edit(o.concat([this.Properties,o.concat(o.map(function(C){return C.Properties;},o.ofSeq(this.Children.PanelItems)))]));},WithHeight:function(B){return f.New(this.Key,this.Left,this.Top,this.Width,B,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithWidth:function(B){return f.New(this.Key,this.Left,this.Top,B,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithProperties:function(B){return f.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,B);},WithOnAfterRender:function(B){return f.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,B,this.Properties);},WithInternalName:function(B){return f.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,B,this.onAfterRender,this.Properties);},WithTitle:function(B){return f.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,B,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithChildPanelContainer:function(B){return f.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,B,this.InternalName,this.onAfterRender,this.Properties);},WithRelayoutFnc:function(B){return f.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,B,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithPanelContent:function(B){return f.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,B,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithTitleButtons:function(B){return f.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,B,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithTitleContent:function(B){return f.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,B,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithTitleAttrs:function(B){return f.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,B,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithPannelAttrs:function(B){return f.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,B,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);}},null,f);f.get_Create=function(){return f.New(y.Fresh(),s.Create$1(0),s.Create$1(0),0,0,s.Create$1(null),function(){},o.T.Empty,true,o.ofArray([p.Class("panelTitle")]),n.Element("div",[],[]),o.T.Empty,n.Element("div",[],[]),g.get_Create(),"",function(){},o.T.Empty);};f.New=function(B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R){return new f({Key:B,Left:C,Top:D,Width:E,Height:F,Element:G,Relayout:H,PannelAttrs:I,IsWithTitle:J,TitleAttrs:K,TitleContent:L,TitleButtons:M,PanelContent:N,Children:O,InternalName:P,onAfterRender:Q,Properties:R});};g=c.PanelContainer=r.Class({get_Render:function(){var B;B=this;return n.Element("div",x.concat([this.ContainerAttributes,this.Width>0?o.ofArray([p.Style("width",(function(C){return function(D){return C(D.toFixed(6)+"px");};}(window.id))(this.Width))]):o.T.Empty,this.Height>0?o.ofArray([p.Style("height",(function(C){return function(D){return C(D.toFixed(6)+"px");};}(window.id))(this.Height))]):o.T.Empty,o.ofArray([p.Style("position","relative")])]),[n.ConvertBy(function(C){return C.Key;},function(C){return C.get_Render().OnAfterRender(function(){B.LayoutManager.WebSharper_Community_Panel_ILayoutManager$PlacePanel(B,C);});},this.PanelItems.v)]);},AddPanel:function(B){var C,D;this.PanelItems.Append(B.WithRelayoutFnc((C=this.LayoutManager,(D=this,function(E){C.WebSharper_Community_Panel_ILayoutManager$Relayout(D,E);}))));},FindPanelItem:function(B){return x.find(function(C){return t.Equals(C.Element,B.Element);},o.ofSeq(this.PanelItems));},WithHeight:function(B){return g.New(this.Width,B,this.PanelItems,this.LayoutManager,this.ContainerAttributes);},WithWidth:function(B){return g.New(B,this.Height,this.PanelItems,this.LayoutManager,this.ContainerAttributes);},WithLayoutManager:function(B){return g.New(this.Width,this.Height,this.PanelItems,B,this.ContainerAttributes);},WithAttributes:function(B){return g.New(this.Width,this.Height,this.PanelItems,this.LayoutManager,B);}},null,g);g.get_Create=function(){return g.New(0,0,z.Create(function(B){return B.Key;},o.T.Empty),{WebSharper_Community_Panel_ILayoutManager$Relayout:function(){return null;},WebSharper_Community_Panel_ILayoutManager$PlacePanel:function(){return null;}},o.T.Empty);};g.New=function(B,C,D,E,F){return new g({Width:B,Height:C,PanelItems:D,LayoutManager:E,ContainerAttributes:F});};h=c.Rect=r.Class({toString:function(){return"left:"+window.String(this.left)+" "+" top:"+window.String(this.top)+" right:"+window.String(this.right)+" bottom:"+window.String(this.bottom);},inflate:function(B,C){return h.New(this.left-B,this.right+B,this.top-C,this.bottom+C);},get_height:function(){return this.bottom-this.top;},get_width:function(){return this.right-this.left;},intersect:function(B){var C,D,E,F,G,H,I,J,K,L,M,N;C=(D=this.left,(E=B.left,t.Compare(D,E)===1?D:E));F=(G=this.right,(H=B.right,t.Compare(G,H)===-1?G:H));I=(J=this.top,(K=B.top,t.Compare(J,K)===1?J:K));L=(M=this.bottom,(N=B.bottom,t.Compare(M,N)===-1?M:N));return h.New(C,t.Compare(C,F)===1?C:F,I,t.Compare(I,L)===1?I:L);},offset:function(B,C){return h.New(this.left+B,this.right+B,this.top+C,this.bottom+C);},get_isEmpty:function(){return this.left>=this.right||this.top>=this.bottom;}},null,h);h.fromPanel=function(B){return h.fromDomRect(B.Element.c).offset(B.Left.c,B.Top.c);};h.fromDomRect=function(B){var C;return!t.Equals(B,null)?(C=B.getBoundingClientRect(),h.New(0,C.width,0,C.height)):h.Create(0,0,0,0);};h.Create=function(B,C,D,E){return h.New(B,D,C,E);};h.New=function(B,C,D,E){return new h({left:B,right:C,top:D,bottom:E});};i.StackPanelLayoutManager=function(){j.$cctor();return j.StackPanelLayoutManager;};i.FloatingPanelLayoutManager=function(B){return{WebSharper_Community_Panel_ILayoutManager$Relayout:function(C,D){return i.relayout(C,D,B);},WebSharper_Community_Panel_ILayoutManager$PlacePanel:function(C,D){return i.placePanel(C,D,B);}};};i.relayout=function(B,C,D){var E,F,G;E=B.PanelItems;F=x.find(function(H){return t.Equals(H.Key,C.Key);},o.ofSeq(E));G=x.tryFind(function(H){return!t.Equals(H.Key,F.Key)&&!h.fromPanel(H).intersect(h.fromPanel(F)).get_isEmpty();},o.ofSeq(E));G!=null&&G.$==1?i.movePanelToFreeSpace(E,G.$0,D):void 0;};i.placePanel=function(B,C,D){var E,F,G;E=h.fromPanel(C);F=x.tryFind(function(H){return H.get_width()>=E.get_width()&&H.get_height()>=E.get_height();},i.collectFreeSpace(B.PanelItems,h.Create(0,0,B.Width,B.Height),C,D));F!=null&&F.$==1?(G=F.$0,s.Set(C.Left,G.left+D),s.Set(C.Top,G.top+D)):void 0;};i.movePanelToFreeSpace=function(B,C,D){var E,F,G;E=h.fromPanel(C);F=x.tryFind(function(H){return H.get_width()>=E.get_width()&&H.get_height()>=E.get_height();},i.collectFreeSpace(B,h.fromDomRect(C.Element.c.parentElement),C,D));F!=null&&F.$==1?(G=F.$0,s.Set(C.Left,G.left+D),s.Set(C.Top,G.top+D)):void 0;};i.collectFreeSpace=function(B,C,D,E){var F;F=o.filter(function(G){return!t.Equals(G.Key,D.Key);},o.ofSeq(B));return x.fold(function(G,H){var I,J,K;I=i.panelRect(H,0);J=h.New(0,C.right,0,I.top);K=h.New(0,I.left,0,C.bottom);return o.concat(o.map(function(L){return o.filter(function(M){return!M.get_isEmpty();},o.map(function(M){return M.intersect(L);},G));},o.ofArray([J,K,h.New(I.right,C.right,K.top,K.bottom),h.New(J.left,J.right,I.bottom,C.bottom)])));},o.ofArray([C]),F);};i.calcClientArea=function(B,C,D){var E;E=o.map(function(F){A.log(F.InternalName);return i.panelRect(F,D);},function(F,G){var H,I;while(true)if(G.$==1){H=G.$1;I=G.$0;if(t.Equals(I.Key,C.Key))return F;else{F=new o.T({$:1,$0:I,$1:F});G=H;}}else return F;}(o.T.Empty,o.ofSeq(B)));return E.$==0?h.Create(0,0,0,0):h.Create(o.min(o.map(function(F){return F.left;},E)),o.min(o.map(function(F){return F.top;},E)),o.max(o.map(function(F){return F.right;},E)),o.max(o.map(function(F){return F.bottom;},E)));};i.panelRect=function(B,C){return h.fromPanel(B).inflate(C,C);};j.$cctor=r.Cctor(function(){j.StackPanelLayoutManager={WebSharper_Community_Panel_ILayoutManager$Relayout:function(B,C){return i.relayout(B,C,0);},WebSharper_Community_Panel_ILayoutManager$PlacePanel:function(){return null;}};j.$cctor=window.ignore;});k=c.Dialog=r.Class({get_Render:function(){var B;B=this;return n.Element("div",[p.Style("position","absolute"),p.Style("left","50%"),p.Style("top","50%"),p.Style("z-index","1"),p.Style("background-color","white"),p.Style("min-height","100px"),p.Style("min-width","200px"),p.DynamicStyle("display",u.Map(function(C){return C?"block":"none";},this.Visibility.v))],[n.Element("table",[p.Style("background-color","grey"),p.Style("display","block"),p.Style("min-height","100px"),p.Style("min-width","200px")],[n.Element("table",[],[n.Element("tr",[],[n.Element("td",[p.Style("border-style","hidden"),p.Style("background","#404040"),p.Style("color","rgb(200,200,200)"),p.Style("padding","0px 2px 5px 2px"),p.Style("Width","200px"),p.Style("font-size","medium")],[n.TextView(this.Title.v)])])]),n.Element("table",[],[n.Element("tr",[],[n.Element("td",[p.Style("padding","5px 0px 0px 2px")],[n.BindView(window.id,this.Content.v)])]),n.Element("tr",[],[n.Element("td",[p.Style("padding","20px 12px 2px 20px")],[n.Element("button",[p.Style("border-radius","2px"),p.Handler("click",function(){return function(){s.Set(B.Visibility,false);return B.OKCallback.c();};})],[n.TextNode("OK")])]),n.Element("td",[p.Style("padding","20px 12px 2px 50px")],[n.Element("button",[p.Style("border-radius","2px"),p.Handler("click",function(){return function(){return s.Set(B.Visibility,false);};})],[n.TextNode("Cancel")])])])])])]);},ShowDialog:function(B,C,D){s.Set(this.Title,B);s.Set(this.Content,C);s.Set(this.Visibility,true);s.Set(this.OKCallback,D);}},null,k);k.get_Create=function(){return k.New(s.Create$1(""),s.Create$1(n.Element("div",[],[])),s.Create$1(false),s.Create$1(function(){}));};k.New=function(B,C,D,E){return new k({Title:B,Content:C,Visibility:D,OKCallback:E});};}());
