(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Community=b.Community||{};d=c.Dashboard=c.Dashboard||{};e=d.Environment=d.Environment||{};f=e.Role=e.Role||{};g=a.StartupCode$WebSharper_Community_Dashboard$Environment=a.StartupCode$WebSharper_Community_Dashboard$Environment||{};h=d.MessageBus=d.MessageBus||{};i=h.Value=h.Value||{};j=h.Message=h.Message||{};k=h.ListenerInfo=h.ListenerInfo||{};l=h.AgentMessage=h.AgentMessage||{};m=h.AgentState=h.AgentState||{};n=a.StartupCode$WebSharper_Community_Dashboard$MessageBus=a.StartupCode$WebSharper_Community_Dashboard$MessageBus||{};o=d.InPortData=d.InPortData||{};p=d.InPort=d.InPort||{};q=d.OutPort=d.OutPort||{};r=d.WorkerData=d.WorkerData||{};s=d.Worker=d.Worker||{};t=d.Workers=d.Workers||{};u=d.RuleEntry=d.RuleEntry||{};v=d.RuleChain=d.RuleChain||{};w=d.RuleContainer=d.RuleContainer||{};x=d.WorkerItem=d.WorkerItem||{};y=d.Factory=d.Factory||{};z=d.RulesCellItem=d.RulesCellItem||{};A=d.RulesRowItem=d.RulesRowItem||{};B=d.SelectorGroup=d.SelectorGroup||{};C=d.WindowSelector=d.WindowSelector||{};D=d.WidgetItem=d.WidgetItem||{};E=d.EventsGroupItem=d.EventsGroupItem||{};F=d.WidgetsGroupItem=d.WidgetsGroupItem||{};G=d.RulesGroupItem=d.RulesGroupItem||{};H=d.DshData=d.DshData||{};I=d.RulesEditor=d.RulesEditor||{};J=d.DshHelper=d.DshHelper||{};K=d.Dashboard=d.Dashboard||{};L=d.Events=d.Events||{};M=L.RandomEvent=L.RandomEvent||{};N=L.DatabaseEventContext=L.DatabaseEventContext||{};O=L.DatabaseEvent=L.DatabaseEvent||{};P=L.OpenWeather=L.OpenWeather||{};Q=P.Forecast=P.Forecast||{};R=L.OpenWeatherEvent=L.OpenWeatherEvent||{};S=d.Widgets=d.Widgets||{};T=S.TextBoxWidget=S.TextBoxWidget||{};U=S.ChartWidgetContext=S.ChartWidgetContext||{};V=S.ChartWidget=S.ChartWidget||{};W=S.ButtonWidget=S.ButtonWidget||{};X=d.AppModelLib=d.AppModelLib||{};Y=d.App=d.App||{};Z=a.StartupCode$WebSharper_Community_Dashboard$AppModelLib=a.StartupCode$WebSharper_Community_Dashboard$AppModelLib||{};_0=d.AppDataHelper=d.AppDataHelper||{};_1=d.AppData=d.AppData||{};_2=a.IntelliFactory;_3=_2&&_2.Runtime;_4=b&&b.Operators;_5=c&&c.Panel;_6=_5&&_5.Helper;_7=a.Date;_8=b&&b.List;_9=b&&b.Concurrency;_=b&&b.Remoting;$=_&&_.AjaxRemotingProvider;ba=b&&b.Control;bb=ba&&ba.MailboxProcessor;bc=b&&b.Seq;bd=b&&b.Utils;be=b&&b.UI;bf=be&&be.Next;bg=bf&&bf.View;bh=bf&&bf.Var;bi=c&&c.PropertyGrid;bj=bi&&bi.Properties;bk=b&&b.Guid;bl=b&&b.Unchecked;bm=bf&&bf.Doc;bn=b&&b.Enumerator;bo=bf&&bf.Key;bp=bf&&bf.ListModel;bq=a.console;br=bf&&bf.AttrModule;bs=b&&b.Option;bt=_5&&_5.WrapControls;bu=_5&&_5.PanelContainer;bv=_5&&_5.LayoutManagers;bw=_5&&_5.Panel;bx=_5&&_5.TitleButton;by=_5&&_5.Dialog;bz=bi&&bi.PropertyGrid;bA=b&&b.Random;bB=a.Math;bC=b&&b.Data;bD=bC&&bC.TxtRuntime;bE=a.FSharp;bF=bE&&bE.Data;bG=bF&&bF.Runtime;bH=bG&&bG.IO;bI=a.JSON;bJ=b&&b.Arrays;bK=b&&b.Charting;bL=bK&&bK.Renderers;bM=bL&&bL.ChartJs;bN=bK&&bK.Chart;bO=bK&&bK.Pervasives;f.Server={$:1};f.Client={$:0};e.DataDirectory=function(){g.$cctor();return g.DataDirectory;};e.set_DataDirectory=function(bP){g.$cctor();g.DataDirectory=bP;};e.Log=function(){g.$cctor();return g.Log;};e.set_Log=function(bP){g.$cctor();g.Log=bP;};e.Role$1=function(){g.$cctor();return g.Role;};e.set_Role=function(bP){g.$cctor();g.Role=bP;};g.$cctor=_3.Cctor(function(){g.Role=f.Server;g.Log=a.ignore;g.DataDirectory="";g.$cctor=a.ignore;});i=h.Value=_3.Class({get_AsBoolean:function(){return this.$==2?this.$0:_4.FailWith("MessageBus.Value: unexpected type");},get_AsString:function(){return this.$==1?this.$0:_4.FailWith("MessageBus.Value: unexpected type");},get_AsNumber:function(){return this.$==0?this.$0:_4.FailWith("MessageBus.Value: unexpected type");}},null,i);j=h.Message=_3.Class({WithTime:function(bP){return j.New(this.Key,bP,this.Value);},WithKey:function(bP){return j.New(bP,this.Time,this.Value);}},null,j);j.Create=function(bP){return j.New(_6.UniqueKey(),_7.now(),bP);};j.New=function(bP,bQ,bR){return new j({Key:bP,Time:bQ,Value:bR});};k.Create=function(bP,bQ,bR){return k.New(bP,bQ,bR);};k.New=function(bP,bQ,bR){return{Key:bP,Name:bQ,CacheSize:bR};};l.Clear={$:4};m.get_empty=function(){return m.New(null,_8.T.Empty);};m.New=function(bP,bQ){return{ServerCallback:bP,Listeners:bQ};};h.RunServerRequests=function(){var bP;_9.Start((bP=null,_9.Delay(function(){return _9.While(function(){return true;},_9.Delay(function(){return _9.Bind(_9.Sleep(2*1000),function(){return _9.Bind(h.Agent().PostAndAsyncReply(function(bQ){return{$:6,$0:bQ};},null),function(bQ){return _9.Bind((new $.New()).Async("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.MessageBus.GetMessages:1550733476",[bQ]),function(bR){var bS;_8.iter(function(bT){var bU;bU=h.Agent();bU.mailbox.AddLast({$:1,$0:bT});bU.resume();},bR);return bR.get_Length()>0?(bS=(function(bT){return function(bU){return bT("Values from server requested messages received:"+a.String(bU));};}(a.id))(bR.get_Length()),(h.log())(bS),_9.Zero()):_9.Zero();});});});}));})),null);};h.Agent=function(){n.$cctor();return n.Agent;};h.StringMessage=function(bP){return h.StringKeyMessage(_6.UniqueKey(),bP);};h.NumberMessage=function(bP){return h.NumberKeyMessage(_6.UniqueKey(),bP);};h.BooleanKeyMesage=function(bP,bQ){return h.CreateMessage(bP,new i({$:2,$0:bQ}));};h.StringKeyMessage=function(bP,bQ){return h.CreateMessage(bP,new i({$:1,$0:bQ}));};h.NumberKeyMessage=function(bP,bQ){return h.CreateMessage(bP,new i({$:0,$0:bQ}));};h.CreateMessage=function(bP,bQ){return j.New(bP,_7.now(),bQ);};h.log=function(){n.$cctor();return n.log;};n.$cctor=_3.Cctor(function(){n.log=e.Log();n.Agent=bb.Start(function(bP){function bQ(bV,bW){return bc.fold(function(bX,bY){var bZ;return(bZ=bY.Time-bV,bZ/1000)>0.01?new _8.T({$:1,$0:bY,$1:bX}):bX;},_8.T.Empty,bW);}function bR(bV,bW){return bV<bW.get_Length()?(_8.splitAt(bV,bW))[0]:bW;}function bS(bV,bW,bX){return bV===1?_8.ofArray([bX]):bR(bV,new _8.T({$:1,$0:bX,$1:bW}));}function bT(bV,bW){function bX(bY,bZ,b0){var b1;b1=a.Array.prototype.slice.call(arguments);return bY.Key===bV.Key?(bZ(bV),[bY,bZ,bS(bY.CacheSize,b0,bV)]):b1;}return _8.map(function(bY){return bX(bY[0],bY[1],bY[2]);},bW);}function bU(bV){var bW;bW=null;return _9.Delay(function(){return _9.Bind(bP.Receive(null),function(bX){var bY,bZ,b0,b1,b2,b3,b4;function b5(b7,b8,b9){return bQ(b0,b9);}function b6(b7,b8,b9){return b9.$==0?(new _7(0,0-1,0)).getTime():_8.maxBy(function(b_){return b_.Time;},b9).Time;}return bX.$==2?(bY=bX.$0[0],(bZ=(((_3.Curried3(function(b7,b8,b9){return b7("RegisterListener:"+bd.toSafe(b8)+" "+bd.toSafe(b9));}))(a.id))(bY.Name))(bY.Key),(h.log())(bZ),bU(m.New(bV.ServerCallback,new _8.T({$:1,$0:[bY,bX.$0[2],_8.T.Empty],$1:bV.Listeners}))))):bX.$==3?bU(m.New({$:1,$0:bX.$0},bV.Listeners)):bX.$==5?(b0=bX.$0[0],(bX.$0[1](bc.fold(function(b7,b8){return!_8.contains(b8,b7)?new _8.T({$:1,$0:b8,$1:b7}):b7;},_8.T.Empty,_8.concat(_8.map(function(b7){return b5(b7[0],b7[1],b7[2]);},bV.Listeners)))),bU(bV))):bX.$==6?(b1=_8.map(function(b7){return b6(b7[0],b7[1],b7[2]);},bV.Listeners),(bX.$0(b1.$==0?(new _7(0,0-1,0)).getTime():_8.max(b1)),bU(bV))):bX.$==1?bU(m.New(bV.ServerCallback,bT(bX.$0,bV.Listeners))):bX.$==0?(b2=bX.$0,(b3=(((_3.Curried3(function(b7,b8,b9){return b7("Num listeners:"+a.String(b8)+" msg:"+bd.toSafe(b9));}))(a.id))(bV.Listeners.get_Length()))(b2.Key),(h.log())(b3),(b4=bV.ServerCallback,b4==null?void 0:b4.$0(b2)),bU(m.New(bV.ServerCallback,bT(b2,bV.Listeners))))):bU(m.get_empty());});});}return bU(m.get_empty());},null);n.$cctor=a.ignore;});o.Create=function(bP,bQ,bR){return o.New(bQ.Key,bP,bQ,bR);};o.New=function(bP,bQ,bR,bS){return{Key:bP,Name:bQ,Value:bR,CacheSize:bS};};p=d.InPort=_3.Class({Equals:function(bP){return bP instanceof p&&this.Data.Name===bP.Data.Name;},get_BooleanView:function(){return bg.Map(function(bP){return bP.Value.get_AsBoolean();},this.PortValue.v);},get_Boolean:function(){return this.PortValue.c.Value.get_AsBoolean();},get_StringView:function(){return bg.Map(function(bP){return bP.Value.get_AsString();},this.PortValue.v);},get_String:function(){return this.PortValue.c.Value.get_AsString();},get_NumberView:function(){return bg.Map(function(bP){return bP.Value.get_AsNumber();},this.PortValue.v);},get_Number:function(){return this.PortValue.c.Value.get_AsNumber();},Receive:function(bP){bh.Set(this.PortValue,bP);},get_Property:function(){var bP,bQ,bR,bS,bT;bP=this;bQ=this.PortValue.c.Value;return bQ.$==1?(bR=bh.Create$1(this.get_String()),(bg.Sink(function(bU){var bV;bh.Set(bP.PortValue,(bV=bP.PortValue.c,j.New(bV.Key,bV.Time,new i({$:1,$0:bU}))));},bR.v),bj.string(this.Data.Name,bR))):bQ.$==2?(bS=bh.Create$1(this.get_Boolean()),(bg.Sink(function(bU){var bV;bh.Set(bP.PortValue,(bV=bP.PortValue.c,j.New(bV.Key,bV.Time,new i({$:2,$0:bU}))));},bS.v),bj.check(this.Data.Name,bS))):(bT=bh.Create$1(this.get_Number()),(bg.Sink(function(bU){var bV;bh.Set(bP.PortValue,(bV=bP.PortValue.c,j.New(bV.Key,bV.Time,new i({$:0,$0:bU}))));},bT.v),bj["double"](this.Data.Name,bT)));},get_Key:function(){return this.Data.Key;},get_Name:function(){return this.Data.Name;}},null,p);p.Clone=function(bP){var bQ,bR;return p.New((bQ=bP.Data,o.New((bR=bk.NewGuid(),a.String(bR)),bQ.Name,bQ.Value,bQ.CacheSize)),bh.Create$1(bP.PortValue.c));};p.ToData=function(bP){var bQ;bQ=bP.Data;return o.New(bQ.Key,bQ.Name,bP.PortValue.c,bQ.CacheSize);};p.FromData=function(bP){return p.New(bP,bh.Create$1(bP.Value));};p.New=function(bP,bQ){return new p({Data:bP,PortValue:bQ});};q=d.OutPort=_3.Class({Equals:function(bP){return bP instanceof q&&this.Name===bP.Name;},Trigger:function(bP){var bQ;bQ=h.Agent();bQ.mailbox.AddLast({$:0,$0:h.CreateMessage(this.Key,bP)});bQ.resume();}},null,q);q.Clone=function(bP){return q.New(_6.UniqueKey(),bP.Name,bP.Type);};q.ToData=function(bP){return[bP.Name,bP.Type];};q.FromData=function(bP,bQ){return q.New(bQ.Key,bP,bQ);};q.New=function(bP,bQ,bR){return new q({Key:bP,Name:bQ,Type:bR});};r.CreateWithCache=function(bP,bQ,bR){return r.New(bP,_8.map(function(bS){return o.Create(bS[0],bS[1],bS[2]);},bQ),bR);};r.Create=function(bP,bQ,bR){function bS(bT,bU){return o.Create(bT,bU,1);}return r.New(bP,_8.map(function(bT){return bS(bT[0],bT[1]);},bQ),bR);};r.New=function(bP,bQ,bR){return{WorkerName:bP,InPorts:bQ,OutPorts:bR};};s=d.Worker=_3.Class({Equals:function(bP){return bP instanceof s&&bl.Equals(this.Name,bP.Name);},get_Properties:function(){return new _8.T({$:1,$0:bj.string("Name",this.Name),$1:_8.map(function(bP){return bP.get_Property();},this.InPorts)});},get_Render:function(){var bP;bP=this.Data.WebSharper_Community_Dashboard_IWorkerData$get_Render();return bP==null?bm.Empty():bP.$0(this);},get_Clone:function(){return s.New(_6.UniqueKey(),bh.Create$1(this.Name.c),_8.map(p.Clone,this.InPorts),_8.map(q.Clone,this.OutPorts),this.Data,bh.Create$1(null));},get_ToData:function(){return r.New(this.Name.c,_8.map(p.ToData,this.InPorts),_8.map(q.ToData,this.OutPorts));},StartRunner:function(){var bP;bP=this.Data.WebSharper_Community_Dashboard_IWorkerData$get_Run();bP==null?void 0:bh.Set(this.RunnerContext,bP.$0(this));},WithKey:function(bP){return s.New(bP,this.Name,this.InPorts,this.OutPorts,this.Data,this.RunnerContext);}},null,s);s.Create=function(bP){return s.New(_6.UniqueKey(),bh.Create$1(bP.WebSharper_Community_Dashboard_IWorkerData$get_Data().WorkerName),_8.map(p.FromData,bP.WebSharper_Community_Dashboard_IWorkerData$get_Data().InPorts),_8.map(function(bQ){return q.FromData(bQ[0],bQ[1]);},bP.WebSharper_Community_Dashboard_IWorkerData$get_Data().OutPorts),bP,bh.Create$1(null));};s.New=function(bP,bQ,bR,bS,bT,bU){return new s({Key:bP,Name:bQ,InPorts:bR,OutPorts:bS,Data:bT,RunnerContext:bU});};t.allInPorts=function(bP){return t.allPorts(bP,function(bQ){return bQ.InPorts;});};t.allOutPorts=function(bP){return t.allPorts(bP,function(bQ){return bQ.OutPorts;});};t.allPorts=function(bP,bQ){return _8.concat(_8.map(bQ,bP));};u.New=function(bP,bQ,bR){return{InPortKey:bP,OutPortKey:bQ,WorkerKey:bR};};v.New=function(bP){return{RuleChain:bP};};w=d.RuleContainer=_3.Class({Reconnect:function(bP){var bQ,bR,bS,bT;bQ=e.Log();bR=t.allOutPorts(bP);bS=t.allInPorts(bP);_8.iter(function(bU){(e.Log())((((_3.Curried3(function(bV,bW,bX){return bV("InPort: "+bd.toSafe(bW)+" "+bd.toSafe(bX));}))(a.id))(bU.get_Name()))(bU.Data.Key));},bS);_8.iter(function(bU){(e.Log())((((_3.Curried3(function(bV,bW,bX){return bV("outPort: "+bd.toSafe(bW)+" "+bd.toSafe(bX));}))(a.id))(bU.Name))(bU.Key));},bR);bT=h.Agent();bT.mailbox.AddLast(l.Clear);bT.resume();_8.iter(function(bU){var bV,bW,bX;bV=_8.ofSeq(bU.RuleChain);bW=_8.ofSeq(_4.range(1,bV.get_Length()-1));bX=bn.Get(bW);try{while(bX.MoveNext())(function(){var bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7;bY=bX.Current();bZ=bV.get_Item(bY-1);b0=bV.get_Item(bY);{b1=bc.tryFind(function(b8){return b8.Key===bZ.OutPortKey;},bR),b1==null?null:{$:1,$0:(b2=b1.$0,(bQ((((_3.Curried3(function(b8,b9,b_){return b8("Found outPort "+bd.toSafe(b9)+" try to find inPort:"+bd.toSafe(b_));}))(a.id))(bZ.OutPortKey))(b0.InPortKey)),b3=bc.tryFind(function(b8){return b8.Data.Key===b0.InPortKey;},bS),b3==null?null:{$:1,$0:(b4=b3.$0,(bQ("Found inPort"),b4.PortValue.c.Key!==b4.Data.Key?bh.Set(b4.PortValue,b4.PortValue.c.WithKey(b4.Data.Key)):void 0,b5=(b6=b4.PortValue.c.Value,b6.$==1?j.Create(new i({$:1,$0:""})):b6.$==2?j.Create(new i({$:2,$0:false})):j.Create(new i({$:0,$0:0}))),b7=h.Agent(),b7.mailbox.AddLast({$:2,$0:[k.Create(b2.Key,b2.Name+"->"+b4.get_Name(),b4.Data.CacheSize),b5,function(b8){b4.Receive(b8);}]}),b7.resume()))}))};return;}}());}finally{if("Dispose"in bX)bX.Dispose();}},_8.ofSeq(this.RuleContainer));}},null,w);w.New=function(bP){return new w({RuleContainer:bP});};x.Create=function(bP){return x.New(bo.Fresh(),bP);};x.New=function(bP,bQ){return{Key:bP,Worker:bQ};};y=d.Factory=_3.Class({RegisterEvent:function(bP){this.EventItems.Append(x.Create(bP));},RegisterWidget:function(bP){this.WidgetItems.Append(x.Create(bP));}},null,y);y.get_Create=function(){return y.New(bp.Create(function(bP){return bP.Key;},_8.T.Empty),bp.Create(function(bP){return bP.Key;},_8.T.Empty));};y.New=function(bP,bQ){return new y({EventItems:bP,WidgetItems:bQ});};z=d.RulesCellItem=_3.Class({Render:function(bP,bQ){var bR,bS,bT,bU,bV;bR=this;bg.Sink(function(bW){var bX;if(bW==null);else{bX=bW.$0;bq.log("Workitem selected");bh.Set(bR.OptInPort,_8.tryHead(bX.Worker.InPorts));bh.Set(bR.OptOutPort,_8.tryHead(bX.Worker.OutPorts));bQ();}},this.OptWorker.v);bg.Sink(function(){bQ();},this.OptInPort.v);bg.Sink(function(){bQ();},this.OptOutPort.v);bS=(bT=bg.Map(function(bW){var bX;return bW==null?_8.ofArray([null]):(bX=_8.map(function(bY){return{$:1,$0:bY};},bW.$0.Worker.InPorts),bX.get_Length()>0?bX:_8.ofArray([null]));},this.OptWorker.v),(bU=bg.Map(function(bW){var bX;return bW==null?_8.ofArray([null]):(bX=_8.map(function(bY){return{$:1,$0:bY};},bW.$0.Worker.OutPorts),bX.get_Length()>0?bX:_8.ofArray([null]));},this.OptWorker.v),(bV=bg.Map(function(bW){return new _8.T({$:1,$0:null,$1:_8.map(function(bX){return{$:1,$0:bX};},_8.ofSeq(bW))});},bP.v),bm.Element("table",[],[bm.Element("tr",[],[bm.Element("td",[],[bm.SelectDyn([br.Class("form-control")],function(bW){return bs.fold(function(bX,bY){return bY.get_Name();}," ",bW);},bT,this.OptInPort)]),bm.Element("td",[],[bm.SelectDyn([br.Class("form-control")],function(bW){return bs.fold(function(bX,bY){return bY.Worker.Name.c;}," ",bW);},bV,this.OptWorker)]),bm.Element("td",[],[bm.SelectDyn([br.Class("form-control")],function(bW){return bs.fold(function(bX,bY){return bY.Name;}," ",bW);},bU,this.OptOutPort)])])]))));return bm.Element("td",[br.Class("td DshEditorCell")],[bm.Element("div",[br.Class("div DshEditorCell")],[bm.Element("table",[],[bm.Element("tr",[],[bm.Element("td",[],[bS])])])])]);}},null,z);z.get_Create=function(){return z.New(bo.Fresh(),bh.Create$1(null),bh.Create$1(null),bh.Create$1(null));};z.New=function(bP,bQ,bR,bS){return new z({Key:bP,OptInPort:bQ,OptWorker:bR,OptOutPort:bS});};A=d.RulesRowItem=_3.Class({Render:function(bP,bQ){var bR;bR=this;return bm.Element("tr",[],[bm.ConvertBy(function(bS){return bS.Key;},function(bS){return bS.Render(bP,bQ);},this.CellItems.v),_6.IconNormal("add",function(){bR.CellItems.Append(z.get_Create());})]);}},null,A);A.Create=function(bP){return A.New(bo.Fresh(),bp.Create(function(bQ){return bQ.Key;},bP));};A.New=function(bP,bQ){return new A({Key:bP,CellItems:bQ});};B=d.SelectorGroup=_3.Class({RenderMenu:function(bP,bQ,bR){var bS,bT,bU,bV,bW,bX;function bY(bZ){return _8.ofArray([_6.IconSmall("keyboard_arrow_down",function(){(bT(true))(bZ);(bS.ItemOnMove(bZ))({$:1});}),_6.IconSmall("keyboard_arrow_up",function(){(bT(false))(bZ);(bS.ItemOnMove(bZ))({$:0});}),_6.IconSmall("clear",function(){bS.SelectorItems.Remove(bZ);bS.ItemOnDelete(bZ);})]);}bS=this;bT=(bU=this.SelectorItems,(_3.Curried3(_6.MoveItemInModelList))(bU));bV=(bW=this.ItemCreatator,bW==null?bm.Element("tr",[],[]):(bX=bW.$0,bm.Element("tr",[],[bm.Element("td",[],[bm.Element("div",[br.Style("margin-left","20px")],[_6.IconSmall("add",function(){var bZ;bZ=bX();bS.ItemOnCreated(bZ);bS.SelectorItems.Append(bZ);})])])])));return bm.Element("table",[],[bm.ConvertBy(function(bZ){return bZ.WebSharper_Community_Dashboard_ISelectorItem$get_Key();},function(bZ){var b0,b1,b2,b3;b0=bg.Map(function(b4){return bP+b4;},bZ.WebSharper_Community_Dashboard_ISelectorItem$get_Name().v);return bm.Element("tr",[],[bm.Element("td",[br.DynamicStyle("Color",bg.Map(function(b4){return b4==null?"#7D4600":bl.Equals(b4.$0.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bZ.WebSharper_Community_Dashboard_ISelectorItem$get_Key())?"#FB8C00":"#7D4600";},bQ.v))],[(b1=bm.Element("div",[br.Style("margin-left","10px"),br.Style("margin-right","5px"),br.Style("cursor","pointer"),br.Handler("click",function(){return function(){bS.ItemOnSelected(bZ);return bh.Set(bQ,{$:1,$0:bZ});};})],[bm.TextView(b0)]),(bR?(b2=bY(bZ),(b3=_5.WrapControlsAligment.Horizontal,function(b4){return bt.Render(b2,b3,b4);})):a.id)(b1))])]);},this.SelectorItems.v),bV]);}},null,B);B.Create=function(bP,bQ,bR,bS,bT,bU,bV){var bW;bW=bp.Create(function(bX){return bX.WebSharper_Community_Dashboard_ISelectorItem$get_Key();},bQ);return B.New(bo.Fresh(),bh.Create$1(bP),bW,bR,bS,bT,bU,bV);};B.New=function(bP,bQ,bR,bS,bT,bU,bV,bW){return new B({Key:bP,Name:bQ,SelectorItems:bR,ItemCreatator:bS,ItemOnCreated:bT,ItemOnSelected:bU,ItemOnDelete:bV,ItemOnMove:bW});};C=d.WindowSelector=_3.Class({get_RenderMenu:function(){var bP;bP=this;return this.SelectorGroups.get_Length()===1?_8.head(_8.ofSeq(this.SelectorGroups)).RenderMenu("",this.OptSelectedItem,this.IsWithControls):bm.Element("div",[],[bm.ConvertBy(function(bQ){return bQ.Key;},function(bQ){return bm.Element("div",[],[bm.Element("div",[br.Style("cursor","pointer"),br.Handler("click",function(){return function(){return bP.GroupOnClick(bQ);};})],[bm.TextView(bQ.Name.v)]),bQ.RenderMenu("    ",bP.OptSelectedItem,bP.IsWithControls)]);},this.SelectorGroups.v)]);},get_Render:function(){return bm.Element("div",[],[bm.BindView(function(bP){return bP==null?bm.Empty():bP.$0.WebSharper_Community_Dashboard_ISelectorItem$get_Render();},this.OptSelectedItem.v)]);},GroupByIndex:function(bP){return bc.nth(bP,_8.ofSeq(this.SelectorGroups));},get_SelectedIndex:function(){var bP;bP=this;return bc.findIndex(function(bQ){return bl.Equals(bQ.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bP.get_SelectedItem().WebSharper_Community_Dashboard_ISelectorItem$get_Key());},_8.concat(_8.map(function(bQ){return _8.ofSeq(bQ.SelectorItems);},_8.ofSeq(this.SelectorGroups))));},get_SelectedIndexInGroup:function(){var bP;bP=this;return bc.findIndex(function(bQ){return bl.Equals(bQ.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bP.get_SelectedItem().WebSharper_Community_Dashboard_ISelectorItem$get_Key());},_8.ofSeq(this.get_SelectedGroup().SelectorItems));},get_SelectedGroupIndex:function(){var bP;bP=this;return bc.findIndex(function(bQ){return bl.Equals(bQ.Key,bP.get_SelectedGroup().Key);},_8.ofSeq(this.SelectorGroups));},get_SelectedGroup:function(){return this.GroupFromItem(this.get_SelectedItem());},GroupFromItem:function(bP){return bc.find(function(bQ){return _8.exists(function(bR){return bl.Equals(bR.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bP.WebSharper_Community_Dashboard_ISelectorItem$get_Key());},_8.ofSeq(bQ.SelectorItems));},_8.ofSeq(this.SelectorGroups));},AppenGroup:function(bP,bQ,bR){var bS;bS=this.SelectorGroups.get_Length();this.SelectorGroups.Append(B.Create(bP,bQ,bR,this.ItemOnCreated(bS),this.ItemOnSelected,this.ItemOnDeleted(bS),this.ItemOnMove(bS)));},get_SelectedItem:function(){var bP;bP=this.OptSelectedItem.c;return bP==null?_4.FailWith("Something really wrong with WindowSelector"):bP.$0;},ClearGroups:function(){bh.Set(this.OptSelectedItem,null);_8.iter(function(bP){bP.SelectorItems.Clear();},_8.ofSeq(this.SelectorGroups));},WithControls:function(bP){return C.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,bP);},WithItemOnMove:function(bP){return C.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,bP,this.IsWithControls);},WithItemOnDeleted:function(bP){return C.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,bP,this.ItemOnMove,this.IsWithControls);},WithItemOnSelected:function(bP){return C.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,bP,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);},WithGroupOnClick:function(bP){return C.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,bP,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);},WithItemOnCreated:function(bP){return C.New(this.OptSelectedItem,this.SelectorGroups,bP,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);}},null,C);C.get_Create=function(){var bP;bP=bp.Create(function(bQ){return bQ.Key;},_8.T.Empty);return C.New(bh.Create$1(null),bP,function(){return function(){return null;};},a.ignore,a.ignore,function(){return function(){return null;};},_3.Curried3(function(bQ,bR,bS){return null;}),false);};C.New=function(bP,bQ,bR,bS,bT,bU,bV,bW){return new C({OptSelectedItem:bP,SelectorGroups:bQ,ItemOnCreated:bR,GroupOnClick:bS,ItemOnSelected:bT,ItemOnDeleted:bU,ItemOnMove:bV,IsWithControls:bW});};D.Create=function(bP,bQ){return D.New(bo.Fresh(),bP,bQ);};D.New=function(bP,bQ,bR){return{Key:bP,Panel:bQ,Widget:bR};};E=d.EventsGroupItem=_3.Class({get_Render:function(){var bP,bQ,bR;function bS(bT){return _8.ofArray([_6.IconSmall("keyboard_arrow_down",function(){(bQ(true))(bT);}),_6.IconSmall("keyboard_arrow_up",function(){(bQ(false))(bT);}),_6.IconSmall("clear",function(){bP.EventItems.Remove(bT);})]);}bP=this;bQ=(bR=this.EventItems,(_3.Curried3(_6.MoveItemInModelList))(bR));return bm.Element("table",[],[bm.ConvertBy(function(bT){return bT.Key;},function(bT){var bU;return bm.Element("tr",[],[(bU=bm.Element("div",_6.AttrsClick(function(){bP.PropertyGrid.Edit(bT.Worker.get_Properties());}),[bm.TextView(bT.Worker.Name.v)]),bt.Render(bS(bT),_5.WrapControlsAligment.Horizontal,bU))]);},this.EventItems.v)]);},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,E);E.Create=function(bP,bQ){return E.New(bo.Fresh(),bh.Create$1(bP),bp.Create(function(bR){return bR.Key;},_8.T.Empty),bQ);};E.New=function(bP,bQ,bR,bS){return new E({Key:bP,Name:bQ,EventItems:bR,PropertyGrid:bS});};F=d.WidgetsGroupItem=_3.Class({get_Render:function(){return this.PanelContainer.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,F);F.Create=function(bP,bQ){return F.New(bo.Fresh(),bh.Create$1(bP),bp.Create(function(bR){return bR.Key;},_8.T.Empty),bQ);};F.New=function(bP,bQ,bR,bS){return new F({Key:bP,Name:bQ,WidgetItems:bR,PanelContainer:bS});};G=d.RulesGroupItem=_3.Class({Equals:function(bP){return bP instanceof G&&bl.Equals(this.Key,bP.Key);},get_Render:function(){return this.Renderer(this.RulesRowItems);},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,G);G.Create=function(bP,bQ){return G.New(bo.Fresh(),bh.Create$1(bP),bp.Create(function(bR){return bR.Key;},_8.T.Empty),bQ);};G.New=function(bP,bQ,bR,bS){return new G({Key:bP,Name:bQ,RulesRowItems:bR,Renderer:bS});};H=d.DshData=_3.Class({RegisterWidget:function(bP,bQ,bR,bS){var bT;bT=bS.WithKey(bP);bQ.WidgetItems.Append(D.Create(bR,bT));this.WorkItems.Append(x.Create(bT));},RegisterEvent:function(bP,bQ,bR){var bS;bS=x.Create(bR.WithKey(bP));bQ.EventItems.Append(bS);this.WorkItems.Append(bS);},get_Clear:function(){this.WorkItems.Clear();this.WidgetGroups.Clear();this.EventGroups.Clear();this.RulesGroups.Clear();}},null,H);H.get_Create=function(){return H.New(bp.Create(function(bP){return bP.Key;},_8.T.Empty),bp.Create(function(bP){return bP.Key;},_8.T.Empty),bp.Create(function(bP){return bP.Key;},_8.T.Empty),bp.Create(function(bP){return bP.Key;},_8.T.Empty));};H.New=function(bP,bQ,bR,bS){return new H({WorkItems:bP,WidgetGroups:bQ,EventGroups:bR,RulesGroups:bS});};I.Render=function(bP,bQ){function bR(bU,bV){return _6.MoveItemInModelList(bQ,bU,bV);}function bS(bU){return _8.ofArray([_6.IconSmall("keyboard_arrow_down",function(){bR(true,bU);}),_6.IconSmall("keyboard_arrow_up",function(){bR(false,bU);}),_6.IconSmall("clear",function(){bQ.Remove(bU);})]);}function bT(){var bU;bU=_8.map(function(bV){return bV.Worker;},_8.ofSeq(bP.WorkItems));I.CopyToRules(bQ).Reconnect(bU);}return bm.Element("table",[],[bm.ConvertBy(function(bU){return bU.Key;},function(bU){var bV;return bm.Element("tr",[],[(bV=bU.Render(bP.WorkItems,function(){bT();}),bt.Render(bS(bU),_5.WrapControlsAligment.Horizontal,bV))]);},bQ.v)]);};I.Restore=function(bP,bQ,bR){var bS,bT,bU;bQ.Clear();bS=_8.map(function(bV){return bV.Worker;},_8.ofSeq(bP.WorkItems));bT=t.allOutPorts(bS);bU=t.allInPorts(bS);_8.iter(function(bV){var bW;bW=A.Create([]);_8.iter(function(bX){var bY;bY=z.get_Create();bh.Set(bY.OptWorker,bc.tryFind(function(bZ){return bZ.Worker.Key===bX.WorkerKey;},_8.ofSeq(bP.WorkItems)));bh.Set(bY.OptInPort,bc.tryFind(function(bZ){return bZ.get_Key()===bX.InPortKey;},bU));bh.Set(bY.OptOutPort,bc.tryFind(function(bZ){return bZ.Key===bX.OutPortKey;},bT));bW.CellItems.Append(bY);},bV.RuleChain);bQ.Append(bW);},bR.RuleContainer);bR.Reconnect(bS);};I.CopyToRules=function(bP){return w.New(_8.map(function(bQ){return v.New(_8.map(function(bR){var bS,bT,bU;return u.New((bS=bR.OptInPort.c,bS==null?"":bS.$0.get_Key()),(bT=bR.OptOutPort.c,bT==null?"":bT.$0.Key),(bU=bR.OptWorker.c,bU==null?"":bU.$0.Worker.Key));},_8.ofSeq(bQ.CellItems)));},_8.ofSeq(bP)));};J.RulesGroupCreator=function(bP,bQ){var bR;bR=G.Create("rules"+a.String(_8.length(_8.ofSeq(bP.RulesGroups))+1),function(bS){return I.Render(bP,bS);});bP.RulesGroups.Append(bR);return bR;};J.EventsGroupCreator=function(bP,bQ,bR){var bS;bS=E.Create("event"+a.String(_8.length(_8.ofSeq(bP.EventGroups))+1),bQ);bP.EventGroups.Append(bS);return bS;};J.PanelGroupCreator=function(bP,bQ,bR){var bS;bS=F.Create("panel"+a.String(_8.length(_8.ofSeq(bP.WidgetGroups))+1),bQ());bP.WidgetGroups.Append(bS);return bS;};K=d.Dashboard=_3.Class({Render:function(bP){var bQ;bQ=this;return bm.EmbedView(bg.Map(function(bR){return bR.$==1?bm.Element("div",[],[bm.Element("table",[],[bm.Element("tr",[],[bm.Element("td",[br.Style("vertical-align","top")],[bm.Element("table",[],bc.concat([_8.ofArray([bm.Element("tr",[],[bm.Element("td",[],[_6.IconNormal("dehaze",function(){bh.Set(bQ.PanelTitleVisibility,false);bh.Set(bQ.Mode,{$:0});})])])]),_8.ofArray([bQ.EditorSelectorEdit.get_RenderMenu()]),_8.ofArray([bm.Element("tr",[],[bm.Element("td",[],[])]),bm.Element("tr",[],[bm.Element("td",[],[bQ.PropertyGrid.get_Render()])])])]))]),bm.Element("td",[br.Style("vertical-align","top")],[bP,_6.IconNormal("add",function(){var bS,bT,bU,bV,bW;bS=bQ.EditorSelectorEdit.get_SelectedGroupIndex();bS===1?(bT=_8.ofSeq(bQ.Factory.EventItems),bU=bh.Create$1(_8.head(bT)),bQ.Dialog.ShowDialog("Select source",bm.Element("div",[],[bm.Select([br.Class("form-control")],function(bX){return bX.Worker.Name.c;},bT,bU)]),function(){var bX,bY,bZ;bX=bU.c.Worker.get_Clone();bX.StartRunner();bY=(bZ=_8.ofSeq(bQ.Data.EventGroups),bc.nth(bQ.EditorSelectorEdit.get_SelectedIndexInGroup(),bZ));bQ.Data.RegisterEvent(_6.UniqueKey(),bY,bX);})):bS===0?bQ.CreatePanel((bV=_8.ofSeq(bQ.Data.WidgetGroups),bc.nth(bQ.EditorSelectorEdit.get_SelectedIndexInGroup(),bV)),"Panel",700,null):bS===2?(bW=_8.ofSeq(bQ.Data.RulesGroups),bc.nth(bQ.EditorSelectorEdit.get_SelectedIndexInGroup(),bW)).RulesRowItems.Append(A.Create([z.get_Create(),z.get_Create()])):void 0;}),bQ.EditorSelectorEdit.get_Render()])])]),bm.Element("div",[],[bQ.Dialog.get_Render()])]):bm.Element("div",[],[bm.Element("table",[],[bm.Element("tr",[],[bm.Element("td",[br.Style("vertical-align","top")],[_6.IconNormal("dehaze",function(){bh.Set(bQ.PanelTitleVisibility,true);bh.Set(bQ.Mode,{$:1});}),bQ.EditorSelectorRun.GroupByIndex(0).SelectorItems.get_Length()>1?bQ.EditorSelectorRun.get_RenderMenu():bm.Element("div",[],[])]),bm.Element("td",[],[bQ.EditorSelectorRun.get_Render()])])])]);},this.Mode.v));},Restore:function(bP,bQ,bR,bS){var bT,bU,bV,bW,bX;bT=this;this.EditorSelectorRun.ClearGroups();this.EditorSelectorEdit.ClearGroups();this.Data.get_Clear();bU=this.EditorSelectorRun.GroupByIndex(0);bV=this.EditorSelectorEdit.GroupByIndex(0);bW=this.EditorSelectorEdit.GroupByIndex(1);bX=this.EditorSelectorEdit.GroupByIndex(2);_8.iteri(function(bY,bZ){var b0,b1;function b2(b3,b4,b5){bT.RegisterWidget(b3,b1,b4,bc.find(function(b6){return b6.Key===b4;},_8.ofSeq(b1.PanelContainer.PanelItems)).Children,(b5.StartRunner(),b5));}b0=J.PanelGroupCreator(bT.Data,bP,null);bh.Set(b0.WebSharper_Community_Dashboard_ISelectorItem$get_Name(),bZ[0]);bV.SelectorItems.Append(b0);bU.SelectorItems.Append(b0);b1=bc.nth(bY,_8.ofSeq(bT.Data.WidgetGroups));_8.iter(function(b3){var b4;b4=bT.CreatePanel(b1,"Panel",700,{$:1,$0:b3.Key});bh.Set(b4.Left,b3.Left);bh.Set(b4.Top,b3.Top);},bZ[1]);return _8.iter(function(b3){return b2(b3[0],b3[1],b3[2]);},bZ[2]);},bR);bq.log("Widgets restored");_8.iteri(function(bY,bZ){var b0,b1;function b2(b3,b4){bT.Data.RegisterEvent(b3,b1,b4);}b0=J.EventsGroupCreator(bT.Data,bT.PropertyGrid,null);bh.Set(b0.WebSharper_Community_Dashboard_ISelectorItem$get_Name(),bZ[0]);bW.SelectorItems.Append(b0);b1=bc.nth(bY,_8.ofSeq(bT.Data.EventGroups));return _8.iter(function(b3){return b2(b3[0],b3[1]);},bZ[1]);},bQ);bq.log("Events restored");_8.iteri(function(bY,bZ){var b0;b0=J.RulesGroupCreator(bT.Data,null);bh.Set(b0.WebSharper_Community_Dashboard_ISelectorItem$get_Name(),bZ[0]);bX.SelectorItems.Append(b0);return I.Restore(bT.Data,bc.nth(bY,_8.ofSeq(bT.Data.RulesGroups)).RulesRowItems,bZ[1]);},bS);this.Data.WidgetGroups.get_Length()>0?(bh.Set(this.EditorSelectorEdit.OptSelectedItem,{$:1,$0:_8.head(_8.ofSeq(this.EditorSelectorEdit.GroupByIndex(0).SelectorItems))}),bh.Set(this.EditorSelectorRun.OptSelectedItem,{$:1,$0:_8.head(_8.ofSeq(this.EditorSelectorRun.GroupByIndex(0).SelectorItems))})):(bh.Set(this.EditorSelectorEdit.OptSelectedItem,null),bh.Set(this.EditorSelectorRun.OptSelectedItem,null));bq.log("Connectors restored");return[_8.concat(_8.map(function(bY){return _8.map(function(bZ){return bZ.Worker;},_8.ofSeq(bY.EventItems));},_8.ofSeq(this.Data.EventGroups))),_8.concat(_8.map(function(bY){return _8.map(function(bZ){return bZ.Widget;},_8.ofSeq(bY.WidgetItems));},_8.ofSeq(this.Data.WidgetGroups)))];},Store:function(bP){function bQ(bS,bT){var bU;bU=bP(bT);return bU==null?bS:new _8.T({$:1,$0:[bT.Key,bU.$0],$1:bS});}function bR(bS,bT,bU){var bV;bV=bP(bU);return bV==null?bS:new _8.T({$:1,$0:[bU.Key,bT,bV.$0],$1:bS});}return[_8.map(function(bS){return[bS.Name.c,_8.rev(bc.fold(function(bT,bU){return bQ(bT,bU.Worker);},_8.T.Empty,_8.ofSeq(bS.EventItems)))];},_8.ofSeq(this.Data.EventGroups)),_8.map(function(bS){return[bS.Name.c,_8.map(function(bT){return bT.get_PanelData();},_8.ofSeq(bS.PanelContainer.PanelItems)),_8.rev(bc.fold(function(bT,bU){return bR(bT,bU.Panel,bU.Widget);},_8.T.Empty,_8.ofSeq(bS.WidgetItems)))];},_8.ofSeq(this.Data.WidgetGroups)),_8.map(function(bS){return[bS.Name.c,I.CopyToRules(bS.RulesRowItems)];},_8.ofSeq(this.Data.RulesGroups))];},CreatePanel:function(bP,bQ,bR,bS){var bT,bU,bV,bW,bX,bY;bT=this;bm.ConvertBy(bP.WidgetItems.key,function(bZ){return bm.Element("div",[],[bm.TextView(bZ.Widget.Name.v)]);},bP.WidgetItems.v);bU=(bV=(bW=bk.NewGuid(),a.String(bW)),bS==null?bV:bS.$0);bX=bu.get_Create().WithLayoutManager(bv.StackPanelLayoutManager()).WithAttributes([br.Style("border","1px solid white"),br.Style("display","flex")]);bY=bw.get_Create().WithKey(bU).WithPannelAttrs([br.Style("Width",a.String(bR)+"px"),br.Style("position","absolute")]).WithTitle(this.PanelTitleVisibility).WithTitleContent(bm.TextNode(bQ)).WithTitleButtons(_8.ofArray([bx.New("add",function(bZ){var b0,b1;b0=_8.ofSeq(bT.Factory.WidgetItems);b1=bh.Create$1(_8.head(b0));bT.Dialog.ShowDialog("Select widget",bm.Element("div",[],[bm.Select([br.Class("form-control")],function(b2){return b2.Worker.Name.c;},b0,b1)]),function(){var b2;bq.log("Dialog.IsOK");b2=b1.c.Worker.get_Clone();b2.StartRunner();bT.RegisterWidget(_6.UniqueKey(),bP,bZ.Key,bZ.Children,b2);});}),bx.New("edit",function(bZ){bq.log("Edit");bT.PropertyGrid.Edit(_8.concat(_8.map(function(b0){return b0.Widget.get_Properties();},_8.filter(function(b0){return b0.Panel===bZ.Key;},_8.ofSeq(bP.WidgetItems)))));}),bx.New("clear",function(bZ){bP.PanelContainer.PanelItems.Remove(bP.PanelContainer.FindPanelItem(bZ));bP.WidgetItems.RemoveBy(function(b0){return b0.Panel===bZ.Key;});})])).WithChildPanelContainer(bX);bP.PanelContainer.AddPanel(bY);return bY;},RegisterWidget:function(bP,bQ,bR,bS,bT){var bU;this.Data.RegisterWidget(bP,bQ,bR,bT);bU=bw.get_Create().WithPanelContent(bT.get_Render());bh.Set(bU.IsWithTitle,false);bS.AddPanel(bU);}},null,K);K.Create=function(bP){var bQ,bR,bS,bT,bU,bV;function bW(){return J.PanelGroupCreator(bR,bP,void 0);}function bX(){return J.EventsGroupCreator(bR,bS,void 0);}function bY(){return J.RulesGroupCreator(bR,void 0);}bQ=by.get_Create();bR=H.get_Create();bS=bz.get_Create();bT=C.get_Create();bU=C.get_Create().WithGroupOnClick(function(bZ){bS.Edit(_8.mapi(function(b0,b1){var b2;return bj.string((b2=b0+1,a.String(b2)),b1.WebSharper_Community_Dashboard_ISelectorItem$get_Name());},_8.ofSeq(bZ.SelectorItems)));}).WithItemOnSelected(function(){bS.Edit(_8.T.Empty);}).WithItemOnCreated(function(bZ){return function(b0){return bZ===0?_8.head(_8.ofSeq(bT.SelectorGroups)).SelectorItems.Append(b0):null;};}).WithItemOnDeleted(function(){return function(){return null;};}).WithItemOnDeleted(function(bZ){return function(b0){b0 instanceof F?bR.WidgetGroups.Remove(b0):b0 instanceof E?bR.EventGroups.Remove(b0):b0 instanceof G?bR.RulesGroups.Remove(b0):_4.FailWith("WithItemOnDeleted, type unknown");return bZ===0?_8.head(_8.ofSeq(bT.SelectorGroups)).SelectorItems.Remove(b0):null;};}).WithItemOnMove(_3.Curried3(function(bZ,b0,b1){var b2;b2=b1.$==1&&true;return b0 instanceof F?(_6.MoveItemInModelList(bR.WidgetGroups,b2,b0),_6.MoveItemInModelList(_8.head(_8.ofSeq(bT.SelectorGroups)).SelectorItems,b2,b0)):b0 instanceof E?_6.MoveItemInModelList(bR.EventGroups,b2,b0):b0 instanceof G?_6.MoveItemInModelList(bR.RulesGroups,b2,b0):_4.FailWith("WithItemOnDeleted, type unknown");})).WithControls(true);bV=bW();bU.AppenGroup("Panels",_8.ofArray([bV]),{$:1,$0:bW});bT.AppenGroup("Panels",_8.ofArray([bV]),null);bU.AppenGroup("Events",_8.ofArray([bX()]),{$:1,$0:bX});bU.AppenGroup("Rules",_8.ofArray([bY()]),{$:1,$0:bY});bh.Set(bU.OptSelectedItem,{$:1,$0:_8.head(_8.ofSeq(bU.GroupByIndex(0).SelectorItems))});bh.Set(bT.OptSelectedItem,{$:1,$0:_8.head(_8.ofSeq(bT.GroupByIndex(0).SelectorItems))});return K.New(y.get_Create(),bR,bS,bQ,bT,bU,bh.Create$1({$:0}),bh.Create$1(false));};K.New=function(bP,bQ,bR,bS,bT,bU,bV,bW){return new K({Factory:bP,Data:bQ,PropertyGrid:bR,Dialog:bS,EditorSelectorRun:bT,EditorSelectorEdit:bU,Mode:bV,PanelTitleVisibility:bW});};M=L.RandomEvent=_3.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bP){var bQ;new bA.New();_9.Start((bQ=null,_9.Delay(function(){return _9.While(function(){return true;},_9.Delay(function(){return _9.Bind(_9.Sleep(bP.InPorts.get_Item(2).get_Number()*1000>>0),function(){var bR,bS,bT;bR=bP.InPorts.get_Item(0).get_Number();bS=bP.InPorts.get_Item(1).get_Number();bT=bB.random()*bS+bR;bP.OutPorts.get_Item(0).Trigger(new i({$:0,$0:bT}));return _9.Zero();});}));})),null);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.RandomEventData;}},null,M);M.get_FromWorker=function(){return function(bP){return M.New(bP.get_ToData());};};M.get_Create=function(){return M.New(r.Create("Random",_8.ofArray([["Middle value",h.NumberMessage(100)],["Dispersion",h.NumberMessage(10)],["Delay sec.",h.NumberMessage(2)]]),_8.ofArray([["Random value",h.NumberMessage(0)]])));};M.New=function(bP){return new M({RandomEventData:bP});};N.New=function(bP){return{DatabaseEventRun:bP};};O=L.DatabaseEvent=_3.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bP){var bQ;bQ=true;bg.Sink(function(bR){bQ?(_8.iter(function(bS){var bT;bT=h.Agent();bT.mailbox.AddLast({$:0,$0:bS});bT.resume();},(new $.New()).Sync("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.Events.ServerDatabase.ReadAllMessages:965639103",[bP.InPorts.get_Item(1).get_String()])),bQ=false):((new $.New()).Send("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.Events.ServerDatabase.WriteMessage:-353093100",[bP.InPorts.get_Item(1).get_String(),bR.WithKey(bP.OutPorts.get_Item(0).Key)]),bP.OutPorts.get_Item(0).Trigger(bR.Value));},bP.InPorts.get_Item(0).PortValue.v);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.DatabaseEventData;}},null,O);O.get_FromWorker=function(){return function(bP){return O.New(bP.get_ToData());};};O.get_Create=function(){return O.New(r.Create("Database",_8.ofArray([[" in Value",h.NumberMessage(100)],["Database name",h.StringMessage("Database.txt")]]),_8.ofArray([["Number value",h.NumberMessage(0)]])));};O.New=function(bP){return new O({DatabaseEventData:bP});};Q.New=function(bP,bQ,bR,bS,bT){return{Title:bP,Description:bQ,ImageUrl:bR,Temperature:bS,TemparatureMinMax:bT};};P.get=function(bP,bQ){var bR;bR=null;return _9.Delay(function(){var bS;bS=(((_3.Curried3(function(bT,bU,bV){return bT("http://api.openweathermap.org/data/2.5/weather?q="+bd.toSafe(bU)+"&units=metric&appid="+bd.toSafe(bV));}))(a.id))(bQ))(bP);(e.Log())("get key city "+bS);return _9.TryWith(_9.Delay(function(){return _9.Bind(bD.AsyncMap(bH.asyncReadTextAtRuntime(false,"C:\\AEAFrame\\WebSharper.Community.Dashboard\\WebSharper.Community.Dashboard","","JSON","",bS),function(bT){return bl.Equals(typeof bT,"string")?bI.parse(bT):bT;}),function(bT){var bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce;(e.Log())("get key city 2");return _9.Return((bU=bJ.tryHead(bT.weather),bU==null?null:{$:1,$0:(bV=bU.$0,Q.New((((_3.Curried3(function(cf,cg,ch){return cf(bd.toSafe(cg)+", "+bd.toSafe(ch));}))(a.id))((bX=(bW="name",bW in bT?{$:1,$0:bT[bW]}:null),bX==null?null:bX.$0)))((b0=(bY=bT.sys,(bZ="country",bZ in bY?{$:1,$0:bY[bZ]}:null)),b0==null?null:b0.$0)),(b2=(b1="main",b1 in bV?{$:1,$0:bV[b1]}:null),b2==null?null:b2.$0),(function(cf){return function(cg){return cf("http://openweathermap.org/img/w/"+bd.toSafe(cg)+".png");};}(a.id))((b4=(b3="icon",b3 in bV?{$:1,$0:bV[b3]}:null),b4==null?null:b4.$0)),(b5=(b6=bT.main,(b7="temp",b7 in b6?{$:1,$0:b6[b7]}:null)),(b8=b5==null?null:{$:1,$0:1*b5.$0},b8==null?null:b8.$0)),[(b9=(b_=bT.main,(b$="temp_min",b$ in b_?{$:1,$0:b_[b$]}:null)),(ca=b9==null?null:{$:1,$0:1*b9.$0},ca==null?null:ca.$0)),(cb=(cc=bT.main,(cd="temp_max",cd in cc?{$:1,$0:cc[cd]}:null)),(ce=cb==null?null:{$:1,$0:1*cb.$0},ce==null?null:ce.$0))]))}));});}),function(bT){(e.Log())(bT.message);return _9.Return(null);});});};R=L.OpenWeatherEvent=_3.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bP){var bQ;_9.Start((bQ=null,_9.Delay(function(){return _9.While(function(){return true;},_9.Delay(function(){var bR,bS,bT;bR=bP.InPorts.get_Item(0);bS=bP.InPorts.get_Item(1);bT=bP.OutPorts.get_Item(0);return _9.Bind(P.get(bS.get_String(),bR.get_String()),function(bU){return _9.Combine(bU==null?_9.Zero():((e.Log())("Value generated:"+bU.$0.Title),bT.Trigger(new i({$:0,$0:+bU.$0.Temperature})),_9.Zero()),_9.Delay(function(){return _9.Bind(_9.Sleep(1000*15),function(){return _9.Return(null);});}));});}));})),null);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.OpenWeatherEventData;}},null,R);R.get_FromWorker=function(){return function(bP){return R.New(bP.get_ToData());};};R.Create=function(bP,bQ){return R.New(r.Create("OpenWeatherMap",_8.ofArray([["City",h.StringMessage(bP)],["ApiKey",h.StringMessage(bQ)]]),_8.ofArray([["Temperature",h.NumberMessage(0)]])));};R.New=function(bP){return new R({OpenWeatherEventData:bP});};T=S.TextBoxWidget=_3.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bP){var bQ;bQ=bg.Map(function(bR){var bS;bS=bR>>0;return a.String(bS);},bP.InPorts.get_Item(0).get_NumberView());return bm.Element("div",[br.Class("bigvalue")],[bm.TextView(bQ)]);}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.TextBoxWidgetData;}},null,T);T.get_FromWorker=function(){return function(bP){return T.New(bP.get_ToData());};};T.get_Create=function(){return T.New(r.Create("Text",_8.ofArray([["in Value",h.NumberMessage(0)]]),_8.T.Empty));};T.New=function(bP){return new T({TextBoxWidgetData:bP});};U.New=function(bP,bQ){return{LineChart:bP,Queue:bQ};};V=S.ChartWidget=_3.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bP){var bQ,bR,bS,bT,bU,bV,bW,bX;bQ=bP.InPorts.get_Item(3).get_Number()>>0;bR=bP.RunnerContext.c.$0;bg.Sink(function(bY){bR.Queue.push(bY);bR.Queue.length>bQ?bR.Queue.shift():void 0;bc.iteri(function(bZ,b0){return bR.LineChart.__UpdateData(bZ,function(){return b0;});},bR.Queue);},bP.InPorts.get_Item(0).get_NumberView());return bM.Render$8(bR.LineChart,{$:1,$0:{$:0,$0:bP.InPorts.get_Item(1).get_Number()>>0,$1:bP.InPorts.get_Item(2).get_Number()>>0}},{$:1,$0:(bS={},bS.title=(bT={},bT.display=false,bT),bS.legend=(bU={},bU.display=false,bU),bS.elements=(bV={},bV.point=(bW={},bW.radius=0,bW),bV.line=(bX={},bX.borderWidth=1,bX),bV),bS)},null);}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bP){var bQ,bR,bS,bT;bQ=bP.InPorts.get_Item(3).get_Number()>>0;bR=_8.ofSeq(bc.delay(function(){return bc.map(function(){return 0;},_4.range(0,bQ-1));}));bS=(bT=[],(bc.iter(function(bU){bT.push(bU);},bR),bT));return{$:1,$0:U.New(bN.Line(bR).WithFill(false).__WithStrokeColor(new bO.Color({$:1,$0:"#FB8C00"})).__WithPointColor(new bO.Color({$:2,$0:"black"})),bS)};}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.ChartWidgetData;}},null,V);V.get_FromWorker=function(){return function(bP){return V.New(bP.get_ToData());};};V.Create=function(bP,bQ,bR){return V.New(r.CreateWithCache("Chart",_8.ofArray([[" in Value",h.NumberMessage(100),bR>>0],["cx",h.NumberMessage(bP),1],["cy",h.NumberMessage(bQ),1],["BufferSize",h.NumberMessage(bR),1]]),_8.T.Empty));};V.New=function(bP){return new V({ChartWidgetData:bP});};W=S.ButtonWidget=_3.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bP){return bm.ButtonView(bP.InPorts.get_Item(0).get_String(),[],bP.InPorts.get_Item(1).get_BooleanView(),function(bQ){bP.OutPorts.get_Item(0).Trigger(new i({$:2,$0:bQ}));});}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.ButtonWidgetData;}},null,W);W.get_FromWorker=function(){return function(bP){return W.New(bP.get_ToData());};};W.get_Create=function(){return W.New(r.Create("Button",_8.ofArray([["Caption",h.StringMessage("Button")],["State",h.NumberMessage(0)]]),_8.ofArray([["Button value",h.NumberMessage(0)]])));};W.New=function(bP){return new W({ButtonWidgetData:bP});};X.FromWorker=function(bP){var bQ;bQ=bP.Data;return bQ instanceof M?{$:1,$0:{$:0,$0:(M.get_FromWorker())(bP)}}:bQ instanceof R?{$:1,$0:{$:1,$0:(R.get_FromWorker())(bP)}}:bQ instanceof O?{$:1,$0:{$:2,$0:(O.get_FromWorker())(bP)}}:bQ instanceof T?{$:1,$0:{$:3,$0:(T.get_FromWorker())(bP)}}:bQ instanceof V?{$:1,$0:{$:4,$0:(V.get_FromWorker())(bP)}}:bQ instanceof W?{$:1,$0:{$:5,$0:(W.get_FromWorker())(bP)}}:null;};X.ToWorker=function(bP){return bP.$==1?s.Create(bP.$0):bP.$==2?s.Create(bP.$0):bP.$==3?s.Create(bP.$0):bP.$==4?s.Create(bP.$0):bP.$==5?s.Create(bP.$0):s.Create(bP.$0);};Y.CreateDashboard=function(){Z.$cctor();return Z.CreateDashboard;};Y.PanelContainerCreator=function(bP){return bu.get_Create().WithLayoutManager(bv.FloatingPanelLayoutManager(5)).WithWidth(800).WithHeight(420).WithAttributes([br.Style("border","1px solid white")]);};Y.RegisterAppModelLib=function(bP){function bQ(bS){Y.RegisterEventGeneral(bP,bS);}function bR(bS){Y.RegisterWidgetGeneral(bP,bS);}bQ(R.Create("London",""));bQ(M.get_Create());bQ(O.get_Create());bR(T.get_Create());bR(V.Create(300,150,50));bR(W.get_Create());return bP;};Y.RegisterWidgetGeneral=function(bP,bQ){var bR;Y.Register((bR=bP.Factory,function(bS){bR.RegisterWidget(bS);}),bQ);};Y.RegisterEventGeneral=function(bP,bQ){var bR;Y.Register((bR=bP.Factory,function(bS){bR.RegisterEvent(bS);}),bQ);};Y.Register=function(bP,bQ){return bP(s.Create(bQ));};Z.$cctor=_3.Cctor(function(){Z.CreateDashboard=Y.RegisterAppModelLib(K.Create(function(){return Y.PanelContainerCreator();}));Z.$cctor=a.ignore;});_0.RecreatWidgetsOnServer=function(bP,bQ){function bR(bT,bU,bV){return bV;}function bS(bT,bU,bV){return bV;}return _8.map(function(bT){return bR(bT[0],bT[1],bT[2]);},_8.concat(_8.map(function(bT){return bS(bT[0],bT[1],bT[2]);},_0.RecreateWidgets(bP,bQ))));};_0.RecreateEventsOnServer=function(bP,bQ){function bR(bT,bU){return bU;}function bS(bT,bU){return bU;}return _8.map(function(bT){return bR(bT[0],bT[1]);},_8.concat(_8.map(function(bT){return bS(bT[0],bT[1]);},_0.RecreateEvents(bP,bQ))));};_0.RecreateOnClient=function(bP,bQ,bR,bS,bT,bU,bV){var bW;e.set_Role(f.Client);bW=h.Agent();bW.mailbox.AddLast({$:3,$0:function(bX){(new $.New()).Send("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.MessageBus.SendToServer:-1358505674",[bX]);}});bW.resume();_8.iter(bP,(bQ.Restore(bR,_0.RecreateEvents(bS,bT),_0.RecreateWidgets(bS,bU),bV))[0]);};_0.RecreateWidgets=function(bP,bQ){function bR(bS,bT,bU){function bV(bW,bX,bY){return[bW,bX,bP(bY)];}return[bS,bT,_8.map(function(bW){return bV(bW[0],bW[1],bW[2]);},bU)];}return _8.map(function(bS){return bR(bS[0],bS[1],bS[2]);},bQ);};_0.RecreateEvents=function(bP,bQ){function bR(bS,bT){function bU(bV,bW){return[bV,bP(bW)];}return[bS,_8.map(function(bV){return bU(bV[0],bV[1]);},bT)];}return _8.map(function(bS){return bR(bS[0],bS[1]);},bQ);};_1=d.AppData=_3.Class({RecreateOnServer:function(bP){var bQ,bR;function bS(bT,bU){bU.Reconnect(bR);}bQ=_0.RecreateEventsOnServer(bP,this.Events);bR=_8.append(bQ,_0.RecreatWidgetsOnServer(bP,this.Widgets));_8.iter(function(bT){return bS(bT[0],bT[1]);},this.Rules);_8.iter(function(bT){bT.StartRunner();},bR);return bQ;},RecreateOnClientEventsRunning:function(bP,bQ,bR){_0.RecreateOnClient(function(bS){bS.StartRunner();},bP,bQ,bR,this.Events,this.Widgets,this.Rules);},RecreateOnClientEventsNotRunning:function(bP,bQ,bR){_0.RecreateOnClient(a.ignore,bP,bQ,bR,this.Events,this.Widgets,this.Rules);}},null,_1);_1.Create=function(bP,bQ){var bR;bR=bP.Store(bQ);return _1.New(bR[0],bR[1],bR[2]);};_1.empty=function(){return _1.New(_8.T.Empty,_8.T.Empty,_8.T.Empty);};_1.New=function(bP,bQ,bR){return new _1({Events:bP,Widgets:bQ,Rules:bR});};}());
