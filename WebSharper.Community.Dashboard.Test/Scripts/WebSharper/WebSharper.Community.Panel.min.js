(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Community=b.Community||{};d=c.Panel=c.Panel||{};e=d.Helper=d.Helper||{};f=d.PanelData=d.PanelData||{};g=d.TitleButton=d.TitleButton||{};h=d.Panel=d.Panel||{};i=d.PanelContainer=d.PanelContainer||{};j=d.Rect=d.Rect||{};k=d.LayoutManagers=d.LayoutManagers||{};l=a.StartupCode$WebSharper_Community_Panel$LayoutManagers=a.StartupCode$WebSharper_Community_Panel$LayoutManagers||{};m=d.Dialog=d.Dialog||{};n=b&&b.Guid;o=b&&b.UI;p=o&&o.Next;q=p&&p.Doc;r=p&&p.AttrModule;s=b&&b.List;t=a.IntelliFactory;u=t&&t.Runtime;v=b&&b.Unchecked;w=p&&p.Var;x=p&&p.View;y=p&&p.Input;z=y&&y.Mouse;A=b&&b.Seq;B=p&&p.ListModel;C=a.console;e.UniqueKey=function(){var D;D=n.NewGuid();return a.String(D);};e.TxtIconNormal=function(D,E,F){return e.TxtIcon("material-icons orange600",D,E,F);};e.TxtIcon=function(D,E,F,G){return q.Element("div",e.AttrsClick(G),[q.Element("i",[r.Class(D)],[q.TextNode(E)]),q.TextNode(F)]);};e.IconSmall=function(D,E){return e.Icon("material-icons orange600 small",D,E);};e.IconNormal=function(D,E){return e.Icon("material-icons orange600",D,E);};e.Icon=function(D,E,F){return q.Element("i",new s.T({$:1,$0:r.Class(D),$1:e.AttrsClick(F)}),[q.TextNode(E)]);};e.AttrsClick=function(D){return s.ofArray([r.Style("Color","#FB8C00"),r.Style("cursor","pointer"),r.Handler("click",function(){return function(){return D();};})]);};f.Create=function(D,E,F,G){return f.New(D,E,F,G);};f.New=function(D,E,F,G){return{Key:D,Left:E,Top:F,Children:G};};g=d.TitleButton=u.Class({Render:function(D){var E;E=this;return e.IconSmall(this.Icon,function(){E.Action(D);});}},null,g);g.New=function(D,E){return new g({Icon:D,Action:E});};h=d.Panel=u.Class({get_Render:function(){var D,E,F,G,H,I,J,K,L,M;function N(Q,R){var S,T,U,V,W,X,Y,Z,_0,_1,_2,_3;return E.c?(S=D.Element.c.getBoundingClientRect(),(T=D.Element.c.parentElement.getBoundingClientRect(),(U=T.width-S.width,(V=T.height-S.height,(W=(X=(Y=0,(Z=+Q-G.c,v.Compare(Y,Z)===1?Y:Z)),v.Compare(U,X)===-1?U:X),(_0=(_1=(_2=0,(_3=+R-H.c,v.Compare(_2,_3)===1?_2:_3)),v.Compare(V,_1)===-1?V:_1),(w.Set(D.Left,W),w.Set(D.Top,_0),D.Relayout(D),[W,_0]))))))):[D.Left.c,D.Top.c];}function O(Q,R){return(function(S){return function(T){return S(T.toFixed(6)+"px");};}(a.id))(Q);}function P(Q,R){return(function(S){return function(T){return S(T.toFixed(6)+"px");};}(a.id))(R);}D=this;E=w.Create$1(false);F=w.Create$1(false);G=w.Create$1(0);H=w.Create$1(0);I=x.Map(function(Q){return N(Q[0],Q[1]);},x.UpdateWhile([0,0],x.Map(function(Q){return Q&&E.c;},z.get_LeftPressed()),z.get_Position()));J=A.concat([this.TitleAttrs,s.ofArray([r.Style("cursor","grab"),r.Handler("mouseenter",function(){return function(){return w.Set(F,true);};}),r.Handler("mouseleave",function(){return function(){return!E.c?w.Set(F,false):null;};}),r.Handler("mouseup",function(){return function(){w.Set(F,false);return w.Set(E,false);};}),r.Handler("mousedown",function(){return function(Q){F.c&&!v.Equals(D.Element.c.parentElement,null)&&!v.Equals(D.Element.c.parentElement.parentElement,null)?w.Set(E,true):void 0;w.Set(G,+Q.clientX-D.Left.c);return w.Set(H,+Q.clientY-D.Top.c);};})])]);K=q.Element("table",[r.Style("width","100%")],[q.Element("tr",[],[q.Element("td",[],[this.TitleContent]),q.Element("td",[r.Style("text-align","right"),r.Style("vertical-align","middle")],s.map(function(Q){return Q.Render(D);},this.TitleButtons))])]);L=this.Width>0?s.ofArray([r.Style("width",(function(Q){return function(R){return Q(R.toFixed(6)+"px");};}(a.id))(this.Width))]):s.T.Empty;M=q.Element("div",A.concat([this.PannelAttrs,A.concat([L,this.Height>0?s.ofArray([r.Style("height",(function(Q){return function(R){return Q(R.toFixed(6)+"px");};}(a.id))(this.Height))]):s.T.Empty]),s.ofArray([r.DynamicStyle("left",x.Map(function(Q){return(function(R){return function(S){return R(S.toFixed(6)+"px");};}(a.id))(Q);},this.Left.v)),r.DynamicStyle("left",x.Map(function(Q){return O(Q[0],Q[1]);},I)),r.DynamicStyle("top",x.Map(function(Q){return P(Q[0],Q[1]);},I)),r.DynamicStyle("top",x.Map(function(Q){return(function(R){return function(S){return R(S.toFixed(6)+"px");};}(a.id))(Q);},this.Top.v))])]),[q.Element("table",[],[q.Element("tr",[],[q.Element("td",L,[q.EmbedView(x.Map(function(Q){return Q?q.Element("div",J,[K]):q.Element("div",[],[]);},this.IsWithTitle.v))])]),q.Element("tr",[],[q.Element("td",[],[this.PanelContent,this.Children.get_Render()])])])]);w.Set(this.Element,M.elt);return M.OnAfterRender(function(){D.onAfterRender(D);});},get_PanelData:function(){return f.Create(this.Key,this.Left.c,this.Top.c,s.map(function(D){return D.get_PanelData();},s.ofSeq(this.Children.PanelItems)));},EditProperties:function(D){D.Edit(s.concat([this.Properties,s.concat(s.map(function(E){return E.Properties;},s.ofSeq(this.Children.PanelItems)))]));},WithHeight:function(D){return h.New(this.Key,this.Left,this.Top,this.Width,D,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithWidth:function(D){return h.New(this.Key,this.Left,this.Top,D,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithProperties:function(D){return h.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,D);},WithOnAfterRender:function(D){return h.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,D,this.Properties);},WithInternalName:function(D){return h.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,D,this.onAfterRender,this.Properties);},WithTitle:function(D){return h.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,D,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithChildPanelContainer:function(D){return h.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,D,this.InternalName,this.onAfterRender,this.Properties);},WithRelayoutFnc:function(D){return h.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,D,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithPanelContent:function(D){return h.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,D,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithTitleButtons:function(D){return h.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,D,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithTitleContent:function(D){return h.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,D,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithTitleAttrs:function(D){return h.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,D,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithPannelAttrs:function(D){return h.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,D,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithKey:function(D){return h.New(D,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);}},null,h);h.get_Create=function(){var D;return h.New((D=n.NewGuid(),a.String(D)),w.Create$1(0),w.Create$1(0),0,0,w.Create$1(null),a.ignore,s.T.Empty,w.Create$1(true),s.ofArray([r.Class("panelTitle")]),q.Element("div",[],[]),s.T.Empty,q.Element("div",[],[]),i.get_Create(),"",a.ignore,s.T.Empty);};h.New=function(D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T){return new h({Key:D,Left:E,Top:F,Width:G,Height:H,Element:I,Relayout:J,PannelAttrs:K,IsWithTitle:L,TitleAttrs:M,TitleContent:N,TitleButtons:O,PanelContent:P,Children:Q,InternalName:R,onAfterRender:S,Properties:T});};i=d.PanelContainer=u.Class({get_Render:function(){var D;D=this;return q.Element("div",A.concat([this.ContainerAttributes,this.Width>0?s.ofArray([r.Style("width",(function(E){return function(F){return E(F.toFixed(6)+"px");};}(a.id))(this.Width))]):s.T.Empty,this.Height>0?s.ofArray([r.Style("height",(function(E){return function(F){return E(F.toFixed(6)+"px");};}(a.id))(this.Height))]):s.T.Empty,s.ofArray([r.Style("position","relative")])]),[q.ConvertBy(function(E){return E.Key;},function(E){return E.get_Render().OnAfterRender(function(){D.LayoutManager.WebSharper_Community_Panel_ILayoutManager$PlacePanel(D,E);});},this.PanelItems.v)]);},AddPanel:function(D){var E,F;this.PanelItems.Append(D.WithRelayoutFnc((E=this.LayoutManager,(F=this,function(G){E.WebSharper_Community_Panel_ILayoutManager$Relayout(F,G);}))));},FindPanelItem:function(D){return A.find(function(E){return v.Equals(E.Element,D.Element);},s.ofSeq(this.PanelItems));},WithHeight:function(D){return i.New(this.Width,D,this.PanelItems,this.LayoutManager,this.ContainerAttributes);},WithWidth:function(D){return i.New(D,this.Height,this.PanelItems,this.LayoutManager,this.ContainerAttributes);},WithLayoutManager:function(D){return i.New(this.Width,this.Height,this.PanelItems,D,this.ContainerAttributes);},WithAttributes:function(D){return i.New(this.Width,this.Height,this.PanelItems,this.LayoutManager,D);}},null,i);i.get_Create=function(){return i.New(0,0,B.Create(function(D){return D.Key;},s.T.Empty),{WebSharper_Community_Panel_ILayoutManager$Relayout:function(){return null;},WebSharper_Community_Panel_ILayoutManager$PlacePanel:function(){return null;}},s.T.Empty);};i.New=function(D,E,F,G,H){return new i({Width:D,Height:E,PanelItems:F,LayoutManager:G,ContainerAttributes:H});};j=d.Rect=u.Class({toString:function(){return"left:"+a.String(this.left)+" "+" top:"+a.String(this.top)+" right:"+a.String(this.right)+" bottom:"+a.String(this.bottom);},inflate:function(D,E){return j.New(this.left-D,this.right+D,this.top-E,this.bottom+E);},get_height:function(){return this.bottom-this.top;},get_width:function(){return this.right-this.left;},intersect:function(D){var E,F,G,H,I,J,K,L,M,N,O,P;E=(F=this.left,(G=D.left,v.Compare(F,G)===1?F:G));H=(I=this.right,(J=D.right,v.Compare(I,J)===-1?I:J));K=(L=this.top,(M=D.top,v.Compare(L,M)===1?L:M));N=(O=this.bottom,(P=D.bottom,v.Compare(O,P)===-1?O:P));return j.New(E,v.Compare(E,H)===1?E:H,K,v.Compare(K,N)===1?K:N);},offset:function(D,E){return j.New(this.left+D,this.right+D,this.top+E,this.bottom+E);},get_isEmpty:function(){return this.left>=this.right||this.top>=this.bottom;}},null,j);j.fromPanel=function(D){return j.fromDomRect(D.Element.c).offset(D.Left.c,D.Top.c);};j.fromDomRect=function(D){var E;return!v.Equals(D,null)?(E=D.getBoundingClientRect(),j.New(0,E.width,0,E.height)):j.Create(0,0,0,0);};j.Create=function(D,E,F,G){return j.New(D,F,E,G);};j.New=function(D,E,F,G){return new j({left:D,right:E,top:F,bottom:G});};k.StackPanelLayoutManager=function(){l.$cctor();return l.StackPanelLayoutManager;};k.FloatingPanelLayoutManager=function(D){return{WebSharper_Community_Panel_ILayoutManager$Relayout:function(E,F){return k.relayout(E,F,D);},WebSharper_Community_Panel_ILayoutManager$PlacePanel:function(E,F){return k.placePanel(E,F,D);}};};k.relayout=function(D,E,F){var G,H,I;G=D.PanelItems;H=A.find(function(J){return J.Key===E.Key;},s.ofSeq(G));I=A.tryFind(function(J){return J.Key!==H.Key&&!j.fromPanel(J).intersect(j.fromPanel(H)).get_isEmpty();},s.ofSeq(G));I!=null&&I.$==1?k.movePanelToFreeSpace(G,I.$0,F):void 0;};k.placePanel=function(D,E,F){var G,H,I;G=j.fromPanel(E);H=A.tryFind(function(J){return J.get_width()>=G.get_width()&&J.get_height()>=G.get_height();},k.collectFreeSpace(D.PanelItems,j.Create(0,0,D.Width,D.Height),E,F));H!=null&&H.$==1?(I=H.$0,w.Set(E.Left,I.left+F),w.Set(E.Top,I.top+F)):void 0;};k.movePanelToFreeSpace=function(D,E,F){var G,H,I;G=j.fromPanel(E);H=A.tryFind(function(J){return J.get_width()>=G.get_width()&&J.get_height()>=G.get_height();},k.collectFreeSpace(D,j.fromDomRect(E.Element.c.parentElement),E,F));H!=null&&H.$==1?(I=H.$0,w.Set(E.Left,I.left+F),w.Set(E.Top,I.top+F)):void 0;};k.collectFreeSpace=function(D,E,F,G){var H;H=s.filter(function(I){return I.Key!==F.Key;},s.ofSeq(D));return A.fold(function(I,J){var K,L,M;K=k.panelRect(J,0);L=j.New(0,E.right,0,K.top);M=j.New(0,K.left,0,E.bottom);return s.concat(s.map(function(N){return s.filter(function(O){return!O.get_isEmpty();},s.map(function(O){return O.intersect(N);},I));},s.ofArray([L,M,j.New(K.right,E.right,M.top,M.bottom),j.New(L.left,L.right,K.bottom,E.bottom)])));},s.ofArray([E]),H);};k.calcClientArea=function(D,E,F){var G;G=s.map(function(H){C.log(H.InternalName);return k.panelRect(H,F);},function(H,I){var J,K;while(true)if(I.$==1){J=I.$1;K=I.$0;if(K.Key===E.Key)return H;else{H=new s.T({$:1,$0:K,$1:H});I=J;}}else return H;}(s.T.Empty,s.ofSeq(D)));return G.$==0?j.Create(0,0,0,0):j.Create(s.min(s.map(function(H){return H.left;},G)),s.min(s.map(function(H){return H.top;},G)),s.max(s.map(function(H){return H.right;},G)),s.max(s.map(function(H){return H.bottom;},G)));};k.panelRect=function(D,E){return j.fromPanel(D).inflate(E,E);};l.$cctor=u.Cctor(function(){l.StackPanelLayoutManager={WebSharper_Community_Panel_ILayoutManager$Relayout:function(D,E){return k.relayout(D,E,0);},WebSharper_Community_Panel_ILayoutManager$PlacePanel:function(){return null;}};l.$cctor=a.ignore;});m=d.Dialog=u.Class({get_Render:function(){var D;D=this;return q.Element("div",[r.Style("position","absolute"),r.Style("left","50%"),r.Style("top","50%"),r.Style("z-index","1"),r.Style("background-color","white"),r.Style("min-height","100px"),r.Style("min-width","200px"),r.DynamicStyle("display",x.Map(function(E){return E?"block":"none";},this.Visibility.v))],[q.Element("table",[r.Style("background-color","grey"),r.Style("display","block"),r.Style("min-height","100px"),r.Style("min-width","200px")],[q.Element("table",[],[q.Element("tr",[],[q.Element("td",[r.Style("border-style","hidden"),r.Style("background","#404040"),r.Style("color","rgb(200,200,200)"),r.Style("padding","0px 2px 5px 2px"),r.Style("Width","200px"),r.Style("font-size","medium")],[q.TextView(this.Title.v)])])]),q.Element("table",[],[q.Element("tr",[],[q.Element("td",[r.Style("padding","5px 0px 0px 2px")],[q.BindView(a.id,this.Content.v)])]),q.Element("tr",[],[q.Element("td",[r.Style("padding","20px 12px 2px 20px")],[q.Element("button",[r.Style("border-radius","2px"),r.Handler("click",function(){return function(){w.Set(D.Visibility,false);return D.OKCallback.c();};})],[q.TextNode("OK")])]),q.Element("td",[r.Style("padding","20px 12px 2px 50px")],[q.Element("button",[r.Style("border-radius","2px"),r.Handler("click",function(){return function(){return w.Set(D.Visibility,false);};})],[q.TextNode("Cancel")])])])])])]);},ShowDialog:function(D,E,F){w.Set(this.Title,D);w.Set(this.Content,E);w.Set(this.Visibility,true);w.Set(this.OKCallback,F);}},null,m);m.get_Create=function(){return m.New(w.Create$1(""),w.Create$1(q.Element("div",[],[])),w.Create$1(false),w.Create$1(a.ignore));};m.New=function(D,E,F,G){return new m({Title:D,Content:E,Visibility:F,OKCallback:G});};}());
