(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Community=b.Community||{};d=c.Dashboard=c.Dashboard||{};e=d.IInPortNumber=d.IInPortNumber||{};f=d.IOutPortNumber=d.IOutPortNumber||{};g=d.Sources=d.Sources||{};h=g.RandomValueSource=g.RandomValueSource||{};i=d.SrcOpenWeather=d.SrcOpenWeather||{};j=i.Forecast=i.Forecast||{};k=i.Create=i.Create||{};l=d.Widgets=d.Widgets||{};m=l.TextBox=l.TextBox||{};n=l.Chart=l.Chart||{};o=d.SourceItem=d.SourceItem||{};p=d.ReceiverItem=d.ReceiverItem||{};q=d.Factory=d.Factory||{};r=d.Dashboard=d.Dashboard||{};s=a.IntelliFactory;t=s&&s.Runtime;u=b&&b.Control;v=u&&u.FSharpEvent;w=b&&b.Random;x=b&&b.Concurrency;y=b&&b.List;z=c&&c.PropertyGrid;A=z&&z.Properties;B=b&&b.UI;C=B&&B.Next;D=C&&C.Var;E=b&&b.PrintfHelpers;F=b&&b.Data;G=F&&F.TxtRuntime;H=a.FSharp;I=H&&H.Data;J=I&&I.Runtime;K=J&&J.IO;L=b&&b.Unchecked;M=b&&b.Arrays;N=C&&C.AttrProxy;O=C&&C.Doc;P=b&&b.Charting;Q=P&&P.Renderers;R=Q&&Q.ChartJs;S=b&&b.Seq;T=b&&b.Operators;U=P&&P.Chart;V=P&&P.Pervasives;W=C&&C.Key;X=C&&C.ListModel;Y=C&&C.AttrModule;Z=C&&C.View;_0=c&&c.Panel;_1=_0&&_0.PanelContainer;_2=_0&&_0.LayoutManagers;_3=_0&&_0.Panel;_4=_0&&_0.TitleButton;_5=z&&z.PropertyGrid;_6=_0&&_0.Dialog;e=d.IInPortNumber=t.Class({Disconnect:function(){var _7;this.Disconnector();_7="Port "+this.name+" disconnected";a.console.log(_7);this.Disconnector=function(){};},RegisterDisconnector:function(_7){this.Disconnector=_7;},get_Callback:function(){return this.callback;},WebSharper_Community_Dashboard_IInPort$get_Name:function(){return this.name;}},null,e);e.New=t.Ctor(function(_7,_8){this.name=_7;this.callback=_8;this.Disconnector=function(){};},e);f=d.IOutPortNumber=t.Class({Trigger:function(_7){this.event.event.Trigger(_7);},WebSharper_Community_Dashboard_IOutPort$Connect:function(_7){var _8,_9,_;_8=this;_9="Port "+this.name+" connect";a.console.log(_9);_7.Disconnect();_=function($,ba){return(_7.get_Callback())(ba);};this.event.event.AddHandler(_);_7.RegisterDisconnector(function(){_8.event.event.RemoveHandler(_);});},WebSharper_Community_Dashboard_IOutPort$IsCompatible:function(_7){return _7 instanceof e;},WebSharper_Community_Dashboard_IOutPort$get_Name:function(){return this.name;}},null,f);f.New=t.Ctor(function(_7){this.name=_7;this.event=new v.New();},f);h=g.RandomValueSource=t.Class({WebSharper_Community_Dashboard_ISource$Run:function(){var _7,_8;_7=this;_8=new w.New();x.Start(x.Delay(function(){return x.While(function(){return true;},x.Delay(function(){return x.Bind(x.Sleep(600),function(){var _9;_9=a.Math.random()*_7.varDispersion.c+_7.varMiddleValue.c;_7.outRandomNumber.Trigger(_9);return x.Return(null);});}));}),null);},WebSharper_Community_Dashboard_ISource$Clone:function(){return new h.New(this.middleValue,this.dispersion);},WebSharper_Community_Dashboard_ISource$get_Properties:function(){return y.ofArray([A.string("Name",this.name),A["double"]("Middle value",this.varMiddleValue),A["double"]("Dispersion value",this.varDispersion)]);},WebSharper_Community_Dashboard_ISource$get_OutPorts:function(){return y.ofArray([this.outRandomNumber]);},WebSharper_Community_Dashboard_ISource$get_Name:function(){return this.name;}},null,h);h.New=t.Ctor(function(_7,_8){this.middleValue=_7;this.dispersion=_8;this.outRandomNumber=new f.New("Random value");this.varMiddleValue=D.Create$1(this.middleValue);this.varDispersion=D.Create$1(this.dispersion);this.name=D.Create$1("Random");},h);j.New=function(_7,_8,_9,_,$){return{Title:_7,Description:_8,ImageUrl:_9,Temperature:_,TemparatureMinMax:$};};k=i.Create=t.Class({WebSharper_Community_Dashboard_ISource$Run:function(){var _7,_8;_7=this;_8=new w.New();x.Start(x.Delay(function(){return x.While(function(){return true;},x.Delay(function(){var _9;_9=i.get(_7.apiKey.c,_7.cityVar.c);return x.Bind(_9,function(_){var $;$="Value generated:"+_.$0.Title;a.console.log($);_7.outTempearatur.Trigger(+_.$0.Temperature);return x.Bind(x.Sleep(1000*15),function(){return x.Return(null);});});}));}),null);},WebSharper_Community_Dashboard_ISource$Clone:function(){return new k.New(this.city);},WebSharper_Community_Dashboard_ISource$get_Properties:function(){return y.ofArray([A.string("Name",this.name),A.string("ApiKey",this.apiKey),A.string("City",this.cityVar)]);},WebSharper_Community_Dashboard_ISource$get_OutPorts:function(){return y.ofArray([this.outTempearatur]);},WebSharper_Community_Dashboard_ISource$get_Name:function(){return this.name;}},null,k);k.New=t.Ctor(function(_7){this.city=_7;this.outTempearatur=new f.New("Temperature");this.apiKey=D.Create$1("");this.cityVar=D.Create$1(this.city);this.name=D.Create$1("OpenWeatherMap");},k);i.get=function(_7,_8){return x.Delay(function(){var _9,_,$;_9=((_=function(ba,bb,bc){return ba("http://api.openweathermap.org/data/2.5/weather?q="+E.toSafe(bb)+"&units=metric&appid="+E.toSafe(bc));},(t.Curried3(_))(a.id))(_8))(_7);a.console.log("get key city "+_9);$=G.AsyncMap(K.asyncReadTextAtRuntime(false,"C:\\Users\\Andrey\\Private\\VS_Projects\\WebSharper.Community.Dashboard\\WebSharper.Community.Dashboard","","JSON","",_9),function(ba){return L.Equals(typeof ba,"string")?a.JSON.parse(ba):ba;});return x.Bind($,function(ba){var bb;a.console.log("get key city 2");return x.Return((bb=function(bc){var bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz;return j.New(((bd=function(bA,bB,bC){return bA(E.toSafe(bB)+", "+E.toSafe(bC));},(t.Curried3(bd))(a.id))((be=(bf="name",bf in ba?{$:1,$0:ba[bf]}:null),be==null?null:be.$0)))((bg=ba.sys,(bh=(bi="country",bi in bg?{$:1,$0:bg[bi]}:null),bh==null?null:bh.$0))),(bj=(bk="main",bk in bc?{$:1,$0:bc[bk]}:null),bj==null?null:bj.$0),(bl=function(bA,bB){return bA("http://openweathermap.org/img/w/"+E.toSafe(bB)+".png");},(function(bA){return function(bB){return bl(bA,bB);};}(a.id))((bm=(bn="icon",bn in bc?{$:1,$0:bc[bn]}:null),bm==null?null:bm.$0))),(bo=ba.main,(bp=(bq="temp",bq in bo?{$:1,$0:bo[bq]}:null),(br=bp==null?null:{$:1,$0:1*bp.$0},br==null?null:br.$0))),[(bs=ba.main,(bt=(bu="temp_min",bu in bs?{$:1,$0:bs[bu]}:null),(bv=bt==null?null:{$:1,$0:1*bt.$0},bv==null?null:bv.$0))),(bw=ba.main,(bx=(by="temp_max",by in bw?{$:1,$0:bw[by]}:null),(bz=bx==null?null:{$:1,$0:1*bx.$0},bz==null?null:bz.$0)))]);},function(bc){return bc==null?null:{$:1,$0:bb(bc.$0)};}(M.tryHead(ba.weather))));});});};m=l.TextBox=t.Class({WebSharper_Community_Dashboard_IReceiver$get_Properties:function(){return y.T.Empty;},WebSharper_Community_Dashboard_IReceiver$Clone:function(){return new m.New();},WebSharper_Community_Dashboard_IReceiver$Render:function(){var _7,_8;_7=[N.Create("class","bigvalue")];_8=[O.TextView(this.varText.v)];return O.Element("div",_7,_8);},WebSharper_Community_Dashboard_IReceiver$get_InPorts:function(){return y.ofArray([this.inPortNumber]);},WebSharper_Community_Dashboard_IReceiver$get_Name:function(){return D.Create$1("Text");}},null,m);m.New=t.Ctor(function(){var _7;_7=this;this.varText=D.Create$1("");this.inPortNumber=new e.New("in Value",function(_8){var _9,_,$;_9=_7.varText;_=($=_8<<0,a.String($));D.Set(_9,_);});},m);n=l.Chart=t.Class({WebSharper_Community_Dashboard_IReceiver$Clone:function(){return new n.New(this.cx,this.cy,this.chartBufferSize);},WebSharper_Community_Dashboard_IReceiver$get_Properties:function(){return y.T.Empty;},WebSharper_Community_Dashboard_IReceiver$Render:function(){return R.Render$8(this.chart,{$:1,$0:{$:0,$0:this.cx,$1:this.cy}},null,null);},WebSharper_Community_Dashboard_IReceiver$get_InPorts:function(){return y.ofArray([this.inPortNumber]);},WebSharper_Community_Dashboard_IReceiver$get_Name:function(){return D.Create$1("Chart");}},null,n);n.New=t.Ctor(function(_7,_8,_9){var _,$,ba,bb,bc;_=this;this.cx=_7;this.cy=_8;this.chartBufferSize=_9;$=y.ofSeq(S.delay(function(){return S.map(function(){return 0;},T.range(0,_.chartBufferSize-1));}));ba=(bb=[],(bc=function(bd){bb.push(bd);},function(bd){S.iter(bc,bd);}($),bb));this.chart=U.Line($).__WithFillColor(new V.Color({$:2,$0:"white"}));this.inPortNumber=new e.New("in Value",function(bd){var be,bf;ba.push(bd);ba.length>_.chartBufferSize?be=ba.shift():void 0;bf=function(bg,bh){return _.chart.__UpdateData(bg,function(){return bh;});};(function(bg){S.iteri(bf,bg);}(ba));});},n);o.Create=function(_7){return o.New(W.Fresh(),_7);};o.New=function(_7,_8){return{Key:_7,Source:_8};};p.Create=function(_7){return p.New(W.Fresh(),_7);};p.New=function(_7,_8){return{Key:_7,Receiver:_8};};q=d.Factory=t.Class({RegisterSource:function(_7){this.SourceItems.Append(o.Create(_7));},RegisterReceiver:function(_7){this.ReceiverItems.Append(p.Create(_7));}},null,q);q.get_Create=function(){var _7,_8;return q.New((_7=y.T.Empty,X.Create(function(_9){return _9.Key;},_7)),(_8=y.T.Empty,X.Create(function(_9){return _9.Key;},_8)));};q.New=function(_7,_8){return new q({SourceItems:_7,ReceiverItems:_8});};r=d.Dashboard=t.Class({get_Render:function(){var _7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt;function bu(bw,bx){var by,bz;by=new y.T({$:1,$0:Y.Class("material-icons orange600"),$1:_8(bx)});bz=[O.TextNode(bw)];return O.Element("i",by,bz);}function bv(bw,bx){var by,bz,bA;by=D.Create$1(bw);return[by,(bz=[Y.DynamicStyle("display",(bA=by.v,Z.Map(function(bB){return bB?"initial":"none";},bA)))],O.Element("div",bz,[bx]))];}_7=this;_8=function(bw){return y.ofArray([Y.Style("Color","#FB8C00"),Y.Style("cursor","pointer"),Y.Handler("click",function(){return function(){return bw();};})]);};_9=(_=[($=function(bw){return bw.Key;},(ba=function(bw){var bx,by,bz;bx=[(by=_8(function(){_7.PropertyGrid.Edit(bw.Source.WebSharper_Community_Dashboard_ISource$get_Properties());}),(bz=[O.TextView(bw.Source.WebSharper_Community_Dashboard_ISource$get_Name().v)],O.Element("i",by,bz)))];return O.Element("tr",[],bx);},function(bw){return O.ConvertBy($,ba,bw);})(this.SourceItems.v))],O.Element("table",[],_));bb=y.ofArray([["Board",bv(true,this.PanelContainer.get_Render())],["Sources",bv(false,_9)]]);bc=(bd=function(bw,bx){var by,bz,bA,bB,bC;by=bx[0];bz=[(bA=[Y.DynamicStyle("Color",(bB=by.v,Z.Map(function(bD){return bD?"#FB8C00":"#7D4600";},bB))),Y.Style("cursor","pointer"),Y.Handler("click",function(){return function(){var bD;bD=function(bE,bF){var bG;bG=bF[0];!L.Equals(bG,by)?D.Set(bG,false):D.Set(bG,true);};return function(bE){y.iter(function(bF){return bD(bF[0],bF[1]);},bE);}(bb);};})],(bC=[O.TextNode(bw)],O.Element("td",bA,bC)))];return O.Element("tr",[],bz);},function(bw){return y.map(function(bx){return bd(bx[0],bx[1]);},bw);}(bb));be=(bf=function(bw,bx){return bx[1];},function(bw){return y.map(function(bx){return bf(bx[0],bx[1]);},bw);}(bb));bg=[(bh=[(bi=[(bj=[Y.Style("vertical-align","top")],(bk=[(bl=S.concat([y.ofArray([(bm=[(bn=[bu("dehaze",function(){})],O.Element("td",[],bn))],O.Element("tr",[],bm)),(bo=[(bp=[bu("add",function(){var bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG;bw=bb.get_Item(0);bx=bw[1][0];by=bb.get_Item(1);bz=by[1][0];bz.c?(bA=y.ofSeq(_7.Factory.SourceItems),bB=D.Create$1(y.head(bA)),bC=_7.Dialog,bD=(bE=[(bF=[Y.Class("form-control")],O.Select(bF,function(bH){return bH.Source.WebSharper_Community_Dashboard_ISource$get_Name().c;},bA,bB))],O.Element("div",[],bE)),bC.ShowDialog("Select source",bD,function(){bB.c.Source.WebSharper_Community_Dashboard_ISource$Run();_7.RegisterSource(bB.c.Source.WebSharper_Community_Dashboard_ISource$Clone());})):bx.c?bG=_7.CreatePanel("Panel",700,{$:1,$0:function(){}}):void 0;})],O.Element("td",[],bp))],O.Element("tr",[],bo)),(bq=[O.Element("td",[],[])],O.Element("tr",[],bq)),(br=[(bs=[this.PropertyGrid.get_Render()],O.Element("td",[],bs))],O.Element("tr",[],br))]),bc]),O.Element("table",[],bl))],O.Element("td",bj,bk))),O.Element("td",[],be)],O.Element("tr",[],bi))],O.Element("table",[],bh)),(bt=[this.Dialog.get_Render()],O.Element("div",[],bt))];return O.Element("div",[],bg);},CreatePanel:function(_7,_8,_9){var _,$,ba,bb,bc;_=this;$=(ba=this.Factory.ReceiverItems.v,(bb=this.ReceiverItems.key,O.ConvertBy(bb,function(bd){var be;be=[O.TextView(bd.Receiver.WebSharper_Community_Dashboard_IReceiver$get_Name().v)];return O.Element("div",[],be);},ba)));bc=_1.get_Create().WithLayoutManager(_2.StackPanelLayoutManager()).WithAttributes([Y.Style("border","1px solid white"),Y.Style("display","flex")]);this.PanelContainer.AddPanel(_3.get_Create().WithPannelAttrs([Y.Style("Width",a.String(_8)+"px"),Y.Style("position","absolute")]).WithTitleContent(O.TextNode(_7)).WithTitleButtons(y.ofArray([_4.New("add",function(bd){var be,bf,bg,bh,bi,bj;be=y.ofSeq(_.Factory.ReceiverItems);bf=D.Create$1(y.head(be));bg=_.Dialog;bh=(bi=[(bj=[Y.Class("form-control")],O.Select(bj,function(bk){return bk.Receiver.WebSharper_Community_Dashboard_IReceiver$get_Name().c;},be,bf))],O.Element("div",[],bi));bg.ShowDialog("Select widget",bh,function(){a.console.log("Dialog.IsOK");_.RegisterReceiver(bd.Children,bf.c.Receiver.WebSharper_Community_Dashboard_IReceiver$Clone());});}),_4.New("edit",function(bd){a.console.log("Edit");bd.EditProperties(_.PropertyGrid);}),_4.New("clear",function(bd){_.PanelContainer.PanelItems.Remove(_.PanelContainer.FindPanelItem(bd));})])).WithChildPanelContainer(bc).WithOnAfterRender(T.DefaultArg(_9,function(){})));return bc;},RegisterReceiver:function(_7,_8){var _9,_,$,ba,bb;this.ReceiverItems.Append(p.Create(_8));_7.AddPanel(_3.get_Create().WithTitle(false).WithPanelContent(_8.WebSharper_Community_Dashboard_IReceiver$Render()).WithProperties((_9=y.concat((_=function(bc){var bd;bd=function(be){return[bc,be];};return function(be){return y.map(bd,be);}(bc.Source.WebSharper_Community_Dashboard_ISource$get_OutPorts());},function(bc){return y.map(_,bc);}(y.ofSeq(this.SourceItems)))),($=D.Create$1(y.head(_9)),(ba=function(bc,bd){var be;be="RegisterReceiver observe"+bc.Source.WebSharper_Community_Dashboard_ISource$get_Name().c;a.console.log(be);bd.WebSharper_Community_Dashboard_IOutPort$Connect(_8.WebSharper_Community_Dashboard_IReceiver$get_InPorts().get_Item(0));},(bb=$.v,Z.Sink(function(bc){return ba(bc[0],bc[1]);},bb),new y.T({$:1,$0:A.select("Source",function(bc){var bd;bd=bc[1];return bc[0].Source.WebSharper_Community_Dashboard_ISource$get_Name().c+"\\"+bd.WebSharper_Community_Dashboard_IOutPort$get_Name();},_9,$),$1:_8.WebSharper_Community_Dashboard_IReceiver$get_Properties()})))))));},RegisterSource:function(_7){this.SourceItems.Append(o.Create(_7));_7.WebSharper_Community_Dashboard_ISource$Run();}},null,r);r.Create=function(_7){var _8,_9;return r.New(q.get_Create(),(_8=y.T.Empty,X.Create(function(_){return _.Key;},_8)),(_9=y.T.Empty,X.Create(function(_){return _.Key;},_9)),_7,_5.get_Create(),_6.get_Create());};r.New=function(_7,_8,_9,_,$,ba){return new r({Factory:_7,SourceItems:_8,ReceiverItems:_9,PanelContainer:_,PropertyGrid:$,Dialog:ba});};}());
