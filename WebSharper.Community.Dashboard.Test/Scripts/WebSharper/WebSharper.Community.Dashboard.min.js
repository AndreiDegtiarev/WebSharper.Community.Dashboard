(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Community=b.Community||{};d=c.Dashboard=c.Dashboard||{};e=d.Environment=d.Environment||{};f=e.Role=e.Role||{};g=a.StartupCode$WebSharper_Community_Dashboard$Environment=a.StartupCode$WebSharper_Community_Dashboard$Environment||{};h=d.MessageBus=d.MessageBus||{};i=h.Value=h.Value||{};j=h.Message=h.Message||{};k=h.ListenerInfo=h.ListenerInfo||{};l=h.AgentMessage=h.AgentMessage||{};m=h.AgentState=h.AgentState||{};n=a.StartupCode$WebSharper_Community_Dashboard$MessageBus=a.StartupCode$WebSharper_Community_Dashboard$MessageBus||{};o=d.InPort=d.InPort||{};p=d.OutPortType=d.OutPortType||{};q=d.OutPort=d.OutPort||{};r=d.Ports=d.Ports||{};s=d.Worker=d.Worker||{};t=d.Workers=d.Workers||{};u=d.RandomRunner=d.RandomRunner||{};v=d.OpenWeather=d.OpenWeather||{};w=v.Forecast=v.Forecast||{};x=d.OpenWeatherRunner=d.OpenWeatherRunner||{};y=d.DatabaseRunnerContext=d.DatabaseRunnerContext||{};z=d.DatabaseRunner=d.DatabaseRunner||{};A=d.ChartRunnerContext=d.ChartRunnerContext||{};B=d.ChartRenderer=d.ChartRenderer||{};C=d.TextBoxRenderer=d.TextBoxRenderer||{};D=d.ButtonRenderer=d.ButtonRenderer||{};E=d.RuleEntry=d.RuleEntry||{};F=d.RuleChain=d.RuleChain||{};G=d.RuleContainer=d.RuleContainer||{};H=d.WorkerItem=d.WorkerItem||{};I=d.Factory=d.Factory||{};J=d.SelectorItem=d.SelectorItem||{};K=d.SelectorGroup=d.SelectorGroup||{};L=d.WindowSelector=d.WindowSelector||{};M=d.RulesCellItem=d.RulesCellItem||{};N=d.RulesRowItem=d.RulesRowItem||{};O=d.WidgetItem=d.WidgetItem||{};P=d.EventsGroupItem=d.EventsGroupItem||{};Q=d.WidgetsGroupItem=d.WidgetsGroupItem||{};R=d.RulesGroupItem=d.RulesGroupItem||{};S=d.DshData=d.DshData||{};T=d.EventsEditor=d.EventsEditor||{};U=d.RulesEditor=d.RulesEditor||{};V=d.DshHelper=d.DshHelper||{};W=d.Dashboard=d.Dashboard||{};X=d.AppModelLib=d.AppModelLib||{};Y=d.App=d.App||{};Z=a.StartupCode$WebSharper_Community_Dashboard$AppModelLib=a.StartupCode$WebSharper_Community_Dashboard$AppModelLib||{};_0=a.IntelliFactory;_1=_0&&_0.Runtime;_2=b&&b.Operators;_3=c&&c.Panel;_4=_3&&_3.Helper;_5=a.Date;_6=b&&b.List;_7=b&&b.Concurrency;_8=b&&b.Remoting;_9=_8&&_8.AjaxRemotingProvider;_=b&&b.Control;$=_&&_.MailboxProcessor;ba=b&&b.Seq;bb=b&&b.PrintfHelpers;bc=b&&b.UI;bd=bc&&bc.Next;be=bd&&bd.View;bf=bd&&bd.Var;bg=c&&c.PropertyGrid;bh=bg&&bg.Properties;bi=b&&b.Guid;bj=b&&b.Unchecked;bk=bd&&bd.Doc;bl=b&&b.Random;bm=a.Math;bn=a.console;bo=b&&b.Data;bp=bo&&bo.TxtRuntime;bq=a.FSharp;br=bq&&bq.Data;bs=br&&br.Runtime;bt=bs&&bs.IO;bu=a.JSON;bv=b&&b.Arrays;bw=b&&b.Charting;bx=bw&&bw.Renderers;by=bx&&bx.ChartJs;bz=bw&&bw.Chart;bA=bw&&bw.Pervasives;bB=bd&&bd.AttrModule;bC=b&&b.Enumerator;bD=bd&&bd.Key;bE=bd&&bd.ListModel;bF=b&&b.Option;bG=_3&&_3.PanelContainer;bH=_3&&_3.LayoutManagers;bI=_3&&_3.Panel;bJ=_3&&_3.TitleButton;bK=_3&&_3.Dialog;bL=bg&&bg.PropertyGrid;f.Server={$:1};f.Client={$:0};e.DataDirectory=function(){g.$cctor();return g.DataDirectory;};e.set_DataDirectory=function(bM){g.$cctor();g.DataDirectory=bM;};e.Log=function(){g.$cctor();return g.Log;};e.set_Log=function(bM){g.$cctor();g.Log=bM;};e.Role$1=function(){g.$cctor();return g.Role;};e.set_Role=function(bM){g.$cctor();g.Role=bM;};g.$cctor=_1.Cctor(function(){g.Role=f.Server;g.Log=a.ignore;g.DataDirectory="";g.$cctor=a.ignore;});i=h.Value=_1.Class({get_AsBoolean:function(){return this.$==2?this.$0:_2.FailWith("MessageBus.Value: unexpected type");},get_AsString:function(){return this.$==1?this.$0:_2.FailWith("MessageBus.Value: unexpected type");},get_AsNumber:function(){return this.$==0?this.$0:_2.FailWith("MessageBus.Value: unexpected type");}},null,i);j.Create=function(bM){return j.New(_4.UniqueKey(),_5.now(),bM);};j.New=function(bM,bN,bO){return{Key:bM,Time:bN,Value:bO};};k.Create=function(bM,bN,bO){return k.New(bM,bN,bO);};k.New=function(bM,bN,bO){return{Key:bM,Name:bN,CacheSize:bO};};l.Clear={$:4};m.get_empty=function(){return m.New(null,_6.T.Empty);};m.New=function(bM,bN){return{ServerCallback:bM,Listeners:bN};};h.RunServerRequests=function(){var bM;_7.Start((bM=null,_7.Delay(function(){return _7.While(function(){return true;},_7.Delay(function(){return _7.Bind(_7.Sleep(2*1000),function(){return _7.Bind(h.Agent().PostAndAsyncReply(function(bN){return{$:6,$0:bN};},null),function(bN){return _7.Bind((new _9.New()).Async("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.MessageBus.GetMessages:1550733476",[bN]),function(bO){var bP;_6.iter(function(bQ){var bR;bR=h.Agent();bR.mailbox.AddLast({$:1,$0:bQ});bR.resume();},bO);return bO.get_Length()>0?(bP=(function(bQ){return function(bR){return bQ("Values from server requested messages received:"+a.String(bR));};}(a.id))(bO.get_Length()),(h.log())(bP),_7.Zero()):_7.Zero();});});});}));})),null);};h.Agent=function(){n.$cctor();return n.Agent;};h.CreateString=function(bM){return h.CreateStrPair(_4.UniqueKey(),bM);};h.CreateNumber=function(bM){return h.CreateNumPair(_4.UniqueKey(),bM);};h.CreateBooleanPair=function(bM,bN){return h.CreateKeyValue(bM,new i({$:2,$0:bN}));};h.CreateStrPair=function(bM,bN){return h.CreateKeyValue(bM,new i({$:1,$0:bN}));};h.CreateNumPair=function(bM,bN){return h.CreateKeyValue(bM,new i({$:0,$0:bN}));};h.CreateKeyValue=function(bM,bN){return j.New(bM,_5.now(),bN);};h.log=function(){n.$cctor();return n.log;};n.$cctor=_1.Cctor(function(){n.log=e.Log();n.Agent=$.Start(function(bM){function bN(bS,bT){return ba.fold(function(bU,bV){return bV.Time>=bS?new _6.T({$:1,$0:bV,$1:bU}):bU;},_6.T.Empty,bT);}function bO(bS,bT){return bS<bT.get_Length()?(_6.splitAt(bS,bT))[0]:bT;}function bP(bS,bT,bU){return bS===1?_6.ofArray([bU]):bO(bS,new _6.T({$:1,$0:bU,$1:bT}));}function bQ(bS,bT){function bU(bV,bW,bX){var bY;bY=a.Array.prototype.slice.call(arguments);return bV.Key===bS.Key?(bW(bS),[bV,bW,bP(bV.CacheSize,bX,bS)]):bY;}return _6.map(function(bV){return bU(bV[0],bV[1],bV[2]);},bT);}function bR(bS){var bT;bT=null;return _7.Delay(function(){return _7.Bind(bM.Receive(null),function(bU){var bV,bW,bX,bY,bZ,b0;function b1(b3,b4,b5){return bN(bX,b5);}function b2(b3,b4,b5){return b5.$==0?(new _5(0,0-1,0)).getTime():_6.maxBy(function(b6){return b6.Time;},b5).Time;}return bU.$==2?(bV=bU.$0[0],(bW=(((_1.Curried3(function(b3,b4,b5){return b3("RegisterListener:"+bb.toSafe(b4)+" "+bb.toSafe(b5));}))(a.id))(bV.Name))(bV.Key),(h.log())(bW),bR(m.New(bS.ServerCallback,new _6.T({$:1,$0:[bV,bU.$0[2],_6.T.Empty],$1:bS.Listeners}))))):bU.$==3?bR(m.New({$:1,$0:bU.$0},bS.Listeners)):bU.$==5?(bX=bU.$0[0],(bU.$0[1](ba.fold(function(b3,b4){return!_6.contains(b4,b3)?new _6.T({$:1,$0:b4,$1:b3}):b3;},_6.T.Empty,_6.concat(_6.map(function(b3){return b1(b3[0],b3[1],b3[2]);},bS.Listeners)))),bR(bS))):bU.$==6?(bY=_6.map(function(b3){return b2(b3[0],b3[1],b3[2]);},bS.Listeners),(bU.$0(bY.$==0?(new _5(0,0-1,0)).getTime():_6.max(bY)),bR(bS))):bU.$==1?bR(m.New(bS.ServerCallback,bQ(bU.$0,bS.Listeners))):bU.$==0?(bZ=bU.$0,(b0=bS.ServerCallback,b0==null?void 0:b0.$0(bZ),bR(m.New(bS.ServerCallback,bQ(bZ,bS.Listeners))))):bR(m.get_empty());});});}return bR(m.get_empty());},null);n.$cctor=a.ignore;});o=d.InPort=_1.Class({Equals:function(bM){return bM instanceof o&&this.Name===bM.Name;},get_BooleanView:function(){return be.Map(function(bM){return bM.Value.get_AsBoolean();},this.PortValue.v);},get_Boolean:function(){return this.PortValue.c.Value.get_AsBoolean();},get_StringView:function(){return be.Map(function(bM){return bM.Value.get_AsString();},this.PortValue.v);},get_String:function(){return this.PortValue.c.Value.get_AsString();},get_NumberView:function(){return be.Map(function(bM){return bM.Value.get_AsNumber();},this.PortValue.v);},get_Number:function(){return this.PortValue.c.Value.get_AsNumber();},Receive:function(bM){bf.Set(this.PortValue,bM);},get_Property:function(){var bM,bN,bO,bP,bQ;bM=this;bN=this.PortValue.c.Value;return bN.$==1?(bO=bf.Create$1(this.get_String()),(be.Sink(function(bR){var bS;bf.Set(bM.PortValue,(bS=bM.PortValue.c,j.New(bS.Key,bS.Time,new i({$:1,$0:bR}))));},bO.v),bh.string(this.Name,bO))):bN.$==2?(bP=bf.Create$1(this.get_Boolean()),(be.Sink(function(bR){var bS;bf.Set(bM.PortValue,(bS=bM.PortValue.c,j.New(bS.Key,bS.Time,new i({$:2,$0:bR}))));},bP.v),bh.check(this.Name,bP))):(bQ=bf.Create$1(this.get_Number()),(be.Sink(function(bR){var bS;bf.Set(bM.PortValue,(bS=bM.PortValue.c,j.New(bS.Key,bS.Time,new i({$:0,$0:bR}))));},bQ.v),bh["double"](this.Name,bQ)));},get_Clone:function(){var bM;return o.New((bM=bi.NewGuid(),a.String(bM)),this.Name,bf.Create$1(this.PortValue.c),this.CacheSize);}},null,o);o.Create=function(bM,bN,bO,bP){return o.New(bM,bN,bO,bP);};o.New=function(bM,bN,bO,bP){return new o({Key:bM,Name:bN,PortValue:bO,CacheSize:bP});};p=d.OutPortType=_1.Class({IsCompatible:function(bM){return this.$==1?bM.PortValue.c.Value.$==1&&true:this.$==2?bM.PortValue.c.Value.$==2&&true:bM.PortValue.c.Value.$==0&&true;}},null,p);p.BooleanOutPort=new p({$:2});p.StringOutPort=new p({$:1});p.NumberOutPort=new p({$:0});q=d.OutPort=_1.Class({Equals:function(bM){return bM instanceof q&&this.Name===bM.Name;},TriggerWithKey:function(bM){var bN;bN=h.Agent();bN.mailbox.AddLast({$:0,$0:bM});bN.resume();},Trigger:function(bM){var bN;bN=h.Agent();bN.mailbox.AddLast({$:0,$0:h.CreateKeyValue(this.Key,bM)});bN.resume();},get_Clone:function(){return q.New(_4.UniqueKey(),this.Name,this.Type);}},null,q);q.CreateString=function(bM,bN){return q.Create(bM,bN,p.StringOutPort);};q.CreateNumber=function(bM,bN){return q.Create(bM,bN,p.NumberOutPort);};q.Create=function(bM,bN,bO){return q.New(bM,bN,bO);};q.New=function(bM,bN,bO){return new q({Key:bM,Name:bN,Type:bO});};r.Create=function(bM){function bN(bO,bP){return[bO,bP,1];}return r.CreateWithCache(_6.map(function(bO){return bN(bO[0],bO[1]);},bM));};r.CreateWithCache=function(bM){function bN(bO,bP,bQ){var bR;bR=bP.Value;return bR.$==1?o.Create(bP.Key,bO,bf.Create$1(j.Create(new i({$:1,$0:bR.$0}))),bQ):bR.$==2?o.Create(bP.Key,bO,bf.Create$1(j.Create(new i({$:2,$0:bR.$0}))),bQ):o.Create(bP.Key,bO,bf.Create$1(j.Create(new i({$:0,$0:bR.$0}))),bQ);}return _6.map(function(bO){return bN(bO[0],bO[1],bO[2]);},bM);};s=d.Worker=_1.Class({Equals:function(bM){return bM instanceof s&&bj.Equals(this.Name,bM.Name);},get_Properties:function(){return new _6.T({$:1,$0:bh.string("Name",this.Name),$1:_6.map(function(bM){return bM.get_Property();},this.InPorts)});},get_Render:function(){var bM;bM=this.Renderer;return bM==null?bk.Empty():(bM.$0.WebSharper_Community_Dashboard_IRenderer$get_Render())(this);},get_CloneAndRun:function(){var bM,bN,bO;bM=bf.Create$1(this.Name.c);bN=_6.map(function(bP){return bP.get_Clone();},this.InPorts);bO=_6.map(function(bP){return bP.get_Clone();},this.OutPorts);return s.New(_4.UniqueKey(),bM,bN,bO,this.Runner,this.Renderer,this.DataContext,null).WithStartRunner();},WithStartRunner:function(){var bM;bM=this.Runner;return bM==null?this:s.New(this.Key,this.Name,this.InPorts,this.OutPorts,this.Runner,this.Renderer,this.DataContext,(bM.$0.WebSharper_Community_Dashboard_IRunner$get_Run())(this));},WithRenderer:function(bM){return s.New(this.Key,this.Name,this.InPorts,this.OutPorts,this.Runner,{$:1,$0:bM},this.DataContext,this.RunnerContext);},WithRunner:function(bM){return s.New(this.Key,this.Name,this.InPorts,this.OutPorts,{$:1,$0:bM},this.Renderer,this.DataContext,this.RunnerContext);},WithKey:function(bM){return s.New(bM,this.Name,this.InPorts,this.OutPorts,this.Runner,this.Renderer,this.DataContext,this.RunnerContext);}},null,s);s.CreateWithRenderer=function(bM){return s.Create(bM).WithRenderer(bM);};s.CreateWithRunner=function(bM){return s.Create(bM).WithRunner(bM);};s.Create=function(bM){return s.New(_4.UniqueKey(),bf.Create$1(bM.WebSharper_Community_Dashboard_IWorkerContext$get_Name()),bM.WebSharper_Community_Dashboard_IWorkerContext$get_InPorts(),bM.WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts(),null,null,bM,null);};s.New=function(bM,bN,bO,bP,bQ,bR,bS,bT){return new s({Key:bM,Name:bN,InPorts:bO,OutPorts:bP,Runner:bQ,Renderer:bR,DataContext:bS,RunnerContext:bT});};t.allInPorts=function(bM){return t.allPorts(bM,function(bN){return bN.InPorts;});};t.allOutPorts=function(bM){return t.allPorts(bM,function(bN){return bN.OutPorts;});};t.allPorts=function(bM,bN){return _6.concat(_6.map(bN,bM));};u=d.RandomRunner=_1.Class({WithMiddleValue:function(bM){return u.New(this.Name,h.CreateNumber(bM),this.Dispersion,this.OutPortKey);},WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bM){var bN;new bl.New();_7.Start((bN=null,_7.Delay(function(){return _7.While(function(){return true;},_7.Delay(function(){return _7.Bind(_7.Sleep(600),function(){var bO,bP,bQ;bO=bM.InPorts.get_Item(1).get_Number();bP=bM.InPorts.get_Item(0).get_Number();bQ=bm.random()*bO+bP;bM.OutPorts.get_Item(0).Trigger(new i({$:0,$0:bQ}));return _7.Zero();});}));})),null);return null;};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return _6.ofArray([q.CreateNumber(this.OutPortKey,"Random value")]);},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return r.Create(_6.ofArray([["Middle value",this.MiddleValue],["Dispersion",this.Dispersion]]));},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return this.Name;}},null,u);u.get_FromPorts=function(){return function(bM){return u.New(bM.Name.c,bM.InPorts.get_Item(0).PortValue.c,bM.InPorts.get_Item(1).PortValue.c,bM.OutPorts.get_Item(0).Key);};};u.Create=function(bM,bN){return u.New("Random",h.CreateNumber(bM),h.CreateNumber(bN),_4.UniqueKey());};u.New=function(bM,bN,bO,bP){return new u({Name:bM,MiddleValue:bN,Dispersion:bO,OutPortKey:bP});};w.New=function(bM,bN,bO,bP,bQ){return{Title:bM,Description:bN,ImageUrl:bO,Temperature:bP,TemparatureMinMax:bQ};};v.get=function(bM,bN){var bO;bO=null;return _7.Delay(function(){var bP;bP=(((_1.Curried3(function(bQ,bR,bS){return bQ("http://api.openweathermap.org/data/2.5/weather?q="+bb.toSafe(bR)+"&units=metric&appid="+bb.toSafe(bS));}))(a.id))(bN))(bM);bn.log("get key city "+bP);return _7.TryWith(_7.Delay(function(){return _7.Bind(bp.AsyncMap(bt.asyncReadTextAtRuntime(false,"C:\\AEAFrame\\WebSharper.Community.Dashboard\\WebSharper.Community.Dashboard","","JSON","",bP),function(bQ){return bj.Equals(typeof bQ,"string")?bu.parse(bQ):bQ;}),function(bQ){var bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb;bn.log("get key city 2");return _7.Return((bR=bv.tryHead(bQ.weather),bR==null?null:{$:1,$0:(bS=bR.$0,w.New((((_1.Curried3(function(cc,cd,ce){return cc(bb.toSafe(cd)+", "+bb.toSafe(ce));}))(a.id))((bU=(bT="name",bT in bQ?{$:1,$0:bQ[bT]}:null),bU==null?null:bU.$0)))((bX=(bV=bQ.sys,(bW="country",bW in bV?{$:1,$0:bV[bW]}:null)),bX==null?null:bX.$0)),(bZ=(bY="main",bY in bS?{$:1,$0:bS[bY]}:null),bZ==null?null:bZ.$0),(function(cc){return function(cd){return cc("http://openweathermap.org/img/w/"+bb.toSafe(cd)+".png");};}(a.id))((b1=(b0="icon",b0 in bS?{$:1,$0:bS[b0]}:null),b1==null?null:b1.$0)),(b2=(b3=bQ.main,(b4="temp",b4 in b3?{$:1,$0:b3[b4]}:null)),(b5=b2==null?null:{$:1,$0:1*b2.$0},b5==null?null:b5.$0)),[(b6=(b7=bQ.main,(b8="temp_min",b8 in b7?{$:1,$0:b7[b8]}:null)),(b9=b6==null?null:{$:1,$0:1*b6.$0},b9==null?null:b9.$0)),(b_=(b$=bQ.main,(ca="temp_max",ca in b$?{$:1,$0:b$[ca]}:null)),(cb=b_==null?null:{$:1,$0:1*b_.$0},cb==null?null:cb.$0))]))}));});}),function(bQ){bn.log(bQ.message);return _7.Return(null);});});};x=d.OpenWeatherRunner=_1.Class({WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bM){var bN;_7.Start((bN=null,_7.Delay(function(){return _7.While(function(){return true;},_7.Delay(function(){var bO,bP,bQ;bO=bM.InPorts.get_Item(0);bP=bM.InPorts.get_Item(1);bQ=bM.OutPorts.get_Item(0);return _7.Bind(v.get(bP.get_String(),bO.get_String()),function(bR){return _7.Combine(bR==null?_7.Zero():(bn.log("Value generated:"+bR.$0.Title),bQ.Trigger(new i({$:0,$0:+bR.$0.Temperature})),_7.Zero()),_7.Delay(function(){return _7.Bind(_7.Sleep(1000*15),function(){return _7.Return(null);});}));});}));})),null);return null;};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return _6.ofArray([q.CreateNumber(this.OutPortKey,"Temperature")]);},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return r.Create(_6.ofArray([["City",this.OpenWeatherCity],["ApiKey",this.OpenWeatherApiKey]]));},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return this.Name;}},null,x);x.get_FromPorts=function(){return function(bM){return x.New(bM.Name.c,bM.InPorts.get_Item(0).PortValue.c,bM.InPorts.get_Item(1).PortValue.c,bM.OutPorts.get_Item(0).Key);};};x.Create=function(bM,bN){var bO;return x.New("OpenWeatherMap",h.CreateString(bM),h.CreateString(bN),(bO=bi.NewGuid(),a.String(bO)));};x.New=function(bM,bN,bO,bP){return new x({Name:bM,OpenWeatherCity:bN,OpenWeatherApiKey:bO,OutPortKey:bP});};y.New=function(bM){return{DatabaseRunnerRun:bM};};z=d.DatabaseRunner=_1.Class({WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bM){be.Sink(function(bN){var bO;bO=((((_1.Curried(function(bP,bQ,bR,bS){return bP(bb.toSafe(bQ)+" "+bb.toSafe(bR)+" "+bS.toFixed(6));},4))(a.id))(bN.Key))(a.String(bN.Time)))(bN.Value.get_AsNumber());(new _9.New()).Send("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.ServerDatabase.WriteLine:2078881569",[bM.InPorts.get_Item(1).get_String(),bO]);bM.OutPorts.get_Item(0).TriggerWithKey(bN);},bM.InPorts.get_Item(0).PortValue.v);return null;};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return _6.ofArray([q.CreateNumber(this.OutPortKey,"Number value")]);},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return r.Create(_6.ofArray([[" in Value",this.InValue],["Database name",this.DatabaseName]]));},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return this.Name;}},null,z);z.get_FromPorts=function(){return function(bM){var bN;bN=bM.InPorts.get_Item(0).PortValue.c;return z.New(bM.Name.c,bM.InPorts.get_Item(1).PortValue.c,bN,bM.OutPorts.get_Item(0).Key);};};z.get_Create=function(){return z.New("Database",h.CreateString("Database.txt"),h.CreateNumber(0),_4.UniqueKey());};z.New=function(bM,bN,bO,bP){return new z({Name:bM,DatabaseName:bN,InValue:bO,OutPortKey:bP});};A.New=function(bM,bN){return{LineChart:bM,Queue:bN};};B=d.ChartRenderer=_1.Class({WebSharper_Community_Dashboard_IRenderer$get_Render:function(){return function(bM){var bN,bO,bP,bQ,bR,bS,bT,bU;bN=bM.InPorts.get_Item(3).get_Number()<<0;bO=bM.RunnerContext.$0;be.Sink(function(bV){bO.Queue.push(bV);bO.Queue.length>bN?bO.Queue.shift():void 0;ba.iteri(function(bW,bX){return bO.LineChart.__UpdateData(bW,function(){return bX;});},bO.Queue);},bM.InPorts.get_Item(0).get_NumberView());return by.Render$8(bM.RunnerContext.$0.LineChart,{$:1,$0:{$:0,$0:bM.InPorts.get_Item(1).get_Number()<<0,$1:bM.InPorts.get_Item(2).get_Number()<<0}},{$:1,$0:(bP={},bP.title=(bQ={},bQ.display=false,bQ),bP.legend=(bR={},bR.display=false,bR),bP.elements=(bS={},bS.point=(bT={},bT.radius=0,bT),bS.line=(bU={},bU.borderWidth=1,bU),bS),bP)},null);};},WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bM){var bN,bO,bP,bQ;bN=bM.InPorts.get_Item(3).get_Number()<<0;bO=_6.ofSeq(ba.delay(function(){return ba.map(function(){return 0;},_2.range(0,bN-1));}));bP=(bQ=[],(ba.iter(function(bR){bQ.push(bR);},bO),bQ));return{$:1,$0:A.New(bz.Line(bO).WithFill(false).__WithStrokeColor(new bA.Color({$:1,$0:"#FB8C00"})).__WithPointColor(new bA.Color({$:2,$0:"black"})),bP)};};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return _6.T.Empty;},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return r.CreateWithCache(_6.ofArray([[" in Value",this.Number,this.ChartBufferSize.Value.get_AsNumber()<<0],["cx",this.Cx,1],["cy",this.Cy,1],["BufferSize",this.ChartBufferSize,1]]));},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return this.Name;}},null,B);B.get_FromPorts=function(){return function(bM){return B.New(bM.Name.c,bM.InPorts.get_Item(0).PortValue.c,bM.InPorts.get_Item(1).PortValue.c,bM.InPorts.get_Item(2).PortValue.c,bM.InPorts.get_Item(3).PortValue.c);};};B.Create=function(bM,bN,bO){return B.New("Chart",h.CreateNumber(0),h.CreateNumber(bM),h.CreateNumber(bN),h.CreateNumber(bO));};B.New=function(bM,bN,bO,bP,bQ){return new B({Name:bM,Number:bN,Cx:bO,Cy:bP,ChartBufferSize:bQ});};C=d.TextBoxRenderer=_1.Class({WebSharper_Community_Dashboard_IRenderer$get_Render:function(){return function(bM){var bN;bN=be.Map(function(bO){var bP;bP=bO<<0;return a.String(bP);},bM.InPorts.get_Item(0).get_NumberView());return bk.Element("div",[bB.Class("bigvalue")],[bk.TextView(bN)]);};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return _6.T.Empty;},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return r.Create(_6.ofArray([["in Value",this.TextBoxValue]]));},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return this.Name;}},null,C);C.get_FromPorts=function(){return function(bM){return C.New(bM.Name.c,bM.InPorts.get_Item(0).PortValue.c);};};C.get_Create=function(){return C.New("Text",h.CreateNumber(0));};C.New=function(bM,bN){return new C({Name:bM,TextBoxValue:bN});};D=d.ButtonRenderer=_1.Class({WebSharper_Community_Dashboard_IRenderer$get_Render:function(){return function(bM){return bk.ButtonView(bM.InPorts.get_Item(0).get_String(),[],bM.InPorts.get_Item(1).get_BooleanView(),function(bN){bM.OutPorts.get_Item(0).Trigger(new i({$:2,$0:bN}));});};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return _6.ofArray([q.CreateNumber(this.OutPortKey,"Button value")]);},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return r.Create(_6.ofArray([["Caption",this.ButtonName],["State",this.State]]));},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return this.Name;}},null,D);D.get_FromPorts=function(){return function(bM){return D.New(bM.Name.c,bM.InPorts.get_Item(0).PortValue.c,bM.InPorts.get_Item(1).PortValue.c,bM.OutPorts.get_Item(0).Key);};};D.get_Create=function(){return D.New("Button",h.CreateString("Button"),h.CreateNumber(0),_4.UniqueKey());};D.New=function(bM,bN,bO,bP){return new D({Name:bM,ButtonName:bN,State:bO,OutPortKey:bP});};E.New=function(bM,bN,bO){return{InPortKey:bM,OutPortKey:bN,WorkerKey:bO};};F.New=function(bM){return{RuleChain:bM};};G=d.RuleContainer=_1.Class({Reconnect:function(bM){var bN,bO,bP;bN=t.allOutPorts(bM);bO=t.allInPorts(bM);_6.iter(function(bQ){(e.Log())((((_1.Curried3(function(bR,bS,bT){return bR(bb.toSafe(bS)+" "+bb.toSafe(bT));}))(a.id))(bQ.Name))(bQ.Key));},bO);bP=h.Agent();bP.mailbox.AddLast(l.Clear);bP.resume();_6.iter(function(bQ){var bR,bS,bT;bR=_6.ofSeq(bQ.RuleChain);bS=_6.ofSeq(_2.range(1,bR.get_Length()-1));bT=bC.Get(bS);try{while(bT.MoveNext())(function(){var bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3;bU=bT.Current();bV=bR.get_Item(bU-1);bW=bR.get_Item(bU);{bX=ba.tryFind(function(b4){return b4.Key===bV.OutPortKey;},bN),bX==null?null:{$:1,$0:(bY=bX.$0,((e.Log())((function(b4){return function(b5){return b4("Found out port "+bb.toSafe(b5));};}(a.id))(bW.InPortKey)),bZ=ba.tryFind(function(b4){return b4.Key===bW.InPortKey;},bO),bZ==null?null:{$:1,$0:(b0=bZ.$0,((e.Log())("Found int port"),b1=(b2=b0.PortValue.c.Value,b2.$==1?j.Create(new i({$:1,$0:""})):b2.$==2?j.Create(new i({$:2,$0:false})):j.Create(new i({$:0,$0:0}))),b3=h.Agent(),b3.mailbox.AddLast({$:2,$0:[k.Create(bY.Key,bY.Name+"->"+b0.Name,b0.CacheSize),b1,function(b4){b0.Receive(b4);}]}),b3.resume()))}))};return;}}());}finally{if("Dispose"in bT)bT.Dispose();}},_6.ofSeq(this.RuleContainer));}},null,G);G.New=function(bM){return new G({RuleContainer:bM});};H.Create=function(bM){return H.New(bD.Fresh(),bM);};H.New=function(bM,bN){return{Key:bM,Worker:bN};};I=d.Factory=_1.Class({RegisterEvent:function(bM){this.EventItems.Append(H.Create(bM));},RegisterWidget:function(bM){this.WidgetItems.Append(H.Create(bM));}},null,I);I.get_Create=function(){return I.New(bE.Create(function(bM){return bM.Key;},_6.T.Empty),bE.Create(function(bM){return bM.Key;},_6.T.Empty));};I.New=function(bM,bN){return new I({EventItems:bM,WidgetItems:bN});};J.Create=function(bM,bN){return J.New(bD.Fresh(),bM,bN);};J.New=function(bM,bN,bO){return{Key:bM,Name:bN,SelectorRenderer:bO};};K=d.SelectorGroup=_1.Class({RenderMenu:function(bM,bN){var bO,bP,bQ,bR;bO=this;bP=(bQ=this.ChildCreatator,bQ==null?bk.Element("tr",[],[]):(bR=bQ.$0,bk.Element("tr",[],[bk.Element("td",[],[bk.Element("div",[bB.Style("margin-left","20px")],[_4.IconSmall("add",function(){var bS,bT;bS=bR();bT=J.Create(bS[0],bS[1]);bO.ItemOnCreated(bT);bO.SelectorItems.Append(bT);})])])])));return bk.Element("table",[],[bk.ConvertBy(function(bS){return bS.Key;},function(bS){var bT;bT=be.Map(function(bU){return bM+bU;},bS.Name.v);return bk.Element("tr",[],[bk.Element("td",[bB.DynamicStyle("Color",be.Map(function(bU){return bU==null?"#7D4600":bj.Equals(bU.$0.Key,bS.Key)?"#FB8C00":"#7D4600";},bN.v)),bB.Style("cursor","pointer"),bB.Handler("click",function(){return function(){bO.ItemOnSelected(bS);return bf.Set(bN,{$:1,$0:bS});};})],[bk.Element("div",[bB.Style("margin-left","10px"),bB.Style("margin-right","5px")],[bk.TextView(bT)])])]);},this.SelectorItems.v),bP]);},ItemByIndex:function(bM){return _6.head(_6.ofSeq(this.SelectorItems));}},null,K);K.Create=function(bM,bN,bO,bP,bQ){var bR;bR=bE.Create(function(bS){return bS.Key;},_6.map(function(bS){return J.Create(bS[0],bS[1]);},bN));return K.New(bD.Fresh(),bf.Create$1(bM),bR,bO,bP,bQ);};K.New=function(bM,bN,bO,bP,bQ,bR){return new K({Key:bM,Name:bN,SelectorItems:bO,ChildCreatator:bP,ItemOnCreated:bQ,ItemOnSelected:bR});};L=d.WindowSelector=_1.Class({get_RenderMenu:function(){var bM;bM=this;return this.SelectorGroups.get_Length()===1?_6.head(_6.ofSeq(this.SelectorGroups)).RenderMenu("",this.OptSelectedItem):bk.Element("div",[],[bk.ConvertBy(function(bN){return bN.Key;},function(bN){return bk.Element("div",[],[bk.Element("div",[bB.Style("cursor","pointer"),bB.Handler("click",function(){return function(){return bM.GroupOnClick(bN);};})],[bk.TextView(bN.Name.v)]),bN.RenderMenu("    ",bM.OptSelectedItem)]);},this.SelectorGroups.v)]);},get_Render:function(){return bk.Element("div",[],[bk.BindView(function(bM){return bM==null?bk.Empty():bM.$0.SelectorRenderer;},this.OptSelectedItem.v)]);},GroupByIndex:function(bM){return ba.nth(bM,_6.ofSeq(this.SelectorGroups));},get_SelectedIndex:function(){var bM;bM=this;return ba.findIndex(function(bN){return bj.Equals(bN.Key,bM.get_SelectedItem().Key);},_6.concat(_6.map(function(bN){return _6.ofSeq(bN.SelectorItems);},_6.ofSeq(this.SelectorGroups))));},get_SelectedIndexInGroup:function(){var bM;bM=this;return ba.findIndex(function(bN){return bj.Equals(bN.Key,bM.get_SelectedItem().Key);},_6.ofSeq(this.get_SelectedGroup().SelectorItems));},get_SelectedGroupIndex:function(){var bM;bM=this;return ba.findIndex(function(bN){return bj.Equals(bN.Key,bM.get_SelectedGroup().Key);},_6.ofSeq(this.SelectorGroups));},get_SelectedGroup:function(){return this.GroupFromItem(this.get_SelectedItem());},GroupFromItem:function(bM){return ba.find(function(bN){return _6.exists(function(bO){return bj.Equals(bO.Key,bM.Key);},_6.ofSeq(bN.SelectorItems));},_6.ofSeq(this.SelectorGroups));},AppenGroup:function(bM,bN,bO){this.SelectorGroups.Append(K.Create(bM,bN,bO,this.ItemOnCreated(this.SelectorGroups.get_Length()),this.ItemOnSelected));},get_SelectedItem:function(){var bM;bM=this.OptSelectedItem.c;return bM==null?_2.FailWith("Something really wrong with WindowSelector"):bM.$0;},ClearGroups:function(){bf.Set(this.OptSelectedItem,null);_6.iter(function(bM){bM.SelectorItems.Clear();},_6.ofSeq(this.SelectorGroups));},WithItemOnSelected:function(bM){return L.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,bM);},WithGroupOnClick:function(bM){return L.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,bM,this.ItemOnSelected);},WithItemOnCreated:function(bM){return L.New(this.OptSelectedItem,this.SelectorGroups,bM,this.GroupOnClick,this.ItemOnSelected);}},null,L);L.get_Create=function(){var bM;bM=bE.Create(function(bN){return bN.Key;},_6.T.Empty);return L.New(bf.Create$1(null),bM,function(){return function(){return null;};},a.ignore,a.ignore);};L.New=function(bM,bN,bO,bP,bQ){return new L({OptSelectedItem:bM,SelectorGroups:bN,ItemOnCreated:bO,GroupOnClick:bP,ItemOnSelected:bQ});};M=d.RulesCellItem=_1.Class({Render:function(bM,bN){var bO,bP,bQ,bR,bS;bO=this;be.Sink(function(bT){var bU;if(bT==null);else{bU=bT.$0;bn.log("Workitem selected");bf.Set(bO.OptInPort,_6.tryHead(bU.Worker.InPorts));bf.Set(bO.OptOutPort,_6.tryHead(bU.Worker.OutPorts));bN();}},this.OptWorker.v);be.Sink(function(){bN();},this.OptInPort.v);be.Sink(function(){bN();},this.OptOutPort.v);bP=(bQ=be.Map(function(bT){var bU;return bT==null?_6.ofArray([null]):(bU=_6.map(function(bV){return{$:1,$0:bV};},bT.$0.Worker.InPorts),bU.get_Length()>0?bU:_6.ofArray([null]));},this.OptWorker.v),(bR=be.Map(function(bT){var bU;return bT==null?_6.ofArray([null]):(bU=_6.map(function(bV){return{$:1,$0:bV};},bT.$0.Worker.OutPorts),bU.get_Length()>0?bU:_6.ofArray([null]));},this.OptWorker.v),(bS=be.Map(function(bT){return new _6.T({$:1,$0:null,$1:_6.map(function(bU){return{$:1,$0:bU};},_6.ofSeq(bT))});},bM.v),bk.Element("table",[],[bk.Element("tr",[],[bk.Element("td",[],[bk.SelectDyn([bB.Class("form-control")],function(bT){return bF.fold(function(bU,bV){return bV.Name;}," ",bT);},bQ,this.OptInPort)]),bk.Element("td",[],[bk.SelectDyn([bB.Class("form-control")],function(bT){return bF.fold(function(bU,bV){return bV.Worker.Name.c;}," ",bT);},bS,this.OptWorker)]),bk.Element("td",[],[bk.SelectDyn([bB.Class("form-control")],function(bT){return bF.fold(function(bU,bV){return bV.Name;}," ",bT);},bR,this.OptOutPort)])])]))));return bk.Element("td",[bB.Class("td DshEditorCell")],[bk.Element("div",[bB.Class("div DshEditorCell")],[bk.Element("table",[],[bk.Element("tr",[],[bk.Element("td",[],[bP])])])])]);}},null,M);M.get_Create=function(){return M.New(bD.Fresh(),bf.Create$1(null),bf.Create$1(null),bf.Create$1(null));};M.New=function(bM,bN,bO,bP){return new M({Key:bM,OptInPort:bN,OptWorker:bO,OptOutPort:bP});};N=d.RulesRowItem=_1.Class({Render:function(bM,bN){var bO;bO=this;return bk.Element("tr",[],[bk.ConvertBy(function(bP){return bP.Key;},function(bP){return bP.Render(bM,bN);},this.CellItems.v),_4.IconNormal("add",function(){bO.CellItems.Append(M.get_Create());})]);}},null,N);N.Create=function(bM){return N.New(bD.Fresh(),bE.Create(function(bN){return bN.Key;},bM));};N.New=function(bM,bN){return new N({Key:bM,CellItems:bN});};O.Create=function(bM,bN){return O.New(bD.Fresh(),bM,bN);};O.New=function(bM,bN,bO){return{Key:bM,Panel:bN,Widget:bO};};P.Create=function(bM){return P.New(bD.Fresh(),bf.Create$1(bM),bE.Create(function(bN){return bN.Key;},_6.T.Empty));};P.New=function(bM,bN,bO){return{Key:bM,Name:bN,EventItems:bO};};Q.Create=function(bM,bN){return Q.New(bD.Fresh(),bf.Create$1(bM),bE.Create(function(bO){return bO.Key;},_6.T.Empty),bN);};Q.New=function(bM,bN,bO,bP){return{Key:bM,Name:bN,WidgetItems:bO,PanelContainer:bP};};R.Create=function(bM){return R.New(bD.Fresh(),bf.Create$1(bM),bE.Create(function(bN){return bN.Key;},_6.T.Empty));};R.New=function(bM,bN,bO){return{Key:bM,Name:bN,RulesRowItems:bO};};S=d.DshData=_1.Class({RegisterWidget:function(bM,bN,bO,bP){var bQ;bQ=bP.WithKey(bM);bN.WidgetItems.Append(O.Create(bO,bQ));this.WorkItems.Append(H.Create(bQ));},RegisterEvent:function(bM,bN,bO){var bP;bP=H.Create(bO.WithKey(bM));bN.EventItems.Append(bP);this.WorkItems.Append(bP);},get_Clear:function(){this.WorkItems.Clear();this.WidgetGroups.Clear();this.EventGroups.Clear();this.RulesGroups.Clear();}},null,S);S.get_Create=function(){return S.New(bE.Create(function(bM){return bM.Key;},_6.T.Empty),bE.Create(function(bM){return bM.Key;},_6.T.Empty),bE.Create(function(bM){return bM.Key;},_6.T.Empty),bE.Create(function(bM){return bM.Key;},_6.T.Empty));};S.New=function(bM,bN,bO,bP){return new S({WorkItems:bM,WidgetGroups:bN,EventGroups:bO,RulesGroups:bP});};T.Render=function(bM,bN){return bk.Element("table",[],[bk.ConvertBy(function(bO){return bO.Key;},function(bO){return bk.Element("tr",[],[bk.Element("i",_4.AttrsClick(function(){bN.Edit(bO.Worker.get_Properties());}),[bk.TextView(bO.Worker.Name.v)])]);},bM.v)]);};U.Render=function(bM,bN){function bO(){var bP;bP=_6.map(function(bQ){return bQ.Worker;},_6.ofSeq(bM.WorkItems));U.CopyToRules(bN).Reconnect(bP);}return bk.Element("table",[],[bk.ConvertBy(function(bP){return bP.Key;},function(bP){return bk.Element("tr",[],[bP.Render(bM.WorkItems,function(){bO();})]);},bN.v)]);};U.Restore=function(bM,bN,bO){var bP,bQ,bR;bN.Clear();bP=_6.map(function(bS){return bS.Worker;},_6.ofSeq(bM.WorkItems));bQ=t.allOutPorts(bP);bR=t.allInPorts(bP);_6.iter(function(bS){var bT;bT=N.Create([]);_6.iter(function(bU){var bV;bV=M.get_Create();bf.Set(bV.OptWorker,ba.tryFind(function(bW){return bW.Worker.Key===bU.WorkerKey;},_6.ofSeq(bM.WorkItems)));bf.Set(bV.OptInPort,ba.tryFind(function(bW){return bW.Key===bU.InPortKey;},bR));bf.Set(bV.OptOutPort,ba.tryFind(function(bW){return bW.Key===bU.OutPortKey;},bQ));bT.CellItems.Append(bV);},bS.RuleChain);bN.Append(bT);},bO.RuleContainer);bO.Reconnect(bP);};U.CopyToRules=function(bM){return G.New(_6.map(function(bN){return F.New(_6.map(function(bO){var bP,bQ,bR;return E.New((bP=bO.OptInPort.c,bP==null?"":bP.$0.Key),(bQ=bO.OptOutPort.c,bQ==null?"":bQ.$0.Key),(bR=bO.OptWorker.c,bR==null?"":bR.$0.Worker.Key));},_6.ofSeq(bN.CellItems)));},_6.ofSeq(bM)));};V.RulesGroupCreator=function(bM,bN){var bO;bO=R.Create("rules"+a.String(_6.length(_6.ofSeq(bM.RulesGroups))+1));bM.RulesGroups.Append(bO);return[bO.Name,U.Render(bM,bO.RulesRowItems)];};V.EventsGroupCreator=function(bM,bN,bO){var bP;bP=P.Create("event"+a.String(_6.length(_6.ofSeq(bM.EventGroups))+1));bM.EventGroups.Append(bP);return[bP.Name,T.Render(bP.EventItems,bN)];};V.PanelGroupCreator=function(bM,bN,bO){var bP,bQ,bR;bP=_6.length(_6.ofSeq(bM.WidgetGroups))+1;bQ=bN();bR=Q.Create("panel"+a.String(bP),bQ);bM.WidgetGroups.Append(bR);return[bR.Name,bQ.get_Render()];};W=d.Dashboard=_1.Class({Render:function(bM){var bN;bN=this;return bk.EmbedView(be.Map(function(bO){return bO.$==1?bk.Element("div",[],[bk.Element("table",[],[bk.Element("tr",[],[bk.Element("td",[bB.Style("vertical-align","top")],[bk.Element("table",[],ba.concat([_6.ofArray([bk.Element("tr",[],[bk.Element("td",[],[_4.IconNormal("dehaze",function(){bf.Set(bN.PanelTitleVisibility,false);bf.Set(bN.Mode,{$:0});})])])]),_6.ofArray([bN.EditorSelectorEdit.get_RenderMenu()]),_6.ofArray([bk.Element("tr",[],[bk.Element("td",[],[])]),bk.Element("tr",[],[bk.Element("td",[],[bN.PropertyGrid.get_Render()])])])]))]),bk.Element("td",[bB.Style("vertical-align","top")],[bM,_4.IconNormal("add",function(){var bP,bQ,bR,bS,bT;bP=bN.EditorSelectorEdit.get_SelectedGroupIndex();bP===1?(bQ=_6.ofSeq(bN.Factory.EventItems),bR=bf.Create$1(_6.head(bQ)),bN.Dialog.ShowDialog("Select source",bk.Element("div",[],[bk.Select([bB.Class("form-control")],function(bU){return bU.Worker.Name.c;},bQ,bR)]),function(){var bU,bV,bW;bU=bR.c.Worker.get_CloneAndRun();bV=(bW=_6.ofSeq(bN.Data.EventGroups),ba.nth(bN.EditorSelectorEdit.get_SelectedIndexInGroup(),bW));bN.Data.RegisterEvent(_4.UniqueKey(),bV,bU);})):bP===0?bN.CreatePanel((bS=_6.ofSeq(bN.Data.WidgetGroups),ba.nth(bN.EditorSelectorEdit.get_SelectedIndexInGroup(),bS)),"Panel",700,null):bP===2?(bT=_6.ofSeq(bN.Data.RulesGroups),ba.nth(bN.EditorSelectorEdit.get_SelectedIndexInGroup(),bT)).RulesRowItems.Append(N.Create([M.get_Create(),M.get_Create()])):void 0;}),bN.EditorSelectorEdit.get_Render()])])]),bk.Element("div",[],[bN.Dialog.get_Render()])]):bk.Element("div",[],[bk.Element("table",[],[bk.Element("tr",[],[bk.Element("td",[bB.Style("vertical-align","top")],[_4.IconNormal("dehaze",function(){bf.Set(bN.PanelTitleVisibility,true);bf.Set(bN.Mode,{$:1});}),bN.EditorSelectorRun.GroupByIndex(0).SelectorItems.get_Length()>1?bN.EditorSelectorRun.get_RenderMenu():bk.Element("div",[],[])]),bk.Element("td",[],[bN.EditorSelectorRun.get_Render()])])])]);},this.Mode.v));},Restore:function(bM,bN,bO,bP){var bQ,bR,bS,bT,bU;bQ=this;this.EditorSelectorRun.ClearGroups();this.EditorSelectorEdit.ClearGroups();this.Data.get_Clear();bR=this.EditorSelectorRun.GroupByIndex(0);bS=this.EditorSelectorEdit.GroupByIndex(0);bT=this.EditorSelectorEdit.GroupByIndex(1);bU=this.EditorSelectorEdit.GroupByIndex(2);_6.iteri(function(bV,bW){var bX,bY,bZ,b0;function b1(b2,b3,b4){bQ.RegisterWidget(b2,b0,b3,ba.find(function(b5){return b5.Key===b3;},_6.ofSeq(b0.PanelContainer.PanelItems)).Children,b4.WithStartRunner());}bX=V.PanelGroupCreator(bQ.Data,bM,null);bY=bX[1];bZ=bX[0];bf.Set(bZ,bW[0]);bS.SelectorItems.Append(J.Create(bZ,bY));bR.SelectorItems.Append(J.Create(bZ,bY));b0=ba.nth(bV,_6.ofSeq(bQ.Data.WidgetGroups));_6.iter(function(b2){var b3;b3=bQ.CreatePanel(b0,"Panel",700,{$:1,$0:b2.Key});bf.Set(b3.Left,b2.Left);bf.Set(b3.Top,b2.Top);},bW[1]);return _6.iter(function(b2){return b1(b2[0],b2[1],b2[2]);},bW[2]);},bO);bn.log("Widgets restored");_6.iteri(function(bV,bW){var bX,bY,bZ;function b0(b1,b2){bQ.Data.RegisterEvent(b1,bZ,b2);}bX=V.EventsGroupCreator(bQ.Data,bQ.PropertyGrid,null);bY=bX[0];bf.Set(bY,bW[0]);bT.SelectorItems.Append(J.Create(bY,bX[1]));bZ=ba.nth(bV,_6.ofSeq(bQ.Data.EventGroups));return _6.iter(function(b1){return b0(b1[0],b1[1]);},bW[1]);},bN);bn.log("Events restored");_6.iteri(function(bV,bW){var bX,bY;bX=V.RulesGroupCreator(bQ.Data,null);bY=bX[0];bf.Set(bY,bW[0]);bU.SelectorItems.Append(J.Create(bY,bX[1]));return U.Restore(bQ.Data,ba.nth(bV,_6.ofSeq(bQ.Data.RulesGroups)).RulesRowItems,bW[1]);},bP);this.Data.WidgetGroups.get_Length()>0?(bf.Set(this.EditorSelectorEdit.OptSelectedItem,{$:1,$0:_6.head(_6.ofSeq(this.EditorSelectorEdit.GroupByIndex(0).SelectorItems))}),bf.Set(this.EditorSelectorRun.OptSelectedItem,{$:1,$0:_6.head(_6.ofSeq(this.EditorSelectorRun.GroupByIndex(0).SelectorItems))})):(bf.Set(this.EditorSelectorEdit.OptSelectedItem,null),bf.Set(this.EditorSelectorRun.OptSelectedItem,null));bn.log("Connectors restored");},Store:function(bM){return[_6.map(function(bN){return[bN.Name.c,_6.map(function(bO){return[bO.Worker.Key,bM(bO.Worker)];},_6.ofSeq(bN.EventItems))];},_6.ofSeq(this.Data.EventGroups)),_6.map(function(bN){return[bN.Name.c,_6.map(function(bO){return bO.get_PanelData();},_6.ofSeq(bN.PanelContainer.PanelItems)),_6.map(function(bO){return[bO.Widget.Key,bO.Panel,bM(bO.Widget)];},_6.ofSeq(bN.WidgetItems))];},_6.ofSeq(this.Data.WidgetGroups)),_6.map(function(bN){return[bN.Name.c,U.CopyToRules(bN.RulesRowItems)];},_6.ofSeq(this.Data.RulesGroups))];},CreatePanel:function(bM,bN,bO,bP){var bQ,bR,bS,bT,bU,bV;bQ=this;bk.ConvertBy(bM.WidgetItems.key,function(bW){return bk.Element("div",[],[bk.TextView(bW.Widget.Name.v)]);},bM.WidgetItems.v);bR=(bS=(bT=bi.NewGuid(),a.String(bT)),bP==null?bS:bP.$0);bU=bG.get_Create().WithLayoutManager(bH.StackPanelLayoutManager()).WithAttributes([bB.Style("border","1px solid white"),bB.Style("display","flex")]);bV=bI.get_Create().WithKey(bR).WithPannelAttrs([bB.Style("Width",a.String(bO)+"px"),bB.Style("position","absolute")]).WithTitle(this.PanelTitleVisibility).WithTitleContent(bk.TextNode(bN)).WithTitleButtons(_6.ofArray([bJ.New("add",function(bW){var bX,bY;bX=_6.ofSeq(bQ.Factory.WidgetItems);bY=bf.Create$1(_6.head(bX));bQ.Dialog.ShowDialog("Select widget",bk.Element("div",[],[bk.Select([bB.Class("form-control")],function(bZ){return bZ.Worker.Name.c;},bX,bY)]),function(){bn.log("Dialog.IsOK");bQ.RegisterWidget(_4.UniqueKey(),bM,bW.Key,bW.Children,bY.c.Worker.get_CloneAndRun());});}),bJ.New("edit",function(bW){bn.log("Edit");bQ.PropertyGrid.Edit(_6.concat(_6.map(function(bX){return bX.Widget.get_Properties();},_6.filter(function(bX){return bX.Panel===bW.Key;},_6.ofSeq(bM.WidgetItems)))));}),bJ.New("clear",function(bW){bM.PanelContainer.PanelItems.Remove(bM.PanelContainer.FindPanelItem(bW));})])).WithChildPanelContainer(bU);bM.PanelContainer.AddPanel(bV);return bV;},RegisterWidget:function(bM,bN,bO,bP,bQ){var bR;this.Data.RegisterWidget(bM,bN,bO,bQ);bR=bI.get_Create().WithPanelContent(bQ.get_Render());bf.Set(bR.IsWithTitle,false);bP.AddPanel(bR);}},null,W);W.Create=function(bM){var bN,bO,bP,bQ,bR,bS;function bT(){return V.PanelGroupCreator(bO,bM,void 0);}function bU(){return V.EventsGroupCreator(bO,bP,void 0);}function bV(){return V.RulesGroupCreator(bO,void 0);}bN=bK.get_Create();bO=S.get_Create();bP=bL.get_Create();bQ=L.get_Create();bR=L.get_Create().WithGroupOnClick(function(bW){bP.Edit(_6.mapi(function(bX,bY){var bZ;return bh.string((bZ=bX+1,a.String(bZ)),bY.Name);},_6.ofSeq(bW.SelectorItems)));}).WithItemOnSelected(function(){bP.Edit(_6.T.Empty);}).WithItemOnCreated(function(bW){return function(bX){return bW===0?_6.head(_6.ofSeq(bQ.SelectorGroups)).SelectorItems.Append(bX):null;};});bS=bT();bR.AppenGroup("Panels",_6.ofArray([bS]),{$:1,$0:bT});bQ.AppenGroup("Panels",_6.ofArray([bS]),null);bR.AppenGroup("Events",_6.ofArray([bU()]),{$:1,$0:bU});bR.AppenGroup("Rules",_6.ofArray([bV()]),{$:1,$0:bV});bf.Set(bR.OptSelectedItem,{$:1,$0:_6.head(_6.ofSeq(bR.GroupByIndex(0).SelectorItems))});bf.Set(bQ.OptSelectedItem,{$:1,$0:_6.head(_6.ofSeq(bQ.GroupByIndex(0).SelectorItems))});return W.New(I.get_Create(),bO,bP,bN,bQ,bR,bf.Create$1({$:0}),bf.Create$1(false));};W.New=function(bM,bN,bO,bP,bQ,bR,bS,bT){return new W({Factory:bM,Data:bN,PropertyGrid:bO,Dialog:bP,EditorSelectorRun:bQ,EditorSelectorEdit:bR,Mode:bS,PanelTitleVisibility:bT});};X=d.AppModelLib=_1.Class({get_Worker:function(){var bM;return this.$==1?s.CreateWithRunner(this.$0):this.$==2?s.CreateWithRunner(this.$0):this.$==3?s.CreateWithRenderer(this.$0):this.$==4?(bM=this.$0,s.Create(bM).WithRunner(bM).WithRenderer(bM)):this.$==5?s.CreateWithRenderer(this.$0):s.CreateWithRunner(this.$0);}},null,X);X.FromWorker=function(bM){var bN;bN=bM.DataContext;return bN instanceof u?{$:1,$0:new X({$:0,$0:(u.get_FromPorts())(bM)})}:bN instanceof x?{$:1,$0:new X({$:1,$0:(x.get_FromPorts())(bM)})}:bN instanceof z?{$:1,$0:new X({$:2,$0:(z.get_FromPorts())(bM)})}:bN instanceof C?{$:1,$0:new X({$:3,$0:(C.get_FromPorts())(bM)})}:bN instanceof B?{$:1,$0:new X({$:4,$0:(B.get_FromPorts())(bM)})}:bN instanceof D?{$:1,$0:new X({$:5,$0:(D.get_FromPorts())(bM)})}:null;};X.FromDataContext=function(bM){return bM instanceof u?{$:1,$0:new X({$:0,$0:bM})}:bM instanceof x?{$:1,$0:new X({$:1,$0:bM})}:bM instanceof z?{$:1,$0:new X({$:2,$0:bM})}:bM instanceof C?{$:1,$0:new X({$:3,$0:bM})}:bM instanceof B?{$:1,$0:new X({$:4,$0:bM})}:bM instanceof D?{$:1,$0:new X({$:5,$0:bM})}:null;};Y.CreateDashboard=function(){Z.$cctor();return Z.CreateDashboard;};Y.PanelContainerCreator=function(bM){return bG.get_Create().WithLayoutManager(bH.FloatingPanelLayoutManager(5)).WithWidth(800).WithHeight(420).WithAttributes([bB.Style("border","1px solid white")]);};Y.Register=function(bM){function bN(bQ,bR){var bS;{bS=X.FromDataContext(bR),bS==null?null:{$:1,$0:bQ(bS.$0.get_Worker())};return;}}function bO(bQ){var bR;bN((bR=bM.Factory,function(bS){bR.RegisterEvent(bS);}),bQ);}function bP(bQ){var bR;bN((bR=bM.Factory,function(bS){bR.RegisterWidget(bS);}),bQ);}bO(x.Create("London",""));bO(u.Create(50,5));bO(z.get_Create());bP(C.get_Create());bP(B.Create(300,100,50));bP(D.get_Create());};Z.$cctor=_1.Cctor(function(){var bM;Z.CreateDashboard=(bM=W.Create(function(){return Y.PanelContainerCreator();}),(Y.Register(bM),bM));Z.$cctor=a.ignore;});}());
