(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Community=b.Community||{};d=c.Dashboard=c.Dashboard||{};e=d.Environment=d.Environment||{};f=e.Role=e.Role||{};g=a.StartupCode$WebSharper_Community_Dashboard$Environment=a.StartupCode$WebSharper_Community_Dashboard$Environment||{};h=d.MessageBus=d.MessageBus||{};i=h.Value=h.Value||{};j=h.Message=h.Message||{};k=h.ListenerInfo=h.ListenerInfo||{};l=h.AgentMessage=h.AgentMessage||{};m=h.AgentState=h.AgentState||{};n=a.StartupCode$WebSharper_Community_Dashboard$MessageBus=a.StartupCode$WebSharper_Community_Dashboard$MessageBus||{};o=d.InPortData=d.InPortData||{};p=d.InPort=d.InPort||{};q=d.OutPort=d.OutPort||{};r=d.Ports=d.Ports||{};s=d.WorkerData=d.WorkerData||{};t=d.Worker=d.Worker||{};u=d.Workers=d.Workers||{};v=d.RandomRunner=d.RandomRunner||{};w=d.OpenWeather=d.OpenWeather||{};x=w.Forecast=w.Forecast||{};y=d.OpenWeatherRunner=d.OpenWeatherRunner||{};z=d.DatabaseRunnerContext=d.DatabaseRunnerContext||{};A=d.DatabaseRunner=d.DatabaseRunner||{};B=d.ChartRunnerContext=d.ChartRunnerContext||{};C=d.ChartRenderer=d.ChartRenderer||{};D=d.TextBoxRenderer=d.TextBoxRenderer||{};E=d.ButtonRenderer=d.ButtonRenderer||{};F=d.RuleEntry=d.RuleEntry||{};G=d.RuleChain=d.RuleChain||{};H=d.RuleContainer=d.RuleContainer||{};I=d.WorkerItem=d.WorkerItem||{};J=d.Factory=d.Factory||{};K=d.SelectorItem=d.SelectorItem||{};L=d.SelectorGroup=d.SelectorGroup||{};M=d.WindowSelector=d.WindowSelector||{};N=d.RulesCellItem=d.RulesCellItem||{};O=d.RulesRowItem=d.RulesRowItem||{};P=d.WidgetItem=d.WidgetItem||{};Q=d.EventsGroupItem=d.EventsGroupItem||{};R=d.WidgetsGroupItem=d.WidgetsGroupItem||{};S=d.RulesGroupItem=d.RulesGroupItem||{};T=d.DshData=d.DshData||{};U=d.EventsEditor=d.EventsEditor||{};V=d.RulesEditor=d.RulesEditor||{};W=d.DshHelper=d.DshHelper||{};X=d.Dashboard=d.Dashboard||{};Y=d.AppModelLib=d.AppModelLib||{};Z=d.App=d.App||{};_0=a.StartupCode$WebSharper_Community_Dashboard$AppModelLib=a.StartupCode$WebSharper_Community_Dashboard$AppModelLib||{};_1=d.AppDataHelper=d.AppDataHelper||{};_2=d.AppData=d.AppData||{};_3=a.IntelliFactory;_4=_3&&_3.Runtime;_5=b&&b.Operators;_6=c&&c.Panel;_7=_6&&_6.Helper;_8=a.Date;_9=b&&b.List;_=b&&b.Concurrency;$=b&&b.Remoting;ba=$&&$.AjaxRemotingProvider;bb=b&&b.Control;bc=bb&&bb.MailboxProcessor;bd=b&&b.Seq;be=b&&b.PrintfHelpers;bf=b&&b.UI;bg=bf&&bf.Next;bh=bg&&bg.View;bi=bg&&bg.Var;bj=c&&c.PropertyGrid;bk=bj&&bj.Properties;bl=b&&b.Guid;bm=b&&b.Unchecked;bn=bg&&bg.Doc;bo=b&&b.Random;bp=a.Math;bq=a.console;br=b&&b.Data;bs=br&&br.TxtRuntime;bt=a.FSharp;bu=bt&&bt.Data;bv=bu&&bu.Runtime;bw=bv&&bv.IO;bx=a.JSON;by=b&&b.Arrays;bz=b&&b.Charting;bA=bz&&bz.Renderers;bB=bA&&bA.ChartJs;bC=bz&&bz.Chart;bD=bz&&bz.Pervasives;bE=bg&&bg.AttrModule;bF=b&&b.Enumerator;bG=bg&&bg.Key;bH=bg&&bg.ListModel;bI=b&&b.Option;bJ=_6&&_6.PanelContainer;bK=_6&&_6.LayoutManagers;bL=_6&&_6.Panel;bM=_6&&_6.TitleButton;bN=_6&&_6.Dialog;bO=bj&&bj.PropertyGrid;f.Server={$:1};f.Client={$:0};e.DataDirectory=function(){g.$cctor();return g.DataDirectory;};e.set_DataDirectory=function(bP){g.$cctor();g.DataDirectory=bP;};e.Log=function(){g.$cctor();return g.Log;};e.set_Log=function(bP){g.$cctor();g.Log=bP;};e.Role$1=function(){g.$cctor();return g.Role;};e.set_Role=function(bP){g.$cctor();g.Role=bP;};g.$cctor=_4.Cctor(function(){g.Role=f.Server;g.Log=a.ignore;g.DataDirectory="";g.$cctor=a.ignore;});i=h.Value=_4.Class({get_AsBoolean:function(){return this.$==2?this.$0:_5.FailWith("MessageBus.Value: unexpected type");},get_AsString:function(){return this.$==1?this.$0:_5.FailWith("MessageBus.Value: unexpected type");},get_AsNumber:function(){return this.$==0?this.$0:_5.FailWith("MessageBus.Value: unexpected type");}},null,i);j=h.Message=_4.Class({WithTime:function(bP){return j.New(this.Key,bP,this.Value);},WithKey:function(bP){return j.New(bP,this.Time,this.Value);}},null,j);j.Create=function(bP){return j.New(_7.UniqueKey(),_8.now(),bP);};j.New=function(bP,bQ,bR){return new j({Key:bP,Time:bQ,Value:bR});};k.Create=function(bP,bQ,bR){return k.New(bP,bQ,bR);};k.New=function(bP,bQ,bR){return{Key:bP,Name:bQ,CacheSize:bR};};l.Clear={$:4};m.get_empty=function(){return m.New(null,_9.T.Empty);};m.New=function(bP,bQ){return{ServerCallback:bP,Listeners:bQ};};h.RunServerRequests=function(){var bP;_.Start((bP=null,_.Delay(function(){return _.While(function(){return true;},_.Delay(function(){return _.Bind(_.Sleep(2*1000),function(){return _.Bind(h.Agent().PostAndAsyncReply(function(bQ){return{$:6,$0:bQ};},null),function(bQ){return _.Bind((new ba.New()).Async("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.MessageBus.GetMessages:1550733476",[bQ]),function(bR){var bS;_9.iter(function(bT){var bU;bU=h.Agent();bU.mailbox.AddLast({$:1,$0:bT});bU.resume();},bR);return bR.get_Length()>0?(bS=(function(bT){return function(bU){return bT("Values from server requested messages received:"+a.String(bU));};}(a.id))(bR.get_Length()),(h.log())(bS),_.Zero()):_.Zero();});});});}));})),null);};h.Agent=function(){n.$cctor();return n.Agent;};h.StringMessage=function(bP){return h.StringKeyMessage(_7.UniqueKey(),bP);};h.NumberMessage=function(bP){return h.NumberKeyMessage(_7.UniqueKey(),bP);};h.BooleanKeyMesage=function(bP,bQ){return h.CreateMessage(bP,new i({$:2,$0:bQ}));};h.StringKeyMessage=function(bP,bQ){return h.CreateMessage(bP,new i({$:1,$0:bQ}));};h.NumberKeyMessage=function(bP,bQ){return h.CreateMessage(bP,new i({$:0,$0:bQ}));};h.CreateMessage=function(bP,bQ){return j.New(bP,_8.now(),bQ);};h.log=function(){n.$cctor();return n.log;};n.$cctor=_4.Cctor(function(){n.log=e.Log();n.Agent=bc.Start(function(bP){function bQ(bV,bW){return bd.fold(function(bX,bY){var bZ;return(bZ=bY.Time-bV,bZ/1000)>0.01?new _9.T({$:1,$0:bY,$1:bX}):bX;},_9.T.Empty,bW);}function bR(bV,bW){return bV<bW.get_Length()?(_9.splitAt(bV,bW))[0]:bW;}function bS(bV,bW,bX){return bV===1?_9.ofArray([bX]):bR(bV,new _9.T({$:1,$0:bX,$1:bW}));}function bT(bV,bW){function bX(bY,bZ,b0){var b1;b1=a.Array.prototype.slice.call(arguments);return bY.Key===bV.Key?(bZ(bV),[bY,bZ,bS(bY.CacheSize,b0,bV)]):b1;}return _9.map(function(bY){return bX(bY[0],bY[1],bY[2]);},bW);}function bU(bV){var bW;bW=null;return _.Delay(function(){return _.Bind(bP.Receive(null),function(bX){var bY,bZ,b0,b1,b2,b3;function b4(b6,b7,b8){return bQ(b0,b8);}function b5(b6,b7,b8){return b8.$==0?(new _8(0,0-1,0)).getTime():_9.maxBy(function(b9){return b9.Time;},b8).Time;}return bX.$==2?(bY=bX.$0[0],(bZ=(((_4.Curried3(function(b6,b7,b8){return b6("RegisterListener:"+be.toSafe(b7)+" "+be.toSafe(b8));}))(a.id))(bY.Name))(bY.Key),(h.log())(bZ),bU(m.New(bV.ServerCallback,new _9.T({$:1,$0:[bY,bX.$0[2],_9.T.Empty],$1:bV.Listeners}))))):bX.$==3?bU(m.New({$:1,$0:bX.$0},bV.Listeners)):bX.$==5?(b0=bX.$0[0],(bX.$0[1](bd.fold(function(b6,b7){return!_9.contains(b7,b6)?new _9.T({$:1,$0:b7,$1:b6}):b6;},_9.T.Empty,_9.concat(_9.map(function(b6){return b4(b6[0],b6[1],b6[2]);},bV.Listeners)))),bU(bV))):bX.$==6?(b1=_9.map(function(b6){return b5(b6[0],b6[1],b6[2]);},bV.Listeners),(bX.$0(b1.$==0?(new _8(0,0-1,0)).getTime():_9.max(b1)),bU(bV))):bX.$==1?bU(m.New(bV.ServerCallback,bT(bX.$0,bV.Listeners))):bX.$==0?(b2=bX.$0,(b3=bV.ServerCallback,b3==null?void 0:b3.$0(b2),bU(m.New(bV.ServerCallback,bT(b2,bV.Listeners))))):bU(m.get_empty());});});}return bU(m.get_empty());},null);n.$cctor=a.ignore;});o.Create=function(bP,bQ,bR){return o.New(bQ.Key,bP,bQ,bR);};o.New=function(bP,bQ,bR,bS){return{Key:bP,Name:bQ,Value:bR,CacheSize:bS};};p=d.InPort=_4.Class({Equals:function(bP){return bP instanceof p&&this.Data.Name===bP.Data.Name;},get_BooleanView:function(){return bh.Map(function(bP){return bP.Value.get_AsBoolean();},this.PortValue.v);},get_Boolean:function(){return this.PortValue.c.Value.get_AsBoolean();},get_StringView:function(){return bh.Map(function(bP){return bP.Value.get_AsString();},this.PortValue.v);},get_String:function(){return this.PortValue.c.Value.get_AsString();},get_NumberView:function(){return bh.Map(function(bP){return bP.Value.get_AsNumber();},this.PortValue.v);},get_Number:function(){return this.PortValue.c.Value.get_AsNumber();},Receive:function(bP){bi.Set(this.PortValue,bP);},get_Property:function(){var bP,bQ,bR,bS,bT;bP=this;bQ=this.PortValue.c.Value;return bQ.$==1?(bR=bi.Create$1(this.get_String()),(bh.Sink(function(bU){var bV;bi.Set(bP.PortValue,(bV=bP.PortValue.c,j.New(bV.Key,bV.Time,new i({$:1,$0:bU}))));},bR.v),bk.string(this.Data.Name,bR))):bQ.$==2?(bS=bi.Create$1(this.get_Boolean()),(bh.Sink(function(bU){var bV;bi.Set(bP.PortValue,(bV=bP.PortValue.c,j.New(bV.Key,bV.Time,new i({$:2,$0:bU}))));},bS.v),bk.check(this.Data.Name,bS))):(bT=bi.Create$1(this.get_Number()),(bh.Sink(function(bU){var bV;bi.Set(bP.PortValue,(bV=bP.PortValue.c,j.New(bV.Key,bV.Time,new i({$:0,$0:bU}))));},bT.v),bk["double"](this.Data.Name,bT)));},get_Key:function(){return this.Data.Key;},get_Name:function(){return this.Data.Name;},get_Clone:function(){var bP,bQ;return p.New((bP=this.Data,o.New((bQ=bl.NewGuid(),a.String(bQ)),bP.Name,bP.Value,bP.CacheSize)),bi.Create$1(this.PortValue.c));}},null,p);p.ToData=function(bP){var bQ;bQ=bP.Data;return o.New(bQ.Key,bQ.Name,bP.PortValue.c,bQ.CacheSize);};p.FromData=function(bP){return p.New(bP,bi.Create$1(bP.Value));};p.New=function(bP,bQ){return new p({Data:bP,PortValue:bQ});};q=d.OutPort=_4.Class({Equals:function(bP){return bP instanceof q&&this.Name===bP.Name;},Trigger:function(bP){var bQ;bQ=h.Agent();bQ.mailbox.AddLast({$:0,$0:h.CreateMessage(this.Key,bP)});bQ.resume();},get_Clone:function(){return q.New(_7.UniqueKey(),this.Name,this.Type);}},null,q);q.CreateString=function(bP,bQ){return q.Create(bP,bQ,h.StringMessage(""));};q.CreateNumber=function(bP,bQ){return q.Create(bP,bQ,h.NumberMessage(0));};q.Create=function(bP,bQ,bR){return q.New(bP,bQ,bR);};q.New=function(bP,bQ,bR){return new q({Key:bP,Name:bQ,Type:bR});};r.CreateOut=function(bP){function bQ(bR,bS){return q.Create(bS.Key,bR,bS);}return _9.map(function(bR){return bQ(bR[0],bR[1]);},bP);};s.CreateWithCache=function(bP,bQ,bR){return s.New(bP,_9.map(function(bS){return o.Create(bS[0],bS[1],bS[2]);},bQ),bR);};s.Create=function(bP,bQ,bR){function bS(bT,bU){return o.Create(bT,bU,1);}return s.New(bP,_9.map(function(bT){return bS(bT[0],bT[1]);},bQ),bR);};s.New=function(bP,bQ,bR){return{WorkerName:bP,InPorts:bQ,OutPorts:bR};};t=d.Worker=_4.Class({Equals:function(bP){return bP instanceof t&&bm.Equals(this.Name,bP.Name);},get_Properties:function(){return new _9.T({$:1,$0:bk.string("Name",this.Name),$1:_9.map(function(bP){return bP.get_Property();},this.InPorts)});},get_Render:function(){var bP;bP=this.Renderer;return bP==null?bn.Empty():(bP.$0.WebSharper_Community_Dashboard_IRenderer$get_Render())(this);},get_CloneAndRun:function(){var bP,bQ,bR;bP=bi.Create$1(this.Name.c);bQ=_9.map(function(bS){return bS.get_Clone();},this.InPorts);bR=_9.map(function(bS){return bS.get_Clone();},this.OutPorts);return t.New(_7.UniqueKey(),bP,bQ,bR,this.Runner,this.Renderer,this.DataContext,null).WithStartRunner();},get_ToData:function(){return s.New(this.Name.c,_9.map(p.ToData,this.InPorts),_9.map(function(bP){return[bP.Name,bP.Type];},this.OutPorts));},WithStartRunner:function(){var bP;bP=this.Runner;return bP==null?this:t.New(this.Key,this.Name,this.InPorts,this.OutPorts,this.Runner,this.Renderer,this.DataContext,(bP.$0.WebSharper_Community_Dashboard_IRunner$get_Run())(this));},WithRenderer:function(bP){return t.New(this.Key,this.Name,this.InPorts,this.OutPorts,this.Runner,{$:1,$0:bP},this.DataContext,this.RunnerContext);},WithRunner:function(bP){return t.New(this.Key,this.Name,this.InPorts,this.OutPorts,{$:1,$0:bP},this.Renderer,this.DataContext,this.RunnerContext);},WithKey:function(bP){return t.New(bP,this.Name,this.InPorts,this.OutPorts,this.Runner,this.Renderer,this.DataContext,this.RunnerContext);}},null,t);t.CreateWithRenderer=function(bP){return t.Create(bP).WithRenderer(bP);};t.CreateWithRunner=function(bP){return t.Create(bP).WithRunner(bP);};t.Create=function(bP){return t.New(_7.UniqueKey(),bi.Create$1(bP.WebSharper_Community_Dashboard_IWorkerContext$get_Data().WorkerName),_9.map(p.FromData,bP.WebSharper_Community_Dashboard_IWorkerContext$get_Data().InPorts),r.CreateOut(bP.WebSharper_Community_Dashboard_IWorkerContext$get_Data().OutPorts),null,null,bP,null);};t.New=function(bP,bQ,bR,bS,bT,bU,bV,bW){return new t({Key:bP,Name:bQ,InPorts:bR,OutPorts:bS,Runner:bT,Renderer:bU,DataContext:bV,RunnerContext:bW});};u.allInPorts=function(bP){return u.allPorts(bP,function(bQ){return bQ.InPorts;});};u.allOutPorts=function(bP){return u.allPorts(bP,function(bQ){return bQ.OutPorts;});};u.allPorts=function(bP,bQ){return _9.concat(_9.map(bQ,bP));};v=d.RandomRunner=_4.Class({WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bP){var bQ;new bo.New();_.Start((bQ=null,_.Delay(function(){return _.While(function(){return true;},_.Delay(function(){return _.Bind(_.Sleep(bP.InPorts.get_Item(2).get_Number()*1000<<0),function(){var bR,bS,bT;bR=bP.InPorts.get_Item(0).get_Number();bS=bP.InPorts.get_Item(1).get_Number();bT=bp.random()*bS+bR;bP.OutPorts.get_Item(0).Trigger(new i({$:0,$0:bT}));return _.Zero();});}));})),null);return null;};},WebSharper_Community_Dashboard_IWorkerContext$get_Data:function(){return this.RandomRunnerData;}},null,v);v.get_FromWorker=function(){return function(bP){return v.New(bP.get_ToData());};};v.get_Create=function(){return v.New(s.Create("Random",_9.ofArray([["Middle value",h.NumberMessage(100)],["Dispersion",h.NumberMessage(10)],["Delay sec.",h.NumberMessage(2)]]),_9.ofArray([["Random value",h.NumberMessage(0)]])));};v.New=function(bP){return new v({RandomRunnerData:bP});};x.New=function(bP,bQ,bR,bS,bT){return{Title:bP,Description:bQ,ImageUrl:bR,Temperature:bS,TemparatureMinMax:bT};};w.get=function(bP,bQ){var bR;bR=null;return _.Delay(function(){var bS;bS=(((_4.Curried3(function(bT,bU,bV){return bT("http://api.openweathermap.org/data/2.5/weather?q="+be.toSafe(bU)+"&units=metric&appid="+be.toSafe(bV));}))(a.id))(bQ))(bP);bq.log("get key city "+bS);return _.TryWith(_.Delay(function(){return _.Bind(bs.AsyncMap(bw.asyncReadTextAtRuntime(false,"C:\\AEAFrame\\WebSharper.Community.Dashboard\\WebSharper.Community.Dashboard","","JSON","",bS),function(bT){return bm.Equals(typeof bT,"string")?bx.parse(bT):bT;}),function(bT){var bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce;bq.log("get key city 2");return _.Return((bU=by.tryHead(bT.weather),bU==null?null:{$:1,$0:(bV=bU.$0,x.New((((_4.Curried3(function(cf,cg,ch){return cf(be.toSafe(cg)+", "+be.toSafe(ch));}))(a.id))((bX=(bW="name",bW in bT?{$:1,$0:bT[bW]}:null),bX==null?null:bX.$0)))((b0=(bY=bT.sys,(bZ="country",bZ in bY?{$:1,$0:bY[bZ]}:null)),b0==null?null:b0.$0)),(b2=(b1="main",b1 in bV?{$:1,$0:bV[b1]}:null),b2==null?null:b2.$0),(function(cf){return function(cg){return cf("http://openweathermap.org/img/w/"+be.toSafe(cg)+".png");};}(a.id))((b4=(b3="icon",b3 in bV?{$:1,$0:bV[b3]}:null),b4==null?null:b4.$0)),(b5=(b6=bT.main,(b7="temp",b7 in b6?{$:1,$0:b6[b7]}:null)),(b8=b5==null?null:{$:1,$0:1*b5.$0},b8==null?null:b8.$0)),[(b9=(b_=bT.main,(b$="temp_min",b$ in b_?{$:1,$0:b_[b$]}:null)),(ca=b9==null?null:{$:1,$0:1*b9.$0},ca==null?null:ca.$0)),(cb=(cc=bT.main,(cd="temp_max",cd in cc?{$:1,$0:cc[cd]}:null)),(ce=cb==null?null:{$:1,$0:1*cb.$0},ce==null?null:ce.$0))]))}));});}),function(bT){bq.log(bT.message);return _.Return(null);});});};y=d.OpenWeatherRunner=_4.Class({WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bP){var bQ;_.Start((bQ=null,_.Delay(function(){return _.While(function(){return true;},_.Delay(function(){var bR,bS,bT;bR=bP.InPorts.get_Item(0);bS=bP.InPorts.get_Item(1);bT=bP.OutPorts.get_Item(0);return _.Bind(w.get(bS.get_String(),bR.get_String()),function(bU){return _.Combine(bU==null?_.Zero():(bq.log("Value generated:"+bU.$0.Title),bT.Trigger(new i({$:0,$0:+bU.$0.Temperature})),_.Zero()),_.Delay(function(){return _.Bind(_.Sleep(1000*15),function(){return _.Return(null);});}));});}));})),null);return null;};},WebSharper_Community_Dashboard_IWorkerContext$get_Data:function(){return this.OpenWeatherRunnerData;}},null,y);y.get_FromWorker=function(){return function(bP){return y.New(bP.get_ToData());};};y.Create=function(bP,bQ){return y.New(s.Create("OpenWeatherMap",_9.ofArray([["City",h.StringMessage(bP)],["ApiKey",h.StringMessage(bQ)]]),_9.ofArray([["Temperature",h.NumberMessage(0)]])));};y.New=function(bP){return new y({OpenWeatherRunnerData:bP});};z.New=function(bP){return{DatabaseRunnerRun:bP};};A=d.DatabaseRunner=_4.Class({WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bP){var bQ;bQ=bP.InPorts.get_Item(1).get_String();_9.iter(function(bR){var bS;bS=h.Agent();bS.mailbox.AddLast({$:0,$0:bR});bS.resume();},(new ba.New()).Sync("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.ServerDatabase.ReadAllMessages:965639103",[bQ]));bh.Sink(function(bR){(new ba.New()).Send("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.ServerDatabase.WriteMessage:-353093100",[bQ,bR]);bP.OutPorts.get_Item(0).Trigger(bR.Value);},bP.InPorts.get_Item(0).PortValue.v);return null;};},WebSharper_Community_Dashboard_IWorkerContext$get_Data:function(){return this.DatabaseData;}},null,A);A.get_FromWorker=function(){return function(bP){return A.New(bP.get_ToData());};};A.get_Create=function(){return A.New(s.Create("Database",_9.ofArray([[" in Value",h.NumberMessage(100)],["Database name",h.StringMessage("Database.txt")]]),_9.ofArray([["Number value",h.NumberMessage(0)]])));};A.New=function(bP){return new A({DatabaseData:bP});};B.New=function(bP,bQ){return{LineChart:bP,Queue:bQ};};C=d.ChartRenderer=_4.Class({WebSharper_Community_Dashboard_IRenderer$get_Render:function(){return function(bP){var bQ,bR,bS,bT,bU,bV,bW,bX;bQ=bP.InPorts.get_Item(3).get_Number()<<0;bR=bP.RunnerContext.$0;bh.Sink(function(bY){bR.Queue.push(bY);bR.Queue.length>bQ?bR.Queue.shift():void 0;bd.iteri(function(bZ,b0){return bR.LineChart.__UpdateData(bZ,function(){return b0;});},bR.Queue);},bP.InPorts.get_Item(0).get_NumberView());return bB.Render$8(bP.RunnerContext.$0.LineChart,{$:1,$0:{$:0,$0:bP.InPorts.get_Item(1).get_Number()<<0,$1:bP.InPorts.get_Item(2).get_Number()<<0}},{$:1,$0:(bS={},bS.title=(bT={},bT.display=false,bT),bS.legend=(bU={},bU.display=false,bU),bS.elements=(bV={},bV.point=(bW={},bW.radius=0,bW),bV.line=(bX={},bX.borderWidth=1,bX),bV),bS)},null);};},WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bP){var bQ,bR,bS,bT;bQ=bP.InPorts.get_Item(3).get_Number()<<0;bR=_9.ofSeq(bd.delay(function(){return bd.map(function(){return 0;},_5.range(0,bQ-1));}));bS=(bT=[],(bd.iter(function(bU){bT.push(bU);},bR),bT));return{$:1,$0:B.New(bC.Line(bR).WithFill(false).__WithStrokeColor(new bD.Color({$:1,$0:"#FB8C00"})).__WithPointColor(new bD.Color({$:2,$0:"black"})),bS)};};},WebSharper_Community_Dashboard_IWorkerContext$get_Data:function(){return this.ChartRendererData;}},null,C);C.get_FromWorker=function(){return function(bP){return C.New(bP.get_ToData());};};C.Create=function(bP,bQ,bR){return C.New(s.CreateWithCache("Chart",_9.ofArray([[" in Value",h.NumberMessage(100),bR<<0],["cx",h.NumberMessage(bP),1],["cy",h.NumberMessage(bQ),1],["BufferSize",h.NumberMessage(bR),1]]),_9.T.Empty));};C.New=function(bP){return new C({ChartRendererData:bP});};D=d.TextBoxRenderer=_4.Class({WebSharper_Community_Dashboard_IRenderer$get_Render:function(){return function(bP){var bQ;bQ=bh.Map(function(bR){var bS;bS=bR<<0;return a.String(bS);},bP.InPorts.get_Item(0).get_NumberView());return bn.Element("div",[bE.Class("bigvalue")],[bn.TextView(bQ)]);};},WebSharper_Community_Dashboard_IWorkerContext$get_Data:function(){return this.TextBoxRendererData;}},null,D);D.get_FromWorker=function(){return function(bP){return D.New(bP.get_ToData());};};D.get_Create=function(){return D.New(s.Create("Text",_9.ofArray([["in Value",h.NumberMessage(0)]]),_9.T.Empty));};D.New=function(bP){return new D({TextBoxRendererData:bP});};E=d.ButtonRenderer=_4.Class({WebSharper_Community_Dashboard_IRenderer$get_Render:function(){return function(bP){return bn.ButtonView(bP.InPorts.get_Item(0).get_String(),[],bP.InPorts.get_Item(1).get_BooleanView(),function(bQ){bP.OutPorts.get_Item(0).Trigger(new i({$:2,$0:bQ}));});};},WebSharper_Community_Dashboard_IWorkerContext$get_Data:function(){return this.ButtonRendererData;}},null,E);E.get_FromWorker=function(){return function(bP){return E.New(bP.get_ToData());};};E.get_Create=function(){return E.New(s.Create("Button",_9.ofArray([["Caption",h.StringMessage("Button")],["State",h.NumberMessage(0)]]),_9.ofArray([["Button value",h.NumberMessage(0)]])));};E.New=function(bP){return new E({ButtonRendererData:bP});};F.New=function(bP,bQ,bR){return{InPortKey:bP,OutPortKey:bQ,WorkerKey:bR};};G.New=function(bP){return{RuleChain:bP};};H=d.RuleContainer=_4.Class({Reconnect:function(bP){var bQ,bR,bS,bT;bQ=e.Log();bR=u.allOutPorts(bP);bS=u.allInPorts(bP);_9.iter(function(bU){(e.Log())((((_4.Curried3(function(bV,bW,bX){return bV(be.toSafe(bW)+" "+be.toSafe(bX));}))(a.id))(bU.get_Name()))(bU.Data.Key));},bS);bT=h.Agent();bT.mailbox.AddLast(l.Clear);bT.resume();_9.iter(function(bU){var bV,bW,bX;bV=_9.ofSeq(bU.RuleChain);bW=_9.ofSeq(_5.range(1,bV.get_Length()-1));bX=bF.Get(bW);try{while(bX.MoveNext())(function(){var bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7;bY=bX.Current();bZ=bV.get_Item(bY-1);b0=bV.get_Item(bY);{b1=bd.tryFind(function(b8){return b8.Key===bZ.OutPortKey;},bR),b1==null?null:{$:1,$0:(b2=b1.$0,(bQ((((_4.Curried3(function(b8,b9,b_){return b8("Found outPort "+be.toSafe(b9)+" try to find inPort:"+be.toSafe(b_));}))(a.id))(bZ.OutPortKey))(b0.InPortKey)),b3=bd.tryFind(function(b8){return b8.Data.Key===b0.InPortKey;},bS),b3==null?null:{$:1,$0:(b4=b3.$0,(bQ("Found inPort"),b4.PortValue.c.Key!==b4.Data.Key?bi.Set(b4.PortValue,b4.PortValue.c.WithKey(b4.Data.Key)):void 0,b5=(b6=b4.PortValue.c.Value,b6.$==1?j.Create(new i({$:1,$0:""})):b6.$==2?j.Create(new i({$:2,$0:false})):j.Create(new i({$:0,$0:0}))),b7=h.Agent(),b7.mailbox.AddLast({$:2,$0:[k.Create(b2.Key,b2.Name+"->"+b4.get_Name(),b4.Data.CacheSize),b5,function(b8){b4.Receive(b8);}]}),b7.resume()))}))};return;}}());}finally{if("Dispose"in bX)bX.Dispose();}},_9.ofSeq(this.RuleContainer));}},null,H);H.New=function(bP){return new H({RuleContainer:bP});};I.Create=function(bP){return I.New(bG.Fresh(),bP);};I.New=function(bP,bQ){return{Key:bP,Worker:bQ};};J=d.Factory=_4.Class({RegisterEvent:function(bP){this.EventItems.Append(I.Create(bP));},RegisterWidget:function(bP){this.WidgetItems.Append(I.Create(bP));}},null,J);J.get_Create=function(){return J.New(bH.Create(function(bP){return bP.Key;},_9.T.Empty),bH.Create(function(bP){return bP.Key;},_9.T.Empty));};J.New=function(bP,bQ){return new J({EventItems:bP,WidgetItems:bQ});};K.Create=function(bP,bQ){return K.New(bG.Fresh(),bP,bQ);};K.New=function(bP,bQ,bR){return{Key:bP,Name:bQ,SelectorRenderer:bR};};L=d.SelectorGroup=_4.Class({RenderMenu:function(bP,bQ){var bR,bS,bT,bU;bR=this;bS=(bT=this.ChildCreatator,bT==null?bn.Element("tr",[],[]):(bU=bT.$0,bn.Element("tr",[],[bn.Element("td",[],[bn.Element("div",[bE.Style("margin-left","20px")],[_7.IconSmall("add",function(){var bV,bW;bV=bU();bW=K.Create(bV[0],bV[1]);bR.ItemOnCreated(bW);bR.SelectorItems.Append(bW);})])])])));return bn.Element("table",[],[bn.ConvertBy(function(bV){return bV.Key;},function(bV){var bW;bW=bh.Map(function(bX){return bP+bX;},bV.Name.v);return bn.Element("tr",[],[bn.Element("td",[bE.DynamicStyle("Color",bh.Map(function(bX){return bX==null?"#7D4600":bm.Equals(bX.$0.Key,bV.Key)?"#FB8C00":"#7D4600";},bQ.v)),bE.Style("cursor","pointer"),bE.Handler("click",function(){return function(){bR.ItemOnSelected(bV);return bi.Set(bQ,{$:1,$0:bV});};})],[bn.Element("div",[bE.Style("margin-left","10px"),bE.Style("margin-right","5px")],[bn.TextView(bW)])])]);},this.SelectorItems.v),bS]);},ItemByIndex:function(bP){return _9.head(_9.ofSeq(this.SelectorItems));}},null,L);L.Create=function(bP,bQ,bR,bS,bT){var bU;bU=bH.Create(function(bV){return bV.Key;},_9.map(function(bV){return K.Create(bV[0],bV[1]);},bQ));return L.New(bG.Fresh(),bi.Create$1(bP),bU,bR,bS,bT);};L.New=function(bP,bQ,bR,bS,bT,bU){return new L({Key:bP,Name:bQ,SelectorItems:bR,ChildCreatator:bS,ItemOnCreated:bT,ItemOnSelected:bU});};M=d.WindowSelector=_4.Class({get_RenderMenu:function(){var bP;bP=this;return this.SelectorGroups.get_Length()===1?_9.head(_9.ofSeq(this.SelectorGroups)).RenderMenu("",this.OptSelectedItem):bn.Element("div",[],[bn.ConvertBy(function(bQ){return bQ.Key;},function(bQ){return bn.Element("div",[],[bn.Element("div",[bE.Style("cursor","pointer"),bE.Handler("click",function(){return function(){return bP.GroupOnClick(bQ);};})],[bn.TextView(bQ.Name.v)]),bQ.RenderMenu("    ",bP.OptSelectedItem)]);},this.SelectorGroups.v)]);},get_Render:function(){return bn.Element("div",[],[bn.BindView(function(bP){return bP==null?bn.Empty():bP.$0.SelectorRenderer;},this.OptSelectedItem.v)]);},GroupByIndex:function(bP){return bd.nth(bP,_9.ofSeq(this.SelectorGroups));},get_SelectedIndex:function(){var bP;bP=this;return bd.findIndex(function(bQ){return bm.Equals(bQ.Key,bP.get_SelectedItem().Key);},_9.concat(_9.map(function(bQ){return _9.ofSeq(bQ.SelectorItems);},_9.ofSeq(this.SelectorGroups))));},get_SelectedIndexInGroup:function(){var bP;bP=this;return bd.findIndex(function(bQ){return bm.Equals(bQ.Key,bP.get_SelectedItem().Key);},_9.ofSeq(this.get_SelectedGroup().SelectorItems));},get_SelectedGroupIndex:function(){var bP;bP=this;return bd.findIndex(function(bQ){return bm.Equals(bQ.Key,bP.get_SelectedGroup().Key);},_9.ofSeq(this.SelectorGroups));},get_SelectedGroup:function(){return this.GroupFromItem(this.get_SelectedItem());},GroupFromItem:function(bP){return bd.find(function(bQ){return _9.exists(function(bR){return bm.Equals(bR.Key,bP.Key);},_9.ofSeq(bQ.SelectorItems));},_9.ofSeq(this.SelectorGroups));},AppenGroup:function(bP,bQ,bR){this.SelectorGroups.Append(L.Create(bP,bQ,bR,this.ItemOnCreated(this.SelectorGroups.get_Length()),this.ItemOnSelected));},get_SelectedItem:function(){var bP;bP=this.OptSelectedItem.c;return bP==null?_5.FailWith("Something really wrong with WindowSelector"):bP.$0;},ClearGroups:function(){bi.Set(this.OptSelectedItem,null);_9.iter(function(bP){bP.SelectorItems.Clear();},_9.ofSeq(this.SelectorGroups));},WithItemOnSelected:function(bP){return M.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,bP);},WithGroupOnClick:function(bP){return M.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,bP,this.ItemOnSelected);},WithItemOnCreated:function(bP){return M.New(this.OptSelectedItem,this.SelectorGroups,bP,this.GroupOnClick,this.ItemOnSelected);}},null,M);M.get_Create=function(){var bP;bP=bH.Create(function(bQ){return bQ.Key;},_9.T.Empty);return M.New(bi.Create$1(null),bP,function(){return function(){return null;};},a.ignore,a.ignore);};M.New=function(bP,bQ,bR,bS,bT){return new M({OptSelectedItem:bP,SelectorGroups:bQ,ItemOnCreated:bR,GroupOnClick:bS,ItemOnSelected:bT});};N=d.RulesCellItem=_4.Class({Render:function(bP,bQ){var bR,bS,bT,bU,bV;bR=this;bh.Sink(function(bW){var bX;if(bW==null);else{bX=bW.$0;bq.log("Workitem selected");bi.Set(bR.OptInPort,_9.tryHead(bX.Worker.InPorts));bi.Set(bR.OptOutPort,_9.tryHead(bX.Worker.OutPorts));bQ();}},this.OptWorker.v);bh.Sink(function(){bQ();},this.OptInPort.v);bh.Sink(function(){bQ();},this.OptOutPort.v);bS=(bT=bh.Map(function(bW){var bX;return bW==null?_9.ofArray([null]):(bX=_9.map(function(bY){return{$:1,$0:bY};},bW.$0.Worker.InPorts),bX.get_Length()>0?bX:_9.ofArray([null]));},this.OptWorker.v),(bU=bh.Map(function(bW){var bX;return bW==null?_9.ofArray([null]):(bX=_9.map(function(bY){return{$:1,$0:bY};},bW.$0.Worker.OutPorts),bX.get_Length()>0?bX:_9.ofArray([null]));},this.OptWorker.v),(bV=bh.Map(function(bW){return new _9.T({$:1,$0:null,$1:_9.map(function(bX){return{$:1,$0:bX};},_9.ofSeq(bW))});},bP.v),bn.Element("table",[],[bn.Element("tr",[],[bn.Element("td",[],[bn.SelectDyn([bE.Class("form-control")],function(bW){return bI.fold(function(bX,bY){return bY.get_Name();}," ",bW);},bT,this.OptInPort)]),bn.Element("td",[],[bn.SelectDyn([bE.Class("form-control")],function(bW){return bI.fold(function(bX,bY){return bY.Worker.Name.c;}," ",bW);},bV,this.OptWorker)]),bn.Element("td",[],[bn.SelectDyn([bE.Class("form-control")],function(bW){return bI.fold(function(bX,bY){return bY.Name;}," ",bW);},bU,this.OptOutPort)])])]))));return bn.Element("td",[bE.Class("td DshEditorCell")],[bn.Element("div",[bE.Class("div DshEditorCell")],[bn.Element("table",[],[bn.Element("tr",[],[bn.Element("td",[],[bS])])])])]);}},null,N);N.get_Create=function(){return N.New(bG.Fresh(),bi.Create$1(null),bi.Create$1(null),bi.Create$1(null));};N.New=function(bP,bQ,bR,bS){return new N({Key:bP,OptInPort:bQ,OptWorker:bR,OptOutPort:bS});};O=d.RulesRowItem=_4.Class({Render:function(bP,bQ){var bR;bR=this;return bn.Element("tr",[],[bn.ConvertBy(function(bS){return bS.Key;},function(bS){return bS.Render(bP,bQ);},this.CellItems.v),_7.IconNormal("add",function(){bR.CellItems.Append(N.get_Create());})]);}},null,O);O.Create=function(bP){return O.New(bG.Fresh(),bH.Create(function(bQ){return bQ.Key;},bP));};O.New=function(bP,bQ){return new O({Key:bP,CellItems:bQ});};P.Create=function(bP,bQ){return P.New(bG.Fresh(),bP,bQ);};P.New=function(bP,bQ,bR){return{Key:bP,Panel:bQ,Widget:bR};};Q.Create=function(bP){return Q.New(bG.Fresh(),bi.Create$1(bP),bH.Create(function(bQ){return bQ.Key;},_9.T.Empty));};Q.New=function(bP,bQ,bR){return{Key:bP,Name:bQ,EventItems:bR};};R.Create=function(bP,bQ){return R.New(bG.Fresh(),bi.Create$1(bP),bH.Create(function(bR){return bR.Key;},_9.T.Empty),bQ);};R.New=function(bP,bQ,bR,bS){return{Key:bP,Name:bQ,WidgetItems:bR,PanelContainer:bS};};S.Create=function(bP){return S.New(bG.Fresh(),bi.Create$1(bP),bH.Create(function(bQ){return bQ.Key;},_9.T.Empty));};S.New=function(bP,bQ,bR){return{Key:bP,Name:bQ,RulesRowItems:bR};};T=d.DshData=_4.Class({RegisterWidget:function(bP,bQ,bR,bS){var bT;bT=bS.WithKey(bP);bQ.WidgetItems.Append(P.Create(bR,bT));this.WorkItems.Append(I.Create(bT));},RegisterEvent:function(bP,bQ,bR){var bS;bS=I.Create(bR.WithKey(bP));bQ.EventItems.Append(bS);this.WorkItems.Append(bS);},get_Clear:function(){this.WorkItems.Clear();this.WidgetGroups.Clear();this.EventGroups.Clear();this.RulesGroups.Clear();}},null,T);T.get_Create=function(){return T.New(bH.Create(function(bP){return bP.Key;},_9.T.Empty),bH.Create(function(bP){return bP.Key;},_9.T.Empty),bH.Create(function(bP){return bP.Key;},_9.T.Empty),bH.Create(function(bP){return bP.Key;},_9.T.Empty));};T.New=function(bP,bQ,bR,bS){return new T({WorkItems:bP,WidgetGroups:bQ,EventGroups:bR,RulesGroups:bS});};U.Render=function(bP,bQ){return bn.Element("table",[],[bn.ConvertBy(function(bR){return bR.Key;},function(bR){return bn.Element("tr",[],[bn.Element("i",_7.AttrsClick(function(){bQ.Edit(bR.Worker.get_Properties());}),[bn.TextView(bR.Worker.Name.v)])]);},bP.v)]);};V.Render=function(bP,bQ){function bR(){var bS;bS=_9.map(function(bT){return bT.Worker;},_9.ofSeq(bP.WorkItems));V.CopyToRules(bQ).Reconnect(bS);}return bn.Element("table",[],[bn.ConvertBy(function(bS){return bS.Key;},function(bS){return bn.Element("tr",[],[bS.Render(bP.WorkItems,function(){bR();})]);},bQ.v)]);};V.Restore=function(bP,bQ,bR){var bS,bT,bU;bQ.Clear();bS=_9.map(function(bV){return bV.Worker;},_9.ofSeq(bP.WorkItems));bT=u.allOutPorts(bS);bU=u.allInPorts(bS);_9.iter(function(bV){var bW;bW=O.Create([]);_9.iter(function(bX){var bY;bY=N.get_Create();bi.Set(bY.OptWorker,bd.tryFind(function(bZ){return bZ.Worker.Key===bX.WorkerKey;},_9.ofSeq(bP.WorkItems)));bi.Set(bY.OptInPort,bd.tryFind(function(bZ){return bZ.get_Key()===bX.InPortKey;},bU));bi.Set(bY.OptOutPort,bd.tryFind(function(bZ){return bZ.Key===bX.OutPortKey;},bT));bW.CellItems.Append(bY);},bV.RuleChain);bQ.Append(bW);},bR.RuleContainer);bR.Reconnect(bS);};V.CopyToRules=function(bP){return H.New(_9.map(function(bQ){return G.New(_9.map(function(bR){var bS,bT,bU;return F.New((bS=bR.OptInPort.c,bS==null?"":bS.$0.get_Key()),(bT=bR.OptOutPort.c,bT==null?"":bT.$0.Key),(bU=bR.OptWorker.c,bU==null?"":bU.$0.Worker.Key));},_9.ofSeq(bQ.CellItems)));},_9.ofSeq(bP)));};W.RulesGroupCreator=function(bP,bQ){var bR;bR=S.Create("rules"+a.String(_9.length(_9.ofSeq(bP.RulesGroups))+1));bP.RulesGroups.Append(bR);return[bR.Name,V.Render(bP,bR.RulesRowItems)];};W.EventsGroupCreator=function(bP,bQ,bR){var bS;bS=Q.Create("event"+a.String(_9.length(_9.ofSeq(bP.EventGroups))+1));bP.EventGroups.Append(bS);return[bS.Name,U.Render(bS.EventItems,bQ)];};W.PanelGroupCreator=function(bP,bQ,bR){var bS,bT,bU;bS=_9.length(_9.ofSeq(bP.WidgetGroups))+1;bT=bQ();bU=R.Create("panel"+a.String(bS),bT);bP.WidgetGroups.Append(bU);return[bU.Name,bT.get_Render()];};X=d.Dashboard=_4.Class({Render:function(bP){var bQ;bQ=this;return bn.EmbedView(bh.Map(function(bR){return bR.$==1?bn.Element("div",[],[bn.Element("table",[],[bn.Element("tr",[],[bn.Element("td",[bE.Style("vertical-align","top")],[bn.Element("table",[],bd.concat([_9.ofArray([bn.Element("tr",[],[bn.Element("td",[],[_7.IconNormal("dehaze",function(){bi.Set(bQ.PanelTitleVisibility,false);bi.Set(bQ.Mode,{$:0});})])])]),_9.ofArray([bQ.EditorSelectorEdit.get_RenderMenu()]),_9.ofArray([bn.Element("tr",[],[bn.Element("td",[],[])]),bn.Element("tr",[],[bn.Element("td",[],[bQ.PropertyGrid.get_Render()])])])]))]),bn.Element("td",[bE.Style("vertical-align","top")],[bP,_7.IconNormal("add",function(){var bS,bT,bU,bV,bW;bS=bQ.EditorSelectorEdit.get_SelectedGroupIndex();bS===1?(bT=_9.ofSeq(bQ.Factory.EventItems),bU=bi.Create$1(_9.head(bT)),bQ.Dialog.ShowDialog("Select source",bn.Element("div",[],[bn.Select([bE.Class("form-control")],function(bX){return bX.Worker.Name.c;},bT,bU)]),function(){var bX,bY,bZ;bX=bU.c.Worker.get_CloneAndRun();bY=(bZ=_9.ofSeq(bQ.Data.EventGroups),bd.nth(bQ.EditorSelectorEdit.get_SelectedIndexInGroup(),bZ));bQ.Data.RegisterEvent(_7.UniqueKey(),bY,bX);})):bS===0?bQ.CreatePanel((bV=_9.ofSeq(bQ.Data.WidgetGroups),bd.nth(bQ.EditorSelectorEdit.get_SelectedIndexInGroup(),bV)),"Panel",700,null):bS===2?(bW=_9.ofSeq(bQ.Data.RulesGroups),bd.nth(bQ.EditorSelectorEdit.get_SelectedIndexInGroup(),bW)).RulesRowItems.Append(O.Create([N.get_Create(),N.get_Create()])):void 0;}),bQ.EditorSelectorEdit.get_Render()])])]),bn.Element("div",[],[bQ.Dialog.get_Render()])]):bn.Element("div",[],[bn.Element("table",[],[bn.Element("tr",[],[bn.Element("td",[bE.Style("vertical-align","top")],[_7.IconNormal("dehaze",function(){bi.Set(bQ.PanelTitleVisibility,true);bi.Set(bQ.Mode,{$:1});}),bQ.EditorSelectorRun.GroupByIndex(0).SelectorItems.get_Length()>1?bQ.EditorSelectorRun.get_RenderMenu():bn.Element("div",[],[])]),bn.Element("td",[],[bQ.EditorSelectorRun.get_Render()])])])]);},this.Mode.v));},Restore:function(bP,bQ,bR,bS){var bT,bU,bV,bW,bX;bT=this;this.EditorSelectorRun.ClearGroups();this.EditorSelectorEdit.ClearGroups();this.Data.get_Clear();bU=this.EditorSelectorRun.GroupByIndex(0);bV=this.EditorSelectorEdit.GroupByIndex(0);bW=this.EditorSelectorEdit.GroupByIndex(1);bX=this.EditorSelectorEdit.GroupByIndex(2);_9.iteri(function(bY,bZ){var b0,b1,b2,b3;function b4(b5,b6,b7){bT.RegisterWidget(b5,b3,b6,bd.find(function(b8){return b8.Key===b6;},_9.ofSeq(b3.PanelContainer.PanelItems)).Children,b7.WithStartRunner());}b0=W.PanelGroupCreator(bT.Data,bP,null);b1=b0[1];b2=b0[0];bi.Set(b2,bZ[0]);bV.SelectorItems.Append(K.Create(b2,b1));bU.SelectorItems.Append(K.Create(b2,b1));b3=bd.nth(bY,_9.ofSeq(bT.Data.WidgetGroups));_9.iter(function(b5){var b6;b6=bT.CreatePanel(b3,"Panel",700,{$:1,$0:b5.Key});bi.Set(b6.Left,b5.Left);bi.Set(b6.Top,b5.Top);},bZ[1]);return _9.iter(function(b5){return b4(b5[0],b5[1],b5[2]);},bZ[2]);},bR);bq.log("Widgets restored");_9.iteri(function(bY,bZ){var b0,b1,b2;function b3(b4,b5){bT.Data.RegisterEvent(b4,b2,b5);}b0=W.EventsGroupCreator(bT.Data,bT.PropertyGrid,null);b1=b0[0];bi.Set(b1,bZ[0]);bW.SelectorItems.Append(K.Create(b1,b0[1]));b2=bd.nth(bY,_9.ofSeq(bT.Data.EventGroups));return _9.iter(function(b4){return b3(b4[0],b4[1]);},bZ[1]);},bQ);bq.log("Events restored");_9.iteri(function(bY,bZ){var b0,b1;b0=W.RulesGroupCreator(bT.Data,null);b1=b0[0];bi.Set(b1,bZ[0]);bX.SelectorItems.Append(K.Create(b1,b0[1]));return V.Restore(bT.Data,bd.nth(bY,_9.ofSeq(bT.Data.RulesGroups)).RulesRowItems,bZ[1]);},bS);this.Data.WidgetGroups.get_Length()>0?(bi.Set(this.EditorSelectorEdit.OptSelectedItem,{$:1,$0:_9.head(_9.ofSeq(this.EditorSelectorEdit.GroupByIndex(0).SelectorItems))}),bi.Set(this.EditorSelectorRun.OptSelectedItem,{$:1,$0:_9.head(_9.ofSeq(this.EditorSelectorRun.GroupByIndex(0).SelectorItems))})):(bi.Set(this.EditorSelectorEdit.OptSelectedItem,null),bi.Set(this.EditorSelectorRun.OptSelectedItem,null));bq.log("Connectors restored");},Store:function(bP){return[_9.map(function(bQ){return[bQ.Name.c,_9.map(function(bR){return[bR.Worker.Key,bP(bR.Worker)];},_9.ofSeq(bQ.EventItems))];},_9.ofSeq(this.Data.EventGroups)),_9.map(function(bQ){return[bQ.Name.c,_9.map(function(bR){return bR.get_PanelData();},_9.ofSeq(bQ.PanelContainer.PanelItems)),_9.map(function(bR){return[bR.Widget.Key,bR.Panel,bP(bR.Widget)];},_9.ofSeq(bQ.WidgetItems))];},_9.ofSeq(this.Data.WidgetGroups)),_9.map(function(bQ){return[bQ.Name.c,V.CopyToRules(bQ.RulesRowItems)];},_9.ofSeq(this.Data.RulesGroups))];},CreatePanel:function(bP,bQ,bR,bS){var bT,bU,bV,bW,bX,bY;bT=this;bn.ConvertBy(bP.WidgetItems.key,function(bZ){return bn.Element("div",[],[bn.TextView(bZ.Widget.Name.v)]);},bP.WidgetItems.v);bU=(bV=(bW=bl.NewGuid(),a.String(bW)),bS==null?bV:bS.$0);bX=bJ.get_Create().WithLayoutManager(bK.StackPanelLayoutManager()).WithAttributes([bE.Style("border","1px solid white"),bE.Style("display","flex")]);bY=bL.get_Create().WithKey(bU).WithPannelAttrs([bE.Style("Width",a.String(bR)+"px"),bE.Style("position","absolute")]).WithTitle(this.PanelTitleVisibility).WithTitleContent(bn.TextNode(bQ)).WithTitleButtons(_9.ofArray([bM.New("add",function(bZ){var b0,b1;b0=_9.ofSeq(bT.Factory.WidgetItems);b1=bi.Create$1(_9.head(b0));bT.Dialog.ShowDialog("Select widget",bn.Element("div",[],[bn.Select([bE.Class("form-control")],function(b2){return b2.Worker.Name.c;},b0,b1)]),function(){bq.log("Dialog.IsOK");bT.RegisterWidget(_7.UniqueKey(),bP,bZ.Key,bZ.Children,b1.c.Worker.get_CloneAndRun());});}),bM.New("edit",function(bZ){bq.log("Edit");bT.PropertyGrid.Edit(_9.concat(_9.map(function(b0){return b0.Widget.get_Properties();},_9.filter(function(b0){return b0.Panel===bZ.Key;},_9.ofSeq(bP.WidgetItems)))));}),bM.New("clear",function(bZ){bP.PanelContainer.PanelItems.Remove(bP.PanelContainer.FindPanelItem(bZ));})])).WithChildPanelContainer(bX);bP.PanelContainer.AddPanel(bY);return bY;},RegisterWidget:function(bP,bQ,bR,bS,bT){var bU;this.Data.RegisterWidget(bP,bQ,bR,bT);bU=bL.get_Create().WithPanelContent(bT.get_Render());bi.Set(bU.IsWithTitle,false);bS.AddPanel(bU);}},null,X);X.Create=function(bP){var bQ,bR,bS,bT,bU,bV;function bW(){return W.PanelGroupCreator(bR,bP,void 0);}function bX(){return W.EventsGroupCreator(bR,bS,void 0);}function bY(){return W.RulesGroupCreator(bR,void 0);}bQ=bN.get_Create();bR=T.get_Create();bS=bO.get_Create();bT=M.get_Create();bU=M.get_Create().WithGroupOnClick(function(bZ){bS.Edit(_9.mapi(function(b0,b1){var b2;return bk.string((b2=b0+1,a.String(b2)),b1.Name);},_9.ofSeq(bZ.SelectorItems)));}).WithItemOnSelected(function(){bS.Edit(_9.T.Empty);}).WithItemOnCreated(function(bZ){return function(b0){return bZ===0?_9.head(_9.ofSeq(bT.SelectorGroups)).SelectorItems.Append(b0):null;};});bV=bW();bU.AppenGroup("Panels",_9.ofArray([bV]),{$:1,$0:bW});bT.AppenGroup("Panels",_9.ofArray([bV]),null);bU.AppenGroup("Events",_9.ofArray([bX()]),{$:1,$0:bX});bU.AppenGroup("Rules",_9.ofArray([bY()]),{$:1,$0:bY});bi.Set(bU.OptSelectedItem,{$:1,$0:_9.head(_9.ofSeq(bU.GroupByIndex(0).SelectorItems))});bi.Set(bT.OptSelectedItem,{$:1,$0:_9.head(_9.ofSeq(bT.GroupByIndex(0).SelectorItems))});return X.New(J.get_Create(),bR,bS,bQ,bT,bU,bi.Create$1({$:0}),bi.Create$1(false));};X.New=function(bP,bQ,bR,bS,bT,bU,bV,bW){return new X({Factory:bP,Data:bQ,PropertyGrid:bR,Dialog:bS,EditorSelectorRun:bT,EditorSelectorEdit:bU,Mode:bV,PanelTitleVisibility:bW});};Y.FromWorker=function(bP){var bQ;bQ=bP.DataContext;return bQ instanceof v?{$:1,$0:{$:0,$0:(v.get_FromWorker())(bP)}}:bQ instanceof y?{$:1,$0:{$:1,$0:(y.get_FromWorker())(bP)}}:bQ instanceof A?{$:1,$0:{$:2,$0:(A.get_FromWorker())(bP)}}:bQ instanceof D?{$:1,$0:{$:3,$0:(D.get_FromWorker())(bP)}}:bQ instanceof C?{$:1,$0:{$:4,$0:(C.get_FromWorker())(bP)}}:bQ instanceof E?{$:1,$0:{$:5,$0:(E.get_FromWorker())(bP)}}:null;};Y.ToWorker=function(bP){var bQ;return bP.$==1?t.CreateWithRunner(bP.$0):bP.$==2?t.CreateWithRunner(bP.$0):bP.$==3?t.CreateWithRenderer(bP.$0):bP.$==4?(bQ=bP.$0,t.Create(bQ).WithRunner(bQ).WithRenderer(bQ)):bP.$==5?t.CreateWithRenderer(bP.$0):t.CreateWithRunner(bP.$0);};Z.CreateDashboard=function(){_0.$cctor();return _0.CreateDashboard;};Z.PanelContainerCreator=function(bP){return bJ.get_Create().WithLayoutManager(bK.FloatingPanelLayoutManager(5)).WithWidth(800).WithHeight(420).WithAttributes([bE.Style("border","1px solid white")]);};Z.Register=function(bP){function bQ(bT,bU){bT(t.Create(bU));}function bR(bT){var bU;bQ((bU=bP.Factory,function(bV){bU.RegisterEvent(bV);}),bT);}function bS(bT){var bU;bQ((bU=bP.Factory,function(bV){bU.RegisterWidget(bV);}),bT);}bR(y.Create("London",""));bR(v.get_Create());bR(A.get_Create());bS(D.get_Create());bS(C.Create(300,100,50));bS(E.get_Create());};_0.$cctor=_4.Cctor(function(){var bP;_0.CreateDashboard=(bP=X.Create(function(){return Z.PanelContainerCreator();}),(Z.Register(bP),bP));_0.$cctor=a.ignore;});_1.RecreatWidgetsOnServer=function(bP,bQ){function bR(bT,bU,bV){return bV;}function bS(bT,bU,bV){return bV;}return _9.map(function(bT){return bR(bT[0],bT[1],bT[2]);},_9.concat(_9.map(function(bT){return bS(bT[0],bT[1],bT[2]);},_1.RecreateWidgets(bP,bQ))));};_1.RecreateEventsOnServer=function(bP,bQ){function bR(bT,bU){return bU;}function bS(bT,bU){return bU;}return _9.map(function(bT){return bR(bT[0],bT[1]);},_9.concat(_9.map(function(bT){return bS(bT[0],bT[1]);},_1.RecreateEvents(a.id,bP,bQ))));};_1.RecreateOnClient=function(bP,bQ,bR,bS,bT,bU,bV){var bW;e.set_Role(f.Client);bW=h.Agent();bW.mailbox.AddLast({$:3,$0:function(bX){(new ba.New()).Send("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.MessageBus.SendToServer:-1358505674",[bX]);}});bW.resume();bQ.Restore(bR,_1.RecreateEvents(bP,bS,bT),_1.RecreateWidgets(bS,bU),bV);};_1.RecreateWidgets=function(bP,bQ){function bR(bS,bT,bU){function bV(bW,bX,bY){return[bW,bX,bP(bY)];}return[bS,bT,_9.map(function(bW){return bV(bW[0],bW[1],bW[2]);},bU)];}return _9.map(function(bS){return bR(bS[0],bS[1],bS[2]);},bQ);};_1.RecreateEvents=function(bP,bQ,bR){function bS(bT,bU){function bV(bW,bX){return[bW,bP(bQ(bX))];}return[bT,_9.map(function(bW){return bV(bW[0],bW[1]);},bU)];}return _9.map(function(bT){return bS(bT[0],bT[1]);},bR);};_2=d.AppData=_4.Class({RecreateOnServer:function(bP){var bQ,bR;function bS(bT,bU){bU.Reconnect(bR);}bQ=_1.RecreateEventsOnServer(bP,this.Events);bR=_9.map(function(bT){return bT.WithStartRunner();},_9.append(bQ,_1.RecreatWidgetsOnServer(bP,this.Widgets)));_9.iter(function(bT){return bS(bT[0],bT[1]);},this.Rules);return bQ;},RecreateOnClientEventsRunning:function(bP,bQ,bR){_1.RecreateOnClient(function(bS){return bS.WithStartRunner();},bP,bQ,bR,this.Events,this.Widgets,this.Rules);},RecreateOnClientEventsNotRunning:function(bP,bQ,bR){_1.RecreateOnClient(a.id,bP,bQ,bR,this.Events,this.Widgets,this.Rules);}},null,_2);_2.Create=function(bP,bQ){var bR;bR=bP.Store(bQ);return _2.New(bR[0],bR[1],bR[2]);};_2.empty=function(){return _2.New(_9.T.Empty,_9.T.Empty,_9.T.Empty);};_2.New=function(bP,bQ,bR){return new _2({Events:bP,Widgets:bQ,Rules:bR});};}());
