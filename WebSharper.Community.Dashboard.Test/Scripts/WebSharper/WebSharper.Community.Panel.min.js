(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Community=b.Community||{};d=c.Panel=c.Panel||{};e=d.TitleButton=d.TitleButton||{};f=d.Panel=d.Panel||{};g=d.PanelContainer=d.PanelContainer||{};h=d.Rect=d.Rect||{};i=d.LayoutManagers=d.LayoutManagers||{};j=a.StartupCode$WebSharper_Community_Panel$LayoutManagers=a.StartupCode$WebSharper_Community_Panel$LayoutManagers||{};k=d.Dialog=d.Dialog||{};l=a.IntelliFactory;m=l&&l.Runtime;n=b&&b.UI;o=n&&n.Next;p=o&&o.AttrModule;q=o&&o.Doc;r=o&&o.Var;s=o&&o.Input;t=s&&s.Mouse;u=o&&o.View;v=b&&b.Operators;w=b&&b.Seq;x=b&&b.List;y=b&&b.Unchecked;z=o&&o.Key;A=o&&o.ListModel;e=d.TitleButton=m.Class({Render:function(B){var C,D,E;C=this;D=[p.Class("material-icons orange600 small"),p.Style("cursor","pointer"),p.Handler("click",function(){return function(){return C.Action(B);};})];E=[q.TextNode(this.Icon)];return q.Element("i",D,E);}},null,e);e.New=function(B,C){return new e({Icon:B,Action:C});};f=d.Panel=m.Class({get_Render:function(){var B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba;B=this;C=r.Create$1(false);D=r.Create$1(false);E=r.Create$1(0);F=r.Create$1(0);G=(H=t.get_LeftPressed(),u.Map(function(bb){return bb?C.c:false;},H));I=(J=t.get_Position(),u.UpdateWhile([0,0],G,J));K=(L=function(bb,bc){var bd,be,bf,bg,bh,bi,bj,bk;return C.c?(bd=B.Element.c.getBoundingClientRect(),(be=B.Element.c.parentElement.getBoundingClientRect(),(bf=be.width-bd.width,(bg=be.height-bd.height,(bh=v.Min(bf,v.Max(0,+bb-E.c)),(bi=v.Min(bg,v.Max(0,+bc-F.c)),(bj=B.Left,r.Set(bj,bh),bk=B.Top,r.Set(bk,bi),B.Relayout(B),[bh,bi]))))))):[B.Left.c,B.Top.c];},u.Map(function(bb){return L(bb[0],bb[1]);},I));M=w.concat([this.TitleAttrs,x.ofArray([p.Style("cursor","grab"),p.Handler("mouseenter",function(){return function(){return r.Set(D,true);};}),p.Handler("mouseleave",function(){return function(){return!C.c?r.Set(D,false):null;};}),p.Handler("mouseup",function(){return function(){r.Set(D,false);return r.Set(C,false);};}),p.Handler("mousedown",function(){return function(bb){var bc,bd;((D.c?!y.Equals(B.Element.c.parentElement,null):false)?!y.Equals(B.Element.c.parentElement.parentElement,null):false)?r.Set(C,true):void 0;bc=+bb.clientX-B.Left.c;r.Set(E,bc);bd=+bb.clientY-B.Top.c;return r.Set(F,bd);};})])]);N=(O=[p.Style("width","100%")],(P=[(Q=[(R=[this.TitleContent],q.Element("td",[],R)),(S=[p.Style("text-align","right"),p.Style("vertical-align","middle")],(T=(U=function(bb){return bb.Render(B);},function(bb){return x.map(U,bb);}(this.TitleButtons)),q.Element("td",S,T)))],q.Element("tr",[],Q))],q.Element("table",O,P)));V=this.Width>0?x.ofArray([p.Style("width",(W=function(bb,bc){return bb(bc.toFixed(6)+"px");},(function(bb){return function(bc){return W(bb,bc);};}(a.id))(this.Width)))]):x.T.Empty;X=this.Height>0?x.ofArray([p.Style("height",(Y=function(bb,bc){return bb(bc.toFixed(6)+"px");},(function(bb){return function(bc){return Y(bb,bc);};}(a.id))(this.Height)))]):x.T.Empty;Z=w.concat([this.PannelAttrs,w.concat([V,X]),x.ofArray([p.DynamicStyle("left",(_0=this.Left.v,u.Map(function(bb){var bc;bc=function(bd,be){return bd(be.toFixed(6)+"px");};return(function(bd){return function(be){return bc(bd,be);};}(a.id))(bb);},_0))),p.DynamicStyle("left",(_1=function(bb){var bc;bc=function(bd,be){return bd(be.toFixed(6)+"px");};return(function(bd){return function(be){return bc(bd,be);};}(a.id))(bb);},u.Map(function(bb){return _1(bb[0],bb[1]);},K))),p.DynamicStyle("top",(_2=function(bb,bc){var bd;bd=function(be,bf){return be(bf.toFixed(6)+"px");};return(function(be){return function(bf){return bd(be,bf);};}(a.id))(bc);},u.Map(function(bb){return _2(bb[0],bb[1]);},K))),p.DynamicStyle("top",(_3=this.Top.v,u.Map(function(bb){var bc;bc=function(bd,be){return bd(be.toFixed(6)+"px");};return(function(bd){return function(be){return bc(bd,be);};}(a.id))(bb);},_3)))])]);_4=(_5=[(_6=[(_7=[(_8=[this.IsWithTitle?q.Element("div",M,[N]):q.Element("div",[],[])],q.Element("td",V,_8))],q.Element("tr",[],_7)),(_9=[(_=[this.PanelContent,this.Children.get_Render()],q.Element("td",[],_))],q.Element("tr",[],_9))],q.Element("table",[],_6))],q.Element("div",Z,_5));$=this.Element;ba=_4.elt;r.Set($,ba);return _4.OnAfterRender(function(){B.onAfterRender(B);});},EditProperties:function(B){var C;B.Edit(x.concat([this.Properties,x.concat((C=function(D){return D.Properties;},function(D){return x.map(C,D);}(x.ofSeq(this.Children.PanelItems))))]));},WithHeight:function(B){return f.New(this.Key,this.Left,this.Top,this.Width,B,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithWidth:function(B){return f.New(this.Key,this.Left,this.Top,B,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithProperties:function(B){return f.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,B);},WithOnAfterRender:function(B){return f.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,B,this.Properties);},WithInternalName:function(B){return f.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,B,this.onAfterRender,this.Properties);},WithTitle:function(B){return f.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,B,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithChildPanelContainer:function(B){return f.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,B,this.InternalName,this.onAfterRender,this.Properties);},WithRelayoutFnc:function(B){return f.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,B,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithPanelContent:function(B){return f.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,B,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithTitleButtons:function(B){return f.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,B,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithTitleContent:function(B){return f.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,B,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithTitleAttrs:function(B){return f.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,B,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithPannelAttrs:function(B){return f.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,B,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);}},null,f);f.get_Create=function(){return f.New(z.Fresh(),r.Create$1(0),r.Create$1(0),0,0,r.Create$1(null),function(){},x.T.Empty,true,x.ofArray([p.Class("panelTitle")]),q.Element("div",[],[]),x.T.Empty,q.Element("div",[],[]),g.get_Create(),"",function(){},x.T.Empty);};f.New=function(B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R){return new f({Key:B,Left:C,Top:D,Width:E,Height:F,Element:G,Relayout:H,PannelAttrs:I,IsWithTitle:J,TitleAttrs:K,TitleContent:L,TitleButtons:M,PanelContent:N,Children:O,InternalName:P,onAfterRender:Q,Properties:R});};g=d.PanelContainer=m.Class({get_Render:function(){var B,C,D,E,F,G,H,I,J;B=this;C=this.Width>0?x.ofArray([p.Style("width",(D=function(K,L){return K(L.toFixed(6)+"px");},(function(K){return function(L){return D(K,L);};}(a.id))(this.Width)))]):x.T.Empty;E=this.Height>0?x.ofArray([p.Style("height",(F=function(K,L){return K(L.toFixed(6)+"px");},(function(K){return function(L){return F(K,L);};}(a.id))(this.Height)))]):x.T.Empty;G=w.concat([this.ContainerAttributes,C,E,x.ofArray([p.Style("position","relative")])]);H=[(I=function(K){return K.Key;},(J=function(K){var L;L=K.get_Render();return L.OnAfterRender(function(){B.LayoutManager.WebSharper_Community_Panel_ILayoutManager$PlacePanel(B,K);});},function(K){return q.ConvertBy(I,J,K);})(this.PanelItems.v))];return q.Element("div",G,H);},AddPanel:function(B){var C,D;this.PanelItems.Append(B.WithRelayoutFnc((C=this.LayoutManager,(D=this,function(E){C.WebSharper_Community_Panel_ILayoutManager$Relayout(D,E);}))));},FindPanelItem:function(B){var C;C=function(D){return y.Equals(D.Element,B.Element);};return function(D){return w.find(C,D);}(x.ofSeq(this.PanelItems));},WithHeight:function(B){return g.New(this.Width,B,this.PanelItems,this.LayoutManager,this.ContainerAttributes);},WithWidth:function(B){return g.New(B,this.Height,this.PanelItems,this.LayoutManager,this.ContainerAttributes);},WithLayoutManager:function(B){return g.New(this.Width,this.Height,this.PanelItems,B,this.ContainerAttributes);},WithAttributes:function(B){return g.New(this.Width,this.Height,this.PanelItems,this.LayoutManager,B);}},null,g);g.get_Create=function(){var B;return g.New(0,0,(B=x.T.Empty,A.Create(function(C){return C.Key;},B)),{WebSharper_Community_Panel_ILayoutManager$PlacePanel:function(){return null;},WebSharper_Community_Panel_ILayoutManager$Relayout:function(){return null;}},x.T.Empty);};g.New=function(B,C,D,E,F){return new g({Width:B,Height:C,PanelItems:D,LayoutManager:E,ContainerAttributes:F});};h=d.Rect=m.Class({toString:function(){return"left:"+a.String(this.left)+" "+" top:"+a.String(this.top)+" right:"+a.String(this.right)+" bottom:"+a.String(this.bottom);},inflate:function(B,C){var D,E;D=this.left-B;E=this.top-C;return h.New(D,this.right+B,E,this.bottom+C);},get_height:function(){return this.bottom-this.top;},get_width:function(){return this.right-this.left;},intersect:function(B){var C,D,E,F;C=v.Max(this.left,B.left);D=v.Min(this.right,B.right);E=v.Max(this.top,B.top);F=v.Min(this.bottom,B.bottom);return h.New(C,v.Max(C,D),E,v.Max(E,F));},offset:function(B,C){var D,E;D=this.left+B;E=this.top+C;return h.New(D,this.right+B,E,this.bottom+C);},get_isEmpty:function(){return this.left>=this.right?true:this.top>=this.bottom;}},null,h);h.fromPanel=function(B){return h.fromDomRect(B.Element.c).offset(B.Left.c,B.Top.c);};h.fromDomRect=function(B){var C;return!y.Equals(B,null)?(C=B.getBoundingClientRect(),h.New(0,C.width,0,C.height)):h.Create(0,0,0,0);};h.Create=function(B,C,D,E){return h.New(B,D,C,E);};h.New=function(B,C,D,E){return new h({left:B,right:C,top:D,bottom:E});};i.StackPanelLayoutManager=function(){j.$cctor();return j.StackPanelLayoutManager;};i.FloatingPanelLayoutManager=function(B){return{WebSharper_Community_Panel_ILayoutManager$PlacePanel:function(C,D){return i.placePanel(C,D,B);},WebSharper_Community_Panel_ILayoutManager$Relayout:function(C,D){return i.relayout(C,D,B);}};};i.relayout=function(B,C,D){var E,F,G,H,I,J,K;E=B.PanelItems;F=x.ofSeq(E);G=(H=function(L){return y.Equals(L.Key,C.Key);},function(L){return w.find(H,L);}(F));I=(J=function(L){return!y.Equals(L.Key,G.Key)?!h.fromPanel(L).intersect(h.fromPanel(G)).get_isEmpty():false;},function(L){return w.tryFind(J,L);}(x.ofSeq(E)));(I!=null?I.$==1:false)?(K=I.$0,i.movePanelToFreeSpace(E,K,D)):void 0;};i.placePanel=function(B,C,D){var E,F,G,H,I,J,K,L,M,N,O;E=h.fromPanel(C);F=(G=B.Width,(H=B.Height,h.Create(0,0,G,H)));I=(J=function(P){return P.get_width()>=E.get_width()?P.get_height()>=E.get_height():false;},function(P){return w.tryFind(J,P);}(i.collectFreeSpace(B.PanelItems,F,C,D)));(I!=null?I.$==1:false)?(K=I.$0,L=C.Left,M=K.left+D,r.Set(L,M),N=C.Top,O=K.top+D,r.Set(N,O)):void 0;};i.movePanelToFreeSpace=function(B,C,D){var E,F,G,H,I,J,K,L,M;E=h.fromPanel(C);F=h.fromDomRect(C.Element.c.parentElement);G=(H=function(N){return N.get_width()>=E.get_width()?N.get_height()>=E.get_height():false;},function(N){return w.tryFind(H,N);}(i.collectFreeSpace(B,F,C,D)));(G!=null?G.$==1:false)?(I=G.$0,J=C.Left,K=I.left+D,r.Set(J,K),L=C.Top,M=I.top+D,r.Set(L,M)):void 0;};i.collectFreeSpace=function(B,C,D,E){var F,G,H;F=(G=function(I){return!y.Equals(I.Key,D.Key);},function(I){return x.filter(G,I);}(x.ofSeq(B)));H=x.ofArray([C]);return w.fold(function(I,J){var K,L,M,N,O,P;K=i.panelRect(J,0);L=h.New(0,C.right,0,K.top);M=h.New(0,K.left,0,C.bottom);return x.concat((N=function(Q){var R,S;R=function(T){return!T.get_isEmpty();};return function(T){return x.filter(R,T);}((S=function(T){return T.intersect(Q);},function(T){return x.map(S,T);}(I)));},function(Q){return x.map(N,Q);}(x.ofArray([L,M,h.New(K.right,C.right,M.top,M.bottom),(O=K.bottom,(P=C.bottom,h.New(L.left,L.right,O,P)))]))));},H,F);};i.calcClientArea=function(B,C,D){var E,F,G,H,I,J,K,L,M,N,O,P,Q;E=function(R,S){var T,U;while(true)if(S.$==1){T=S.$1;U=S.$0;if(y.Equals(U.Key,C.Key))return R;else{R=new x.T({$:1,$0:U,$1:R});S=T;}}else return R;};F=(G=function(R){var S;S=R.InternalName;a.console.log(S);return i.panelRect(R,D);},function(R){return x.map(G,R);}((H=x.ofSeq(B),(I=x.T.Empty,function(R){return E(I,R);}(H)))));return F.$==0?h.Create(0,0,0,0):(J=x.min((K=function(R){return R.left;},function(R){return x.map(K,R);}(F))),(L=x.min((M=function(R){return R.top;},function(R){return x.map(M,R);}(F))),(N=x.max((O=function(R){return R.right;},function(R){return x.map(O,R);}(F))),(P=x.max((Q=function(R){return R.bottom;},function(R){return x.map(Q,R);}(F))),h.Create(J,L,N,P)))));};i.panelRect=function(B,C){return h.fromPanel(B).inflate(C,C);};j.$cctor=m.Cctor(function(){j.StackPanelLayoutManager={WebSharper_Community_Panel_ILayoutManager$PlacePanel:function(){return null;},WebSharper_Community_Panel_ILayoutManager$Relayout:function(B,C){return i.relayout(B,C,0);}};j.$cctor=a.ignore;});k=d.Dialog=m.Class({get_Render:function(){var B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R;B=this;C=[p.Style("position","absolute"),p.Style("left","50%"),p.Style("top","50%"),p.Style("z-index","1"),p.Style("background-color","white"),p.Style("min-height","100px"),p.Style("min-width","200px"),p.DynamicStyle("display",(D=this.Visibility.v,u.Map(function(S){return S?"block":"none";},D)))];E=[(F=[(G=[(H=[q.TextView(this.Title.v)],q.Element("td",[],H))],q.Element("tr",[],G)),(I=[(J=[(K=a.id,function(S){return q.BindView(K,S);}(this.Content.v))],q.Element("td",[],J))],q.Element("tr",[],I)),(L=[(M=[(N=[p.Handler("click",function(){return function(){var S;S=B.Visibility;r.Set(S,false);return B.OKCallback.c();};})],(O=[q.TextNode("OK")],q.Element("button",N,O)))],q.Element("td",[],M)),(P=[(Q=[p.Handler("click",function(){return function(){var S;S=B.Visibility;return r.Set(S,false);};})],(R=[q.TextNode("Cancel")],q.Element("button",Q,R)))],q.Element("td",[],P))],q.Element("tr",[],L))],q.Element("table",[],F))];return q.Element("div",C,E);},ShowDialog:function(B,C,D){var E,F,G,H;E=this.Title;r.Set(E,B);F=this.Content;r.Set(F,C);G=this.Visibility;r.Set(G,true);H=this.OKCallback;r.Set(H,D);}},null,k);k.get_Create=function(){return k.New(r.Create$1(""),r.Create$1(q.Element("div",[],[])),r.Create$1(false),r.Create$1(function(){}));};k.New=function(B,C,D,E){return new k({Title:B,Content:C,Visibility:D,OKCallback:E});};}());
