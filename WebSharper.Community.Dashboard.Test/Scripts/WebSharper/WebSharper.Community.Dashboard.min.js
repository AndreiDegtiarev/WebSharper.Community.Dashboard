(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg;a=window.WebSharper=window.WebSharper||{};b=a.Community=a.Community||{};c=b.Dashboard=b.Dashboard||{};d=c.EmptyTrigger=c.EmptyTrigger||{};e=c.NumberTrigger=c.NumberTrigger||{};f=c.InPort=c.InPort||{};g=c.OutPort=c.OutPort||{};h=c.PortConnector=c.PortConnector||{};i=c.Ports=c.Ports||{};j=c.Worker=c.Worker||{};k=c.RandomRunner=c.RandomRunner||{};l=c.OpenWeather=c.OpenWeather||{};m=l.Forecast=l.Forecast||{};n=c.OpenWeatherRunner=c.OpenWeatherRunner||{};o=c.ChartRunnerContext=c.ChartRunnerContext||{};p=c.ChartRenderer=c.ChartRenderer||{};q=c.TextBoxRenderer=c.TextBoxRenderer||{};r=c.WorkerItem=c.WorkerItem||{};s=c.Factory=c.Factory||{};t=c.PortConnectorItem=c.PortConnectorItem||{};u=c.DshData=c.DshData||{};v=c.DshEditorCellItem=c.DshEditorCellItem||{};w=c.DshEditorRowItem=c.DshEditorRowItem||{};x=c.DshEditor=c.DshEditor||{};y=c.Dashboard=c.Dashboard||{};z=window.IntelliFactory;A=z&&z.Runtime;B=b&&b.PropertyGrid;C=B&&B.Properties;D=a&&a.UI;E=D&&D.Next;F=E&&E.Var;G=a&&a.Control;H=G&&G.FSharpEvent;I=window.console;J=a&&a.Operators;K=a&&a.Unchecked;L=a&&a.List;M=E&&E.Doc;N=a&&a.Random;O=a&&a.Concurrency;P=window.Math;Q=a&&a.PrintfHelpers;R=a&&a.Data;S=R&&R.TxtRuntime;T=window.FSharp;U=T&&T.Data;V=U&&U.Runtime;W=V&&V.IO;X=window.JSON;Y=a&&a.Arrays;Z=a&&a.Charting;_0=Z&&Z.Renderers;_1=_0&&_0.ChartJs;_2=a&&a.Seq;_3=Z&&Z.Chart;_4=Z&&Z.Pervasives;_5=E&&E.View;_6=E&&E.AttrModule;_7=E&&E.Key;_8=E&&E.ListModel;_9=a&&a.Option;_=b&&b.Panel;$=_&&_.Helper;ba=a&&a.Enumerator;bb=_&&_.PanelContainer;bc=_&&_.LayoutManagers;bd=_&&_.Panel;be=_&&_.TitleButton;bf=_&&_.Dialog;bg=B&&B.PropertyGrid;d.New=function(bh){return{EmptyTrigger:bh};};e=c.NumberTrigger=A.Class({Trigger:function(bh){this.NumberEvent.event.Trigger(bh);}},null,e);e.New=function(bh){return new e({NumberEvent:bh});};f=c.InPort=A.Class({Equals:function(bh){return bh instanceof f&&this.Name===bh.Name;},get_Property:function(){var bh;bh=this.Value;return bh.$==1?C["double"](this.Name,bh.$0.NumValue):bh.$==2?C.string(this.Name,bh.$0.StrValue):C.group(this.Name);},get_Clone:function(){var bh;return f.New(this.Name,this.Disconnector,this.Disconnect,this.OutPort,(bh=this.Value,bh.$==1?{$:1,$0:{NumValue:F.Create$1(bh.$0.NumValue.c)}}:bh.$==2?{$:2,$0:{StrValue:F.Create$1(bh.$0.StrValue.c)}}:{$:0,$0:bh.$0}));}},null,f);f.New=function(bh,bi,bj,bk,bl){return new f({Name:bh,Disconnector:bi,Disconnect:bj,OutPort:bk,Value:bl});};g=c.OutPort=A.Class({Equals:function(bh){return bh instanceof g&&this.Name===bh.Name;}},null,g);g.New=function(bh,bi,bj,bk){return new g({Name:bh,IsCompatible:bi,Connect:bj,Trigger:bk});};h.Create=function(bh,bi){return h.New(bh.Name+"->"+bi.Name,bi,bh,bh.Connect(bi));};h.New=function(bh,bi,bj,bk){return{Name:bh,InPort:bi,OutPort:bj,Disconnect:bk};};i.Clone=function(bh){return bh.Trigger.$==1?i.OutPortNum(bh.Name):i.BaseOutPort(bh.Name);};i.OutPortNum=function(bh){var bi;bi=new H.New();return g.New(i.BaseOutPort(bh).Name,function(bj){return bj.Value.$==1&&true;},function(bj){var bk,bl,bm;bk=bj.Value;return bk.$==1?(bl=bk.$0,(bj.Disconnect(),bm=function(bn,bo){return F.Set(bl.NumValue,bo);},bi.event.AddHandler(bm),I.log("Port "+bh+" connected with "+bj.Name),function(){bi.event.RemoveHandler(bm);})):J.FailWith("Unexpected type");},{$:1,$0:e.New(bi)});};i.InPortStr=function(bh,bi){var bj;bj=i.BaseInPort(bh);return f.New(bj.Name,bj.Disconnector,bj.Disconnect,bj.OutPort,{$:2,$0:{StrValue:F.Create$1(bi)}});};i.InPortNum=function(bh,bi){var bj;bj=i.BaseInPort(bh);return f.New(bj.Name,bj.Disconnector,bj.Disconnect,bj.OutPort,{$:1,$0:{NumValue:F.Create$1(bi)}});};i.BaseInPort=function(bh){return f.New(bh,function(){},function(){I.log("Port "+bh+" disconnected");},i.BaseOutPort("Empty"),{$:0,$0:{Nothing:""}});};i.BaseOutPort=function(bh){return g.New(bh,function(){return false;},function(){return function(){return null;};},{$:0,$0:d.New("")});};i.NumTrigger=function(bh){var bi,bj;bi=bh.Trigger;return bi.$==1?(bj=bi.$0,function(bk){bj.Trigger(bk);}):J.FailWith("unexpected type");};i.StringVar=function(bh){var bi;bi=bh.Value;return bi.$==2?bi.$0.StrValue:J.FailWith("unexpected type");};i.NumberVar=function(bh){var bi;bi=bh.Value;return bi.$==1?bi.$0.NumValue:J.FailWith("unexpected type");};j=c.Worker=A.Class({Equals:function(bh){return bh instanceof j&&K.Equals(this.Name,bh.Name);},get_Properties:function(){return new L.T({$:1,$0:C.string("Name",this.Name),$1:L.map(function(bh){return bh.get_Property();},this.InPorts)});},get_Render:function(){var bh;bh=this.Renderer;return bh==null?M.Empty():(bh.$0.WebSharper_Community_Dashboard_IRenderer$get_Render())(this);},get_CloneAndRun:function(){var bh,bi;bh=j.New(F.Create$1(this.Name.c),L.map(function(bj){return bj.get_Clone();},this.InPorts),L.map(i.Clone,this.OutPorts),this.Runner,this.Renderer,this.DataContext,null);bi=bh.Runner;return bi==null?bh:j.New(bh.Name,bh.InPorts,bh.OutPorts,bh.Runner,bh.Renderer,bh.DataContext,(bi.$0.WebSharper_Community_Dashboard_IRunner$get_Run())(bh));}},null,j);j.CreateRenderer=function(bh){return j.CreateNative(bh,null,{$:1,$0:bh});};j.CreateRunner=function(bh){return j.CreateNative(bh,{$:1,$0:bh},null);};j.Create=function(bh){return j.CreateNative(bh,{$:1,$0:bh},{$:1,$0:bh});};j.CreateNative=function(bh,bi,bj){return j.New(F.Create$1(bh.WebSharper_Community_Dashboard_IWorkerContext$get_Name()),bh.WebSharper_Community_Dashboard_IWorkerContext$get_InPorts(),bh.WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts(),bi,bj,bh,null);};j.New=function(bh,bi,bj,bk,bl,bm,bn){return new j({Name:bh,InPorts:bi,OutPorts:bj,Runner:bk,Renderer:bl,DataContext:bm,RunnerContext:bn});};k=c.RandomRunner=A.Class({WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bh){var bi;new N.New();O.Start((bi=null,O.Delay(function(){return O.While(function(){return true;},O.Delay(function(){return O.Bind(O.Sleep(600),function(){var bj,bk,bl;bj=i.NumberVar(bh.InPorts.get_Item(1));bk=i.NumberVar(bh.InPorts.get_Item(0));bl=P.random()*bj.c+bk.c;(i.NumTrigger(bh.OutPorts.get_Item(0)))(bl);return O.Zero();});}));})),null);return null;};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return L.ofArray([i.OutPortNum("Random value")]);},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return L.ofArray([i.InPortNum("Middle value",this.MiddleValue),i.InPortNum("Dispersion",this.Dispersion)]);},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return"Rundom";}},null,k);k.get_FromInPorts=function(){return function(bh){return k.Create(i.NumberVar(bh.InPorts.get_Item(0)).c,i.NumberVar(bh.InPorts.get_Item(1)).c);};};k.Create=function(bh,bi){return k.New(bh,bi);};k.New=function(bh,bi){return new k({MiddleValue:bh,Dispersion:bi});};m.New=function(bh,bi,bj,bk,bl){return{Title:bh,Description:bi,ImageUrl:bj,Temperature:bk,TemparatureMinMax:bl};};l.get=function(bh,bi){var bj;bj=null;return O.Delay(function(){var bk;bk=(((A.Curried3(function(bl,bm,bn){return bl("http://api.openweathermap.org/data/2.5/weather?q="+Q.toSafe(bm)+"&units=metric&appid="+Q.toSafe(bn));}))(window.id))(bi))(bh);I.log("get key city "+bk);return O.TryWith(O.Delay(function(){return O.Bind(S.AsyncMap(W.asyncReadTextAtRuntime(false,"C:\\Users\\Andrey\\Private\\VS_Projects\\WebSharper.Community.Dashboard\\WebSharper.Community.Dashboard","","JSON","",bk),function(bl){return K.Equals(typeof bl,"string")?X.parse(bl):bl;}),function(bl){var bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI;I.log("get key city 2");return O.Return((bm=Y.tryHead(bl.weather),bm==null?null:{$:1,$0:(bn=bm.$0,m.New((((A.Curried3(function(bJ,bK,bL){return bJ(Q.toSafe(bK)+", "+Q.toSafe(bL));}))(window.id))((bp=(bo="name",bo in bl?{$:1,$0:bl[bo]}:null),bp==null?null:bp.$0)))((bs=(bq=bl.sys,(br="country",br in bq?{$:1,$0:bq[br]}:null)),bs==null?null:bs.$0)),(bu=(bt="main",bt in bn?{$:1,$0:bn[bt]}:null),bu==null?null:bu.$0),(function(bJ){return function(bK){return bJ("http://openweathermap.org/img/w/"+Q.toSafe(bK)+".png");};}(window.id))((bw=(bv="icon",bv in bn?{$:1,$0:bn[bv]}:null),bw==null?null:bw.$0)),(bx=(by=bl.main,(bz="temp",bz in by?{$:1,$0:by[bz]}:null)),(bA=bx==null?null:{$:1,$0:1*bx.$0},bA==null?null:bA.$0)),[(bB=(bC=bl.main,(bD="temp_min",bD in bC?{$:1,$0:bC[bD]}:null)),(bE=bB==null?null:{$:1,$0:1*bB.$0},bE==null?null:bE.$0)),(bF=(bG=bl.main,(bH="temp_max",bH in bG?{$:1,$0:bG[bH]}:null)),(bI=bF==null?null:{$:1,$0:1*bF.$0},bI==null?null:bI.$0))]))}));});}),function(bl){I.log(bl.message);return O.Return(null);});});};n=c.OpenWeatherRunner=A.Class({WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bh){var bi;O.Start((bi=null,O.Delay(function(){return O.While(function(){return true;},O.Delay(function(){var bj,bk,bl;bj=bh.InPorts.get_Item(0);bk=bh.InPorts.get_Item(1);bl=bh.OutPorts.get_Item(0);return O.Bind(l.get(i.StringVar(bk).c,i.StringVar(bj).c),function(bm){return O.Combine(bm==null?O.Zero():(I.log("Value generated:"+bm.$0.Title),(i.NumTrigger(bl))(+bm.$0.Temperature),O.Zero()),O.Delay(function(){return O.Bind(O.Sleep(1000*15),function(){return O.Return(null);});}));});}));})),null);return null;};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return L.ofArray([i.OutPortNum("Temperature")]);},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return L.ofArray([i.InPortStr("City",this.OpenWeatherCity),i.InPortStr("ApiKey",this.OpenWeatherApiKey)]);},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return"OpenWeatherMap";}},null,n);n.get_FromInPorts=function(){return function(bh){return n.Create(i.StringVar(bh.InPorts.get_Item(0)).c,i.StringVar(bh.InPorts.get_Item(1)).c);};};n.Create=function(bh,bi){return n.New(bh,bi);};n.New=function(bh,bi){return new n({OpenWeatherCity:bh,OpenWeatherApiKey:bi});};o.New=function(bh){return{LineChart:bh};};p=c.ChartRenderer=A.Class({WebSharper_Community_Dashboard_IRenderer$get_Render:function(){return function(bh){return _1.Render$8(bh.RunnerContext.$0.LineChart,{$:1,$0:{$:0,$0:i.NumberVar(bh.InPorts.get_Item(1)).c<<0,$1:i.NumberVar(bh.InPorts.get_Item(2)).c<<0}},null,null);};},WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bh){var bi,bj,bk,bl,bm;bi=i.NumberVar(bh.InPorts.get_Item(3)).c<<0;bj=L.ofSeq(_2.delay(function(){return _2.map(function(){return 0;},J.range(0,bi-1));}));bk=(bl=[],(_2.iter(function(bn){bl.push(bn);},bj),bl));bm=_3.Line(bj).__WithFillColor(new _4.Color({$:2,$0:"white"}));_5.Sink(function(bn){bk.push(bn);bk.length>bi?bk.shift():void 0;_2.iteri(function(bo,bp){return bm.__UpdateData(bo,function(){return bp;});},bk);},i.NumberVar(bh.InPorts.get_Item(0)).v);return{$:1,$0:o.New(bm)};};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return L.T.Empty;},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return L.ofArray([i.InPortNum("in Value",0),i.InPortNum("cx",this.Cx),i.InPortNum("cy",this.Cy),i.InPortNum("BufferSize",+this.ChartBufferSize)]);},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return"Chart";}},null,p);p.get_FromInPorts=function(){return function(bh){return p.Create(i.NumberVar(bh.InPorts.get_Item(1)).c,i.NumberVar(bh.InPorts.get_Item(2)).c,i.NumberVar(bh.InPorts.get_Item(3)).c<<0);};};p.Create=function(bh,bi,bj){return p.New(bh,bi,bj);};p.New=function(bh,bi,bj){return new p({Cx:bh,Cy:bi,ChartBufferSize:bj});};q=c.TextBoxRenderer=A.Class({WebSharper_Community_Dashboard_IRenderer$get_Render:function(){return function(bh){var bi;bi=_5.Map(function(bj){var bk;bk=bj<<0;return window.String(bk);},i.NumberVar(bh.InPorts.get_Item(0)).v);return M.Element("div",[_6.Class("bigvalue")],[M.TextView(bi)]);};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return L.T.Empty;},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return L.ofArray([i.InPortNum("in Value",this.TextBoxValue)]);},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return"Text";}},null,q);q.get_FromInPorts=function(){return function(bh){return q.New(i.NumberVar(bh.InPorts.get_Item(0)).c);};};q.get_Create=function(){return q.New(0);};q.New=function(bh){return new q({TextBoxValue:bh});};r.Create=function(bh){return r.New(_7.Fresh(),bh);};r.New=function(bh,bi){return{Key:bh,Worker:bi};};s=c.Factory=A.Class({RegisterEvent:function(bh){this.EventItems.Append(r.Create(bh));},RegisterWidget:function(bh){this.WidgetItems.Append(r.Create(bh));}},null,s);s.get_Create=function(){return s.New(_8.Create(function(bh){return bh.Key;},L.T.Empty),_8.Create(function(bh){return bh.Key;},L.T.Empty));};s.New=function(bh,bi){return new s({EventItems:bh,WidgetItems:bi});};t.Create=function(bh){return t.New(_7.Fresh(),bh);};t.New=function(bh,bi){return{Key:bh,PortConnector:bi};};u=c.DshData=A.Class({ConnectPorts:function(bh,bi){I.log("Connect ports:"+bh.Name+" "+bi.Name);this.PortConnectorItems.Append(t.Create(h.Create(bh,bi)));},RegisterWidget:function(bh){var bi;bi=r.Create(bh);this.WidgetItems.Append(bi);this.WorkItems.Append(bi);},RegisterEvent:function(bh){var bi;bi=r.Create(bh);this.EventItems.Append(bi);this.WorkItems.Append(bi);}},null,u);u.get_Create=function(){return u.New(_8.Create(function(bh){return bh.Key;},L.T.Empty),_8.Create(function(bh){return bh.Key;},L.T.Empty),_8.Create(function(bh){return bh.Key;},L.T.Empty),_8.Create(function(bh){return bh.Key;},L.T.Empty));};u.New=function(bh,bi,bj,bk){return new u({WorkItems:bh,WidgetItems:bi,EventItems:bj,PortConnectorItems:bk});};v=c.DshEditorCellItem=A.Class({Render:function(bh,bi){var bj,bk,bl,bm,bn;bj=this;_5.Sink(function(bo){var bp;if(bo==null);else{bp=bo.$0;I.log("Workitem selected");F.Set(bj.OptInPort,L.tryHead(bp.Worker.InPorts));F.Set(bj.OptOutPort,L.tryHead(bp.Worker.OutPorts));bi();}},this.OptWorker.v);_5.Sink(function(){bi();},this.OptInPort.v);_5.Sink(function(){bi();},this.OptOutPort.v);bk=(bl=_5.Map(function(bo){var bp;return bo==null?L.ofArray([null]):(bp=L.map(function(bq){return{$:1,$0:bq};},bo.$0.Worker.InPorts),bp.get_Length()>0?bp:L.ofArray([null]));},this.OptWorker.v),(bm=_5.Map(function(bo){var bp;return bo==null?L.ofArray([null]):(bp=L.map(function(bq){return{$:1,$0:bq};},bo.$0.Worker.OutPorts),bp.get_Length()>0?bp:L.ofArray([null]));},this.OptWorker.v),(bn=_5.Map(function(bo){return new L.T({$:1,$0:null,$1:L.map(function(bp){return{$:1,$0:bp};},L.ofSeq(bo))});},bh.WorkItems.v),M.Element("table",[],[M.Element("tr",[],[M.Element("td",[],[M.SelectDyn([_6.Class("form-control")],function(bo){return _9.fold(function(bp,bq){return bq.Name;}," ",bo);},bl,this.OptInPort)]),M.Element("td",[],[M.SelectDyn([_6.Class("form-control")],function(bo){return _9.fold(function(bp,bq){return bq.Worker.Name.c;}," ",bo);},bn,this.OptWorker)]),M.Element("td",[],[M.SelectDyn([_6.Class("form-control")],function(bo){return _9.fold(function(bp,bq){return bq.Name;}," ",bo);},bm,this.OptOutPort)])])]))));return M.Element("td",[_6.Class("td DshEditorCell")],[M.Element("div",[_6.Class("div DshEditorCell")],[M.Element("table",[],[M.Element("tr",[],[M.Element("td",[],[$.IconNormal("add",function(){})]),M.Element("td",[],[bk])])])])]);}},null,v);v.get_Create=function(){return v.New(_7.Fresh(),F.Create$1(null),F.Create$1(null),F.Create$1(null));};v.New=function(bh,bi,bj,bk){return new v({Key:bh,OptInPort:bi,OptWorker:bj,OptOutPort:bk});};w=c.DshEditorRowItem=A.Class({Render:function(bh,bi){var bj;bj=this;return M.Element("tr",[],[M.ConvertBy(function(bk){return bk.Key;},function(bk){return bk.Render(bh,bi);},this.CellItems.v),$.IconNormal("add",function(){bj.CellItems.Append(v.get_Create());})]);}},null,w);w.get_Create=function(){return w.New(_7.Fresh(),_8.Create(function(bh){return bh.Key;},L.T.Empty));};w.New=function(bh,bi){return new w({Key:bh,CellItems:bi});};x=c.DshEditor=A.Class({Render:function(bh){var bi;bi=this;return M.Element("table",[],[M.ConvertBy(function(bj){return bj.Key;},function(bj){return M.Element("tr",[],[bj.Render(bh,function(){bi.Reconnect(bh,void 0);})]);},this.RowItems.v),M.Element("tr",[],[M.Element("td",[],[$.IconNormal("add",function(){bi.RowItems.Append(w.get_Create());})])])]);},Reconnect:function(bh,bi){_2.iter(function(bj){bj.PortConnector.Disconnect();},bh.PortConnectorItems);bh.PortConnectorItems.Clear();L.iter(function(bj){var bk,bl,bm;bk=L.ofSeq(bj.CellItems);bl=L.ofSeq(J.range(1,bk.get_Length()-1));bm=ba.Get(bl);try{while(bm.MoveNext())(function(){var bn,bo,bp,bq,br;bn=bm.Current();bo=bk.get_Item(bn-1);bp=bk.get_Item(bn);bq=bo.OptOutPort.c,bq==null?null:{$:1,$0:(br=bp.OptInPort.c,br==null?null:{$:1,$0:bh.ConnectPorts(bq.$0,br.$0)})};}());}finally{if("Dispose"in bm)bm.Dispose();}},L.ofSeq(this.RowItems));}},null,x);x.get_Create=function(){return x.New(_8.Create(function(bh){return bh.Key;},L.T.Empty));};x.New=function(bh){return new x({RowItems:bh});};y=c.Dashboard=A.Class({get_Render:function(){var bh,bi,bj,bk,bl,bm,bn;function bo(bp,bq){var br;br=F.Create$1(bp);return[br,M.Element("div",[_6.DynamicStyle("display",_5.Map(function(bs){return bs?"initial":"none";},br.v))],[bq])];}bh=this;bi=M.Element("table",[],[M.ConvertBy(function(bp){return bp.Key;},function(bp){return M.Element("tr",[],[M.Element("i",$.AttrsClick(function(){bh.PropertyGrid.Edit(bp.Worker.get_Properties());}),[M.TextView(bp.Worker.Name.v)])]);},this.Data.EventItems.v)]);bj=L.ofArray([["Board",bo(true,this.PanelContainer.get_Render())],["Events",bo(false,bi)],["Rules",bo(false,this.DshEditor.Render(this.Data))]]);bk=(bl=function(bp,bq){var br;br=bq[0];return M.Element("tr",[],[M.Element("td",[_6.DynamicStyle("Color",_5.Map(function(bs){return bs?"#FB8C00":"#7D4600";},br.v)),_6.Style("cursor","pointer"),_6.Handler("click",function(){return function(){var bs;bh.PropertyGrid.Edit(L.T.Empty);bs=function(bt,bu){var bv;bv=bu[0];!K.Equals(bv,br)?F.Set(bv,false):F.Set(bv,true);};return L.iter(function(bt){return bs(bt[0],bt[1]);},bj);};})],[M.TextNode(bp)])]);},L.map(function(bp){return bl(bp[0],bp[1]);},bj));bm=(bn=function(bp,bq){return bq[1];},L.map(function(bp){return bn(bp[0],bp[1]);},bj));return M.Element("div",[],[M.Element("table",[],[M.Element("tr",[],[M.Element("td",[_6.Style("vertical-align","top")],[M.Element("table",[],_2.concat([L.ofArray([M.Element("tr",[],[M.Element("td",[],[$.IconNormal("dehaze",function(){})])]),M.Element("tr",[],[M.Element("td",[],[$.IconNormal("add",function(){var bp,bq,br;bp=(bj.get_Item(0))[1][0];(bj.get_Item(1))[1][0].c?(bq=L.ofSeq(bh.Factory.EventItems),br=F.Create$1(L.head(bq)),bh.Dialog.ShowDialog("Select source",M.Element("div",[],[M.Select([_6.Class("form-control")],function(bs){return bs.Worker.Name.c;},bq,br)]),function(){bh.Data.RegisterEvent(br.c.Worker.get_CloneAndRun());})):bp.c?bh.CreatePanel("Panel",700,{$:1,$0:function(){}}):void 0;})])]),M.Element("tr",[],[M.Element("td",[],[])]),M.Element("tr",[],[M.Element("td",[],[this.PropertyGrid.get_Render()])])]),bk]))]),M.Element("td",[],bm)])]),M.Element("div",[],[this.Dialog.get_Render()])]);},CreatePanel:function(bh,bi,bj){var bk,bl;bk=this;M.ConvertBy(this.Data.WidgetItems.key,function(bm){return M.Element("div",[],[M.TextView(bm.Worker.Name.v)]);},this.Factory.WidgetItems.v);bl=bb.get_Create().WithLayoutManager(bc.StackPanelLayoutManager()).WithAttributes([_6.Style("border","1px solid white"),_6.Style("display","flex")]);this.PanelContainer.AddPanel(bd.get_Create().WithPannelAttrs([_6.Style("Width",window.String(bi)+"px"),_6.Style("position","absolute")]).WithTitleContent(M.TextNode(bh)).WithTitleButtons(L.ofArray([be.New("add",function(bm){var bn,bo;bn=L.ofSeq(bk.Factory.WidgetItems);bo=F.Create$1(L.head(bn));bk.Dialog.ShowDialog("Select widget",M.Element("div",[],[M.Select([_6.Class("form-control")],function(bp){return bp.Worker.Name.c;},bn,bo)]),function(){I.log("Dialog.IsOK");bk.RegisterWidget(bm.Children,bo.c.Worker.get_CloneAndRun());});}),be.New("edit",function(bm){I.log("Edit");bm.EditProperties(bk.PropertyGrid);}),be.New("clear",function(bm){bk.PanelContainer.PanelItems.Remove(bk.PanelContainer.FindPanelItem(bm));})])).WithChildPanelContainer(bl).WithOnAfterRender(bj==null?function(){}:bj.$0));return bl;},RegisterWidget:function(bh,bi){this.Data.RegisterWidget(bi);bh.AddPanel(bd.get_Create().WithTitle(false).WithPanelContent(bi.get_Render()));}},null,y);y.Create=function(bh){var bi;bi=bf.get_Create();return y.New(s.get_Create(),u.get_Create(),bh,x.get_Create(),bg.get_Create(),bi);};y.New=function(bh,bi,bj,bk,bl,bm){return new y({Factory:bh,Data:bi,PanelContainer:bj,DshEditor:bk,PropertyGrid:bl,Dialog:bm});};}());
