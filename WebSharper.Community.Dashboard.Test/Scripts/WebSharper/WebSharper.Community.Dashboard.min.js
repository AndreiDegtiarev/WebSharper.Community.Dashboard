(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Community=b.Community||{};d=c.Dashboard=c.Dashboard||{};e=d.Environment=d.Environment||{};f=e.Role=e.Role||{};g=a.StartupCode$WebSharper_Community_Dashboard$Environment=a.StartupCode$WebSharper_Community_Dashboard$Environment||{};h=d.MessageBus=d.MessageBus||{};i=h.Value=h.Value||{};j=h.Message=h.Message||{};k=h.ListenerInfo=h.ListenerInfo||{};l=h.SystemStatus=h.SystemStatus||{};m=h.AgentMessage=h.AgentMessage||{};n=h.AgentState=h.AgentState||{};o=a.StartupCode$WebSharper_Community_Dashboard$MessageBus=a.StartupCode$WebSharper_Community_Dashboard$MessageBus||{};p=d.InPortData=d.InPortData||{};q=d.InPort=d.InPort||{};r=d.OutPort=d.OutPort||{};s=d.WorkerData=d.WorkerData||{};t=d.Worker=d.Worker||{};u=d.Workers=d.Workers||{};v=d.RuleEntry=d.RuleEntry||{};w=d.RuleChain=d.RuleChain||{};x=d.RuleContainer=d.RuleContainer||{};y=d.WorkerItem=d.WorkerItem||{};z=d.Factory=d.Factory||{};A=d.RulesCellItem=d.RulesCellItem||{};B=d.RulesRowItem=d.RulesRowItem||{};C=d.SelectorGroup=d.SelectorGroup||{};D=d.WindowSelector=d.WindowSelector||{};E=d.WidgetItem=d.WidgetItem||{};F=d.EventsGroupItem=d.EventsGroupItem||{};G=d.WidgetsGroupItem=d.WidgetsGroupItem||{};H=d.RulesGroupItem=d.RulesGroupItem||{};I=d.DshData=d.DshData||{};J=d.RulesEditor=d.RulesEditor||{};K=d.DshHelper=d.DshHelper||{};L=d.Dashboard=d.Dashboard||{};M=d.Events=d.Events||{};N=M.RandomEvent=M.RandomEvent||{};O=M.DatabaseEventContext=M.DatabaseEventContext||{};P=M.DatabaseEvent=M.DatabaseEvent||{};Q=M.OpenWeather=M.OpenWeather||{};R=Q.Forecast=Q.Forecast||{};S=M.OpenWeatherEvent=M.OpenWeatherEvent||{};T=M.ClockEvent=M.ClockEvent||{};U=d.Widgets=d.Widgets||{};V=U.TextBoxWidget=U.TextBoxWidget||{};W=U.ChartWidgetContext=U.ChartWidgetContext||{};X=U.ChartWidget=U.ChartWidget||{};Y=U.ButtonWidget=U.ButtonWidget||{};Z=U.GaugeWidget=U.GaugeWidget||{};_0=d.AppModelLib=d.AppModelLib||{};_1=d.App=d.App||{};_2=a.StartupCode$WebSharper_Community_Dashboard$AppModelLib=a.StartupCode$WebSharper_Community_Dashboard$AppModelLib||{};_3=d.AppDataHelper=d.AppDataHelper||{};_4=d.AppData=d.AppData||{};_5=a.IntelliFactory;_6=_5&&_5.Runtime;_7=b&&b.Operators;_8=c&&c.Panel;_9=_8&&_8.Helper;_=a.Date;$=b&&b.List;ba=b&&b.Concurrency;bb=b&&b.Remoting;bc=bb&&bb.AjaxRemotingProvider;bd=b&&b.Utils;be=b&&b.Control;bf=be&&be.MailboxProcessor;bg=b&&b.Seq;bh=b&&b.UI;bi=bh&&bh.View;bj=bh&&bh.Var;bk=c&&c.PropertyGrid;bl=bk&&bk.Properties;bm=b&&b.MatchFailureException;bn=a.System;bo=bn&&bn.Guid;bp=bh&&bh.Doc;bq=b&&b.Enumerator;br=bh&&bh.Key;bs=bh&&bh.ListModel;bt=b&&b.Unchecked;bu=bh&&bh.AttrModule;bv=b&&b.Option;bw=bh&&bh.AttrProxy;bx=_8&&_8.WrapControls;by=a.console;bz=_8&&_8.PanelContainer;bA=_8&&_8.LayoutManagers;bB=_8&&_8.Panel;bC=_8&&_8.TitleButton;bD=_8&&_8.Dialog;bE=bk&&bk.PropertyGrid;bF=b&&b.Random;bG=a.Math;bH=b&&b.Data;bI=bH&&bH.TxtRuntime;bJ=a.FSharp;bK=bJ&&bJ.Data;bL=bK&&bK.Runtime;bM=bL&&bL.IO;bN=a.JSON;bO=b&&b.Arrays;bP=b&&b.DateUtil;bQ=b&&b.Charting;bR=bQ&&bQ.Renderers;bS=bR&&bR.ChartJs;bT=be&&be.FSharpEvent;bU=bQ&&bQ.Chart;bV=bQ&&bQ.LiveChart;bW=bQ&&bQ.Pervasives;bX=b&&b.FormatException;f.Server={$:1};f.Client={$:0};e.UpdateConfiguration=function(){g.$cctor();return g.UpdateConfiguration;};e.set_UpdateConfiguration=function(bY){g.$cctor();g.UpdateConfiguration=bY;};e.DataDirectory=function(){g.$cctor();return g.DataDirectory;};e.set_DataDirectory=function(bY){g.$cctor();g.DataDirectory=bY;};e.Log=function(){g.$cctor();return g.Log;};e.set_Log=function(bY){g.$cctor();g.Log=bY;};e.Role$1=function(){g.$cctor();return g.Role;};e.set_Role=function(bY){g.$cctor();g.Role=bY;};g.$cctor=function(){g.$cctor=a.ignore;g.Role=f.Server;g.Log=a.ignore;g.DataDirectory="";g.UpdateConfiguration=a.ignore;};i=h.Value=_6.Class({get_trySystem:function(){return this.$==4?{$:1,$0:this.$0}:null;},get_AsSelect:function(){return this.$==3?this.$0:_7.FailWith("MessageBus.Value: unexpected type");},get_AsBoolean:function(){return this.$==2?this.$0:((h.log())("MessageBus.Value: unexpected type"),false);},get_AsString:function(){return this.$==1?this.$0:((h.log())("MessageBus.Value: unexpected type"),"Invalid");},get_AsNumber:function(){return this.$==0?this.$0:((h.log())("MessageBus.Value: unexpected type"),0);}},null,i);j=h.Message=_6.Class({WithTime:function(bY){return j.New(this.Key,bY,this.Value);},WithKey:function(bY){return j.New(bY,this.Time,this.Value);}},null,j);j.Create=function(bY){return j.New(_9.UniqueKey(),_.now(),bY);};j.New=function(bY,bZ,b0){return new j({Key:bY,Time:bZ,Value:b0});};k.Create=function(bY,bZ,b0){return k.New(bY,bZ,b0);};k.New=function(bY,bZ,b0){return{Key:bY,Name:bZ,CacheSize:b0};};l.Running={$:1};l.Inactive={$:0};m.Start={$:5};m.Stop={$:4};n.get_initListeners=function(){return $.ofArray([[k.Create("system","Configuration",1),function(bY){var bZ;bZ=bY.Value.get_trySystem();bZ==null?void 0:(e.UpdateConfiguration())(bZ.$0.$0);},$.T.Empty]]);};n.get_empty=function(){return n.New(l.Inactive,null,n.get_initListeners(),(new _(1,1-1,1)).getTime());};n.New=function(bY,bZ,b0,b1){return{SystemStatus:bY,ServerCallback:bZ,Listeners:b0,LastConfigurationTime:b1};};h.RunServerRequests=function(){var bY;ba.Start((bY=null,ba.Delay(function(){return ba.While(function(){return true;},ba.Delay(function(){return ba.Bind(ba.Sleep(2*1000),function(){return ba.Bind(h.Agent().PostAndAsyncReply(function(bZ){return{$:8,$0:bZ};},null),function(bZ){return ba.TryWith(ba.Delay(function(){return ba.Bind((new bc.New()).Async("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.MessageBus.GetMessages:1403730234",[bZ[0],bZ[1]]),function(b0){var b1;$.iter(function(b2){var b3;b3=h.Agent();b3.mailbox.AddLast({$:1,$0:b2});b3.resume();},b0);return b0.get_Length()>0?($.iter(function(b2){var b3;b3=(((_6.Curried3(function(b4,b5,b6){return b4(bd.toSafe(b5)+" "+bd.toSafe(b6));}))(a.id))(b2.Key))(a.String(b2.Time));(h.log())(b3);},b0),b1=(function(b2){return function(b3){return b2("Values from server requested messages received:"+a.String(b3));};}(a.id))(b0.get_Length()),(h.log())(b1),ba.Zero()):ba.Zero();});}),function(){return ba.Zero();});});});}));})),null);};h.Agent=function(){o.$cctor();return o.Agent;};h.CreateMessage=function(bY){return j.New(_9.UniqueKey(),_.now(),bY);};h.log=function(){o.$cctor();return o.log;};o.$cctor=function(){o.$cctor=a.ignore;o.log=e.Log();o.Agent=bf.Start(function(bY){function bZ(b4,b5){return bg.fold(function(b6,b7){var b8;return(b8=b7.Time-b4,b8/1000)>0.01?new $.T({$:1,$0:b7,$1:b6}):b6;},$.T.Empty,b5);}function b0(b4,b5){return b4<b5.get_Length()?($.splitAt(b4,b5))[0]:b5;}function b1(b4,b5,b6){return b4===1?$.ofArray([b6]):b0(b4,new $.T({$:1,$0:b6,$1:b5}));}function b2(b4,b5){function b6(b7,b8,b9){var b_,b$;b_=a.Array.prototype.slice.call(arguments);if(b7.Key===b4.Key){try{b8(b4);}catch(ca){b$=(function(cb){return function(cc){return cb("Fails send message. It might be that receiver doesn't expect message of this type: "+bd.toSafe(cc));};}(a.id))(b7.Name);(h.log())(b$);}return[b7,b8,b1(b7.CacheSize,b9,b4)];}else return b_;}return $.map(function(b7){return b6(b7[0],b7[1],b7[2]);},b5);}function b3(b4){var b5;b5=null;return ba.Delay(function(){return ba.Bind(bY.Receive(null),function(b6){var b7,b8,b9,b_,b$,ca,cb;function cc(cg,ch){function ci(cj,ck,cl){return bZ(cg,cl);}return $.sortBy(function(cj){return cj.Time;},bg.fold(function(cj,ck){return!$.contains(ck,cj)?new $.T({$:1,$0:ck,$1:cj}):cj;},$.T.Empty,$.concat($.map(function(cj){return ci(cj[0],cj[1],cj[2]);},ch))));}function cd(cg,ch,ci){return cg.Key==="system";}function ce(cg,ch,ci){return cg.Key!=="system";}function cf(cg,ch,ci){return ci.$==0?(new _(1,1-1,1)).getTime():$.maxBy(function(cj){return cj.Time;},ci).Time;}return b6.$==5?b3(n.New(l.Running,b4.ServerCallback,b4.Listeners,b4.LastConfigurationTime)):b6.$==6?(b6.$0(b4.SystemStatus),b3(b4)):b6.$==2?(b7=b6.$0[0],(b8=(((_6.Curried3(function(cg,ch,ci){return cg("RegisterListener:"+bd.toSafe(ch)+" "+bd.toSafe(ci));}))(a.id))(b7.Name))(b7.Key),(h.log())(b8),b3(n.New(b4.SystemStatus,b4.ServerCallback,new $.T({$:1,$0:[b7,b6.$0[1],$.T.Empty],$1:b4.Listeners}),b4.LastConfigurationTime)))):b6.$==3?b3(n.New(b4.SystemStatus,{$:1,$0:b6.$0},b4.Listeners,b4.LastConfigurationTime)):b6.$==7?(b6.$0[2]($.append(cc(b6.$0[0],$.filter(function(cg){return cd(cg[0],cg[1],cg[2]);},b4.Listeners)),cc(b6.$0[1],$.filter(function(cg){return ce(cg[0],cg[1],cg[2]);},b4.Listeners)))),b3(b4)):b6.$==8?(b9=$.map(function(cg){return cf(cg[0],cg[1],cg[2]);},b4.Listeners),(b6.$0([b4.LastConfigurationTime,b9.$==0?(new _(1,1-1,1)).getTime():$.max(b9)]),b3(b4))):b6.$==1?(b_=b6.$0,(b$=b_.Value.get_trySystem(),b$==null?b3(n.New(b4.SystemStatus,b4.ServerCallback,b2(b_,b4.Listeners),b4.LastConfigurationTime)):ba.Combine(((e.UpdateConfiguration())(b$.$0.$0),ba.Zero()),ba.Delay(function(){return b3(n.New(b4.SystemStatus,b4.ServerCallback,b4.Listeners,b_.Time));})))):b6.$==0?(ca=b6.$0,(cb=b4.ServerCallback,cb==null?void 0:cb.$0(ca),b3(n.New(b4.SystemStatus,b4.ServerCallback,b2(ca,b4.Listeners),b4.LastConfigurationTime)))):b3(n.New(l.Inactive,b4.ServerCallback,n.get_initListeners(),b4.LastConfigurationTime));});});}return b3(n.get_empty());},null);};p=d.InPortData=_6.Class({WithCacheSize:function(bY){return p.New(this.Key,this.Name,this.Value,bY);}},null,p);p.CreateSelect=function(bY,bZ){return p.Create(bY,new i({$:3,$0:bZ}));};p.CreateBoolean=function(bY,bZ){return p.Create(bY,new i({$:2,$0:bZ}));};p.CreateString=function(bY,bZ){return p.Create(bY,new i({$:1,$0:bZ}));};p.CreateNumber=function(bY,bZ){return p.Create(bY,new i({$:0,$0:bZ}));};p.Create=function(bY,bZ){var b0;b0=h.CreateMessage(bZ);return p.New(b0.Key,bY,b0.WithTime((new _(1,1-1,1)).getTime()),1);};p.New=function(bY,bZ,b0,b1){return new p({Key:bY,Name:bZ,Value:b0,CacheSize:b1});};q=d.InPort=_6.Class({get_SelectView:function(){return bi.Map(function(bY){return bY.Value.get_AsSelect();},this.PortValue.get_View());},get_Select:function(){return this.PortValue.Get().Value.get_AsSelect();},get_BooleanView:function(){return bi.Map(function(bY){return bY.Value.get_AsBoolean();},this.PortValue.get_View());},get_Boolean:function(){return this.PortValue.Get().Value.get_AsBoolean();},get_StringView:function(){return bi.Map(function(bY){return bY.Value.get_AsString();},this.PortValue.get_View());},get_String:function(){return this.PortValue.Get().Value.get_AsString();},get_NumberView:function(){return bi.Map(function(bY){return bY.Value.get_AsNumber();},this.PortValue.get_View());},get_Number:function(){return this.PortValue.Get().Value.get_AsNumber();},Receive:function(bY){this.PortValue.Set(bY);},get_Property:function(){var bY,bZ,b0,b1,b2,b3,b4;b3=this;b4=this.PortValue.Get().Value;if(b4.$==0){bY=bj.Create$1(this.get_Number());bi.Sink(function(b5){var b6;b3.PortValue.Set((b6=b3.PortValue.Get(),j.New(b6.Key,b6.Time,new i({$:0,$0:b5}))));},bY.get_View());return bl["double"](this.Data.Name,bY);}else if(b4.$==1){bZ=bj.Create$1(this.get_String());bi.Sink(function(b5){var b6;b3.PortValue.Set((b6=b3.PortValue.Get(),j.New(b6.Key,b6.Time,new i({$:1,$0:b5}))));},bZ.get_View());return bl.string(this.Data.Name,bZ);}else if(b4.$==2){b0=bj.Create$1(this.get_Boolean());bi.Sink(function(b5){var b6;b3.PortValue.Set((b6=b3.PortValue.Get(),j.New(b6.Key,b6.Time,new i({$:2,$0:b5}))));},b0.get_View());return bl.check(this.Data.Name,b0);}else if(b4.$==3){b1=b4.$0[1];b2=bj.Create$1(b1.get_Item(b4.$0[0]));bi.Sink(function(b5){var b6;b3.PortValue.Set((b6=b3.PortValue.Get(),j.New(b6.Key,b6.Time,new i({$:3,$0:[bg.findIndex(function(b7){return b7===b5;},b1),b1]}))));},b2.get_View());return bl.select(this.Data.Name,a.id,b1,b2);}else throw new bm.New("Port.fs",38,30);},get_Key:function(){return this.Data.Key;},get_Name:function(){return this.Data.Name;}},null,q);q.Clone=function(bY){var bZ,b0;return q.New((bZ=bY.Data,p.New((b0=bo.NewGuid(),a.String(b0)),bZ.Name,bZ.Value,bZ.CacheSize)),bj.Create$1(bY.PortValue.Get()));};q.ToData=function(bY){var bZ;bZ=bY.Data;return p.New(bZ.Key,bZ.Name,bY.PortValue.Get(),bZ.CacheSize);};q.FromData=function(bY){return q.New(bY,bj.Create$1(bY.Value));};q.New=function(bY,bZ){return new q({Data:bY,PortValue:bZ});};r=d.OutPort=_6.Class({Trigger:function(bY){var bZ,b0;bZ={$:0,$0:h.CreateMessage(bY).WithKey(this.Key)};b0=h.Agent();b0.mailbox.AddLast(bZ);b0.resume();}},null,r);r.Clone=function(bY){return r.New(_9.UniqueKey(),bY.Name);};r.Create=function(bY){return r.New(_9.UniqueKey(),bY);};r.New=function(bY,bZ){return new r({Key:bY,Name:bZ});};s.Create=function(bY,bZ,b0){return s.New(bY,bZ,b0);};s.New=function(bY,bZ,b0){return{WorkerName:bY,InPorts:bZ,OutPorts:b0};};t=d.Worker=_6.Class({get_Properties:function(){return new $.T({$:1,$0:bl.group(""),$1:new $.T({$:1,$0:bl.string("Name",this.Name),$1:$.map(function(bY){return bY.get_Property();},this.InPorts)})});},get_Render:function(){var bY;bY=this.Data.WebSharper_Community_Dashboard_IWorkerData$get_Render();return bY==null?bp.Empty():bY.$0(this);},get_Clone:function(){return t.New(_9.UniqueKey(),bj.Create$1(this.Name.Get()),$.map(q.Clone,this.InPorts),$.map(r.Clone,this.OutPorts),this.Data,bj.Create$1(null));},get_ToData:function(){return s.New(this.Name.Get(),$.map(q.ToData,this.InPorts),this.OutPorts);},StartRunner:function(){var bY;bY=this.Data.WebSharper_Community_Dashboard_IWorkerData$get_Run();bY==null?void 0:this.RunnerContext.Set(bY.$0(this));},WithKey:function(bY){return t.New(bY,this.Name,this.InPorts,this.OutPorts,this.Data,this.RunnerContext);}},null,t);t.Create=function(bY){return t.New(_9.UniqueKey(),bj.Create$1(bY.WebSharper_Community_Dashboard_IWorkerData$get_Data().WorkerName),$.map(q.FromData,bY.WebSharper_Community_Dashboard_IWorkerData$get_Data().InPorts),bY.WebSharper_Community_Dashboard_IWorkerData$get_Data().OutPorts,bY,bj.Create$1(null));};t.New=function(bY,bZ,b0,b1,b2,b3){return new t({Key:bY,Name:bZ,InPorts:b0,OutPorts:b1,Data:b2,RunnerContext:b3});};u.allInPorts=function(bY){return u.allPorts(bY,function(bZ){return bZ.InPorts;});};u.allOutPorts=function(bY){return u.allPorts(bY,function(bZ){return bZ.OutPorts;});};u.allPorts=function(bY,bZ){return $.concat($.map(bZ,bY));};v.New=function(bY,bZ,b0){return{InPortKey:bY,OutPortKey:bZ,WorkerKey:b0};};w.New=function(bY){return{RuleChain:bY};};x=d.RuleContainer=_6.Class({Reconnect:function(bY){var bZ,b0,b1;bZ=e.Log();b0=u.allOutPorts(bY);b1=u.allInPorts(bY);$.iter(function(b2){var b3,b4,b5;b3=$.ofSeq(b2.RuleChain);b4=$.ofSeq(_7.range(1,b3.get_Length()-1));b5=bq.Get(b4);try{while(b5.MoveNext())(function(){var b6,b7,b8,b9,b_,b$,ca,cb;b6=b5.Current();b7=b3.get_Item(b6-1);b8=b3.get_Item(b6);b9=bg.tryFind(function(cc){return cc.Key===b7.OutPortKey;},b0),b9==null?null:{$:1,$0:(b_=b9.$0,(b$=bg.tryFind(function(cc){return cc.Data.Key===b8.InPortKey;},b1),b$==null?null:{$:1,$0:(ca=b$.$0,(bZ("Found inPort"),ca.PortValue.Get().Key!==ca.Data.Key?ca.PortValue.Set(ca.PortValue.Get().WithKey(ca.Data.Key)):void 0,cb=h.Agent(),cb.mailbox.AddLast({$:2,$0:[k.Create(b_.Key,b_.Name+"->"+ca.get_Name(),ca.Data.CacheSize),function(cc){ca.Receive(cc);}]}),cb.resume()))}))};}());}finally{if("Dispose"in b5)b5.Dispose();}},$.ofSeq(this.RuleContainer));}},null,x);x.New=function(bY){return new x({RuleContainer:bY});};y.Create=function(bY){return y.New(br.Fresh(),bY);};y.New=function(bY,bZ){return{Key:bY,Worker:bZ};};z=d.Factory=_6.Class({RegisterEvent:function(bY){this.EventItems.Append(y.Create(bY));},RegisterWidget:function(bY){this.WidgetItems.Append(y.Create(bY));}},null,z);z.get_Create=function(){return z.New(bs.Create(function(bY){return bY.Key;},$.T.Empty),bs.Create(function(bY){return bY.Key;},$.T.Empty));};z.New=function(bY,bZ){return new z({EventItems:bY,WidgetItems:bZ});};A=d.RulesCellItem=_6.Class({Render:function(bY,bZ){var b0,b1,b2,b3,b4;b0=this;bi.Sink(function(b5){var b6,b7,b8,b9,b_;if(b5==null);else{b6=b5.$0;b7=b0.OptInPort.Get();b7==null?b0.OptInPort.Set($.tryHead(b6.Worker.InPorts)):(b8=b7.$0,!$.exists(function(b$){return bt.Equals(b$,b8);},b6.Worker.InPorts)?b0.OptInPort.Set($.tryHead(b6.Worker.InPorts)):void 0);b9=b0.OptOutPort.Get();b9==null?b0.OptOutPort.Set($.tryHead(b6.Worker.OutPorts)):(b_=b9.$0,!$.exists(function(b$){return bt.Equals(b$,b_);},b6.Worker.OutPorts)?b0.OptOutPort.Set($.tryHead(b6.Worker.OutPorts)):void 0);bZ();}},this.OptWorker.get_View());bi.Sink(function(){bZ();},this.OptInPort.get_View());bi.Sink(function(){bZ();},this.OptOutPort.get_View());b1=(b2=bi.Map(function(b5){var b6;return b5==null?$.ofArray([null]):(b6=$.map(function(b7){return{$:1,$0:b7};},b5.$0.Worker.InPorts),b6.get_Length()>0?b6:$.ofArray([null]));},this.OptWorker.get_View()),(b3=bi.Map(function(b5){var b6;return b5==null?$.ofArray([null]):(b6=$.map(function(b7){return{$:1,$0:b7};},b5.$0.Worker.OutPorts),b6.get_Length()>0?b6:$.ofArray([null]));},this.OptWorker.get_View()),(b4=bi.Map(function(b5){return new $.T({$:1,$0:null,$1:$.map(function(b6){return{$:1,$0:b6};},$.ofSeq(b5))});},bY.v),bp.Element("table",[],[bp.Element("tr",[],[bp.Element("td",[],[bp.SelectDyn([bu.Class("form-control")],function(b5){return bv.fold(function(b6,b7){return b7.get_Name();}," ",b5);},b2,this.OptInPort)]),bp.Element("td",[],[bp.SelectDyn([bu.Class("form-control")],function(b5){return bv.fold(function(b6,b7){return b7.Worker.Name.Get();}," ",b5);},b4,this.OptWorker)]),bp.Element("td",[],[bp.SelectDyn([bu.Class("form-control")],function(b5){return bv.fold(function(b6,b7){return b7.Name;}," ",b5);},b3,this.OptOutPort)])])]))));return bp.Element("td",[bu.Class("td DshEditorCell")],[bp.Element("div",[bu.Class("div DshEditorCell")],[bp.Element("table",[],[bp.Element("tr",[],[bp.Element("td",[],[b1])])])])]);}},null,A);A.get_Create=function(){return A.New(br.Fresh(),bj.Create$1(null),bj.Create$1(null),bj.Create$1(null));};A.New=function(bY,bZ,b0,b1){return new A({Key:bY,OptInPort:bZ,OptWorker:b0,OptOutPort:b1});};B=d.RulesRowItem=_6.Class({Render:function(bY,bZ){var b0;b0=this;return bp.Element("tr",[],[bp.ConvertBy(function(b1){return b1.Key;},function(b1){return b1.Render(bY,bZ);},this.CellItems.v),_9.IconNormal("add",function(){b0.CellItems.Append(A.get_Create());})]);}},null,B);B.Create=function(bY){return B.New(br.Fresh(),bs.Create(function(bZ){return bZ.Key;},bY));};B.New=function(bY,bZ){return new B({Key:bY,CellItems:bZ});};C=d.SelectorGroup=_6.Class({RenderMenu:function(bY,bZ,b0){var b1,b2,b3,b4,b5,b6;function b7(b8){return $.ofArray([_9.IconSmall("keyboard_arrow_down",function(){(b2(true))(b8);(b1.ItemOnMove(b8))({$:1});}),_9.IconSmall("keyboard_arrow_up",function(){(b2(false))(b8);(b1.ItemOnMove(b8))({$:0});}),_9.IconSmall("clear",function(){b1.SelectorItems.Remove(b8);b1.ItemOnDelete(b8);})]);}b1=this;b2=(b3=this.SelectorItems,(_6.Curried3(_9.MoveItemInModelList))(b3));b4=(b5=this.ItemCreatator,b5==null?bp.Element("tr",[],[]):(b6=b5.$0,bp.Element("tr",[],[bp.Element("td",[],[bp.Element("div",[bu.Style("margin-left","20px")],[_9.IconSmall("add",function(){var b8;b8=b6();b1.ItemOnCreated(b8);b1.SelectorItems.Append(b8);})])])])));return bp.Element("table",[],[bp.ConvertBy(function(b8){return b8.WebSharper_Community_Dashboard_ISelectorItem$get_Key();},function(b8){var b9,b_,b$,ca;b9=bi.Map(function(cb){return bY+cb;},b8.WebSharper_Community_Dashboard_ISelectorItem$get_Name().get_View());return bp.Element("tr",[],[bp.Element("td",[bu.DynamicStyle("Color",bi.Map(function(cb){return cb==null?"#7D4600":bt.Equals(cb.$0.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),b8.WebSharper_Community_Dashboard_ISelectorItem$get_Key())?"#FB8C00":"#7D4600";},bZ.get_View()))],[(b_=bp.Element("div",[bu.Style("margin-left","10px"),bu.Style("margin-right","5px"),bu.Style("cursor","pointer"),bw.HandlerImpl("click",function(){return function(){b1.ItemOnSelected(b8);return bZ.Set({$:1,$0:b8});};})],[bp.TextView(b9)]),(b0?(b$=b7(b8),(ca=_8.WrapControlsAligment.Horizontal,function(cb){return bx.Render(b$,ca,cb);})):a.id)(b_))])]);},this.SelectorItems.v),b4]);},Render:function(bY){return bp.ConvertBy(function(bZ){return bZ.WebSharper_Community_Dashboard_ISelectorItem$get_Key();},function(bZ){return bp.Element("div",[bu.DynamicStyle("display",bi.Map(function(b0){return b0==null?"none":bt.Equals(b0.$0,bZ)?"block":"none";},bY.get_View()))],[bZ.WebSharper_Community_Dashboard_ISelectorItem$get_Render()]);},this.SelectorItems.v);}},null,C);C.RenderMenu$87$91=function(bY,bZ,b0){return function(){return function(){bY.ItemOnSelected(bZ);return b0.Set({$:1,$0:bZ});};};};C.Create=function(bY,bZ,b0,b1,b2,b3,b4){var b5;b5=bs.Create(function(b6){return b6.WebSharper_Community_Dashboard_ISelectorItem$get_Key();},bZ);return C.New(br.Fresh(),bj.Create$1(bY),b5,b0,b1,b2,b3,b4);};C.New=function(bY,bZ,b0,b1,b2,b3,b4,b5){return new C({Key:bY,Name:bZ,SelectorItems:b0,ItemCreatator:b1,ItemOnCreated:b2,ItemOnSelected:b3,ItemOnDelete:b4,ItemOnMove:b5});};D=d.WindowSelector=_6.Class({get_RenderMenu:function(){var bY;bY=this;return this.SelectorGroups.get_Length()===1?$.head($.ofSeq(this.SelectorGroups)).RenderMenu("",this.OptSelectedItem,this.IsWithControls):bp.Element("div",[],[bp.ConvertBy(function(bZ){return bZ.Key;},function(bZ){return bp.Element("div",[],[bp.Element("div",[bu.Style("cursor","pointer"),bw.HandlerImpl("click",function(){return function(){return bY.GroupOnClick(bZ);};})],[bp.TextView(bZ.Name.get_View())]),bZ.RenderMenu("    ",bY.OptSelectedItem,bY.IsWithControls)]);},this.SelectorGroups.v)]);},get_Render:function(){var bY;bY=this;return bp.Element("div",[],[bp.ConvertBy(function(bZ){return bZ.Key;},function(bZ){return bZ.Render(bY.OptSelectedItem);},this.SelectorGroups.v)]);},GroupByIndex:function(bY){return bg.nth(bY,$.ofSeq(this.SelectorGroups));},get_SelectedIndex:function(){var bY;bY=this;return bg.findIndex(function(bZ){return bt.Equals(bZ.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bY.get_SelectedItem().WebSharper_Community_Dashboard_ISelectorItem$get_Key());},$.concat($.map(function(bZ){return $.ofSeq(bZ.SelectorItems);},$.ofSeq(this.SelectorGroups))));},get_SelectedIndexInGroup:function(){var bY;bY=this;return bg.findIndex(function(bZ){return bt.Equals(bZ.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bY.get_SelectedItem().WebSharper_Community_Dashboard_ISelectorItem$get_Key());},$.ofSeq(this.get_SelectedGroup().SelectorItems));},get_SelectedGroupIndex:function(){var bY;bY=this;return bg.findIndex(function(bZ){return bt.Equals(bZ.Key,bY.get_SelectedGroup().Key);},$.ofSeq(this.SelectorGroups));},get_SelectedGroup:function(){return this.GroupFromItem(this.get_SelectedItem());},GroupFromItem:function(bY){return bg.find(function(bZ){return $.exists(function(b0){return bt.Equals(b0.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bY.WebSharper_Community_Dashboard_ISelectorItem$get_Key());},$.ofSeq(bZ.SelectorItems));},$.ofSeq(this.SelectorGroups));},AppenGroup:function(bY,bZ,b0){var b1;b1=this.SelectorGroups.get_Length();this.SelectorGroups.Append(C.Create(bY,bZ,b0,this.ItemOnCreated(b1),this.ItemOnSelected,this.ItemOnDeleted(b1),this.ItemOnMove(b1)));},get_SelectedItem:function(){var bY;bY=this.OptSelectedItem.Get();return bY==null?_7.FailWith("Something really wrong with WindowSelector"):bY.$0;},ClearGroups:function(){this.OptSelectedItem.Set(null);$.iter(function(bY){bY.SelectorItems.Clear();},$.ofSeq(this.SelectorGroups));},WithControls:function(bY){return D.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,bY);},WithItemOnMove:function(bY){return D.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,bY,this.IsWithControls);},WithItemOnDeleted:function(bY){return D.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,bY,this.ItemOnMove,this.IsWithControls);},WithItemOnSelected:function(bY){return D.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,bY,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);},WithGroupOnClick:function(bY){return D.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,bY,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);},WithItemOnCreated:function(bY){return D.New(this.OptSelectedItem,this.SelectorGroups,bY,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);}},null,D);D.get_RenderMenu$161$62=function(bY,bZ){return function(){return function(){return bY.GroupOnClick(bZ);};};};D.get_Create=function(){var bY;bY=bs.Create(function(bZ){return bZ.Key;},$.T.Empty);return D.New(bj.Create$1(null),bY,function(){return function(){return null;};},a.ignore,a.ignore,function(){return function(){return null;};},_6.Curried3(function(bZ,b0,b1){return null;}),false);};D.New=function(bY,bZ,b0,b1,b2,b3,b4,b5){return new D({OptSelectedItem:bY,SelectorGroups:bZ,ItemOnCreated:b0,GroupOnClick:b1,ItemOnSelected:b2,ItemOnDeleted:b3,ItemOnMove:b4,IsWithControls:b5});};E.Create=function(bY,bZ){return E.New(br.Fresh(),bY,bZ);};E.New=function(bY,bZ,b0){return{Key:bY,Panel:bZ,Widget:b0};};F=d.EventsGroupItem=_6.Class({get_Render:function(){var bY,bZ,b0;function b1(b2){return $.ofArray([_9.IconSmall("keyboard_arrow_down",function(){(bZ(true))(b2);}),_9.IconSmall("keyboard_arrow_up",function(){(bZ(false))(b2);}),_9.IconSmall("clear",function(){bY.EventItems.Remove(b2);})]);}bY=this;bZ=(b0=this.EventItems,(_6.Curried3(_9.MoveItemInModelList))(b0));return bp.Element("table",[],[bp.ConvertBy(function(b2){return b2.Key;},function(b2){var b3;return bp.Element("tr",[],[(b3=bp.Element("div",_9.AttrsClick(function(){bY.PropertyGrid.Edit(b2.Worker.get_Properties());}),[bp.TextView(b2.Worker.Name.get_View())]),bx.Render(b1(b2),_8.WrapControlsAligment.Horizontal,b3))]);},this.EventItems.v)]);},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,F);F.Create=function(bY,bZ){return F.New(br.Fresh(),bj.Create$1(bY),bs.Create(function(b0){return b0.Key;},$.T.Empty),bZ);};F.New=function(bY,bZ,b0,b1){return new F({Key:bY,Name:bZ,EventItems:b0,PropertyGrid:b1});};G=d.WidgetsGroupItem=_6.Class({get_Render:function(){return this.PanelContainer.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,G);G.Create=function(bY,bZ){return G.New(br.Fresh(),bj.Create$1(bY),bs.Create(function(b0){return b0.Key;},$.T.Empty),bZ);};G.New=function(bY,bZ,b0,b1){return new G({Key:bY,Name:bZ,WidgetItems:b0,PanelContainer:b1});};H=d.RulesGroupItem=_6.Class({Equals:function(bY){return bY instanceof H&&bt.Equals(this.Key,bY.Key);},get_Render:function(){return this.Renderer(this.RulesRowItems);},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,H);H.Create=function(bY,bZ){return H.New(br.Fresh(),bj.Create$1(bY),bs.Create(function(b0){return b0.Key;},$.T.Empty),bZ);};H.New=function(bY,bZ,b0,b1){return new H({Key:bY,Name:bZ,RulesRowItems:b0,Renderer:b1});};I=d.DshData=_6.Class({RegisterWidget:function(bY,bZ,b0,b1){var b2;b2=b1.WithKey(bY);bZ.WidgetItems.Append(E.Create(b0,b2));this.WorkItems.Append(y.Create(b2));},RegisterEvent:function(bY,bZ,b0){var b1;b1=y.Create(b0.WithKey(bY));bZ.EventItems.Append(b1);this.WorkItems.Append(b1);},get_Clear:function(){this.WorkItems.Clear();this.WidgetGroups.Clear();this.EventGroups.Clear();this.RulesGroups.Clear();}},null,I);I.get_Create=function(){return I.New(bs.Create(function(bY){return bY.Key;},$.T.Empty),bs.Create(function(bY){return bY.Key;},$.T.Empty),bs.Create(function(bY){return bY.Key;},$.T.Empty),bs.Create(function(bY){return bY.Key;},$.T.Empty));};I.New=function(bY,bZ,b0,b1){return new I({WorkItems:bY,WidgetGroups:bZ,EventGroups:b0,RulesGroups:b1});};J.Render=function(bY,bZ){function b0(b3,b4){return _9.MoveItemInModelList(bZ,b3,b4);}function b1(b3){return $.ofArray([_9.IconSmall("keyboard_arrow_down",function(){b0(true,b3);}),_9.IconSmall("keyboard_arrow_up",function(){b0(false,b3);}),_9.IconSmall("clear",function(){bZ.Remove(b3);})]);}function b2(){var b3;ba.Start((b3=null,ba.Delay(function(){return ba.Bind(h.Agent().PostAndAsyncReply(function(b4){return{$:6,$0:b4};},null),function(b4){var b5,b6,b7;return b4.$==1?(b5=h.Agent(),b5.mailbox.AddLast(m.Stop),b5.resume(),b6=$.map(function(b8){return b8.Worker;},$.ofSeq(bY.WorkItems)),J.CopyToRules(bZ).Reconnect(b6),b7=h.Agent(),b7.mailbox.AddLast(m.Start),b7.resume(),ba.Zero()):ba.Zero();});})),null);}return bp.Element("table",[],[bp.ConvertBy(function(b3){return b3.Key;},function(b3){var b4;return bp.Element("tr",[],[(b4=b3.Render(bY.WorkItems,function(){b2();}),bx.Render(b1(b3),_8.WrapControlsAligment.Horizontal,b4))]);},bZ.v)]);};J.Restore=function(bY,bZ,b0){var b1,b2,b3;bZ.Clear();b1=$.map(function(b4){return b4.Worker;},$.ofSeq(bY.WorkItems));b2=u.allOutPorts(b1);b3=u.allInPorts(b1);$.iter(function(b4){var b5;b5=B.Create([]);$.iter(function(b6){var b7;b7=A.get_Create();b7.OptWorker.Set(bg.tryFind(function(b8){return b8.Worker.Key===b6.WorkerKey;},$.ofSeq(bY.WorkItems)));b7.OptInPort.Set(bg.tryFind(function(b8){return b8.get_Key()===b6.InPortKey;},b3));b7.OptOutPort.Set(bg.tryFind(function(b8){return b8.Key===b6.OutPortKey;},b2));b5.CellItems.Append(b7);},b4.RuleChain);bZ.Append(b5);},b0.RuleContainer);};J.CopyToRules=function(bY){return x.New($.map(function(bZ){return w.New($.map(function(b0){var b1,b2,b3;return v.New((b1=b0.OptInPort.Get(),b1==null?"":b1.$0.get_Key()),(b2=b0.OptOutPort.Get(),b2==null?"":b2.$0.Key),(b3=b0.OptWorker.Get(),b3==null?"":b3.$0.Worker.Key));},$.ofSeq(bZ.CellItems)));},$.ofSeq(bY)));};K.RulesGroupCreator=function(bY,bZ){var b0;b0=H.Create("rules"+a.String($.length($.ofSeq(bY.RulesGroups))+1),function(b1){return J.Render(bY,b1);});bY.RulesGroups.Append(b0);return b0;};K.EventsGroupCreator=function(bY,bZ,b0){var b1;b1=F.Create("event"+a.String($.length($.ofSeq(bY.EventGroups))+1),bZ);bY.EventGroups.Append(b1);return b1;};K.PanelGroupCreator=function(bY,bZ,b0){var b1;b1=G.Create("panel"+a.String($.length($.ofSeq(bY.WidgetGroups))+1),bZ());bY.WidgetGroups.Append(b1);return b1;};L=d.Dashboard=_6.Class({Render:function(bY){var bZ;bZ=this;return bp.EmbedView(bi.Map(function(b0){return b0.$==1?bp.Element("div",[],[bp.Element("table",[bu.Style("White-space","nowrap")],[bp.Element("tr",[],[bp.Element("td",[bu.Style("vertical-align","top")],[bp.Element("table",[],bg.concat([$.ofArray([bp.Element("tr",[],[bp.Element("td",[],[_9.IconNormal("dehaze",function(){bZ.PanelTitleVisibility.Set(false);bZ.Mode.Set({$:0});})])])]),$.ofArray([bZ.EditorSelectorEdit.get_RenderMenu()]),$.ofArray([bp.Element("tr",[],[bp.Element("td",[],[])]),bp.Element("tr",[],[bp.Element("td",[],[bZ.PropertyGrid.get_Render()])])])]))]),bp.Element("td",[bu.Style("vertical-align","top")],[bY,_9.IconNormal("add",function(){var b1,b2,b3,b4,b5;b1=bZ.EditorSelectorEdit.get_SelectedGroupIndex();b1===1?(b2=$.ofSeq(bZ.Factory.EventItems),b3=bj.Create$1($.head(b2)),bZ.Dialog.ShowDialog("Select source",bp.Element("div",[],[bp.Select([bu.Class("form-control")],function(b6){return b6.Worker.Name.Get();},b2,b3)]),function(){var b6,b7,b8;b6=b3.Get().Worker.get_Clone();b6.StartRunner();b7=(b8=$.ofSeq(bZ.Data.EventGroups),bg.nth(bZ.EditorSelectorEdit.get_SelectedIndexInGroup(),b8));bZ.Data.RegisterEvent(_9.UniqueKey(),b7,b6);})):b1===0?bZ.CreatePanel((b4=$.ofSeq(bZ.Data.WidgetGroups),bg.nth(bZ.EditorSelectorEdit.get_SelectedIndexInGroup(),b4)),"Panel",null).IsWithInitialAutoLayout.Set(true):b1===2?(b5=$.ofSeq(bZ.Data.RulesGroups),bg.nth(bZ.EditorSelectorEdit.get_SelectedIndexInGroup(),b5)).RulesRowItems.Append(B.Create([A.get_Create(),A.get_Create()])):void 0;}),bZ.EditorSelectorEdit.get_Render()])])]),bp.Element("div",[],[bZ.Dialog.get_Render()])]):bp.Element("div",[],[bp.Element("table",[bu.Style("White-space","nowrap")],[bp.Element("tr",[],[bp.Element("td",[bu.Style("vertical-align","top")],[_9.IconNormal("dehaze",function(){bZ.PanelTitleVisibility.Set(true);bZ.Mode.Set({$:1});}),bZ.EditorSelectorRun.get_RenderMenu()]),bp.Element("td",[],[bZ.EditorSelectorRun.get_Render()])])])]);},this.Mode.get_View()));},Restore:function(bY,bZ,b0,b1){var b2,b3,b4,b5,b6,b7,b8,b9;function b_(b$,ca){ca.Reconnect(b8);}b2=this;b3=h.Agent();b3.mailbox.AddLast(m.Stop);b3.resume();this.EditorSelectorRun.ClearGroups();this.EditorSelectorEdit.ClearGroups();this.Data.get_Clear();this.PropertyGrid.Edit($.T.Empty);b4=this.EditorSelectorRun.GroupByIndex(0);b5=this.EditorSelectorEdit.GroupByIndex(0);b6=this.EditorSelectorEdit.GroupByIndex(1);b7=this.EditorSelectorEdit.GroupByIndex(2);$.iteri(function(b$,ca){var cb,cc;function cd(ce,cf,cg){b2.RegisterWidget(ce,cc,cf,bg.find(function(ch){return ch.Key===cf;},$.ofSeq(cc.PanelContainer.PanelItems)).Children,(cg.StartRunner(),cg));}cb=K.PanelGroupCreator(b2.Data,bY,null);cb.WebSharper_Community_Dashboard_ISelectorItem$get_Name().Set(ca[0]);b5.SelectorItems.Append(cb);b4.SelectorItems.Append(cb);cc=bg.nth(b$,$.ofSeq(b2.Data.WidgetGroups));$.iter(function(ce){var cf;cf=b2.CreatePanel(cc,"Panel",{$:1,$0:ce.Key});cf.Left.Set(ce.Left);cf.Top.Set(ce.Top);},ca[1]);return $.iter(function(ce){return cd(ce[0],ce[1],ce[2]);},ca[2]);},b0);by.log("Widgets restored");$.iteri(function(b$,ca){var cb,cc;function cd(ce,cf){b2.Data.RegisterEvent(ce,cc,cf);}cb=K.EventsGroupCreator(b2.Data,b2.PropertyGrid,null);cb.WebSharper_Community_Dashboard_ISelectorItem$get_Name().Set(ca[0]);b6.SelectorItems.Append(cb);cc=bg.nth(b$,$.ofSeq(b2.Data.EventGroups));return $.iter(function(ce){return cd(ce[0],ce[1]);},ca[1]);},bZ);by.log("Events restored");$.iteri(function(b$,ca){var cb;cb=K.RulesGroupCreator(b2.Data,null);cb.WebSharper_Community_Dashboard_ISelectorItem$get_Name().Set(ca[0]);b7.SelectorItems.Append(cb);return J.Restore(b2.Data,bg.nth(b$,$.ofSeq(b2.Data.RulesGroups)).RulesRowItems,ca[1]);},b1);this.Data.WidgetGroups.get_Length()>0?(this.EditorSelectorEdit.OptSelectedItem.Set({$:1,$0:$.head($.ofSeq(this.EditorSelectorEdit.GroupByIndex(0).SelectorItems))}),this.EditorSelectorRun.OptSelectedItem.Set({$:1,$0:$.head($.ofSeq(this.EditorSelectorRun.GroupByIndex(0).SelectorItems))})):(this.EditorSelectorEdit.OptSelectedItem.Set(null),this.EditorSelectorRun.OptSelectedItem.Set(null));b8=$.map(function(b$){return b$.Worker;},$.ofSeq(this.Data.WorkItems));$.iter(function(b$){return b_(b$[0],b$[1]);},b1);b9=h.Agent();b9.mailbox.AddLast(m.Start);b9.resume();by.log("Connectors restored");return[$.concat($.map(function(b$){return $.map(function(ca){return ca.Worker;},$.ofSeq(b$.EventItems));},$.ofSeq(this.Data.EventGroups))),$.concat($.map(function(b$){return $.map(function(ca){return ca.Widget;},$.ofSeq(b$.WidgetItems));},$.ofSeq(this.Data.WidgetGroups)))];},Store:function(bY){function bZ(b1,b2){var b3;b3=bY(b2);return b3==null?b1:new $.T({$:1,$0:[b2.Key,b3.$0],$1:b1});}function b0(b1,b2,b3){var b4;b4=bY(b3);return b4==null?b1:new $.T({$:1,$0:[b3.Key,b2,b4.$0],$1:b1});}return[$.map(function(b1){return[b1.Name.Get(),$.rev(bg.fold(function(b2,b3){return bZ(b2,b3.Worker);},$.T.Empty,$.ofSeq(b1.EventItems)))];},$.ofSeq(this.Data.EventGroups)),$.map(function(b1){var b2;b2=$.map(function(b3){return b3.get_PanelData();},$.ofSeq(b1.PanelContainer.PanelItems));return[b1.Name.Get(),b2,$.rev(bg.fold(function(b3,b4){return b0(b3,b4.Panel,b4.Widget);},$.T.Empty,$.ofSeq(b1.WidgetItems)))];},$.ofSeq(this.Data.WidgetGroups)),$.map(function(b1){return[b1.Name.Get(),J.CopyToRules(b1.RulesRowItems)];},$.ofSeq(this.Data.RulesGroups))];},CreatePanel:function(bY,bZ,b0){var b1,b2,b3,b4,b5,b6;b1=this;bp.ConvertBy(bY.WidgetItems.key,function(b7){return bp.Element("div",[],[bp.TextView(b7.Widget.Name.get_View())]);},bY.WidgetItems.v);b2=(b3=(b4=bo.NewGuid(),a.String(b4)),b0==null?b3:b0.$0);b5=bz.get_Create().WithLayoutManager(bA.StackPanelLayoutManager()).WithAttributes([bu.Style("display","flex")]);b6=bB.get_Create().WithKey(b2).WithPannelAttrs([bu.Style("position","absolute"),bu.Style("Background","#2a2a2a")]).WithTitle(this.PanelTitleVisibility).WithTitleContent(bp.TextNode(bZ)).WithTitleButtons($.ofArray([bC.New("add",function(b7){var b8,b9;b8=$.ofSeq(b1.Factory.WidgetItems);b9=bj.Create$1($.head(b8));b1.Dialog.ShowDialog("Select widget",bp.Element("div",[],[bp.Select([bu.Class("form-control")],function(b_){return b_.Worker.Name.Get();},b8,b9)]),function(){var b_;by.log("Dialog.IsOK");b_=b9.Get().Worker.get_Clone();b_.StartRunner();b1.RegisterWidget(_9.UniqueKey(),bY,b7.Key,b7.Children,b_);});}),bC.New("edit",function(b7){by.log("Edit");b1.PropertyGrid.Edit($.concat($.map(function(b8){return b8.Widget.get_Properties();},$.filter(function(b8){return b8.Panel===b7.Key;},$.ofSeq(bY.WidgetItems)))));}),bC.New("clear",function(b7){bY.PanelContainer.PanelItems.Remove(bY.PanelContainer.FindPanelItem(b7));bY.WidgetItems.RemoveBy(function(b8){return b8.Panel===b7.Key;});})])).WithChildPanelContainer(b5);bY.PanelContainer.AddPanel(b6);return b6;},RegisterWidget:function(bY,bZ,b0,b1,b2){var b3;this.Data.RegisterWidget(bY,bZ,b0,b2);b3=bB.get_Create().WithPanelContent(b2.get_Render());b3.IsWithTitle.Set(false);b1.AddPanel(b3);}},null,L);L.Create=function(bY){var bZ,b0,b1,b2,b3,b4;function b5(){return K.PanelGroupCreator(b0,bY,void 0);}function b6(){return K.EventsGroupCreator(b0,b1,void 0);}function b7(){return K.RulesGroupCreator(b0,void 0);}bZ=bD.get_Create();b0=I.get_Create();b1=bE.get_Create();b2=D.get_Create();b3=D.get_Create().WithGroupOnClick(function(b8){b1.Edit($.mapi(function(b9,b_){var b$;return bl.string((b$=b9+1,a.String(b$)),b_.WebSharper_Community_Dashboard_ISelectorItem$get_Name());},$.ofSeq(b8.SelectorItems)));}).WithItemOnSelected(function(){b1.Edit($.T.Empty);}).WithItemOnCreated(function(b8){return function(b9){return b8===0?$.head($.ofSeq(b2.SelectorGroups)).SelectorItems.Append(b9):null;};}).WithItemOnDeleted(function(){return function(){return null;};}).WithItemOnDeleted(function(b8){return function(b9){b9 instanceof G?b0.WidgetGroups.Remove(b9):b9 instanceof F?b0.EventGroups.Remove(b9):b9 instanceof H?b0.RulesGroups.Remove(b9):_7.FailWith("WithItemOnDeleted, type unknown");return b8===0?$.head($.ofSeq(b2.SelectorGroups)).SelectorItems.Remove(b9):null;};}).WithItemOnMove(_6.Curried3(function(b8,b9,b_){var b$;b$=b_.$==1;return b9 instanceof G?(_9.MoveItemInModelList(b0.WidgetGroups,b$,b9),_9.MoveItemInModelList($.head($.ofSeq(b2.SelectorGroups)).SelectorItems,b$,b9)):b9 instanceof F?_9.MoveItemInModelList(b0.EventGroups,b$,b9):b9 instanceof H?_9.MoveItemInModelList(b0.RulesGroups,b$,b9):_7.FailWith("WithItemOnDeleted, type unknown");})).WithControls(true);b4=b5();b3.AppenGroup("Panels",$.ofArray([b4]),{$:1,$0:b5});b2.AppenGroup("Panels",$.ofArray([b4]),null);b3.AppenGroup("Events",$.ofArray([b6()]),{$:1,$0:b6});b3.AppenGroup("Rules",$.ofArray([b7()]),{$:1,$0:b7});b3.OptSelectedItem.Set({$:1,$0:$.head($.ofSeq(b3.GroupByIndex(0).SelectorItems))});b2.OptSelectedItem.Set({$:1,$0:$.head($.ofSeq(b2.GroupByIndex(0).SelectorItems))});return L.New(z.get_Create(),b0,b1,bZ,b2,b3,bj.Create$1({$:0}),bj.Create$1(false));};L.New=function(bY,bZ,b0,b1,b2,b3,b4,b5){return new L({Factory:bY,Data:bZ,PropertyGrid:b0,Dialog:b1,EditorSelectorRun:b2,EditorSelectorEdit:b3,Mode:b4,PanelTitleVisibility:b5});};N=M.RandomEvent=_6.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bY){var bZ;new bF.New();ba.Start((bZ=null,ba.Delay(function(){return ba.While(function(){return true;},ba.Delay(function(){return ba.Bind(ba.Sleep(bY.InPorts.get_Item(2).get_Number()*1000>>0),function(){var b0,b1,b2;b0=bY.InPorts.get_Item(0).get_Number();b1=bY.InPorts.get_Item(1).get_Number();b2=bG.random()*b1+b0;bY.OutPorts.get_Item(0).Trigger(new i({$:0,$0:b2}));return ba.Zero();});}));})),null);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.RandomEventData;}},null,N);N.get_FromWorker=function(){return function(bY){return N.New(bY.get_ToData());};};N.get_Create=function(){return N.New(s.Create("Random",$.ofArray([p.CreateNumber("Middle value",100),p.CreateNumber("Dispersion",10),p.CreateNumber("Delay sec.",2)]),$.ofArray([r.Create("Random value")])));};N.New=function(bY){return new N({RandomEventData:bY});};O.New=function(bY){return{DatabaseEventRun:bY};};P=M.DatabaseEvent=_6.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bY){var bZ,b0;bZ=true;b0=bY.InPorts.get_Item(0).PortValue.Get().Time;bi.Sink(function(b1){var b2;b2=bY.InPorts.get_Item(1).get_String();bZ?($.iter(function(b3){var b4;b4=h.Agent();b4.mailbox.AddLast({$:0,$0:b3});b4.resume();},(new bc.New()).Sync("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.Events.ServerDatabase.ReadAllMessages:871221883",[b2])),bZ=false):b1.Time>b0?(new bc.New()).Send("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.Events.ServerDatabase.WriteMessage:-459831224",[b2,b1]):void 0;},bY.InPorts.get_Item(0).PortValue.get_View());return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.DatabaseEventData;}},null,P);P.get_FromWorker=function(){return function(bY){return P.New(bY.get_ToData());};};P.get_Create=function(){return P.New(s.Create("Database",$.ofArray([p.CreateNumber(" in Value",100),p.CreateString("Database name","Database.txt")]),$.T.Empty));};P.New=function(bY){return new P({DatabaseEventData:bY});};R.New=function(bY,bZ,b0,b1,b2){return{Title:bY,Description:bZ,ImageUrl:b0,Temperature:b1,TemparatureMinMax:b2};};Q.get=function(bY,bZ){var b0;b0=null;return ba.Delay(function(){var b1;b1=(((_6.Curried3(function(b2,b3,b4){return b2("http://api.openweathermap.org/data/2.5/weather?q="+bd.toSafe(b3)+"&units=metric&appid="+bd.toSafe(b4));}))(a.id))(bZ))(bY);(e.Log())("get key city "+b1);return ba.TryWith(ba.Delay(function(){return ba.Bind(bI.AsyncMap(bM.asyncReadTextAtRuntime(false,"C:\\Users\\Andrey\\Private\\VS_Projects\\WebSharper.Community.Dashboard\\WebSharper.Community.Dashboard","","JSON","",b1),function(b2){return bt.Equals(typeof b2,"string")?bN.parse(b2):b2;}),function(b2){var b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn;(e.Log())("get key city 2");return ba.Return((b3=bO.tryHead(b2.weather),b3==null?null:{$:1,$0:(b4=b3.$0,R.New((((_6.Curried3(function(co,cp,cq){return co(bd.toSafe(cp)+", "+bd.toSafe(cq));}))(a.id))((b6=(b5="name",b5 in b2?{$:1,$0:b2[b5]}:null),b6==null?null:b6.$0)))((b9=(b7=b2.sys,(b8="country",b8 in b7?{$:1,$0:b7[b8]}:null)),b9==null?null:b9.$0)),(b$=(b_="main",b_ in b4?{$:1,$0:b4[b_]}:null),b$==null?null:b$.$0),(function(co){return function(cp){return co("http://openweathermap.org/img/w/"+bd.toSafe(cp)+".png");};}(a.id))((cb=(ca="icon",ca in b4?{$:1,$0:b4[ca]}:null),cb==null?null:cb.$0)),(cc=(cd=b2.main,(ce="temp",ce in cd?{$:1,$0:cd[ce]}:null)),(cf=cc==null?null:{$:1,$0:1*cc.$0},cf==null?null:cf.$0)),[(cg=(ch=b2.main,(ci="temp_min",ci in ch?{$:1,$0:ch[ci]}:null)),(cj=cg==null?null:{$:1,$0:1*cg.$0},cj==null?null:cj.$0)),(ck=(cl=b2.main,(cm="temp_max",cm in cl?{$:1,$0:cl[cm]}:null)),(cn=ck==null?null:{$:1,$0:1*ck.$0},cn==null?null:cn.$0))]))}));});}),function(b2){(e.Log())(b2.message);return ba.Return(null);});});};S=M.OpenWeatherEvent=_6.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bY){var bZ;ba.Start((bZ=null,ba.Delay(function(){return ba.While(function(){return true;},ba.Delay(function(){var b0,b1,b2;b0=bY.InPorts.get_Item(0);b1=bY.InPorts.get_Item(1);b2=bY.OutPorts.get_Item(0);return ba.Bind(Q.get(b1.get_String(),b0.get_String()),function(b3){return ba.Combine(b3==null?ba.Zero():((e.Log())("Value generated:"+b3.$0.Title),b2.Trigger(new i({$:0,$0:+b3.$0.Temperature})),ba.Zero()),ba.Delay(function(){return ba.Bind(ba.Sleep(1000*15),function(){return ba.Return(null);});}));});}));})),null);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.OpenWeatherEventData;}},null,S);S.get_FromWorker=function(){return function(bY){return S.New(bY.get_ToData());};};S.Create=function(bY,bZ){return S.New(s.Create("OpenWeatherMap",$.ofArray([p.CreateString("City",bY),p.CreateString("ApiKey",bZ)]),$.ofArray([r.Create("Temperature")])));};S.New=function(bY){return new S({OpenWeatherEventData:bY});};T=M.ClockEvent=_6.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bY){var bZ;ba.Start((bZ=null,ba.Delay(function(){return ba.While(function(){return true;},ba.Delay(function(){var b0,b1,b2;b0=(bY.InPorts.get_Item(0).PortValue.Get().Value.get_AsSelect())[0];b1=_.now();b2=b0===0?bP.LongTime(b1):b0===1?bP.ShortTime(b1):b0===2?bP.LongDate(b1):b0===3?(new _(b1)).toLocaleDateString():"";bY.OutPorts.get_Item(0).Trigger(new i({$:1,$0:b2}));return ba.Bind(ba.Sleep(bY.InPorts.get_Item(1).get_Number()*1000>>0),function(){return ba.Return(null);});}));})),null);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.ClockEventData;}},null,T);T.get_FromWorker=function(){return function(bY){return T.New(bY.get_ToData());};};T.get_Create=function(){return T.New(s.Create("Clock",$.ofArray([p.CreateSelect("Format",[0,$.ofArray(["long time","short time","long date","short date"])]),p.CreateNumber("Delay sec.",1)]),$.ofArray([r.Create("Date Time")])));};T.New=function(bY){return new T({ClockEventData:bY});};V=U.TextBoxWidget=_6.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bY){var bZ,b0,b1,b2;bZ=bi.Map(function(b3){var b4,b5;b4=b3.Value;return b4.$==0?(b5=b4.$0>>0,a.String(b5)):b4.$==1?b4.$0:b4.$==2?a.String(b4.$0):"Wrong port value format";},bY.InPorts.get_Item(0).PortValue.get_View());b0=bi.Map(function(b3){var b4;return(b4=b3.Value.get_AsNumber(),a.String(b4))+"px";},bY.InPorts.get_Item(1).PortValue.get_View());b1=bi.Map(function(b3){var b4;return(b4=b3.Value.get_AsNumber(),a.String(b4))+"px";},bY.InPorts.get_Item(2).PortValue.get_View());b2=bi.Map(function(b3){var b4;b4=b3.Value.get_AsSelect();return b4[1].get_Item(b4[0]);},bY.InPorts.get_Item(3).PortValue.get_View());return bp.Element("div",[bu.Class("bigvalue"),bu.DynamicStyle("width",b0),bu.DynamicStyle("font-size",b1),bu.DynamicStyle("font-family",b2)],[bp.TextView(bZ)]);}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.TextBoxWidgetData;}},null,V);V.get_FromWorker=function(){return function(bY){return V.New(bY.get_ToData());};};V.get_Create=function(){return V.New(s.Create("Text",$.ofArray([p.CreateString("in Text","txt"),p.CreateNumber("Width",200),p.CreateNumber("Font-Size",100),p.CreateSelect("Font-Family",[0,$.ofArray(["Times New Roman","Courier New","Arial","Freestyle Script"])])]),$.T.Empty));};V.New=function(bY){return new V({TextBoxWidgetData:bY});};W.New=function(bY,bZ){return{LineChart:bY,Sources:bZ};};X=U.ChartWidget=_6.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bY){var bZ,b0,b1,b2,b3,b4,b5,b6,b7;(e.Log())("Chart Render");bZ=bY.InPorts.get_Item(3).get_Number()>>0;b0=bY.RunnerContext.Get().$0;b1=(b2={},b2.title=(b3={},b3.display=false,b3),b2.legend=(b4={},b4.display=false,b4),b2.elements=(b5={},b5.point=(b6={},b6.radius=0,b6),b5.line=(b7={},b7.borderWidth=1,b7),b5),b2);return bS.Render$2(b0.LineChart,{$:1,$0:{$:0,$0:bY.InPorts.get_Item(1).get_Number()>>0,$1:bY.InPorts.get_Item(2).get_Number()>>0}},{$:1,$0:b1},{$:1,$0:bZ});}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){var bY;bY=this;return{$:1,$0:function(bZ){var b0,b1,b2,b3;function b4(b5,b6){var b7,b8,b9;b7=(bZ.InPorts.get_Item(4).PortValue.Get().Value.get_AsSelect())[0];b8=(b9=b6.Time,b7===0?bP.LongTime(b9):b7===1?bP.ShortTime(b9):b7===2?bP.LongDate(b9):b7===3?(new _(b9)).toLocaleDateString():"");(e.Log())("Chart observe "+b8);return b0.get_Item(bg.findIndex(function(b_){return bt.Equals(b_,b5);},b2)).event.Trigger([b8,b6.Value.get_AsNumber()]);}(e.Log())("Chart run");bZ.InPorts.get_Item(3).get_Number();b0=$.init((bY.ChartWidgetData.InPorts.get_Item(5).Value.Value.get_AsNumber()>>0)+1,function(){return new bT.New();});b1=($.splitAt(6,bZ.InPorts))[1];b2=new $.T({$:1,$0:bZ.InPorts.get_Item(0),$1:b1});b3=bU.Combine($.ofSeq(bg.delay(function(){return bg.map(function(b5){return bV.Line$1(b5.event).WithFill(false).__WithStrokeColor(new bW.Color({$:1,$0:"#FB8C00"})).__WithPointColor(new bW.Color({$:2,$0:"black"}));},b0);})));$.iter(function(b5){bi.Sink(function(b6){return b4(b5,b6);},b5.PortValue.get_View());},b2);return{$:1,$0:W.New(b3,b0)};}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){var bY,bZ,b0,b1,b2,b3;bY=this;bZ=this.ChartWidgetData.InPorts.get_Item(3).Value.Value.get_AsNumber()>>0;b0=(this.ChartWidgetData.InPorts.get_Item(5).Value.Value.get_AsNumber()>>0)+6;b1=b0<this.ChartWidgetData.InPorts.get_Length()?($.splitAt(b0,this.ChartWidgetData.InPorts))[0]:b0>this.ChartWidgetData.InPorts.get_Length()?(b2=this.ChartWidgetData.InPorts.get_Length()-6+1,$.append(this.ChartWidgetData.InPorts,$.ofSeq(bg.delay(function(){return bg.map(function(b4){var b5;return p.CreateNumber(" in Value "+(b5=b2+b4,a.String(b5)),0).WithCacheSize(bZ);},_7.range(0,b0-bY.ChartWidgetData.InPorts.get_Length()-1));})))):this.ChartWidgetData.InPorts;b3=this.ChartWidgetData;return s.New(b3.WorkerName,$.mapi(function(b4,b5){return b4===0||b4>5?b5.WithCacheSize(bZ):b5;},b1),b3.OutPorts);}},null,X);X.get_FromWorker=function(){return function(bY){return X.New(bY.get_ToData());};};X.get_Create=function(){var bY;bY=20;return X.New(s.Create("Chart",$.ofArray([p.CreateNumber(" in Value",100).WithCacheSize(bY),p.CreateNumber("cx",300),p.CreateNumber("cy",150),p.CreateNumber("BufferSize",bY),p.CreateSelect("X-Axis",[0,$.ofArray(["long time","short time","long date","short date"])]),p.CreateNumber("Number of additional ports",0)]),$.T.Empty));};X.New=function(bY){return new X({ChartWidgetData:bY});};Y=U.ButtonWidget=_6.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bY){return bp.ButtonView(bY.InPorts.get_Item(0).get_String(),[],bY.InPorts.get_Item(1).get_BooleanView(),function(bZ){bY.OutPorts.get_Item(0).Trigger(new i({$:2,$0:bZ}));});}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.ButtonWidgetData;}},null,Y);Y.get_FromWorker=function(){return function(bY){return Y.New(bY.get_ToData());};};Y.get_Create=function(){return Y.New(s.Create("Button",$.ofArray([p.CreateString("Caption","Button"),p.CreateNumber("State",0)]),$.ofArray([r.Create("Button value")])));};Y.New=function(bY){return new Y({ButtonWidgetData:bY});};Z=U.GaugeWidget=_6.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bY){var bZ,b0,b1,b2;function b3(b6){var b7,b8,b9,b_,b$;b7=b6*3.14159265358979/180;return[(b8=100+(b9=a.Number(bZ),a.isNaN(b9)?new bX.New("Input string was not in a correct format."):b9)*bG.cos(b7),a.String(b8)),(b_=100-(b$=a.Number(bZ),a.isNaN(b$)?new bX.New("Input string was not in a correct format."):b$)*bG.sin(b7),a.String(b_))];}function b4(b6){var b7;b7=b3(b6);return b0+b7[0]+","+b7[1];}function b5(b6){return b6===90?"yellow":b6<=90?"orange":b6>90?"red":"";}bZ="80";b0=(b1=b3(180),"M"+b1[0]+","+b1[1]+"A"+bZ+","+bZ+","+"0, 0 , 1,");b2=bi.Map(function(b6){return b5(b6.Value.get_AsNumber());},bY.InPorts.get_Item(0).PortValue.get_View());return bp.EmbedView(bi.Map(function(b6){return bp.SvgElement("svg",$.T.Empty,$.ofArray([bp.SvgElement("path",$.ofArray([bw.Create("d",b4(0)),bu.Style("stroke","whitesmoke"),bu.Style("stroke-width","30"),bu.Style("fill","none")]),$.T.Empty),bp.SvgElement("path",$.ofArray([bw.Create("d",b4(180-b6.Value.get_AsNumber())),bu.DynamicStyle("stroke",b2),bu.Style("stroke-width","30"),bu.Style("fill","none")]),$.T.Empty)]));},bY.InPorts.get_Item(0).PortValue.get_View()));}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.GaugeWidgetData;}},null,Z);Z.get_FromWorker=function(){return function(bY){return Z.New(bY.get_ToData());};};Z.get_Create=function(){return Z.New(s.Create("Gauge",$.ofArray([p.CreateNumber("Angle",0)]),$.T.Empty));};Z.New=function(bY){return new Z({GaugeWidgetData:bY});};_0.FromWorker=function(bY){var bZ;bZ=bY.Data;return bZ instanceof N?{$:1,$0:{$:0,$0:(N.get_FromWorker())(bY)}}:bZ instanceof T?{$:1,$0:{$:1,$0:(T.get_FromWorker())(bY)}}:bZ instanceof S?{$:1,$0:{$:2,$0:(S.get_FromWorker())(bY)}}:bZ instanceof P?{$:1,$0:{$:3,$0:(P.get_FromWorker())(bY)}}:bZ instanceof V?{$:1,$0:{$:4,$0:(V.get_FromWorker())(bY)}}:bZ instanceof X?{$:1,$0:{$:5,$0:(X.get_FromWorker())(bY)}}:bZ instanceof Y?{$:1,$0:{$:6,$0:(Y.get_FromWorker())(bY)}}:bZ instanceof Z?{$:1,$0:{$:7,$0:(Z.get_FromWorker())(bY)}}:null;};_0.ToWorker=function(bY){return bY.$==1?t.Create(bY.$0):bY.$==2?t.Create(bY.$0):bY.$==3?t.Create(bY.$0):bY.$==4?t.Create(bY.$0):bY.$==5?t.Create(bY.$0):bY.$==6?t.Create(bY.$0):bY.$==7?t.Create(bY.$0):t.Create(bY.$0);};_1.CreateDashboard=function(){_2.$cctor();return _2.CreateDashboard;};_1.PanelContainerCreator=function(bY){return bz.get_Create().WithLayoutManager(bA.FloatingPanelLayoutManager(5)).WithWidth(2800).WithHeight(2420).WithAttributes([]);};_1.RegisterAppModelLib=function(bY){function bZ(b1){_1.RegisterEventGeneral(bY,b1);}function b0(b1){_1.RegisterWidgetGeneral(bY,b1);}bZ(S.Create("London",""));bZ(N.get_Create());bZ(T.get_Create());bZ(P.get_Create());b0(V.get_Create());b0(X.get_Create());b0(Y.get_Create());b0(Z.get_Create());return bY;};_1.RegisterWidgetGeneral=function(bY,bZ){var b0;_1.Register((b0=bY.Factory,function(b1){b0.RegisterWidget(b1);}),bZ);};_1.RegisterEventGeneral=function(bY,bZ){var b0;_1.Register((b0=bY.Factory,function(b1){b0.RegisterEvent(b1);}),bZ);};_1.Register=function(bY,bZ){return bY(t.Create(bZ));};_2.$cctor=function(){_2.$cctor=a.ignore;_2.CreateDashboard=_1.RegisterAppModelLib(L.Create(function(){return _1.PanelContainerCreator();}));};_3.RecreatWidgetsOnServer=function(bY,bZ){function b0(b2,b3,b4){return b4;}function b1(b2,b3,b4){return b4;}return $.map(function(b2){return b0(b2[0],b2[1],b2[2]);},$.concat($.map(function(b2){return b1(b2[0],b2[1],b2[2]);},_3.RecreateWidgets(bY,bZ))));};_3.RecreateEventsOnServer=function(bY,bZ){function b0(b2,b3){return b3;}function b1(b2,b3){return b3;}return $.map(function(b2){return b0(b2[0],b2[1]);},$.concat($.map(function(b2){return b1(b2[0],b2[1]);},_3.RecreateEvents(bY,bZ))));};_3.RecreateOnClient=function(bY,bZ,b0,b1,b2,b3,b4){var b5;e.set_Role(f.Client);b5=h.Agent();b5.mailbox.AddLast({$:3,$0:function(b6){(new bc.New()).Send("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.MessageBus.SendToServer:-1358505674",[b6]);}});b5.resume();$.iter(bY,(bZ.Restore(b0,_3.RecreateEvents(b1,b2),_3.RecreateWidgets(b1,b3),b4))[0]);};_3.RecreateWidgets=function(bY,bZ){function b0(b1,b2,b3){function b4(b5,b6,b7){return[b5,b6,bY(b7)];}return[b1,b2,$.map(function(b5){return b4(b5[0],b5[1],b5[2]);},b3)];}return $.map(function(b1){return b0(b1[0],b1[1],b1[2]);},bZ);};_3.RecreateEvents=function(bY,bZ){function b0(b1,b2){function b3(b4,b5){return[b4,bY(b5)];}return[b1,$.map(function(b4){return b3(b4[0],b4[1]);},b2)];}return $.map(function(b1){return b0(b1[0],b1[1]);},bZ);};_4=d.AppData=_6.Class({RecreateOnServer:function(bY,bZ){var b0,b1,b2;function b3(b4,b5){b5.Reconnect(b0);}b0=$.append(_3.RecreateEventsOnServer(bZ,this.Events),_3.RecreatWidgetsOnServer(bZ,this.Widgets));$.iter(function(b4){return b3(b4[0],b4[1]);},this.Rules);$.iter(function(b4){b4.StartRunner();},b0);b1={$:0,$0:h.CreateMessage(new i({$:4,$0:{$:0,$0:bY}})).WithKey("system")};b2=h.Agent();b2.mailbox.AddLast(b1);b2.resume();return b0;},RecreateOnClientEventsRunning:function(bY,bZ,b0){_3.RecreateOnClient(function(b1){b1.StartRunner();},bY,bZ,b0,this.Events,this.Widgets,this.Rules);},RecreateOnClientEventsNotRunning:function(bY,bZ,b0){_3.RecreateOnClient(a.ignore,bY,bZ,b0,this.Events,this.Widgets,this.Rules);}},null,_4);_4.Create=function(bY,bZ){var b0;b0=bY.Store(bZ);return _4.New(b0[0],b0[1],b0[2]);};_4.empty=function(){return _4.New($.T.Empty,$.T.Empty,$.T.Empty);};_4.New=function(bY,bZ,b0){return new _4({Events:bY,Widgets:bZ,Rules:b0});};}());
