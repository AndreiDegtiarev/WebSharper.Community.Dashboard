(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Community=b.Community||{};d=c.Panel=c.Panel||{};e=d.Helper=d.Helper||{};f=d.WrapControlsAligment=d.WrapControlsAligment||{};g=d.WrapControls=d.WrapControls||{};h=d.PanelData=d.PanelData||{};i=d.TitleButton=d.TitleButton||{};j=d.Panel=d.Panel||{};k=d.PanelContainer=d.PanelContainer||{};l=d.Rect=d.Rect||{};m=d.LayoutManagers=d.LayoutManagers||{};n=a.StartupCode$WebSharper_Community_Panel$LayoutManagers=a.StartupCode$WebSharper_Community_Panel$LayoutManagers||{};o=d.Dialog=d.Dialog||{};p=b&&b.List;q=b&&b.Seq;r=b&&b.Unchecked;s=b&&b.Guid;t=b&&b.UI;u=t&&t.Next;v=u&&u.Doc;w=u&&u.AttrModule;x=u&&u.Var;y=u&&u.View;z=a.IntelliFactory;A=z&&z.Runtime;B=u&&u.Input;C=B&&B.Mouse;D=u&&u.ListModel;E=a.console;e.MoveItemInModelList=function(F,G,H){var I,J,K,L;I=p.ofSeq(F);J=G?q.findIndex(function(M){return r.Equals(M,H);},I)+1:q.findIndex(function(M){return r.Equals(M,H);},I)-1;J>=0&&J<I.get_Length()?(F.Clear(),K=p.splitAt(J,p.filter(function(M){return!r.Equals(M,H);},I)),L=K[0],p.iter(function(M){F.Append(M);},p.append(L,new p.T({$:1,$0:H,$1:K[1]}))),p.iter(function(M){F.Append(M);},L)):void 0;};e.UniqueKey=function(){var F;F=s.NewGuid();return a.String(F);};e.TxtIconNormal=function(F,G,H){return e.TxtIcon("material-icons orange600",F,G,H);};e.TxtIcon=function(F,G,H,I){return v.Element("div",e.AttrsClick(I),[v.Element("i",[w.Class(F)],[v.TextNode(G)]),v.TextNode(H)]);};e.IconSmall=function(F,G){return e.Icon("material-icons orange600 small",F,G);};e.IconNormal=function(F,G){return e.Icon("material-icons orange600",F,G);};e.Icon=function(F,G,H){return v.Element("i",new p.T({$:1,$0:w.Class(F),$1:e.AttrsClick(H)}),[v.TextNode(G)]);};e.AttrsClick=function(F){return p.ofArray([w.Style("Color","#FB8C00"),w.Style("cursor","pointer"),w.Handler("click",function(){return function(){return F();};})]);};f.Horizontal={$:1};f.Vertical={$:0};g.Render=function(F,G,H){var I,J;I=x.Create$1(false);J=v.Element("div",[w.DynamicStyle("display",y.Map(function(K){return!K?"none":"block";},I.v))],F);return G.$==1?v.Element("table",[],[v.Element("tr",[],[v.Element("td",[],[H]),v.Element("td",[],[J])])]).on("mouseenter",function(){return x.Set(I,true);}).on("mouseleave",function(){return x.Set(I,false);}):v.Element("div",[],[J,H]);};h.Create=function(F,G,H,I){return h.New(F,G,H,I);};h.New=function(F,G,H,I){return{Key:F,Left:G,Top:H,Children:I};};i=d.TitleButton=A.Class({Render:function(F){var G;G=this;return e.IconSmall(this.Icon,function(){G.Action(F);});}},null,i);i.New=function(F,G){return new i({Icon:F,Action:G});};j=d.Panel=A.Class({get_Render:function(){var F,G,H,I,J,K,L,M,N,O;function P(S,T){var U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5;return G.c?(U=F.Element.c.getBoundingClientRect(),(V=F.Element.c.parentElement.getBoundingClientRect(),(W=V.width-U.width,(X=V.height-U.height,(Y=(Z=(_0=0,(_1=+S-I.c,r.Compare(_0,_1)===1?_0:_1)),r.Compare(W,Z)===-1?W:Z),(_2=(_3=(_4=0,(_5=+T-J.c,r.Compare(_4,_5)===1?_4:_5)),r.Compare(X,_3)===-1?X:_3),(x.Set(F.Left,Y),x.Set(F.Top,_2),F.Relayout(F),[Y,_2]))))))):[F.Left.c,F.Top.c];}function Q(S,T){return(function(U){return function(V){return U(V.toFixed(6)+"px");};}(a.id))(S);}function R(S,T){return(function(U){return function(V){return U(V.toFixed(6)+"px");};}(a.id))(T);}F=this;G=x.Create$1(false);H=x.Create$1(false);I=x.Create$1(0);J=x.Create$1(0);K=y.Map(function(S){return P(S[0],S[1]);},y.UpdateWhile([0,0],y.Map(function(S){return S&&G.c;},C.get_LeftPressed()),C.get_Position()));L=q.concat([this.TitleAttrs,p.ofArray([w.Style("cursor","grab"),w.Handler("mouseenter",function(){return function(){return x.Set(H,true);};}),w.Handler("mouseleave",function(){return function(){return!G.c?x.Set(H,false):null;};}),w.Handler("mouseup",function(){return function(){x.Set(H,false);return x.Set(G,false);};}),w.Handler("mousedown",function(){return function(S){H.c&&!r.Equals(F.Element.c.parentElement,null)&&!r.Equals(F.Element.c.parentElement.parentElement,null)?x.Set(G,true):void 0;x.Set(I,+S.clientX-F.Left.c);return x.Set(J,+S.clientY-F.Top.c);};})])]);M=v.Element("table",[w.Style("width","100%")],[v.Element("tr",[],[v.Element("td",[],[this.TitleContent]),v.Element("td",[w.Style("text-align","right"),w.Style("vertical-align","middle")],p.map(function(S){return S.Render(F);},this.TitleButtons))])]);N=this.Width>0?p.ofArray([w.Style("width",(function(S){return function(T){return S(T.toFixed(6)+"px");};}(a.id))(this.Width))]):p.T.Empty;O=v.Element("div",q.concat([this.PannelAttrs,q.concat([N,this.Height>0?p.ofArray([w.Style("height",(function(S){return function(T){return S(T.toFixed(6)+"px");};}(a.id))(this.Height))]):p.T.Empty]),p.ofArray([w.DynamicStyle("left",y.Map(function(S){return(function(T){return function(U){return T(U.toFixed(6)+"px");};}(a.id))(S);},this.Left.v)),w.DynamicStyle("left",y.Map(function(S){return Q(S[0],S[1]);},K)),w.DynamicStyle("top",y.Map(function(S){return R(S[0],S[1]);},K)),w.DynamicStyle("top",y.Map(function(S){return(function(T){return function(U){return T(U.toFixed(6)+"px");};}(a.id))(S);},this.Top.v))])]),[v.Element("table",[],[v.Element("tr",[],[v.Element("td",N,[v.EmbedView(y.Map(function(S){return S?v.Element("div",L,[M]):v.Element("div",[],[]);},this.IsWithTitle.v))])]),v.Element("tr",[],[v.Element("td",[],[this.PanelContent,this.Children.get_Render()])])])]);x.Set(this.Element,O.elt);return O.OnAfterRender(function(){F.onAfterRender(F);});},get_PanelData:function(){return h.Create(this.Key,this.Left.c,this.Top.c,p.map(function(F){return F.get_PanelData();},p.ofSeq(this.Children.PanelItems)));},EditProperties:function(F){F.Edit(p.concat([this.Properties,p.concat(p.map(function(G){return G.Properties;},p.ofSeq(this.Children.PanelItems)))]));},WithHeight:function(F){return j.New(this.Key,this.Left,this.Top,this.Width,F,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithWidth:function(F){return j.New(this.Key,this.Left,this.Top,F,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithProperties:function(F){return j.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,F);},WithOnAfterRender:function(F){return j.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,F,this.Properties);},WithInternalName:function(F){return j.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,F,this.onAfterRender,this.Properties);},WithTitle:function(F){return j.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,F,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithChildPanelContainer:function(F){return j.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,F,this.InternalName,this.onAfterRender,this.Properties);},WithRelayoutFnc:function(F){return j.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,F,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithPanelContent:function(F){return j.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,F,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithTitleButtons:function(F){return j.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,F,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithTitleContent:function(F){return j.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,F,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithTitleAttrs:function(F){return j.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,F,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithPannelAttrs:function(F){return j.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,F,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithKey:function(F){return j.New(F,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);}},null,j);j.get_Create=function(){var F;return j.New((F=s.NewGuid(),a.String(F)),x.Create$1(0),x.Create$1(0),0,0,x.Create$1(null),a.ignore,p.T.Empty,x.Create$1(true),p.ofArray([w.Class("panelTitle")]),v.Element("div",[],[]),p.T.Empty,v.Element("div",[],[]),k.get_Create(),"",a.ignore,p.T.Empty);};j.New=function(F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V){return new j({Key:F,Left:G,Top:H,Width:I,Height:J,Element:K,Relayout:L,PannelAttrs:M,IsWithTitle:N,TitleAttrs:O,TitleContent:P,TitleButtons:Q,PanelContent:R,Children:S,InternalName:T,onAfterRender:U,Properties:V});};k=d.PanelContainer=A.Class({get_Render:function(){var F;F=this;return v.Element("div",q.concat([this.ContainerAttributes,this.Width>0?p.ofArray([w.Style("width",(function(G){return function(H){return G(H.toFixed(6)+"px");};}(a.id))(this.Width))]):p.T.Empty,this.Height>0?p.ofArray([w.Style("height",(function(G){return function(H){return G(H.toFixed(6)+"px");};}(a.id))(this.Height))]):p.T.Empty,p.ofArray([w.Style("position","relative")])]),[v.ConvertBy(function(G){return G.Key;},function(G){return G.get_Render().OnAfterRender(function(){F.LayoutManager.WebSharper_Community_Panel_ILayoutManager$PlacePanel(F,G);});},this.PanelItems.v)]);},AddPanel:function(F){var G,H;this.PanelItems.Append(F.WithRelayoutFnc((G=this.LayoutManager,(H=this,function(I){G.WebSharper_Community_Panel_ILayoutManager$Relayout(H,I);}))));},FindPanelItem:function(F){return q.find(function(G){return r.Equals(G.Element,F.Element);},p.ofSeq(this.PanelItems));},WithHeight:function(F){return k.New(this.Width,F,this.PanelItems,this.LayoutManager,this.ContainerAttributes);},WithWidth:function(F){return k.New(F,this.Height,this.PanelItems,this.LayoutManager,this.ContainerAttributes);},WithLayoutManager:function(F){return k.New(this.Width,this.Height,this.PanelItems,F,this.ContainerAttributes);},WithAttributes:function(F){return k.New(this.Width,this.Height,this.PanelItems,this.LayoutManager,F);}},null,k);k.get_Create=function(){return k.New(0,0,D.Create(function(F){return F.Key;},p.T.Empty),{WebSharper_Community_Panel_ILayoutManager$Relayout:function(){return null;},WebSharper_Community_Panel_ILayoutManager$PlacePanel:function(){return null;}},p.T.Empty);};k.New=function(F,G,H,I,J){return new k({Width:F,Height:G,PanelItems:H,LayoutManager:I,ContainerAttributes:J});};l=d.Rect=A.Class({toString:function(){return"left:"+a.String(this.left)+" "+" top:"+a.String(this.top)+" right:"+a.String(this.right)+" bottom:"+a.String(this.bottom);},inflate:function(F,G){return l.New(this.left-F,this.right+F,this.top-G,this.bottom+G);},get_height:function(){return this.bottom-this.top;},get_width:function(){return this.right-this.left;},intersect:function(F){var G,H,I,J,K,L,M,N,O,P,Q,R;G=(H=this.left,(I=F.left,r.Compare(H,I)===1?H:I));J=(K=this.right,(L=F.right,r.Compare(K,L)===-1?K:L));M=(N=this.top,(O=F.top,r.Compare(N,O)===1?N:O));P=(Q=this.bottom,(R=F.bottom,r.Compare(Q,R)===-1?Q:R));return l.New(G,r.Compare(G,J)===1?G:J,M,r.Compare(M,P)===1?M:P);},offset:function(F,G){return l.New(this.left+F,this.right+F,this.top+G,this.bottom+G);},get_isEmpty:function(){return this.left>=this.right||this.top>=this.bottom;}},null,l);l.fromPanel=function(F){return l.fromDomRect(F.Element.c).offset(F.Left.c,F.Top.c);};l.fromDomRect=function(F){var G;return!r.Equals(F,null)?(G=F.getBoundingClientRect(),l.New(0,G.width,0,G.height)):l.Create(0,0,0,0);};l.Create=function(F,G,H,I){return l.New(F,H,G,I);};l.New=function(F,G,H,I){return new l({left:F,right:G,top:H,bottom:I});};m.StackPanelLayoutManager=function(){n.$cctor();return n.StackPanelLayoutManager;};m.FloatingPanelLayoutManager=function(F){return{WebSharper_Community_Panel_ILayoutManager$Relayout:function(G,H){return m.relayout(G,H,F);},WebSharper_Community_Panel_ILayoutManager$PlacePanel:function(G,H){return m.placePanel(G,H,F);}};};m.relayout=function(F,G,H){var I,J,K;I=F.PanelItems;J=q.find(function(L){return L.Key===G.Key;},p.ofSeq(I));K=q.tryFind(function(L){return L.Key!==J.Key&&!l.fromPanel(L).intersect(l.fromPanel(J)).get_isEmpty();},p.ofSeq(I));K!=null&&K.$==1?m.movePanelToFreeSpace(I,K.$0,H):void 0;};m.placePanel=function(F,G,H){var I,J,K;I=l.fromPanel(G);J=q.tryFind(function(L){return L.get_width()>=I.get_width()&&L.get_height()>=I.get_height();},m.collectFreeSpace(F.PanelItems,l.Create(0,0,F.Width,F.Height),G,H));J!=null&&J.$==1?(K=J.$0,x.Set(G.Left,K.left+H),x.Set(G.Top,K.top+H)):void 0;};m.movePanelToFreeSpace=function(F,G,H){var I,J,K;I=l.fromPanel(G);J=q.tryFind(function(L){return L.get_width()>=I.get_width()&&L.get_height()>=I.get_height();},m.collectFreeSpace(F,l.fromDomRect(G.Element.c.parentElement),G,H));J!=null&&J.$==1?(K=J.$0,x.Set(G.Left,K.left+H),x.Set(G.Top,K.top+H)):void 0;};m.collectFreeSpace=function(F,G,H,I){var J;J=p.filter(function(K){return K.Key!==H.Key;},p.ofSeq(F));return q.fold(function(K,L){var M,N,O;M=m.panelRect(L,0);N=l.New(0,G.right,0,M.top);O=l.New(0,M.left,0,G.bottom);return p.concat(p.map(function(P){return p.filter(function(Q){return!Q.get_isEmpty();},p.map(function(Q){return Q.intersect(P);},K));},p.ofArray([N,O,l.New(M.right,G.right,O.top,O.bottom),l.New(N.left,N.right,M.bottom,G.bottom)])));},p.ofArray([G]),J);};m.calcClientArea=function(F,G,H){var I;I=p.map(function(J){E.log(J.InternalName);return m.panelRect(J,H);},function(J,K){var L,M;while(true)if(K.$==1){L=K.$1;M=K.$0;if(M.Key===G.Key)return J;else{J=new p.T({$:1,$0:M,$1:J});K=L;}}else return J;}(p.T.Empty,p.ofSeq(F)));return I.$==0?l.Create(0,0,0,0):l.Create(p.min(p.map(function(J){return J.left;},I)),p.min(p.map(function(J){return J.top;},I)),p.max(p.map(function(J){return J.right;},I)),p.max(p.map(function(J){return J.bottom;},I)));};m.panelRect=function(F,G){return l.fromPanel(F).inflate(G,G);};n.$cctor=A.Cctor(function(){n.StackPanelLayoutManager={WebSharper_Community_Panel_ILayoutManager$Relayout:function(F,G){return m.relayout(F,G,0);},WebSharper_Community_Panel_ILayoutManager$PlacePanel:function(){return null;}};n.$cctor=a.ignore;});o=d.Dialog=A.Class({get_Render:function(){var F;F=this;return v.Element("div",[w.Style("position","absolute"),w.Style("left","50%"),w.Style("top","50%"),w.Style("z-index","1"),w.Style("background-color","white"),w.Style("min-height","100px"),w.Style("min-width","200px"),w.DynamicStyle("display",y.Map(function(G){return G?"block":"none";},this.Visibility.v))],[v.Element("table",[w.Style("background-color","grey"),w.Style("display","block"),w.Style("min-height","100px"),w.Style("min-width","200px")],[v.Element("table",[],[v.Element("tr",[],[v.Element("td",[w.Style("border-style","hidden"),w.Style("background","#404040"),w.Style("color","rgb(200,200,200)"),w.Style("padding","0px 2px 5px 2px"),w.Style("Width","200px"),w.Style("font-size","medium")],[v.TextView(this.Title.v)])])]),v.Element("table",[],[v.Element("tr",[],[v.Element("td",[w.Style("padding","5px 0px 0px 2px")],[v.BindView(a.id,this.Content.v)])]),v.Element("tr",[],[v.Element("td",[w.Style("padding","20px 12px 2px 20px")],[v.Element("button",[w.Style("border-radius","2px"),w.Handler("click",function(){return function(){x.Set(F.Visibility,false);return F.OKCallback.c();};})],[v.TextNode("OK")])]),v.Element("td",[w.Style("padding","20px 12px 2px 50px")],[v.Element("button",[w.Style("border-radius","2px"),w.Handler("click",function(){return function(){return x.Set(F.Visibility,false);};})],[v.TextNode("Cancel")])])])])])]);},ShowDialog:function(F,G,H){x.Set(this.Title,F);x.Set(this.Content,G);x.Set(this.Visibility,true);x.Set(this.OKCallback,H);}},null,o);o.get_Create=function(){return o.New(x.Create$1(""),x.Create$1(v.Element("div",[],[])),x.Create$1(false),x.Create$1(a.ignore));};o.New=function(F,G,H,I){return new o({Title:F,Content:G,Visibility:H,OKCallback:I});};}());
