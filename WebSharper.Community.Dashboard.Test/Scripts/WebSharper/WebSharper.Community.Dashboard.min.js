(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Community=b.Community||{};d=c.Dashboard=c.Dashboard||{};e=d.Environment=d.Environment||{};f=e.Role=e.Role||{};g=a.StartupCode$WebSharper_Community_Dashboard$Environment=a.StartupCode$WebSharper_Community_Dashboard$Environment||{};h=d.MessageBus=d.MessageBus||{};i=h.Value=h.Value||{};j=h.Message=h.Message||{};k=h.ListenerInfo=h.ListenerInfo||{};l=h.AgentMessage=h.AgentMessage||{};m=h.AgentState=h.AgentState||{};n=a.StartupCode$WebSharper_Community_Dashboard$MessageBus=a.StartupCode$WebSharper_Community_Dashboard$MessageBus||{};o=d.InPortData=d.InPortData||{};p=d.InPort=d.InPort||{};q=d.OutPort=d.OutPort||{};r=d.WorkerData=d.WorkerData||{};s=d.Worker=d.Worker||{};t=d.Workers=d.Workers||{};u=d.RuleEntry=d.RuleEntry||{};v=d.RuleChain=d.RuleChain||{};w=d.RuleContainer=d.RuleContainer||{};x=d.WorkerItem=d.WorkerItem||{};y=d.Factory=d.Factory||{};z=d.RulesCellItem=d.RulesCellItem||{};A=d.RulesRowItem=d.RulesRowItem||{};B=d.SelectorGroup=d.SelectorGroup||{};C=d.WindowSelector=d.WindowSelector||{};D=d.WidgetItem=d.WidgetItem||{};E=d.EventsGroupItem=d.EventsGroupItem||{};F=d.WidgetsGroupItem=d.WidgetsGroupItem||{};G=d.RulesGroupItem=d.RulesGroupItem||{};H=d.DshData=d.DshData||{};I=d.RulesEditor=d.RulesEditor||{};J=d.DshHelper=d.DshHelper||{};K=d.Dashboard=d.Dashboard||{};L=d.Events=d.Events||{};M=L.RandomEvent=L.RandomEvent||{};N=L.DatabaseEventContext=L.DatabaseEventContext||{};O=L.DatabaseEvent=L.DatabaseEvent||{};P=L.OpenWeather=L.OpenWeather||{};Q=P.Forecast=P.Forecast||{};R=L.OpenWeatherEvent=L.OpenWeatherEvent||{};S=d.Widgets=d.Widgets||{};T=S.TextBoxWidget=S.TextBoxWidget||{};U=S.ChartWidgetContext=S.ChartWidgetContext||{};V=S.ChartWidget=S.ChartWidget||{};W=S.ButtonWidget=S.ButtonWidget||{};X=d.AppModelLib=d.AppModelLib||{};Y=d.App=d.App||{};Z=a.StartupCode$WebSharper_Community_Dashboard$AppModelLib=a.StartupCode$WebSharper_Community_Dashboard$AppModelLib||{};_0=d.AppDataHelper=d.AppDataHelper||{};_1=d.AppData=d.AppData||{};_2=a.IntelliFactory;_3=_2&&_2.Runtime;_4=b&&b.Operators;_5=c&&c.Panel;_6=_5&&_5.Helper;_7=a.Date;_8=b&&b.List;_9=b&&b.Concurrency;_=b&&b.Remoting;$=_&&_.AjaxRemotingProvider;ba=b&&b.Control;bb=ba&&ba.MailboxProcessor;bc=b&&b.Seq;bd=b&&b.Utils;be=b&&b.UI;bf=be&&be.Next;bg=bf&&bf.View;bh=bf&&bf.Var;bi=c&&c.PropertyGrid;bj=bi&&bi.Properties;bk=b&&b.Guid;bl=b&&b.Unchecked;bm=bf&&bf.Doc;bn=b&&b.Enumerator;bo=b&&b.MatchFailureException;bp=bf&&bf.Key;bq=bf&&bf.ListModel;br=a.console;bs=bf&&bf.AttrModule;bt=b&&b.Option;bu=_5&&_5.WrapControls;bv=_5&&_5.PanelContainer;bw=_5&&_5.LayoutManagers;bx=_5&&_5.Panel;by=_5&&_5.TitleButton;bz=_5&&_5.Dialog;bA=bi&&bi.PropertyGrid;bB=b&&b.Random;bC=a.Math;bD=b&&b.Data;bE=bD&&bD.TxtRuntime;bF=a.FSharp;bG=bF&&bF.Data;bH=bG&&bG.Runtime;bI=bH&&bH.IO;bJ=a.JSON;bK=b&&b.Arrays;bL=b&&b.Charting;bM=bL&&bL.Renderers;bN=bM&&bM.ChartJs;bO=ba&&ba.FSharpEvent;bP=b&&b.DateUtil;bQ=bL&&bL.LiveChart;bR=bL&&bL.Pervasives;f.Server={$:1};f.Client={$:0};e.DataDirectory=function(){g.$cctor();return g.DataDirectory;};e.set_DataDirectory=function(bS){g.$cctor();g.DataDirectory=bS;};e.Log=function(){g.$cctor();return g.Log;};e.set_Log=function(bS){g.$cctor();g.Log=bS;};e.Role$1=function(){g.$cctor();return g.Role;};e.set_Role=function(bS){g.$cctor();g.Role=bS;};g.$cctor=_3.Cctor(function(){g.Role=f.Server;g.Log=a.ignore;g.DataDirectory="";g.$cctor=a.ignore;});i=h.Value=_3.Class({get_AsSelect:function(){return this.$==3?this.$0:_4.FailWith("MessageBus.Value: unexpected type");},get_AsBoolean:function(){return this.$==2?this.$0:_4.FailWith("MessageBus.Value: unexpected type");},get_AsString:function(){return this.$==1?this.$0:_4.FailWith("MessageBus.Value: unexpected type");},get_AsNumber:function(){return this.$==0?this.$0:_4.FailWith("MessageBus.Value: unexpected type");}},null,i);j=h.Message=_3.Class({WithTime:function(bS){return j.New(this.Key,bS,this.Value);},WithKey:function(bS){return j.New(bS,this.Time,this.Value);}},null,j);j.Create=function(bS){return j.New(_6.UniqueKey(),_7.now(),bS);};j.New=function(bS,bT,bU){return new j({Key:bS,Time:bT,Value:bU});};k.Create=function(bS,bT,bU){return k.New(bS,bT,bU);};k.New=function(bS,bT,bU){return{Key:bS,Name:bT,CacheSize:bU};};l.Clear={$:4};m.get_empty=function(){return m.New(null,_8.T.Empty);};m.New=function(bS,bT){return{ServerCallback:bS,Listeners:bT};};h.RunServerRequests=function(){var bS;_9.Start((bS=null,_9.Delay(function(){return _9.While(function(){return true;},_9.Delay(function(){return _9.Bind(_9.Sleep(2*1000),function(){return _9.Bind(h.Agent().PostAndAsyncReply(function(bT){return{$:6,$0:bT};},null),function(bT){return _9.Bind((new $.New()).Async("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.MessageBus.GetMessages:1550733476",[bT]),function(bU){var bV;_8.iter(function(bW){var bX;bX=h.Agent();bX.mailbox.AddLast({$:1,$0:bW});bX.resume();},bU);return bU.get_Length()>0?(bV=(function(bW){return function(bX){return bW("Values from server requested messages received:"+a.String(bX));};}(a.id))(bU.get_Length()),(h.log())(bV),_9.Zero()):_9.Zero();});});});}));})),null);};h.Agent=function(){n.$cctor();return n.Agent;};h.SelectMessage=function(bS,bT){return h.CreateMessage(_6.UniqueKey(),new i({$:3,$0:[bS,bT]}));};h.StringMessage=function(bS){return h.StringKeyMessage(_6.UniqueKey(),bS);};h.NumberMessage=function(bS){return h.NumberKeyMessage(_6.UniqueKey(),bS);};h.BooleanKeyMesage=function(bS,bT){return h.CreateMessage(bS,new i({$:2,$0:bT}));};h.StringKeyMessage=function(bS,bT){return h.CreateMessage(bS,new i({$:1,$0:bT}));};h.NumberKeyMessage=function(bS,bT){return h.CreateMessage(bS,new i({$:0,$0:bT}));};h.CreateMessage=function(bS,bT){return j.New(bS,_7.now(),bT);};h.log=function(){n.$cctor();return n.log;};n.$cctor=_3.Cctor(function(){n.log=e.Log();n.Agent=bb.Start(function(bS){function bT(bY,bZ){return bc.fold(function(b0,b1){var b2;return(b2=b1.Time-bY,b2/1000)>0.01?new _8.T({$:1,$0:b1,$1:b0}):b0;},_8.T.Empty,bZ);}function bU(bY,bZ){return bY<bZ.get_Length()?(_8.splitAt(bY,bZ))[0]:bZ;}function bV(bY,bZ,b0){return bY===1?_8.ofArray([b0]):bU(bY,new _8.T({$:1,$0:b0,$1:bZ}));}function bW(bY,bZ){function b0(b1,b2,b3){var b4;b4=a.Array.prototype.slice.call(arguments);return b1.Key===bY.Key?(b2(bY),[b1,b2,bV(b1.CacheSize,b3,bY)]):b4;}return _8.map(function(b1){return b0(b1[0],b1[1],b1[2]);},bZ);}function bX(bY){var bZ;bZ=null;return _9.Delay(function(){return _9.Bind(bS.Receive(null),function(b0){var b1,b2,b3,b4,b5,b6,b7;function b8(b_,b$,ca){return bT(b3,ca);}function b9(b_,b$,ca){return ca.$==0?(new _7(0,0-1,0)).getTime():_8.maxBy(function(cb){return cb.Time;},ca).Time;}return b0.$==2?(b1=b0.$0[0],(b2=(((_3.Curried3(function(b_,b$,ca){return b_("RegisterListener:"+bd.toSafe(b$)+" "+bd.toSafe(ca));}))(a.id))(b1.Name))(b1.Key),(h.log())(b2),bX(m.New(bY.ServerCallback,new _8.T({$:1,$0:[b1,b0.$0[2],_8.T.Empty],$1:bY.Listeners}))))):b0.$==3?bX(m.New({$:1,$0:b0.$0},bY.Listeners)):b0.$==5?(b3=b0.$0[0],(b0.$0[1](bc.fold(function(b_,b$){return!_8.contains(b$,b_)?new _8.T({$:1,$0:b$,$1:b_}):b_;},_8.T.Empty,_8.concat(_8.map(function(b_){return b8(b_[0],b_[1],b_[2]);},bY.Listeners)))),bX(bY))):b0.$==6?(b4=_8.map(function(b_){return b9(b_[0],b_[1],b_[2]);},bY.Listeners),(b0.$0(b4.$==0?(new _7(0,0-1,0)).getTime():_8.max(b4)),bX(bY))):b0.$==1?bX(m.New(bY.ServerCallback,bW(b0.$0,bY.Listeners))):b0.$==0?(b5=b0.$0,(b6=(((_3.Curried3(function(b_,b$,ca){return b_("Num listeners:"+a.String(b$)+" msg:"+bd.toSafe(ca));}))(a.id))(bY.Listeners.get_Length()))(b5.Key),(h.log())(b6),(b7=bY.ServerCallback,b7==null?void 0:b7.$0(b5)),bX(m.New(bY.ServerCallback,bW(b5,bY.Listeners))))):bX(m.get_empty());});});}return bX(m.get_empty());},null);n.$cctor=a.ignore;});o.Create=function(bS,bT,bU){return o.New(bT.Key,bS,bT,bU);};o.New=function(bS,bT,bU,bV){return{Key:bS,Name:bT,Value:bU,CacheSize:bV};};p=d.InPort=_3.Class({Equals:function(bS){return bS instanceof p&&this.Data.Name===bS.Data.Name;},get_SelectView:function(){return bg.Map(function(bS){return bS.Value.get_AsSelect();},this.PortValue.v);},get_Select:function(){return this.PortValue.c.Value.get_AsSelect();},get_BooleanView:function(){return bg.Map(function(bS){return bS.Value.get_AsBoolean();},this.PortValue.v);},get_Boolean:function(){return this.PortValue.c.Value.get_AsBoolean();},get_StringView:function(){return bg.Map(function(bS){return bS.Value.get_AsString();},this.PortValue.v);},get_String:function(){return this.PortValue.c.Value.get_AsString();},get_NumberView:function(){return bg.Map(function(bS){return bS.Value.get_AsNumber();},this.PortValue.v);},get_Number:function(){return this.PortValue.c.Value.get_AsNumber();},Receive:function(bS){bh.Set(this.PortValue,bS);},get_Property:function(){var bS,bT,bU,bV,bW,bX,bY;bS=this;bT=this.PortValue.c.Value;return bT.$==1?(bU=bh.Create$1(this.get_String()),(bg.Sink(function(bZ){var b0;bh.Set(bS.PortValue,(b0=bS.PortValue.c,j.New(b0.Key,b0.Time,new i({$:1,$0:bZ}))));},bU.v),bj.string(this.Data.Name,bU))):bT.$==2?(bV=bh.Create$1(this.get_Boolean()),(bg.Sink(function(bZ){var b0;bh.Set(bS.PortValue,(b0=bS.PortValue.c,j.New(b0.Key,b0.Time,new i({$:2,$0:bZ}))));},bV.v),bj.check(this.Data.Name,bV))):bT.$==3?(bW=bT.$0[1],(bX=bh.Create$1(bW.get_Item(bT.$0[0])),(bg.Sink(function(bZ){var b0;bh.Set(bS.PortValue,(b0=bS.PortValue.c,j.New(b0.Key,b0.Time,new i({$:3,$0:[bc.findIndex(function(b1){return b1===bZ;},bW),bW]}))));},bX.v),bj.select(this.Data.Name,a.id,bW,bX)))):(bY=bh.Create$1(this.get_Number()),(bg.Sink(function(bZ){var b0;bh.Set(bS.PortValue,(b0=bS.PortValue.c,j.New(b0.Key,b0.Time,new i({$:0,$0:bZ}))));},bY.v),bj["double"](this.Data.Name,bY)));},get_Key:function(){return this.Data.Key;},get_Name:function(){return this.Data.Name;}},null,p);p.Clone=function(bS){var bT,bU;return p.New((bT=bS.Data,o.New((bU=bk.NewGuid(),a.String(bU)),bT.Name,bT.Value,bT.CacheSize)),bh.Create$1(bS.PortValue.c));};p.ToData=function(bS){var bT;bT=bS.Data;return o.New(bT.Key,bT.Name,bS.PortValue.c,bT.CacheSize);};p.FromData=function(bS){return p.New(bS,bh.Create$1(bS.Value));};p.New=function(bS,bT){return new p({Data:bS,PortValue:bT});};q=d.OutPort=_3.Class({Equals:function(bS){return bS instanceof q&&this.Name===bS.Name;},Trigger:function(bS){var bT;bT=h.Agent();bT.mailbox.AddLast({$:0,$0:h.CreateMessage(this.Key,bS)});bT.resume();}},null,q);q.Clone=function(bS){return q.New(_6.UniqueKey(),bS.Name,bS.Type);};q.ToData=function(bS){return[bS.Name,bS.Type];};q.FromData=function(bS,bT){return q.New(bT.Key,bS,bT);};q.New=function(bS,bT,bU){return new q({Key:bS,Name:bT,Type:bU});};r.CreateWithCache=function(bS,bT,bU){return r.New(bS,_8.map(function(bV){return o.Create(bV[0],bV[1],bV[2]);},bT),bU);};r.Create=function(bS,bT,bU){function bV(bW,bX){return o.Create(bW,bX,1);}return r.New(bS,_8.map(function(bW){return bV(bW[0],bW[1]);},bT),bU);};r.New=function(bS,bT,bU){return{WorkerName:bS,InPorts:bT,OutPorts:bU};};s=d.Worker=_3.Class({Equals:function(bS){return bS instanceof s&&bl.Equals(this.Name,bS.Name);},get_Properties:function(){return new _8.T({$:1,$0:bj.string("Name",this.Name),$1:_8.map(function(bS){return bS.get_Property();},this.InPorts)});},get_Render:function(){var bS;bS=this.Data.WebSharper_Community_Dashboard_IWorkerData$get_Render();return bS==null?bm.Empty():bS.$0(this);},get_Clone:function(){return s.New(_6.UniqueKey(),bh.Create$1(this.Name.c),_8.map(p.Clone,this.InPorts),_8.map(q.Clone,this.OutPorts),this.Data,bh.Create$1(null));},get_ToData:function(){return r.New(this.Name.c,_8.map(p.ToData,this.InPorts),_8.map(q.ToData,this.OutPorts));},StartRunner:function(){var bS;bS=this.Data.WebSharper_Community_Dashboard_IWorkerData$get_Run();bS==null?void 0:bh.Set(this.RunnerContext,bS.$0(this));},WithKey:function(bS){return s.New(bS,this.Name,this.InPorts,this.OutPorts,this.Data,this.RunnerContext);}},null,s);s.Create=function(bS){return s.New(_6.UniqueKey(),bh.Create$1(bS.WebSharper_Community_Dashboard_IWorkerData$get_Data().WorkerName),_8.map(p.FromData,bS.WebSharper_Community_Dashboard_IWorkerData$get_Data().InPorts),_8.map(function(bT){return q.FromData(bT[0],bT[1]);},bS.WebSharper_Community_Dashboard_IWorkerData$get_Data().OutPorts),bS,bh.Create$1(null));};s.New=function(bS,bT,bU,bV,bW,bX){return new s({Key:bS,Name:bT,InPorts:bU,OutPorts:bV,Data:bW,RunnerContext:bX});};t.allInPorts=function(bS){return t.allPorts(bS,function(bT){return bT.InPorts;});};t.allOutPorts=function(bS){return t.allPorts(bS,function(bT){return bT.OutPorts;});};t.allPorts=function(bS,bT){return _8.concat(_8.map(bT,bS));};u.New=function(bS,bT,bU){return{InPortKey:bS,OutPortKey:bT,WorkerKey:bU};};v.New=function(bS){return{RuleChain:bS};};w=d.RuleContainer=_3.Class({Reconnect:function(bS){var bT,bU,bV,bW;bT=e.Log();bU=t.allOutPorts(bS);bV=t.allInPorts(bS);_8.iter(function(bX){(e.Log())((((_3.Curried3(function(bY,bZ,b0){return bY("InPort: "+bd.toSafe(bZ)+" "+bd.toSafe(b0));}))(a.id))(bX.get_Name()))(bX.Data.Key));},bV);_8.iter(function(bX){(e.Log())((((_3.Curried3(function(bY,bZ,b0){return bY("outPort: "+bd.toSafe(bZ)+" "+bd.toSafe(b0));}))(a.id))(bX.Name))(bX.Key));},bU);bW=h.Agent();bW.mailbox.AddLast(l.Clear);bW.resume();_8.iter(function(bX){var bY,bZ,b0;bY=_8.ofSeq(bX.RuleChain);bZ=_8.ofSeq(_4.range(1,bY.get_Length()-1));b0=bn.Get(bZ);try{while(b0.MoveNext())(function(){var b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb;b6=b0.Current();b7=bY.get_Item(b6-1);b8=bY.get_Item(b6);b9=bc.tryFind(function(cc){return cc.Key===b7.OutPortKey;},bU);if(b9==null)null;else{b_=b9.$0;bT((((_3.Curried3(function(cc,cd,ce){return cc("Found outPort "+bd.toSafe(cd)+" try to find inPort:"+bd.toSafe(ce));}))(a.id))(b7.OutPortKey))(b8.InPortKey));b$=bc.tryFind(function(cc){return cc.Data.Key===b8.InPortKey;},bV);if(b$==null)b1=null;else{ca=b$.$0;bT("Found inPort");ca.PortValue.c.Key!==ca.Data.Key?bh.Set(ca.PortValue,ca.PortValue.c.WithKey(ca.Data.Key)):null;cb=ca.PortValue.c.Value;if(cb.$==0)b4=j.Create(new i({$:0,$0:0}));else if(cb.$==1)b4=j.Create(new i({$:1,$0:""}));else if(cb.$==2)b4=j.Create(new i({$:2,$0:false}));else throw new bo.New("Rules.fs",37,106);b3=(b5=h.Agent(),(b5.mailbox.AddLast({$:2,$0:[k.Create(b_.Key,b_.Name+"->"+ca.get_Name(),ca.Data.CacheSize),b4,function(cc){ca.Receive(cc);}]}),b5.resume()));b1={$:1,$0:b3};}({$:1,$0:b1});}}());}finally{if("Dispose"in b0)b0.Dispose();}},_8.ofSeq(this.RuleContainer));}},null,w);w.New=function(bS){return new w({RuleContainer:bS});};x.Create=function(bS){return x.New(bp.Fresh(),bS);};x.New=function(bS,bT){return{Key:bS,Worker:bT};};y=d.Factory=_3.Class({RegisterEvent:function(bS){this.EventItems.Append(x.Create(bS));},RegisterWidget:function(bS){this.WidgetItems.Append(x.Create(bS));}},null,y);y.get_Create=function(){return y.New(bq.Create(function(bS){return bS.Key;},_8.T.Empty),bq.Create(function(bS){return bS.Key;},_8.T.Empty));};y.New=function(bS,bT){return new y({EventItems:bS,WidgetItems:bT});};z=d.RulesCellItem=_3.Class({Render:function(bS,bT){var bU,bV,bW,bX,bY;bU=this;bg.Sink(function(bZ){var b0;if(bZ==null);else{b0=bZ.$0;br.log("Workitem selected");bh.Set(bU.OptInPort,_8.tryHead(b0.Worker.InPorts));bh.Set(bU.OptOutPort,_8.tryHead(b0.Worker.OutPorts));bT();}},this.OptWorker.v);bg.Sink(function(){bT();},this.OptInPort.v);bg.Sink(function(){bT();},this.OptOutPort.v);bV=(bW=bg.Map(function(bZ){var b0;return bZ==null?_8.ofArray([null]):(b0=_8.map(function(b1){return{$:1,$0:b1};},bZ.$0.Worker.InPorts),b0.get_Length()>0?b0:_8.ofArray([null]));},this.OptWorker.v),(bX=bg.Map(function(bZ){var b0;return bZ==null?_8.ofArray([null]):(b0=_8.map(function(b1){return{$:1,$0:b1};},bZ.$0.Worker.OutPorts),b0.get_Length()>0?b0:_8.ofArray([null]));},this.OptWorker.v),(bY=bg.Map(function(bZ){return new _8.T({$:1,$0:null,$1:_8.map(function(b0){return{$:1,$0:b0};},_8.ofSeq(bZ))});},bS.v),bm.Element("table",[],[bm.Element("tr",[],[bm.Element("td",[],[bm.SelectDyn([bs.Class("form-control")],function(bZ){return bt.fold(function(b0,b1){return b1.get_Name();}," ",bZ);},bW,this.OptInPort)]),bm.Element("td",[],[bm.SelectDyn([bs.Class("form-control")],function(bZ){return bt.fold(function(b0,b1){return b1.Worker.Name.c;}," ",bZ);},bY,this.OptWorker)]),bm.Element("td",[],[bm.SelectDyn([bs.Class("form-control")],function(bZ){return bt.fold(function(b0,b1){return b1.Name;}," ",bZ);},bX,this.OptOutPort)])])]))));return bm.Element("td",[bs.Class("td DshEditorCell")],[bm.Element("div",[bs.Class("div DshEditorCell")],[bm.Element("table",[],[bm.Element("tr",[],[bm.Element("td",[],[bV])])])])]);}},null,z);z.get_Create=function(){return z.New(bp.Fresh(),bh.Create$1(null),bh.Create$1(null),bh.Create$1(null));};z.New=function(bS,bT,bU,bV){return new z({Key:bS,OptInPort:bT,OptWorker:bU,OptOutPort:bV});};A=d.RulesRowItem=_3.Class({Render:function(bS,bT){var bU;bU=this;return bm.Element("tr",[],[bm.ConvertBy(function(bV){return bV.Key;},function(bV){return bV.Render(bS,bT);},this.CellItems.v),_6.IconNormal("add",function(){bU.CellItems.Append(z.get_Create());})]);}},null,A);A.Create=function(bS){return A.New(bp.Fresh(),bq.Create(function(bT){return bT.Key;},bS));};A.New=function(bS,bT){return new A({Key:bS,CellItems:bT});};B=d.SelectorGroup=_3.Class({RenderMenu:function(bS,bT,bU){var bV,bW,bX,bY,bZ,b0;function b1(b2){return _8.ofArray([_6.IconSmall("keyboard_arrow_down",function(){(bW(true))(b2);(bV.ItemOnMove(b2))({$:1});}),_6.IconSmall("keyboard_arrow_up",function(){(bW(false))(b2);(bV.ItemOnMove(b2))({$:0});}),_6.IconSmall("clear",function(){bV.SelectorItems.Remove(b2);bV.ItemOnDelete(b2);})]);}bV=this;bW=(bX=this.SelectorItems,(_3.Curried3(_6.MoveItemInModelList))(bX));bY=(bZ=this.ItemCreatator,bZ==null?bm.Element("tr",[],[]):(b0=bZ.$0,bm.Element("tr",[],[bm.Element("td",[],[bm.Element("div",[bs.Style("margin-left","20px")],[_6.IconSmall("add",function(){var b2;b2=b0();bV.ItemOnCreated(b2);bV.SelectorItems.Append(b2);})])])])));return bm.Element("table",[],[bm.ConvertBy(function(b2){return b2.WebSharper_Community_Dashboard_ISelectorItem$get_Key();},function(b2){var b3,b4,b5,b6;b3=bg.Map(function(b7){return bS+b7;},b2.WebSharper_Community_Dashboard_ISelectorItem$get_Name().v);return bm.Element("tr",[],[bm.Element("td",[bs.DynamicStyle("Color",bg.Map(function(b7){return b7==null?"#7D4600":bl.Equals(b7.$0.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),b2.WebSharper_Community_Dashboard_ISelectorItem$get_Key())?"#FB8C00":"#7D4600";},bT.v))],[(b4=bm.Element("div",[bs.Style("margin-left","10px"),bs.Style("margin-right","5px"),bs.Style("cursor","pointer"),bs.Handler("click",function(){return function(){bV.ItemOnSelected(b2);return bh.Set(bT,{$:1,$0:b2});};})],[bm.TextView(b3)]),(bU?(b5=b1(b2),(b6=_5.WrapControlsAligment.Horizontal,function(b7){return bu.Render(b5,b6,b7);})):a.id)(b4))])]);},this.SelectorItems.v),bY]);}},null,B);B.Create=function(bS,bT,bU,bV,bW,bX,bY){var bZ;bZ=bq.Create(function(b0){return b0.WebSharper_Community_Dashboard_ISelectorItem$get_Key();},bT);return B.New(bp.Fresh(),bh.Create$1(bS),bZ,bU,bV,bW,bX,bY);};B.New=function(bS,bT,bU,bV,bW,bX,bY,bZ){return new B({Key:bS,Name:bT,SelectorItems:bU,ItemCreatator:bV,ItemOnCreated:bW,ItemOnSelected:bX,ItemOnDelete:bY,ItemOnMove:bZ});};C=d.WindowSelector=_3.Class({get_RenderMenu:function(){var bS;bS=this;return this.SelectorGroups.get_Length()===1?_8.head(_8.ofSeq(this.SelectorGroups)).RenderMenu("",this.OptSelectedItem,this.IsWithControls):bm.Element("div",[],[bm.ConvertBy(function(bT){return bT.Key;},function(bT){return bm.Element("div",[],[bm.Element("div",[bs.Style("cursor","pointer"),bs.Handler("click",function(){return function(){return bS.GroupOnClick(bT);};})],[bm.TextView(bT.Name.v)]),bT.RenderMenu("    ",bS.OptSelectedItem,bS.IsWithControls)]);},this.SelectorGroups.v)]);},get_Render:function(){return bm.Element("div",[],[bm.BindView(function(bS){return bS==null?bm.Empty():bS.$0.WebSharper_Community_Dashboard_ISelectorItem$get_Render();},this.OptSelectedItem.v)]);},GroupByIndex:function(bS){return bc.nth(bS,_8.ofSeq(this.SelectorGroups));},get_SelectedIndex:function(){var bS;bS=this;return bc.findIndex(function(bT){return bl.Equals(bT.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bS.get_SelectedItem().WebSharper_Community_Dashboard_ISelectorItem$get_Key());},_8.concat(_8.map(function(bT){return _8.ofSeq(bT.SelectorItems);},_8.ofSeq(this.SelectorGroups))));},get_SelectedIndexInGroup:function(){var bS;bS=this;return bc.findIndex(function(bT){return bl.Equals(bT.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bS.get_SelectedItem().WebSharper_Community_Dashboard_ISelectorItem$get_Key());},_8.ofSeq(this.get_SelectedGroup().SelectorItems));},get_SelectedGroupIndex:function(){var bS;bS=this;return bc.findIndex(function(bT){return bl.Equals(bT.Key,bS.get_SelectedGroup().Key);},_8.ofSeq(this.SelectorGroups));},get_SelectedGroup:function(){return this.GroupFromItem(this.get_SelectedItem());},GroupFromItem:function(bS){return bc.find(function(bT){return _8.exists(function(bU){return bl.Equals(bU.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bS.WebSharper_Community_Dashboard_ISelectorItem$get_Key());},_8.ofSeq(bT.SelectorItems));},_8.ofSeq(this.SelectorGroups));},AppenGroup:function(bS,bT,bU){var bV;bV=this.SelectorGroups.get_Length();this.SelectorGroups.Append(B.Create(bS,bT,bU,this.ItemOnCreated(bV),this.ItemOnSelected,this.ItemOnDeleted(bV),this.ItemOnMove(bV)));},get_SelectedItem:function(){var bS;bS=this.OptSelectedItem.c;return bS==null?_4.FailWith("Something really wrong with WindowSelector"):bS.$0;},ClearGroups:function(){bh.Set(this.OptSelectedItem,null);_8.iter(function(bS){bS.SelectorItems.Clear();},_8.ofSeq(this.SelectorGroups));},WithControls:function(bS){return C.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,bS);},WithItemOnMove:function(bS){return C.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,bS,this.IsWithControls);},WithItemOnDeleted:function(bS){return C.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,bS,this.ItemOnMove,this.IsWithControls);},WithItemOnSelected:function(bS){return C.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,bS,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);},WithGroupOnClick:function(bS){return C.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,bS,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);},WithItemOnCreated:function(bS){return C.New(this.OptSelectedItem,this.SelectorGroups,bS,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);}},null,C);C.get_Create=function(){var bS;bS=bq.Create(function(bT){return bT.Key;},_8.T.Empty);return C.New(bh.Create$1(null),bS,function(){return function(){return null;};},a.ignore,a.ignore,function(){return function(){return null;};},_3.Curried3(function(bT,bU,bV){return null;}),false);};C.New=function(bS,bT,bU,bV,bW,bX,bY,bZ){return new C({OptSelectedItem:bS,SelectorGroups:bT,ItemOnCreated:bU,GroupOnClick:bV,ItemOnSelected:bW,ItemOnDeleted:bX,ItemOnMove:bY,IsWithControls:bZ});};D.Create=function(bS,bT){return D.New(bp.Fresh(),bS,bT);};D.New=function(bS,bT,bU){return{Key:bS,Panel:bT,Widget:bU};};E=d.EventsGroupItem=_3.Class({get_Render:function(){var bS,bT,bU;function bV(bW){return _8.ofArray([_6.IconSmall("keyboard_arrow_down",function(){(bT(true))(bW);}),_6.IconSmall("keyboard_arrow_up",function(){(bT(false))(bW);}),_6.IconSmall("clear",function(){bS.EventItems.Remove(bW);})]);}bS=this;bT=(bU=this.EventItems,(_3.Curried3(_6.MoveItemInModelList))(bU));return bm.Element("table",[],[bm.ConvertBy(function(bW){return bW.Key;},function(bW){var bX;return bm.Element("tr",[],[(bX=bm.Element("div",_6.AttrsClick(function(){bS.PropertyGrid.Edit(bW.Worker.get_Properties());}),[bm.TextView(bW.Worker.Name.v)]),bu.Render(bV(bW),_5.WrapControlsAligment.Horizontal,bX))]);},this.EventItems.v)]);},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,E);E.Create=function(bS,bT){return E.New(bp.Fresh(),bh.Create$1(bS),bq.Create(function(bU){return bU.Key;},_8.T.Empty),bT);};E.New=function(bS,bT,bU,bV){return new E({Key:bS,Name:bT,EventItems:bU,PropertyGrid:bV});};F=d.WidgetsGroupItem=_3.Class({get_Render:function(){return this.PanelContainer.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,F);F.Create=function(bS,bT){return F.New(bp.Fresh(),bh.Create$1(bS),bq.Create(function(bU){return bU.Key;},_8.T.Empty),bT);};F.New=function(bS,bT,bU,bV){return new F({Key:bS,Name:bT,WidgetItems:bU,PanelContainer:bV});};G=d.RulesGroupItem=_3.Class({Equals:function(bS){return bS instanceof G&&bl.Equals(this.Key,bS.Key);},get_Render:function(){return this.Renderer(this.RulesRowItems);},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,G);G.Create=function(bS,bT){return G.New(bp.Fresh(),bh.Create$1(bS),bq.Create(function(bU){return bU.Key;},_8.T.Empty),bT);};G.New=function(bS,bT,bU,bV){return new G({Key:bS,Name:bT,RulesRowItems:bU,Renderer:bV});};H=d.DshData=_3.Class({RegisterWidget:function(bS,bT,bU,bV){var bW;bW=bV.WithKey(bS);bT.WidgetItems.Append(D.Create(bU,bW));this.WorkItems.Append(x.Create(bW));},RegisterEvent:function(bS,bT,bU){var bV;bV=x.Create(bU.WithKey(bS));bT.EventItems.Append(bV);this.WorkItems.Append(bV);},get_Clear:function(){this.WorkItems.Clear();this.WidgetGroups.Clear();this.EventGroups.Clear();this.RulesGroups.Clear();}},null,H);H.get_Create=function(){return H.New(bq.Create(function(bS){return bS.Key;},_8.T.Empty),bq.Create(function(bS){return bS.Key;},_8.T.Empty),bq.Create(function(bS){return bS.Key;},_8.T.Empty),bq.Create(function(bS){return bS.Key;},_8.T.Empty));};H.New=function(bS,bT,bU,bV){return new H({WorkItems:bS,WidgetGroups:bT,EventGroups:bU,RulesGroups:bV});};I.Render=function(bS,bT){function bU(bX,bY){return _6.MoveItemInModelList(bT,bX,bY);}function bV(bX){return _8.ofArray([_6.IconSmall("keyboard_arrow_down",function(){bU(true,bX);}),_6.IconSmall("keyboard_arrow_up",function(){bU(false,bX);}),_6.IconSmall("clear",function(){bT.Remove(bX);})]);}function bW(){var bX;bX=_8.map(function(bY){return bY.Worker;},_8.ofSeq(bS.WorkItems));I.CopyToRules(bT).Reconnect(bX);}return bm.Element("table",[],[bm.ConvertBy(function(bX){return bX.Key;},function(bX){var bY;return bm.Element("tr",[],[(bY=bX.Render(bS.WorkItems,function(){bW();}),bu.Render(bV(bX),_5.WrapControlsAligment.Horizontal,bY))]);},bT.v)]);};I.Restore=function(bS,bT,bU){var bV,bW,bX;bT.Clear();bV=_8.map(function(bY){return bY.Worker;},_8.ofSeq(bS.WorkItems));bW=t.allOutPorts(bV);bX=t.allInPorts(bV);_8.iter(function(bY){var bZ;bZ=A.Create([]);_8.iter(function(b0){var b1;b1=z.get_Create();bh.Set(b1.OptWorker,bc.tryFind(function(b2){return b2.Worker.Key===b0.WorkerKey;},_8.ofSeq(bS.WorkItems)));bh.Set(b1.OptInPort,bc.tryFind(function(b2){return b2.get_Key()===b0.InPortKey;},bX));bh.Set(b1.OptOutPort,bc.tryFind(function(b2){return b2.Key===b0.OutPortKey;},bW));bZ.CellItems.Append(b1);},bY.RuleChain);bT.Append(bZ);},bU.RuleContainer);bU.Reconnect(bV);};I.CopyToRules=function(bS){return w.New(_8.map(function(bT){return v.New(_8.map(function(bU){var bV,bW,bX;return u.New((bV=bU.OptInPort.c,bV==null?"":bV.$0.get_Key()),(bW=bU.OptOutPort.c,bW==null?"":bW.$0.Key),(bX=bU.OptWorker.c,bX==null?"":bX.$0.Worker.Key));},_8.ofSeq(bT.CellItems)));},_8.ofSeq(bS)));};J.RulesGroupCreator=function(bS,bT){var bU;bU=G.Create("rules"+a.String(_8.length(_8.ofSeq(bS.RulesGroups))+1),function(bV){return I.Render(bS,bV);});bS.RulesGroups.Append(bU);return bU;};J.EventsGroupCreator=function(bS,bT,bU){var bV;bV=E.Create("event"+a.String(_8.length(_8.ofSeq(bS.EventGroups))+1),bT);bS.EventGroups.Append(bV);return bV;};J.PanelGroupCreator=function(bS,bT,bU){var bV;bV=F.Create("panel"+a.String(_8.length(_8.ofSeq(bS.WidgetGroups))+1),bT());bS.WidgetGroups.Append(bV);return bV;};K=d.Dashboard=_3.Class({Render:function(bS){var bT;bT=this;return bm.EmbedView(bg.Map(function(bU){return bU.$==1?bm.Element("div",[],[bm.Element("table",[],[bm.Element("tr",[],[bm.Element("td",[bs.Style("vertical-align","top")],[bm.Element("table",[],bc.concat([_8.ofArray([bm.Element("tr",[],[bm.Element("td",[],[_6.IconNormal("dehaze",function(){bh.Set(bT.PanelTitleVisibility,false);bh.Set(bT.Mode,{$:0});})])])]),_8.ofArray([bT.EditorSelectorEdit.get_RenderMenu()]),_8.ofArray([bm.Element("tr",[],[bm.Element("td",[],[])]),bm.Element("tr",[],[bm.Element("td",[],[bT.PropertyGrid.get_Render()])])])]))]),bm.Element("td",[bs.Style("vertical-align","top")],[bS,_6.IconNormal("add",function(){var bV,bW,bX,bY,bZ;bV=bT.EditorSelectorEdit.get_SelectedGroupIndex();bV===1?(bW=_8.ofSeq(bT.Factory.EventItems),bX=bh.Create$1(_8.head(bW)),bT.Dialog.ShowDialog("Select source",bm.Element("div",[],[bm.Select([bs.Class("form-control")],function(b0){return b0.Worker.Name.c;},bW,bX)]),function(){var b0,b1,b2;b0=bX.c.Worker.get_Clone();b0.StartRunner();b1=(b2=_8.ofSeq(bT.Data.EventGroups),bc.nth(bT.EditorSelectorEdit.get_SelectedIndexInGroup(),b2));bT.Data.RegisterEvent(_6.UniqueKey(),b1,b0);})):bV===0?bT.CreatePanel((bY=_8.ofSeq(bT.Data.WidgetGroups),bc.nth(bT.EditorSelectorEdit.get_SelectedIndexInGroup(),bY)),"Panel",700,null):bV===2?(bZ=_8.ofSeq(bT.Data.RulesGroups),bc.nth(bT.EditorSelectorEdit.get_SelectedIndexInGroup(),bZ)).RulesRowItems.Append(A.Create([z.get_Create(),z.get_Create()])):void 0;}),bT.EditorSelectorEdit.get_Render()])])]),bm.Element("div",[],[bT.Dialog.get_Render()])]):bm.Element("div",[],[bm.Element("table",[],[bm.Element("tr",[],[bm.Element("td",[bs.Style("vertical-align","top")],[_6.IconNormal("dehaze",function(){bh.Set(bT.PanelTitleVisibility,true);bh.Set(bT.Mode,{$:1});}),bT.EditorSelectorRun.GroupByIndex(0).SelectorItems.get_Length()>1?bT.EditorSelectorRun.get_RenderMenu():bm.Element("div",[],[])]),bm.Element("td",[],[bT.EditorSelectorRun.get_Render()])])])]);},this.Mode.v));},Restore:function(bS,bT,bU,bV){var bW,bX,bY,bZ,b0;bW=this;this.EditorSelectorRun.ClearGroups();this.EditorSelectorEdit.ClearGroups();this.Data.get_Clear();bX=this.EditorSelectorRun.GroupByIndex(0);bY=this.EditorSelectorEdit.GroupByIndex(0);bZ=this.EditorSelectorEdit.GroupByIndex(1);b0=this.EditorSelectorEdit.GroupByIndex(2);_8.iteri(function(b1,b2){var b3,b4;function b5(b6,b7,b8){bW.RegisterWidget(b6,b4,b7,bc.find(function(b9){return b9.Key===b7;},_8.ofSeq(b4.PanelContainer.PanelItems)).Children,(b8.StartRunner(),b8));}b3=J.PanelGroupCreator(bW.Data,bS,null);bh.Set(b3.WebSharper_Community_Dashboard_ISelectorItem$get_Name(),b2[0]);bY.SelectorItems.Append(b3);bX.SelectorItems.Append(b3);b4=bc.nth(b1,_8.ofSeq(bW.Data.WidgetGroups));_8.iter(function(b6){var b7;b7=bW.CreatePanel(b4,"Panel",700,{$:1,$0:b6.Key});bh.Set(b7.Left,b6.Left);bh.Set(b7.Top,b6.Top);},b2[1]);return _8.iter(function(b6){return b5(b6[0],b6[1],b6[2]);},b2[2]);},bU);br.log("Widgets restored");_8.iteri(function(b1,b2){var b3,b4;function b5(b6,b7){bW.Data.RegisterEvent(b6,b4,b7);}b3=J.EventsGroupCreator(bW.Data,bW.PropertyGrid,null);bh.Set(b3.WebSharper_Community_Dashboard_ISelectorItem$get_Name(),b2[0]);bZ.SelectorItems.Append(b3);b4=bc.nth(b1,_8.ofSeq(bW.Data.EventGroups));return _8.iter(function(b6){return b5(b6[0],b6[1]);},b2[1]);},bT);br.log("Events restored");_8.iteri(function(b1,b2){var b3;b3=J.RulesGroupCreator(bW.Data,null);bh.Set(b3.WebSharper_Community_Dashboard_ISelectorItem$get_Name(),b2[0]);b0.SelectorItems.Append(b3);return I.Restore(bW.Data,bc.nth(b1,_8.ofSeq(bW.Data.RulesGroups)).RulesRowItems,b2[1]);},bV);this.Data.WidgetGroups.get_Length()>0?(bh.Set(this.EditorSelectorEdit.OptSelectedItem,{$:1,$0:_8.head(_8.ofSeq(this.EditorSelectorEdit.GroupByIndex(0).SelectorItems))}),bh.Set(this.EditorSelectorRun.OptSelectedItem,{$:1,$0:_8.head(_8.ofSeq(this.EditorSelectorRun.GroupByIndex(0).SelectorItems))})):(bh.Set(this.EditorSelectorEdit.OptSelectedItem,null),bh.Set(this.EditorSelectorRun.OptSelectedItem,null));br.log("Connectors restored");return[_8.concat(_8.map(function(b1){return _8.map(function(b2){return b2.Worker;},_8.ofSeq(b1.EventItems));},_8.ofSeq(this.Data.EventGroups))),_8.concat(_8.map(function(b1){return _8.map(function(b2){return b2.Widget;},_8.ofSeq(b1.WidgetItems));},_8.ofSeq(this.Data.WidgetGroups)))];},Store:function(bS){function bT(bV,bW){var bX;bX=bS(bW);return bX==null?bV:new _8.T({$:1,$0:[bW.Key,bX.$0],$1:bV});}function bU(bV,bW,bX){var bY;bY=bS(bX);return bY==null?bV:new _8.T({$:1,$0:[bX.Key,bW,bY.$0],$1:bV});}return[_8.map(function(bV){return[bV.Name.c,_8.rev(bc.fold(function(bW,bX){return bT(bW,bX.Worker);},_8.T.Empty,_8.ofSeq(bV.EventItems)))];},_8.ofSeq(this.Data.EventGroups)),_8.map(function(bV){return[bV.Name.c,_8.map(function(bW){return bW.get_PanelData();},_8.ofSeq(bV.PanelContainer.PanelItems)),_8.rev(bc.fold(function(bW,bX){return bU(bW,bX.Panel,bX.Widget);},_8.T.Empty,_8.ofSeq(bV.WidgetItems)))];},_8.ofSeq(this.Data.WidgetGroups)),_8.map(function(bV){return[bV.Name.c,I.CopyToRules(bV.RulesRowItems)];},_8.ofSeq(this.Data.RulesGroups))];},CreatePanel:function(bS,bT,bU,bV){var bW,bX,bY,bZ,b0,b1;bW=this;bm.ConvertBy(bS.WidgetItems.key,function(b2){return bm.Element("div",[],[bm.TextView(b2.Widget.Name.v)]);},bS.WidgetItems.v);bX=(bY=(bZ=bk.NewGuid(),a.String(bZ)),bV==null?bY:bV.$0);b0=bv.get_Create().WithLayoutManager(bw.StackPanelLayoutManager()).WithAttributes([bs.Style("border","1px solid white"),bs.Style("display","flex")]);b1=bx.get_Create().WithKey(bX).WithPannelAttrs([bs.Style("Width",a.String(bU)+"px"),bs.Style("position","absolute")]).WithTitle(this.PanelTitleVisibility).WithTitleContent(bm.TextNode(bT)).WithTitleButtons(_8.ofArray([by.New("add",function(b2){var b3,b4;b3=_8.ofSeq(bW.Factory.WidgetItems);b4=bh.Create$1(_8.head(b3));bW.Dialog.ShowDialog("Select widget",bm.Element("div",[],[bm.Select([bs.Class("form-control")],function(b5){return b5.Worker.Name.c;},b3,b4)]),function(){var b5;br.log("Dialog.IsOK");b5=b4.c.Worker.get_Clone();b5.StartRunner();bW.RegisterWidget(_6.UniqueKey(),bS,b2.Key,b2.Children,b5);});}),by.New("edit",function(b2){br.log("Edit");bW.PropertyGrid.Edit(_8.concat(_8.map(function(b3){return b3.Widget.get_Properties();},_8.filter(function(b3){return b3.Panel===b2.Key;},_8.ofSeq(bS.WidgetItems)))));}),by.New("clear",function(b2){bS.PanelContainer.PanelItems.Remove(bS.PanelContainer.FindPanelItem(b2));bS.WidgetItems.RemoveBy(function(b3){return b3.Panel===b2.Key;});})])).WithChildPanelContainer(b0);bS.PanelContainer.AddPanel(b1);return b1;},RegisterWidget:function(bS,bT,bU,bV,bW){var bX;this.Data.RegisterWidget(bS,bT,bU,bW);bX=bx.get_Create().WithPanelContent(bW.get_Render());bh.Set(bX.IsWithTitle,false);bV.AddPanel(bX);}},null,K);K.Create=function(bS){var bT,bU,bV,bW,bX,bY;function bZ(){return J.PanelGroupCreator(bU,bS,void 0);}function b0(){return J.EventsGroupCreator(bU,bV,void 0);}function b1(){return J.RulesGroupCreator(bU,void 0);}bT=bz.get_Create();bU=H.get_Create();bV=bA.get_Create();bW=C.get_Create();bX=C.get_Create().WithGroupOnClick(function(b2){bV.Edit(_8.mapi(function(b3,b4){var b5;return bj.string((b5=b3+1,a.String(b5)),b4.WebSharper_Community_Dashboard_ISelectorItem$get_Name());},_8.ofSeq(b2.SelectorItems)));}).WithItemOnSelected(function(){bV.Edit(_8.T.Empty);}).WithItemOnCreated(function(b2){return function(b3){return b2===0?_8.head(_8.ofSeq(bW.SelectorGroups)).SelectorItems.Append(b3):null;};}).WithItemOnDeleted(function(){return function(){return null;};}).WithItemOnDeleted(function(b2){return function(b3){b3 instanceof F?bU.WidgetGroups.Remove(b3):b3 instanceof E?bU.EventGroups.Remove(b3):b3 instanceof G?bU.RulesGroups.Remove(b3):_4.FailWith("WithItemOnDeleted, type unknown");return b2===0?_8.head(_8.ofSeq(bW.SelectorGroups)).SelectorItems.Remove(b3):null;};}).WithItemOnMove(_3.Curried3(function(b2,b3,b4){var b5;b5=b4.$==1&&true;return b3 instanceof F?(_6.MoveItemInModelList(bU.WidgetGroups,b5,b3),_6.MoveItemInModelList(_8.head(_8.ofSeq(bW.SelectorGroups)).SelectorItems,b5,b3)):b3 instanceof E?_6.MoveItemInModelList(bU.EventGroups,b5,b3):b3 instanceof G?_6.MoveItemInModelList(bU.RulesGroups,b5,b3):_4.FailWith("WithItemOnDeleted, type unknown");})).WithControls(true);bY=bZ();bX.AppenGroup("Panels",_8.ofArray([bY]),{$:1,$0:bZ});bW.AppenGroup("Panels",_8.ofArray([bY]),null);bX.AppenGroup("Events",_8.ofArray([b0()]),{$:1,$0:b0});bX.AppenGroup("Rules",_8.ofArray([b1()]),{$:1,$0:b1});bh.Set(bX.OptSelectedItem,{$:1,$0:_8.head(_8.ofSeq(bX.GroupByIndex(0).SelectorItems))});bh.Set(bW.OptSelectedItem,{$:1,$0:_8.head(_8.ofSeq(bW.GroupByIndex(0).SelectorItems))});return K.New(y.get_Create(),bU,bV,bT,bW,bX,bh.Create$1({$:0}),bh.Create$1(false));};K.New=function(bS,bT,bU,bV,bW,bX,bY,bZ){return new K({Factory:bS,Data:bT,PropertyGrid:bU,Dialog:bV,EditorSelectorRun:bW,EditorSelectorEdit:bX,Mode:bY,PanelTitleVisibility:bZ});};M=L.RandomEvent=_3.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bS){var bT;new bB.New();_9.Start((bT=null,_9.Delay(function(){return _9.While(function(){return true;},_9.Delay(function(){return _9.Bind(_9.Sleep(bS.InPorts.get_Item(2).get_Number()*1000>>0),function(){var bU,bV,bW;bU=bS.InPorts.get_Item(0).get_Number();bV=bS.InPorts.get_Item(1).get_Number();bW=bC.random()*bV+bU;bS.OutPorts.get_Item(0).Trigger(new i({$:0,$0:bW}));return _9.Zero();});}));})),null);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.RandomEventData;}},null,M);M.get_FromWorker=function(){return function(bS){return M.New(bS.get_ToData());};};M.get_Create=function(){return M.New(r.Create("Random",_8.ofArray([["Middle value",h.NumberMessage(100)],["Dispersion",h.NumberMessage(10)],["Delay sec.",h.NumberMessage(2)]]),_8.ofArray([["Random value",h.NumberMessage(0)]])));};M.New=function(bS){return new M({RandomEventData:bS});};N.New=function(bS){return{DatabaseEventRun:bS};};O=L.DatabaseEvent=_3.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bS){var bT;bT=true;bg.Sink(function(bU){bT?(_8.iter(function(bV){var bW;bW=h.Agent();bW.mailbox.AddLast({$:0,$0:bV});bW.resume();},(new $.New()).Sync("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.Events.ServerDatabase.ReadAllMessages:965639103",[bS.InPorts.get_Item(1).get_String()])),bT=false):((new $.New()).Send("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.Events.ServerDatabase.WriteMessage:-353093100",[bS.InPorts.get_Item(1).get_String(),bU.WithKey(bS.OutPorts.get_Item(0).Key)]),bS.OutPorts.get_Item(0).Trigger(bU.Value));},bS.InPorts.get_Item(0).PortValue.v);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.DatabaseEventData;}},null,O);O.get_FromWorker=function(){return function(bS){return O.New(bS.get_ToData());};};O.get_Create=function(){return O.New(r.Create("Database",_8.ofArray([[" in Value",h.NumberMessage(100)],["Database name",h.StringMessage("Database.txt")]]),_8.ofArray([["Number value",h.NumberMessage(0)]])));};O.New=function(bS){return new O({DatabaseEventData:bS});};Q.New=function(bS,bT,bU,bV,bW){return{Title:bS,Description:bT,ImageUrl:bU,Temperature:bV,TemparatureMinMax:bW};};P.get=function(bS,bT){var bU;bU=null;return _9.Delay(function(){var bV;bV=(((_3.Curried3(function(bW,bX,bY){return bW("http://api.openweathermap.org/data/2.5/weather?q="+bd.toSafe(bX)+"&units=metric&appid="+bd.toSafe(bY));}))(a.id))(bT))(bS);(e.Log())("get key city "+bV);return _9.TryWith(_9.Delay(function(){return _9.Bind(bE.AsyncMap(bI.asyncReadTextAtRuntime(false,"C:\\AEAFrame\\WebSharper.Community.Dashboard\\WebSharper.Community.Dashboard","","JSON","",bV),function(bW){return bl.Equals(typeof bW,"string")?bJ.parse(bW):bW;}),function(bW){var bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch;(e.Log())("get key city 2");return _9.Return((bX=bK.tryHead(bW.weather),bX==null?null:{$:1,$0:(bY=bX.$0,Q.New((((_3.Curried3(function(ci,cj,ck){return ci(bd.toSafe(cj)+", "+bd.toSafe(ck));}))(a.id))((b0=(bZ="name",bZ in bW?{$:1,$0:bW[bZ]}:null),b0==null?null:b0.$0)))((b3=(b1=bW.sys,(b2="country",b2 in b1?{$:1,$0:b1[b2]}:null)),b3==null?null:b3.$0)),(b5=(b4="main",b4 in bY?{$:1,$0:bY[b4]}:null),b5==null?null:b5.$0),(function(ci){return function(cj){return ci("http://openweathermap.org/img/w/"+bd.toSafe(cj)+".png");};}(a.id))((b7=(b6="icon",b6 in bY?{$:1,$0:bY[b6]}:null),b7==null?null:b7.$0)),(b8=(b9=bW.main,(b_="temp",b_ in b9?{$:1,$0:b9[b_]}:null)),(b$=b8==null?null:{$:1,$0:1*b8.$0},b$==null?null:b$.$0)),[(ca=(cb=bW.main,(cc="temp_min",cc in cb?{$:1,$0:cb[cc]}:null)),(cd=ca==null?null:{$:1,$0:1*ca.$0},cd==null?null:cd.$0)),(ce=(cf=bW.main,(cg="temp_max",cg in cf?{$:1,$0:cf[cg]}:null)),(ch=ce==null?null:{$:1,$0:1*ce.$0},ch==null?null:ch.$0))]))}));});}),function(bW){(e.Log())(bW.message);return _9.Return(null);});});};R=L.OpenWeatherEvent=_3.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bS){var bT;_9.Start((bT=null,_9.Delay(function(){return _9.While(function(){return true;},_9.Delay(function(){var bU,bV,bW;bU=bS.InPorts.get_Item(0);bV=bS.InPorts.get_Item(1);bW=bS.OutPorts.get_Item(0);return _9.Bind(P.get(bV.get_String(),bU.get_String()),function(bX){return _9.Combine(bX==null?_9.Zero():((e.Log())("Value generated:"+bX.$0.Title),bW.Trigger(new i({$:0,$0:+bX.$0.Temperature})),_9.Zero()),_9.Delay(function(){return _9.Bind(_9.Sleep(1000*15),function(){return _9.Return(null);});}));});}));})),null);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.OpenWeatherEventData;}},null,R);R.get_FromWorker=function(){return function(bS){return R.New(bS.get_ToData());};};R.Create=function(bS,bT){return R.New(r.Create("OpenWeatherMap",_8.ofArray([["City",h.StringMessage(bS)],["ApiKey",h.StringMessage(bT)]]),_8.ofArray([["Temperature",h.NumberMessage(0)]])));};R.New=function(bS){return new R({OpenWeatherEventData:bS});};T=S.TextBoxWidget=_3.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bS){var bT;bT=bg.Map(function(bU){var bV;bV=bU>>0;return a.String(bV);},bS.InPorts.get_Item(0).get_NumberView());return bm.Element("div",[bs.Class("bigvalue")],[bm.TextView(bT)]);}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.TextBoxWidgetData;}},null,T);T.get_FromWorker=function(){return function(bS){return T.New(bS.get_ToData());};};T.get_Create=function(){return T.New(r.Create("Text",_8.ofArray([["in Value",h.NumberMessage(0)]]),_8.T.Empty));};T.New=function(bS){return new T({TextBoxWidgetData:bS});};U.New=function(bS,bT){return{LineChart:bS,Source:bT};};V=S.ChartWidget=_3.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bS){var bT,bU,bV,bW,bX,bY,bZ,b0,b1;bT=bS.InPorts.get_Item(3).get_Number()>>0;bU=bS.RunnerContext.c.$0;bV=(bW={},bW.title=(bX={},bX.display=false,bX),bW.legend=(bY={},bY.display=false,bY),bW.elements=(bZ={},bZ.point=(b0={},b0.radius=0,b0),bZ.line=(b1={},b1.borderWidth=1,b1),bZ),bW);return bN.Render$8(bU.LineChart,{$:1,$0:{$:0,$0:bS.InPorts.get_Item(1).get_Number()>>0,$1:bS.InPorts.get_Item(2).get_Number()>>0}},{$:1,$0:bV},{$:1,$0:bT});}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bS){var bT;bS.InPorts.get_Item(3).get_Number();bT=new bO.New();bg.Sink(function(bU){var bV;bV=(bS.InPorts.get_Item(4).PortValue.c.Value.get_AsSelect())[0];bT.event.Trigger([bV===0?bP.LongTime(bU.Time):bV===1?bP.ShortTime(bU.Time):bV===2?bP.LongDate(bU.Time):bV===3?(new _7(bU.Time)).toLocaleDateString():"",bU.Value.get_AsNumber()]);},bS.InPorts.get_Item(0).PortValue.v);return{$:1,$0:U.New(bQ.Line$1(bT.event).WithFill(false).__WithStrokeColor(new bR.Color({$:1,$0:"#FB8C00"})).__WithPointColor(new bR.Color({$:2,$0:"black"})),bT)};}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.ChartWidgetData;}},null,V);V.get_FromWorker=function(){return function(bS){return V.New(bS.get_ToData());};};V.get_Create=function(){var bS;bS=20;return V.New(r.CreateWithCache("Chart",_8.ofArray([[" in Value",h.NumberMessage(100),bS],["cx",h.NumberMessage(300),1],["cy",h.NumberMessage(150),1],["BufferSize",h.NumberMessage(bS),1],["X-Axis",h.SelectMessage(0,_8.ofArray(["long time","short time","long date","short date"])),1]]),_8.T.Empty));};V.New=function(bS){return new V({ChartWidgetData:bS});};W=S.ButtonWidget=_3.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bS){return bm.ButtonView(bS.InPorts.get_Item(0).get_String(),[],bS.InPorts.get_Item(1).get_BooleanView(),function(bT){bS.OutPorts.get_Item(0).Trigger(new i({$:2,$0:bT}));});}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.ButtonWidgetData;}},null,W);W.get_FromWorker=function(){return function(bS){return W.New(bS.get_ToData());};};W.get_Create=function(){return W.New(r.Create("Button",_8.ofArray([["Caption",h.StringMessage("Button")],["State",h.NumberMessage(0)]]),_8.ofArray([["Button value",h.NumberMessage(0)]])));};W.New=function(bS){return new W({ButtonWidgetData:bS});};X.FromWorker=function(bS){var bT;bT=bS.Data;return bT instanceof M?{$:1,$0:{$:0,$0:(M.get_FromWorker())(bS)}}:bT instanceof R?{$:1,$0:{$:1,$0:(R.get_FromWorker())(bS)}}:bT instanceof O?{$:1,$0:{$:2,$0:(O.get_FromWorker())(bS)}}:bT instanceof T?{$:1,$0:{$:3,$0:(T.get_FromWorker())(bS)}}:bT instanceof V?{$:1,$0:{$:4,$0:(V.get_FromWorker())(bS)}}:bT instanceof W?{$:1,$0:{$:5,$0:(W.get_FromWorker())(bS)}}:null;};X.ToWorker=function(bS){return bS.$==1?s.Create(bS.$0):bS.$==2?s.Create(bS.$0):bS.$==3?s.Create(bS.$0):bS.$==4?s.Create(bS.$0):bS.$==5?s.Create(bS.$0):s.Create(bS.$0);};Y.CreateDashboard=function(){Z.$cctor();return Z.CreateDashboard;};Y.PanelContainerCreator=function(bS){return bv.get_Create().WithLayoutManager(bw.FloatingPanelLayoutManager(5)).WithWidth(800).WithHeight(420).WithAttributes([bs.Style("border","1px solid white")]);};Y.RegisterAppModelLib=function(bS){function bT(bV){Y.RegisterEventGeneral(bS,bV);}function bU(bV){Y.RegisterWidgetGeneral(bS,bV);}bT(R.Create("London",""));bT(M.get_Create());bT(O.get_Create());bU(T.get_Create());bU(V.get_Create());bU(W.get_Create());return bS;};Y.RegisterWidgetGeneral=function(bS,bT){var bU;Y.Register((bU=bS.Factory,function(bV){bU.RegisterWidget(bV);}),bT);};Y.RegisterEventGeneral=function(bS,bT){var bU;Y.Register((bU=bS.Factory,function(bV){bU.RegisterEvent(bV);}),bT);};Y.Register=function(bS,bT){return bS(s.Create(bT));};Z.$cctor=_3.Cctor(function(){Z.CreateDashboard=Y.RegisterAppModelLib(K.Create(function(){return Y.PanelContainerCreator();}));Z.$cctor=a.ignore;});_0.RecreatWidgetsOnServer=function(bS,bT){function bU(bW,bX,bY){return bY;}function bV(bW,bX,bY){return bY;}return _8.map(function(bW){return bU(bW[0],bW[1],bW[2]);},_8.concat(_8.map(function(bW){return bV(bW[0],bW[1],bW[2]);},_0.RecreateWidgets(bS,bT))));};_0.RecreateEventsOnServer=function(bS,bT){function bU(bW,bX){return bX;}function bV(bW,bX){return bX;}return _8.map(function(bW){return bU(bW[0],bW[1]);},_8.concat(_8.map(function(bW){return bV(bW[0],bW[1]);},_0.RecreateEvents(bS,bT))));};_0.RecreateOnClient=function(bS,bT,bU,bV,bW,bX,bY){var bZ;e.set_Role(f.Client);bZ=h.Agent();bZ.mailbox.AddLast({$:3,$0:function(b0){(new $.New()).Send("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.MessageBus.SendToServer:-1358505674",[b0]);}});bZ.resume();_8.iter(bS,(bT.Restore(bU,_0.RecreateEvents(bV,bW),_0.RecreateWidgets(bV,bX),bY))[0]);};_0.RecreateWidgets=function(bS,bT){function bU(bV,bW,bX){function bY(bZ,b0,b1){return[bZ,b0,bS(b1)];}return[bV,bW,_8.map(function(bZ){return bY(bZ[0],bZ[1],bZ[2]);},bX)];}return _8.map(function(bV){return bU(bV[0],bV[1],bV[2]);},bT);};_0.RecreateEvents=function(bS,bT){function bU(bV,bW){function bX(bY,bZ){return[bY,bS(bZ)];}return[bV,_8.map(function(bY){return bX(bY[0],bY[1]);},bW)];}return _8.map(function(bV){return bU(bV[0],bV[1]);},bT);};_1=d.AppData=_3.Class({RecreateOnServer:function(bS){var bT,bU;function bV(bW,bX){bX.Reconnect(bU);}bT=_0.RecreateEventsOnServer(bS,this.Events);bU=_8.append(bT,_0.RecreatWidgetsOnServer(bS,this.Widgets));_8.iter(function(bW){return bV(bW[0],bW[1]);},this.Rules);_8.iter(function(bW){bW.StartRunner();},bU);return bT;},RecreateOnClientEventsRunning:function(bS,bT,bU){_0.RecreateOnClient(function(bV){bV.StartRunner();},bS,bT,bU,this.Events,this.Widgets,this.Rules);},RecreateOnClientEventsNotRunning:function(bS,bT,bU){_0.RecreateOnClient(a.ignore,bS,bT,bU,this.Events,this.Widgets,this.Rules);}},null,_1);_1.Create=function(bS,bT){var bU;bU=bS.Store(bT);return _1.New(bU[0],bU[1],bU[2]);};_1.empty=function(){return _1.New(_8.T.Empty,_8.T.Empty,_8.T.Empty);};_1.New=function(bS,bT,bU){return new _1({Events:bS,Widgets:bT,Rules:bU});};}());
