(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Community=b.Community||{};d=c.Dashboard=c.Dashboard||{};e=d.Environment=d.Environment||{};f=e.Role=e.Role||{};g=a.StartupCode$WebSharper_Community_Dashboard$Environment=a.StartupCode$WebSharper_Community_Dashboard$Environment||{};h=d.MessageBus=d.MessageBus||{};i=h.Value=h.Value||{};j=h.Message=h.Message||{};k=h.ListenerInfo=h.ListenerInfo||{};l=h.AgentMessage=h.AgentMessage||{};m=h.AgentState=h.AgentState||{};n=a.StartupCode$WebSharper_Community_Dashboard$MessageBus=a.StartupCode$WebSharper_Community_Dashboard$MessageBus||{};o=d.InPort=d.InPort||{};p=d.OutPortType=d.OutPortType||{};q=d.OutPort=d.OutPort||{};r=d.Ports=d.Ports||{};s=d.Worker=d.Worker||{};t=d.Workers=d.Workers||{};u=d.RandomRunner=d.RandomRunner||{};v=d.OpenWeather=d.OpenWeather||{};w=v.Forecast=v.Forecast||{};x=d.OpenWeatherRunner=d.OpenWeatherRunner||{};y=d.DatabaseRunnerContext=d.DatabaseRunnerContext||{};z=d.DatabaseRunner=d.DatabaseRunner||{};A=d.ChartRunnerContext=d.ChartRunnerContext||{};B=d.ChartRenderer=d.ChartRenderer||{};C=d.TextBoxRenderer=d.TextBoxRenderer||{};D=d.ButtonRenderer=d.ButtonRenderer||{};E=d.RuleEntry=d.RuleEntry||{};F=d.RuleChain=d.RuleChain||{};G=d.RuleContainer=d.RuleContainer||{};H=d.WorkerItem=d.WorkerItem||{};I=d.Factory=d.Factory||{};J=d.SelectorItem=d.SelectorItem||{};K=d.SelectorGroup=d.SelectorGroup||{};L=d.WindowSelector=d.WindowSelector||{};M=d.RulesCellItem=d.RulesCellItem||{};N=d.RulesRowItem=d.RulesRowItem||{};O=d.WidgetItem=d.WidgetItem||{};P=d.EventsGroupItem=d.EventsGroupItem||{};Q=d.WidgetsGroupItem=d.WidgetsGroupItem||{};R=d.RulesGroupItem=d.RulesGroupItem||{};S=d.DshData=d.DshData||{};T=d.EventsEditor=d.EventsEditor||{};U=d.RulesEditor=d.RulesEditor||{};V=d.DshHelper=d.DshHelper||{};W=d.Dashboard=d.Dashboard||{};X=d.AppModelLib=d.AppModelLib||{};Y=d.App=d.App||{};Z=a.StartupCode$WebSharper_Community_Dashboard$AppModelLib=a.StartupCode$WebSharper_Community_Dashboard$AppModelLib||{};_0=d.AppDataHelper=d.AppDataHelper||{};_1=d.AppData=d.AppData||{};_2=a.IntelliFactory;_3=_2&&_2.Runtime;_4=b&&b.Operators;_5=c&&c.Panel;_6=_5&&_5.Helper;_7=a.Date;_8=b&&b.List;_9=b&&b.Concurrency;_=b&&b.Remoting;$=_&&_.AjaxRemotingProvider;ba=b&&b.Control;bb=ba&&ba.MailboxProcessor;bc=b&&b.Seq;bd=b&&b.PrintfHelpers;be=b&&b.UI;bf=be&&be.Next;bg=bf&&bf.View;bh=bf&&bf.Var;bi=c&&c.PropertyGrid;bj=bi&&bi.Properties;bk=b&&b.Guid;bl=b&&b.Unchecked;bm=bf&&bf.Doc;bn=b&&b.Random;bo=a.Math;bp=a.console;bq=b&&b.Data;br=bq&&bq.TxtRuntime;bs=a.FSharp;bt=bs&&bs.Data;bu=bt&&bt.Runtime;bv=bu&&bu.IO;bw=a.JSON;bx=b&&b.Arrays;by=b&&b.Charting;bz=by&&by.Renderers;bA=bz&&bz.ChartJs;bB=by&&by.Chart;bC=by&&by.Pervasives;bD=bf&&bf.AttrModule;bE=b&&b.Enumerator;bF=bf&&bf.Key;bG=bf&&bf.ListModel;bH=b&&b.Option;bI=_5&&_5.PanelContainer;bJ=_5&&_5.LayoutManagers;bK=_5&&_5.Panel;bL=_5&&_5.TitleButton;bM=_5&&_5.Dialog;bN=bi&&bi.PropertyGrid;f.Server={$:1};f.Client={$:0};e.DataDirectory=function(){g.$cctor();return g.DataDirectory;};e.set_DataDirectory=function(bO){g.$cctor();g.DataDirectory=bO;};e.Log=function(){g.$cctor();return g.Log;};e.set_Log=function(bO){g.$cctor();g.Log=bO;};e.Role$1=function(){g.$cctor();return g.Role;};e.set_Role=function(bO){g.$cctor();g.Role=bO;};g.$cctor=_3.Cctor(function(){g.Role=f.Server;g.Log=a.ignore;g.DataDirectory="";g.$cctor=a.ignore;});i=h.Value=_3.Class({get_AsBoolean:function(){return this.$==2?this.$0:_4.FailWith("MessageBus.Value: unexpected type");},get_AsString:function(){return this.$==1?this.$0:_4.FailWith("MessageBus.Value: unexpected type");},get_AsNumber:function(){return this.$==0?this.$0:_4.FailWith("MessageBus.Value: unexpected type");}},null,i);j=h.Message=_3.Class({WithKey:function(bO){return j.New(bO,this.Time,this.Value);}},null,j);j.Create=function(bO){return j.New(_6.UniqueKey(),_7.now(),bO);};j.New=function(bO,bP,bQ){return new j({Key:bO,Time:bP,Value:bQ});};k.Create=function(bO,bP,bQ){return k.New(bO,bP,bQ);};k.New=function(bO,bP,bQ){return{Key:bO,Name:bP,CacheSize:bQ};};l.Clear={$:4};m.get_empty=function(){return m.New(null,_8.T.Empty);};m.New=function(bO,bP){return{ServerCallback:bO,Listeners:bP};};h.RunServerRequests=function(){var bO;_9.Start((bO=null,_9.Delay(function(){return _9.While(function(){return true;},_9.Delay(function(){return _9.Bind(_9.Sleep(2*1000),function(){return _9.Bind(h.Agent().PostAndAsyncReply(function(bP){return{$:6,$0:bP};},null),function(bP){return _9.Bind((new $.New()).Async("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.MessageBus.GetMessages:1550733476",[bP]),function(bQ){var bR;_8.iter(function(bS){var bT;bT=h.Agent();bT.mailbox.AddLast({$:1,$0:bS});bT.resume();},bQ);return bQ.get_Length()>0?(bR=(function(bS){return function(bT){return bS("Values from server requested messages received:"+a.String(bT));};}(a.id))(bQ.get_Length()),(h.log())(bR),_9.Zero()):_9.Zero();});});});}));})),null);};h.Agent=function(){n.$cctor();return n.Agent;};h.CreateString=function(bO){return h.CreateStrPair(_6.UniqueKey(),bO);};h.CreateNumber=function(bO){return h.CreateNumPair(_6.UniqueKey(),bO);};h.CreateBooleanPair=function(bO,bP){return h.CreateMessage(bO,new i({$:2,$0:bP}));};h.CreateStrPair=function(bO,bP){return h.CreateMessage(bO,new i({$:1,$0:bP}));};h.CreateNumPair=function(bO,bP){return h.CreateMessage(bO,new i({$:0,$0:bP}));};h.CreateMessage=function(bO,bP){return j.New(bO,_7.now(),bP);};h.log=function(){n.$cctor();return n.log;};n.$cctor=_3.Cctor(function(){n.log=e.Log();n.Agent=bb.Start(function(bO){function bP(bU,bV){return bc.fold(function(bW,bX){var bY;return(bY=bX.Time-bU,bY/1000)>0.01?new _8.T({$:1,$0:bX,$1:bW}):bW;},_8.T.Empty,bV);}function bQ(bU,bV){return bU<bV.get_Length()?(_8.splitAt(bU,bV))[0]:bV;}function bR(bU,bV,bW){return bU===1?_8.ofArray([bW]):bQ(bU,new _8.T({$:1,$0:bW,$1:bV}));}function bS(bU,bV){function bW(bX,bY,bZ){var b0;b0=a.Array.prototype.slice.call(arguments);return bX.Key===bU.Key?(bY(bU),[bX,bY,bR(bX.CacheSize,bZ,bU)]):b0;}return _8.map(function(bX){return bW(bX[0],bX[1],bX[2]);},bV);}function bT(bU){var bV;bV=null;return _9.Delay(function(){return _9.Bind(bO.Receive(null),function(bW){var bX,bY,bZ,b0,b1,b2;function b3(b5,b6,b7){return bP(bZ,b7);}function b4(b5,b6,b7){return b7.$==0?(new _7(0,0-1,0)).getTime():_8.maxBy(function(b8){return b8.Time;},b7).Time;}return bW.$==2?(bX=bW.$0[0],(bY=(((_3.Curried3(function(b5,b6,b7){return b5("RegisterListener:"+bd.toSafe(b6)+" "+bd.toSafe(b7));}))(a.id))(bX.Name))(bX.Key),(h.log())(bY),bT(m.New(bU.ServerCallback,new _8.T({$:1,$0:[bX,bW.$0[2],_8.T.Empty],$1:bU.Listeners}))))):bW.$==3?bT(m.New({$:1,$0:bW.$0},bU.Listeners)):bW.$==5?(bZ=bW.$0[0],(bW.$0[1](bc.fold(function(b5,b6){return!_8.contains(b6,b5)?new _8.T({$:1,$0:b6,$1:b5}):b5;},_8.T.Empty,_8.concat(_8.map(function(b5){return b3(b5[0],b5[1],b5[2]);},bU.Listeners)))),bT(bU))):bW.$==6?(b0=_8.map(function(b5){return b4(b5[0],b5[1],b5[2]);},bU.Listeners),(bW.$0(b0.$==0?(new _7(0,0-1,0)).getTime():_8.max(b0)),bT(bU))):bW.$==1?bT(m.New(bU.ServerCallback,bS(bW.$0,bU.Listeners))):bW.$==0?(b1=bW.$0,(b2=bU.ServerCallback,b2==null?void 0:b2.$0(b1),bT(m.New(bU.ServerCallback,bS(b1,bU.Listeners))))):bT(m.get_empty());});});}return bT(m.get_empty());},null);n.$cctor=a.ignore;});o=d.InPort=_3.Class({Equals:function(bO){return bO instanceof o&&this.Name===bO.Name;},get_BooleanView:function(){return bg.Map(function(bO){return bO.Value.get_AsBoolean();},this.PortValue.v);},get_Boolean:function(){return this.PortValue.c.Value.get_AsBoolean();},get_StringView:function(){return bg.Map(function(bO){return bO.Value.get_AsString();},this.PortValue.v);},get_String:function(){return this.PortValue.c.Value.get_AsString();},get_NumberView:function(){return bg.Map(function(bO){return bO.Value.get_AsNumber();},this.PortValue.v);},get_Number:function(){return this.PortValue.c.Value.get_AsNumber();},Receive:function(bO){bh.Set(this.PortValue,bO.WithKey(this.Key));},get_Property:function(){var bO,bP,bQ,bR,bS;bO=this;bP=this.PortValue.c.Value;return bP.$==1?(bQ=bh.Create$1(this.get_String()),(bg.Sink(function(bT){var bU;bh.Set(bO.PortValue,(bU=bO.PortValue.c,j.New(bU.Key,bU.Time,new i({$:1,$0:bT}))));},bQ.v),bj.string(this.Name,bQ))):bP.$==2?(bR=bh.Create$1(this.get_Boolean()),(bg.Sink(function(bT){var bU;bh.Set(bO.PortValue,(bU=bO.PortValue.c,j.New(bU.Key,bU.Time,new i({$:2,$0:bT}))));},bR.v),bj.check(this.Name,bR))):(bS=bh.Create$1(this.get_Number()),(bg.Sink(function(bT){var bU;bh.Set(bO.PortValue,(bU=bO.PortValue.c,j.New(bU.Key,bU.Time,new i({$:0,$0:bT}))));},bS.v),bj["double"](this.Name,bS)));},get_Clone:function(){var bO;return o.New((bO=bk.NewGuid(),a.String(bO)),this.Name,bh.Create$1(this.PortValue.c),this.CacheSize);}},null,o);o.Create=function(bO,bP,bQ,bR){return o.New(bO,bP,bQ,bR);};o.New=function(bO,bP,bQ,bR){return new o({Key:bO,Name:bP,PortValue:bQ,CacheSize:bR});};p=d.OutPortType=_3.Class({IsCompatible:function(bO){return this.$==1?bO.PortValue.c.Value.$==1&&true:this.$==2?bO.PortValue.c.Value.$==2&&true:bO.PortValue.c.Value.$==0&&true;}},null,p);p.BooleanOutPort=new p({$:2});p.StringOutPort=new p({$:1});p.NumberOutPort=new p({$:0});q=d.OutPort=_3.Class({Equals:function(bO){return bO instanceof q&&this.Name===bO.Name;},TriggerWithKey:function(bO){var bP;bP=h.Agent();bP.mailbox.AddLast({$:0,$0:bO});bP.resume();},Trigger:function(bO){var bP;bP=h.Agent();bP.mailbox.AddLast({$:0,$0:h.CreateMessage(this.Key,bO)});bP.resume();},get_Clone:function(){return q.New(_6.UniqueKey(),this.Name,this.Type);}},null,q);q.CreateString=function(bO,bP){return q.Create(bO,bP,p.StringOutPort);};q.CreateNumber=function(bO,bP){return q.Create(bO,bP,p.NumberOutPort);};q.Create=function(bO,bP,bQ){return q.New(bO,bP,bQ);};q.New=function(bO,bP,bQ){return new q({Key:bO,Name:bP,Type:bQ});};r.Create=function(bO){function bP(bQ,bR){return[bQ,bR,1];}return r.CreateWithCache(_8.map(function(bQ){return bP(bQ[0],bQ[1]);},bO));};r.CreateWithCache=function(bO){function bP(bQ,bR,bS){return o.Create(bR.Key,bQ,bh.Create$1(j.Create(bR.Value)),bS);}return _8.map(function(bQ){return bP(bQ[0],bQ[1],bQ[2]);},bO);};s=d.Worker=_3.Class({Equals:function(bO){return bO instanceof s&&bl.Equals(this.Name,bO.Name);},get_Properties:function(){return new _8.T({$:1,$0:bj.string("Name",this.Name),$1:_8.map(function(bO){return bO.get_Property();},this.InPorts)});},get_Render:function(){var bO;bO=this.Renderer;return bO==null?bm.Empty():(bO.$0.WebSharper_Community_Dashboard_IRenderer$get_Render())(this);},get_CloneAndRun:function(){var bO,bP,bQ;bO=bh.Create$1(this.Name.c);bP=_8.map(function(bR){return bR.get_Clone();},this.InPorts);bQ=_8.map(function(bR){return bR.get_Clone();},this.OutPorts);return s.New(_6.UniqueKey(),bO,bP,bQ,this.Runner,this.Renderer,this.DataContext,null).WithStartRunner();},WithStartRunner:function(){var bO;bO=this.Runner;return bO==null?this:s.New(this.Key,this.Name,this.InPorts,this.OutPorts,this.Runner,this.Renderer,this.DataContext,(bO.$0.WebSharper_Community_Dashboard_IRunner$get_Run())(this));},WithRenderer:function(bO){return s.New(this.Key,this.Name,this.InPorts,this.OutPorts,this.Runner,{$:1,$0:bO},this.DataContext,this.RunnerContext);},WithRunner:function(bO){return s.New(this.Key,this.Name,this.InPorts,this.OutPorts,{$:1,$0:bO},this.Renderer,this.DataContext,this.RunnerContext);},WithKey:function(bO){return s.New(bO,this.Name,this.InPorts,this.OutPorts,this.Runner,this.Renderer,this.DataContext,this.RunnerContext);}},null,s);s.CreateWithRenderer=function(bO){return s.Create(bO).WithRenderer(bO);};s.CreateWithRunner=function(bO){return s.Create(bO).WithRunner(bO);};s.Create=function(bO){return s.New(_6.UniqueKey(),bh.Create$1(bO.WebSharper_Community_Dashboard_IWorkerContext$get_Name()),bO.WebSharper_Community_Dashboard_IWorkerContext$get_InPorts(),bO.WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts(),null,null,bO,null);};s.New=function(bO,bP,bQ,bR,bS,bT,bU,bV){return new s({Key:bO,Name:bP,InPorts:bQ,OutPorts:bR,Runner:bS,Renderer:bT,DataContext:bU,RunnerContext:bV});};t.allInPorts=function(bO){return t.allPorts(bO,function(bP){return bP.InPorts;});};t.allOutPorts=function(bO){return t.allPorts(bO,function(bP){return bP.OutPorts;});};t.allPorts=function(bO,bP){return _8.concat(_8.map(bP,bO));};u=d.RandomRunner=_3.Class({WithMiddleValue:function(bO){return u.New(this.Name,h.CreateNumber(bO),this.Dispersion,this.OutPortKey);},WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bO){var bP;new bn.New();_9.Start((bP=null,_9.Delay(function(){return _9.While(function(){return true;},_9.Delay(function(){return _9.Bind(_9.Sleep(600),function(){var bQ,bR,bS;bQ=bO.InPorts.get_Item(1).get_Number();bR=bO.InPorts.get_Item(0).get_Number();bS=bo.random()*bQ+bR;bO.OutPorts.get_Item(0).Trigger(new i({$:0,$0:bS}));return _9.Zero();});}));})),null);return null;};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return _8.ofArray([q.CreateNumber(this.OutPortKey,"Random value")]);},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return r.Create(_8.ofArray([["Middle value",this.MiddleValue],["Dispersion",this.Dispersion]]));},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return this.Name;}},null,u);u.get_FromPorts=function(){return function(bO){return u.New(bO.Name.c,bO.InPorts.get_Item(0).PortValue.c,bO.InPorts.get_Item(1).PortValue.c,bO.OutPorts.get_Item(0).Key);};};u.Create=function(bO,bP){return u.New("Random",h.CreateNumber(bO),h.CreateNumber(bP),_6.UniqueKey());};u.New=function(bO,bP,bQ,bR){return new u({Name:bO,MiddleValue:bP,Dispersion:bQ,OutPortKey:bR});};w.New=function(bO,bP,bQ,bR,bS){return{Title:bO,Description:bP,ImageUrl:bQ,Temperature:bR,TemparatureMinMax:bS};};v.get=function(bO,bP){var bQ;bQ=null;return _9.Delay(function(){var bR;bR=(((_3.Curried3(function(bS,bT,bU){return bS("http://api.openweathermap.org/data/2.5/weather?q="+bd.toSafe(bT)+"&units=metric&appid="+bd.toSafe(bU));}))(a.id))(bP))(bO);bp.log("get key city "+bR);return _9.TryWith(_9.Delay(function(){return _9.Bind(br.AsyncMap(bv.asyncReadTextAtRuntime(false,"C:\\AEAFrame\\WebSharper.Community.Dashboard\\WebSharper.Community.Dashboard","","JSON","",bR),function(bS){return bl.Equals(typeof bS,"string")?bw.parse(bS):bS;}),function(bS){var bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd;bp.log("get key city 2");return _9.Return((bT=bx.tryHead(bS.weather),bT==null?null:{$:1,$0:(bU=bT.$0,w.New((((_3.Curried3(function(ce,cf,cg){return ce(bd.toSafe(cf)+", "+bd.toSafe(cg));}))(a.id))((bW=(bV="name",bV in bS?{$:1,$0:bS[bV]}:null),bW==null?null:bW.$0)))((bZ=(bX=bS.sys,(bY="country",bY in bX?{$:1,$0:bX[bY]}:null)),bZ==null?null:bZ.$0)),(b1=(b0="main",b0 in bU?{$:1,$0:bU[b0]}:null),b1==null?null:b1.$0),(function(ce){return function(cf){return ce("http://openweathermap.org/img/w/"+bd.toSafe(cf)+".png");};}(a.id))((b3=(b2="icon",b2 in bU?{$:1,$0:bU[b2]}:null),b3==null?null:b3.$0)),(b4=(b5=bS.main,(b6="temp",b6 in b5?{$:1,$0:b5[b6]}:null)),(b7=b4==null?null:{$:1,$0:1*b4.$0},b7==null?null:b7.$0)),[(b8=(b9=bS.main,(b_="temp_min",b_ in b9?{$:1,$0:b9[b_]}:null)),(b$=b8==null?null:{$:1,$0:1*b8.$0},b$==null?null:b$.$0)),(ca=(cb=bS.main,(cc="temp_max",cc in cb?{$:1,$0:cb[cc]}:null)),(cd=ca==null?null:{$:1,$0:1*ca.$0},cd==null?null:cd.$0))]))}));});}),function(bS){bp.log(bS.message);return _9.Return(null);});});};x=d.OpenWeatherRunner=_3.Class({WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bO){var bP;_9.Start((bP=null,_9.Delay(function(){return _9.While(function(){return true;},_9.Delay(function(){var bQ,bR,bS;bQ=bO.InPorts.get_Item(0);bR=bO.InPorts.get_Item(1);bS=bO.OutPorts.get_Item(0);return _9.Bind(v.get(bR.get_String(),bQ.get_String()),function(bT){return _9.Combine(bT==null?_9.Zero():(bp.log("Value generated:"+bT.$0.Title),bS.Trigger(new i({$:0,$0:+bT.$0.Temperature})),_9.Zero()),_9.Delay(function(){return _9.Bind(_9.Sleep(1000*15),function(){return _9.Return(null);});}));});}));})),null);return null;};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return _8.ofArray([q.CreateNumber(this.OutPortKey,"Temperature")]);},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return r.Create(_8.ofArray([["City",this.OpenWeatherCity],["ApiKey",this.OpenWeatherApiKey]]));},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return this.Name;}},null,x);x.get_FromPorts=function(){return function(bO){return x.New(bO.Name.c,bO.InPorts.get_Item(0).PortValue.c,bO.InPorts.get_Item(1).PortValue.c,bO.OutPorts.get_Item(0).Key);};};x.Create=function(bO,bP){var bQ;return x.New("OpenWeatherMap",h.CreateString(bO),h.CreateString(bP),(bQ=bk.NewGuid(),a.String(bQ)));};x.New=function(bO,bP,bQ,bR){return new x({Name:bO,OpenWeatherCity:bP,OpenWeatherApiKey:bQ,OutPortKey:bR});};y.New=function(bO){return{DatabaseRunnerRun:bO};};z=d.DatabaseRunner=_3.Class({WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bO){bg.Sink(function(bP){var bQ;bQ=((((_3.Curried(function(bR,bS,bT,bU){return bR(bd.toSafe(bS)+" "+bd.toSafe(bT)+" "+bU.toFixed(6));},4))(a.id))(bP.Key))(a.String(bP.Time)))(bP.Value.get_AsNumber());(new $.New()).Send("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.ServerDatabase.WriteLine:2078881569",[bO.InPorts.get_Item(1).get_String(),bQ]);bO.OutPorts.get_Item(0).TriggerWithKey(bP);},bO.InPorts.get_Item(0).PortValue.v);return null;};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return _8.ofArray([q.CreateNumber(this.OutPortKey,"Number value")]);},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return r.Create(_8.ofArray([[" in Value",this.InValue],["Database name",this.DatabaseName]]));},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return this.Name;}},null,z);z.get_FromPorts=function(){return function(bO){var bP;bP=bO.InPorts.get_Item(0).PortValue.c;return z.New(bO.Name.c,bO.InPorts.get_Item(1).PortValue.c,bP,bO.OutPorts.get_Item(0).Key);};};z.get_Create=function(){return z.New("Database",h.CreateString("Database.txt"),h.CreateNumber(0),_6.UniqueKey());};z.New=function(bO,bP,bQ,bR){return new z({Name:bO,DatabaseName:bP,InValue:bQ,OutPortKey:bR});};A.New=function(bO,bP){return{LineChart:bO,Queue:bP};};B=d.ChartRenderer=_3.Class({WebSharper_Community_Dashboard_IRenderer$get_Render:function(){return function(bO){var bP,bQ,bR,bS,bT,bU,bV,bW;bP=bO.InPorts.get_Item(3).get_Number()<<0;bQ=bO.RunnerContext.$0;bg.Sink(function(bX){bQ.Queue.push(bX);bQ.Queue.length>bP?bQ.Queue.shift():void 0;bc.iteri(function(bY,bZ){return bQ.LineChart.__UpdateData(bY,function(){return bZ;});},bQ.Queue);},bO.InPorts.get_Item(0).get_NumberView());return bA.Render$8(bO.RunnerContext.$0.LineChart,{$:1,$0:{$:0,$0:bO.InPorts.get_Item(1).get_Number()<<0,$1:bO.InPorts.get_Item(2).get_Number()<<0}},{$:1,$0:(bR={},bR.title=(bS={},bS.display=false,bS),bR.legend=(bT={},bT.display=false,bT),bR.elements=(bU={},bU.point=(bV={},bV.radius=0,bV),bU.line=(bW={},bW.borderWidth=1,bW),bU),bR)},null);};},WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bO){var bP,bQ,bR,bS;bP=bO.InPorts.get_Item(3).get_Number()<<0;bQ=_8.ofSeq(bc.delay(function(){return bc.map(function(){return 0;},_4.range(0,bP-1));}));bR=(bS=[],(bc.iter(function(bT){bS.push(bT);},bQ),bS));return{$:1,$0:A.New(bB.Line(bQ).WithFill(false).__WithStrokeColor(new bC.Color({$:1,$0:"#FB8C00"})).__WithPointColor(new bC.Color({$:2,$0:"black"})),bR)};};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return _8.T.Empty;},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return r.CreateWithCache(_8.ofArray([[" in Value",this.Number,this.ChartBufferSize.Value.get_AsNumber()<<0],["cx",this.Cx,1],["cy",this.Cy,1],["BufferSize",this.ChartBufferSize,1]]));},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return this.Name;}},null,B);B.get_FromPorts=function(){return function(bO){return B.New(bO.Name.c,bO.InPorts.get_Item(0).PortValue.c,bO.InPorts.get_Item(1).PortValue.c,bO.InPorts.get_Item(2).PortValue.c,bO.InPorts.get_Item(3).PortValue.c);};};B.Create=function(bO,bP,bQ){return B.New("Chart",h.CreateNumber(0),h.CreateNumber(bO),h.CreateNumber(bP),h.CreateNumber(bQ));};B.New=function(bO,bP,bQ,bR,bS){return new B({Name:bO,Number:bP,Cx:bQ,Cy:bR,ChartBufferSize:bS});};C=d.TextBoxRenderer=_3.Class({WebSharper_Community_Dashboard_IRenderer$get_Render:function(){return function(bO){var bP;bP=bg.Map(function(bQ){var bR;bR=bQ<<0;return a.String(bR);},bO.InPorts.get_Item(0).get_NumberView());return bm.Element("div",[bD.Class("bigvalue")],[bm.TextView(bP)]);};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return _8.T.Empty;},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return r.Create(_8.ofArray([["in Value",this.TextBoxValue]]));},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return this.Name;}},null,C);C.get_FromPorts=function(){return function(bO){return C.New(bO.Name.c,bO.InPorts.get_Item(0).PortValue.c);};};C.get_Create=function(){return C.New("Text",h.CreateNumber(0));};C.New=function(bO,bP){return new C({Name:bO,TextBoxValue:bP});};D=d.ButtonRenderer=_3.Class({WebSharper_Community_Dashboard_IRenderer$get_Render:function(){return function(bO){return bm.ButtonView(bO.InPorts.get_Item(0).get_String(),[],bO.InPorts.get_Item(1).get_BooleanView(),function(bP){bO.OutPorts.get_Item(0).Trigger(new i({$:2,$0:bP}));});};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return _8.ofArray([q.CreateNumber(this.OutPortKey,"Button value")]);},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return r.Create(_8.ofArray([["Caption",this.ButtonName],["State",this.State]]));},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return this.Name;}},null,D);D.get_FromPorts=function(){return function(bO){return D.New(bO.Name.c,bO.InPorts.get_Item(0).PortValue.c,bO.InPorts.get_Item(1).PortValue.c,bO.OutPorts.get_Item(0).Key);};};D.get_Create=function(){return D.New("Button",h.CreateString("Button"),h.CreateNumber(0),_6.UniqueKey());};D.New=function(bO,bP,bQ,bR){return new D({Name:bO,ButtonName:bP,State:bQ,OutPortKey:bR});};E.New=function(bO,bP,bQ){return{InPortKey:bO,OutPortKey:bP,WorkerKey:bQ};};F.New=function(bO){return{RuleChain:bO};};G=d.RuleContainer=_3.Class({Reconnect:function(bO){var bP,bQ,bR,bS;bP=e.Log();bQ=t.allOutPorts(bO);bR=t.allInPorts(bO);_8.iter(function(bT){(e.Log())((((_3.Curried3(function(bU,bV,bW){return bU(bd.toSafe(bV)+" "+bd.toSafe(bW));}))(a.id))(bT.Name))(bT.Key));},bR);bS=h.Agent();bS.mailbox.AddLast(l.Clear);bS.resume();_8.iter(function(bT){var bU,bV,bW;bU=_8.ofSeq(bT.RuleChain);bV=_8.ofSeq(_4.range(1,bU.get_Length()-1));bW=bE.Get(bV);try{while(bW.MoveNext())(function(){var bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6;bX=bW.Current();bY=bU.get_Item(bX-1);bZ=bU.get_Item(bX);{b0=bc.tryFind(function(b7){return b7.Key===bY.OutPortKey;},bQ),b0==null?null:{$:1,$0:(b1=b0.$0,(bP((((_3.Curried3(function(b7,b8,b9){return b7("Found outPort "+bd.toSafe(b8)+" try to find inPort:"+bd.toSafe(b9));}))(a.id))(bY.OutPortKey))(bZ.InPortKey)),b2=bc.tryFind(function(b7){return b7.Key===bZ.InPortKey;},bR),b2==null?null:{$:1,$0:(b3=b2.$0,(bP("Found inPort"),b3.PortValue.c.Key!==b3.Key?bh.Set(b3.PortValue,b3.PortValue.c.WithKey(b3.Key)):void 0,b4=(b5=b3.PortValue.c.Value,b5.$==1?j.Create(new i({$:1,$0:""})):b5.$==2?j.Create(new i({$:2,$0:false})):j.Create(new i({$:0,$0:0}))),b6=h.Agent(),b6.mailbox.AddLast({$:2,$0:[k.Create(b1.Key,b1.Name+"->"+b3.Name,b3.CacheSize),b4,function(b7){b3.Receive(b7);}]}),b6.resume()))}))};return;}}());}finally{if("Dispose"in bW)bW.Dispose();}},_8.ofSeq(this.RuleContainer));}},null,G);G.New=function(bO){return new G({RuleContainer:bO});};H.Create=function(bO){return H.New(bF.Fresh(),bO);};H.New=function(bO,bP){return{Key:bO,Worker:bP};};I=d.Factory=_3.Class({RegisterEvent:function(bO){this.EventItems.Append(H.Create(bO));},RegisterWidget:function(bO){this.WidgetItems.Append(H.Create(bO));}},null,I);I.get_Create=function(){return I.New(bG.Create(function(bO){return bO.Key;},_8.T.Empty),bG.Create(function(bO){return bO.Key;},_8.T.Empty));};I.New=function(bO,bP){return new I({EventItems:bO,WidgetItems:bP});};J.Create=function(bO,bP){return J.New(bF.Fresh(),bO,bP);};J.New=function(bO,bP,bQ){return{Key:bO,Name:bP,SelectorRenderer:bQ};};K=d.SelectorGroup=_3.Class({RenderMenu:function(bO,bP){var bQ,bR,bS,bT;bQ=this;bR=(bS=this.ChildCreatator,bS==null?bm.Element("tr",[],[]):(bT=bS.$0,bm.Element("tr",[],[bm.Element("td",[],[bm.Element("div",[bD.Style("margin-left","20px")],[_6.IconSmall("add",function(){var bU,bV;bU=bT();bV=J.Create(bU[0],bU[1]);bQ.ItemOnCreated(bV);bQ.SelectorItems.Append(bV);})])])])));return bm.Element("table",[],[bm.ConvertBy(function(bU){return bU.Key;},function(bU){var bV;bV=bg.Map(function(bW){return bO+bW;},bU.Name.v);return bm.Element("tr",[],[bm.Element("td",[bD.DynamicStyle("Color",bg.Map(function(bW){return bW==null?"#7D4600":bl.Equals(bW.$0.Key,bU.Key)?"#FB8C00":"#7D4600";},bP.v)),bD.Style("cursor","pointer"),bD.Handler("click",function(){return function(){bQ.ItemOnSelected(bU);return bh.Set(bP,{$:1,$0:bU});};})],[bm.Element("div",[bD.Style("margin-left","10px"),bD.Style("margin-right","5px")],[bm.TextView(bV)])])]);},this.SelectorItems.v),bR]);},ItemByIndex:function(bO){return _8.head(_8.ofSeq(this.SelectorItems));}},null,K);K.Create=function(bO,bP,bQ,bR,bS){var bT;bT=bG.Create(function(bU){return bU.Key;},_8.map(function(bU){return J.Create(bU[0],bU[1]);},bP));return K.New(bF.Fresh(),bh.Create$1(bO),bT,bQ,bR,bS);};K.New=function(bO,bP,bQ,bR,bS,bT){return new K({Key:bO,Name:bP,SelectorItems:bQ,ChildCreatator:bR,ItemOnCreated:bS,ItemOnSelected:bT});};L=d.WindowSelector=_3.Class({get_RenderMenu:function(){var bO;bO=this;return this.SelectorGroups.get_Length()===1?_8.head(_8.ofSeq(this.SelectorGroups)).RenderMenu("",this.OptSelectedItem):bm.Element("div",[],[bm.ConvertBy(function(bP){return bP.Key;},function(bP){return bm.Element("div",[],[bm.Element("div",[bD.Style("cursor","pointer"),bD.Handler("click",function(){return function(){return bO.GroupOnClick(bP);};})],[bm.TextView(bP.Name.v)]),bP.RenderMenu("    ",bO.OptSelectedItem)]);},this.SelectorGroups.v)]);},get_Render:function(){return bm.Element("div",[],[bm.BindView(function(bO){return bO==null?bm.Empty():bO.$0.SelectorRenderer;},this.OptSelectedItem.v)]);},GroupByIndex:function(bO){return bc.nth(bO,_8.ofSeq(this.SelectorGroups));},get_SelectedIndex:function(){var bO;bO=this;return bc.findIndex(function(bP){return bl.Equals(bP.Key,bO.get_SelectedItem().Key);},_8.concat(_8.map(function(bP){return _8.ofSeq(bP.SelectorItems);},_8.ofSeq(this.SelectorGroups))));},get_SelectedIndexInGroup:function(){var bO;bO=this;return bc.findIndex(function(bP){return bl.Equals(bP.Key,bO.get_SelectedItem().Key);},_8.ofSeq(this.get_SelectedGroup().SelectorItems));},get_SelectedGroupIndex:function(){var bO;bO=this;return bc.findIndex(function(bP){return bl.Equals(bP.Key,bO.get_SelectedGroup().Key);},_8.ofSeq(this.SelectorGroups));},get_SelectedGroup:function(){return this.GroupFromItem(this.get_SelectedItem());},GroupFromItem:function(bO){return bc.find(function(bP){return _8.exists(function(bQ){return bl.Equals(bQ.Key,bO.Key);},_8.ofSeq(bP.SelectorItems));},_8.ofSeq(this.SelectorGroups));},AppenGroup:function(bO,bP,bQ){this.SelectorGroups.Append(K.Create(bO,bP,bQ,this.ItemOnCreated(this.SelectorGroups.get_Length()),this.ItemOnSelected));},get_SelectedItem:function(){var bO;bO=this.OptSelectedItem.c;return bO==null?_4.FailWith("Something really wrong with WindowSelector"):bO.$0;},ClearGroups:function(){bh.Set(this.OptSelectedItem,null);_8.iter(function(bO){bO.SelectorItems.Clear();},_8.ofSeq(this.SelectorGroups));},WithItemOnSelected:function(bO){return L.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,bO);},WithGroupOnClick:function(bO){return L.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,bO,this.ItemOnSelected);},WithItemOnCreated:function(bO){return L.New(this.OptSelectedItem,this.SelectorGroups,bO,this.GroupOnClick,this.ItemOnSelected);}},null,L);L.get_Create=function(){var bO;bO=bG.Create(function(bP){return bP.Key;},_8.T.Empty);return L.New(bh.Create$1(null),bO,function(){return function(){return null;};},a.ignore,a.ignore);};L.New=function(bO,bP,bQ,bR,bS){return new L({OptSelectedItem:bO,SelectorGroups:bP,ItemOnCreated:bQ,GroupOnClick:bR,ItemOnSelected:bS});};M=d.RulesCellItem=_3.Class({Render:function(bO,bP){var bQ,bR,bS,bT,bU;bQ=this;bg.Sink(function(bV){var bW;if(bV==null);else{bW=bV.$0;bp.log("Workitem selected");bh.Set(bQ.OptInPort,_8.tryHead(bW.Worker.InPorts));bh.Set(bQ.OptOutPort,_8.tryHead(bW.Worker.OutPorts));bP();}},this.OptWorker.v);bg.Sink(function(){bP();},this.OptInPort.v);bg.Sink(function(){bP();},this.OptOutPort.v);bR=(bS=bg.Map(function(bV){var bW;return bV==null?_8.ofArray([null]):(bW=_8.map(function(bX){return{$:1,$0:bX};},bV.$0.Worker.InPorts),bW.get_Length()>0?bW:_8.ofArray([null]));},this.OptWorker.v),(bT=bg.Map(function(bV){var bW;return bV==null?_8.ofArray([null]):(bW=_8.map(function(bX){return{$:1,$0:bX};},bV.$0.Worker.OutPorts),bW.get_Length()>0?bW:_8.ofArray([null]));},this.OptWorker.v),(bU=bg.Map(function(bV){return new _8.T({$:1,$0:null,$1:_8.map(function(bW){return{$:1,$0:bW};},_8.ofSeq(bV))});},bO.v),bm.Element("table",[],[bm.Element("tr",[],[bm.Element("td",[],[bm.SelectDyn([bD.Class("form-control")],function(bV){return bH.fold(function(bW,bX){return bX.Name;}," ",bV);},bS,this.OptInPort)]),bm.Element("td",[],[bm.SelectDyn([bD.Class("form-control")],function(bV){return bH.fold(function(bW,bX){return bX.Worker.Name.c;}," ",bV);},bU,this.OptWorker)]),bm.Element("td",[],[bm.SelectDyn([bD.Class("form-control")],function(bV){return bH.fold(function(bW,bX){return bX.Name;}," ",bV);},bT,this.OptOutPort)])])]))));return bm.Element("td",[bD.Class("td DshEditorCell")],[bm.Element("div",[bD.Class("div DshEditorCell")],[bm.Element("table",[],[bm.Element("tr",[],[bm.Element("td",[],[bR])])])])]);}},null,M);M.get_Create=function(){return M.New(bF.Fresh(),bh.Create$1(null),bh.Create$1(null),bh.Create$1(null));};M.New=function(bO,bP,bQ,bR){return new M({Key:bO,OptInPort:bP,OptWorker:bQ,OptOutPort:bR});};N=d.RulesRowItem=_3.Class({Render:function(bO,bP){var bQ;bQ=this;return bm.Element("tr",[],[bm.ConvertBy(function(bR){return bR.Key;},function(bR){return bR.Render(bO,bP);},this.CellItems.v),_6.IconNormal("add",function(){bQ.CellItems.Append(M.get_Create());})]);}},null,N);N.Create=function(bO){return N.New(bF.Fresh(),bG.Create(function(bP){return bP.Key;},bO));};N.New=function(bO,bP){return new N({Key:bO,CellItems:bP});};O.Create=function(bO,bP){return O.New(bF.Fresh(),bO,bP);};O.New=function(bO,bP,bQ){return{Key:bO,Panel:bP,Widget:bQ};};P.Create=function(bO){return P.New(bF.Fresh(),bh.Create$1(bO),bG.Create(function(bP){return bP.Key;},_8.T.Empty));};P.New=function(bO,bP,bQ){return{Key:bO,Name:bP,EventItems:bQ};};Q.Create=function(bO,bP){return Q.New(bF.Fresh(),bh.Create$1(bO),bG.Create(function(bQ){return bQ.Key;},_8.T.Empty),bP);};Q.New=function(bO,bP,bQ,bR){return{Key:bO,Name:bP,WidgetItems:bQ,PanelContainer:bR};};R.Create=function(bO){return R.New(bF.Fresh(),bh.Create$1(bO),bG.Create(function(bP){return bP.Key;},_8.T.Empty));};R.New=function(bO,bP,bQ){return{Key:bO,Name:bP,RulesRowItems:bQ};};S=d.DshData=_3.Class({RegisterWidget:function(bO,bP,bQ,bR){var bS;bS=bR.WithKey(bO);bP.WidgetItems.Append(O.Create(bQ,bS));this.WorkItems.Append(H.Create(bS));},RegisterEvent:function(bO,bP,bQ){var bR;bR=H.Create(bQ.WithKey(bO));bP.EventItems.Append(bR);this.WorkItems.Append(bR);},get_Clear:function(){this.WorkItems.Clear();this.WidgetGroups.Clear();this.EventGroups.Clear();this.RulesGroups.Clear();}},null,S);S.get_Create=function(){return S.New(bG.Create(function(bO){return bO.Key;},_8.T.Empty),bG.Create(function(bO){return bO.Key;},_8.T.Empty),bG.Create(function(bO){return bO.Key;},_8.T.Empty),bG.Create(function(bO){return bO.Key;},_8.T.Empty));};S.New=function(bO,bP,bQ,bR){return new S({WorkItems:bO,WidgetGroups:bP,EventGroups:bQ,RulesGroups:bR});};T.Render=function(bO,bP){return bm.Element("table",[],[bm.ConvertBy(function(bQ){return bQ.Key;},function(bQ){return bm.Element("tr",[],[bm.Element("i",_6.AttrsClick(function(){bP.Edit(bQ.Worker.get_Properties());}),[bm.TextView(bQ.Worker.Name.v)])]);},bO.v)]);};U.Render=function(bO,bP){function bQ(){var bR;bR=_8.map(function(bS){return bS.Worker;},_8.ofSeq(bO.WorkItems));U.CopyToRules(bP).Reconnect(bR);}return bm.Element("table",[],[bm.ConvertBy(function(bR){return bR.Key;},function(bR){return bm.Element("tr",[],[bR.Render(bO.WorkItems,function(){bQ();})]);},bP.v)]);};U.Restore=function(bO,bP,bQ){var bR,bS,bT;bP.Clear();bR=_8.map(function(bU){return bU.Worker;},_8.ofSeq(bO.WorkItems));bS=t.allOutPorts(bR);bT=t.allInPorts(bR);_8.iter(function(bU){var bV;bV=N.Create([]);_8.iter(function(bW){var bX;bX=M.get_Create();bh.Set(bX.OptWorker,bc.tryFind(function(bY){return bY.Worker.Key===bW.WorkerKey;},_8.ofSeq(bO.WorkItems)));bh.Set(bX.OptInPort,bc.tryFind(function(bY){return bY.Key===bW.InPortKey;},bT));bh.Set(bX.OptOutPort,bc.tryFind(function(bY){return bY.Key===bW.OutPortKey;},bS));bV.CellItems.Append(bX);},bU.RuleChain);bP.Append(bV);},bQ.RuleContainer);bQ.Reconnect(bR);};U.CopyToRules=function(bO){return G.New(_8.map(function(bP){return F.New(_8.map(function(bQ){var bR,bS,bT;return E.New((bR=bQ.OptInPort.c,bR==null?"":bR.$0.Key),(bS=bQ.OptOutPort.c,bS==null?"":bS.$0.Key),(bT=bQ.OptWorker.c,bT==null?"":bT.$0.Worker.Key));},_8.ofSeq(bP.CellItems)));},_8.ofSeq(bO)));};V.RulesGroupCreator=function(bO,bP){var bQ;bQ=R.Create("rules"+a.String(_8.length(_8.ofSeq(bO.RulesGroups))+1));bO.RulesGroups.Append(bQ);return[bQ.Name,U.Render(bO,bQ.RulesRowItems)];};V.EventsGroupCreator=function(bO,bP,bQ){var bR;bR=P.Create("event"+a.String(_8.length(_8.ofSeq(bO.EventGroups))+1));bO.EventGroups.Append(bR);return[bR.Name,T.Render(bR.EventItems,bP)];};V.PanelGroupCreator=function(bO,bP,bQ){var bR,bS,bT;bR=_8.length(_8.ofSeq(bO.WidgetGroups))+1;bS=bP();bT=Q.Create("panel"+a.String(bR),bS);bO.WidgetGroups.Append(bT);return[bT.Name,bS.get_Render()];};W=d.Dashboard=_3.Class({Render:function(bO){var bP;bP=this;return bm.EmbedView(bg.Map(function(bQ){return bQ.$==1?bm.Element("div",[],[bm.Element("table",[],[bm.Element("tr",[],[bm.Element("td",[bD.Style("vertical-align","top")],[bm.Element("table",[],bc.concat([_8.ofArray([bm.Element("tr",[],[bm.Element("td",[],[_6.IconNormal("dehaze",function(){bh.Set(bP.PanelTitleVisibility,false);bh.Set(bP.Mode,{$:0});})])])]),_8.ofArray([bP.EditorSelectorEdit.get_RenderMenu()]),_8.ofArray([bm.Element("tr",[],[bm.Element("td",[],[])]),bm.Element("tr",[],[bm.Element("td",[],[bP.PropertyGrid.get_Render()])])])]))]),bm.Element("td",[bD.Style("vertical-align","top")],[bO,_6.IconNormal("add",function(){var bR,bS,bT,bU,bV;bR=bP.EditorSelectorEdit.get_SelectedGroupIndex();bR===1?(bS=_8.ofSeq(bP.Factory.EventItems),bT=bh.Create$1(_8.head(bS)),bP.Dialog.ShowDialog("Select source",bm.Element("div",[],[bm.Select([bD.Class("form-control")],function(bW){return bW.Worker.Name.c;},bS,bT)]),function(){var bW,bX,bY;bW=bT.c.Worker.get_CloneAndRun();bX=(bY=_8.ofSeq(bP.Data.EventGroups),bc.nth(bP.EditorSelectorEdit.get_SelectedIndexInGroup(),bY));bP.Data.RegisterEvent(_6.UniqueKey(),bX,bW);})):bR===0?bP.CreatePanel((bU=_8.ofSeq(bP.Data.WidgetGroups),bc.nth(bP.EditorSelectorEdit.get_SelectedIndexInGroup(),bU)),"Panel",700,null):bR===2?(bV=_8.ofSeq(bP.Data.RulesGroups),bc.nth(bP.EditorSelectorEdit.get_SelectedIndexInGroup(),bV)).RulesRowItems.Append(N.Create([M.get_Create(),M.get_Create()])):void 0;}),bP.EditorSelectorEdit.get_Render()])])]),bm.Element("div",[],[bP.Dialog.get_Render()])]):bm.Element("div",[],[bm.Element("table",[],[bm.Element("tr",[],[bm.Element("td",[bD.Style("vertical-align","top")],[_6.IconNormal("dehaze",function(){bh.Set(bP.PanelTitleVisibility,true);bh.Set(bP.Mode,{$:1});}),bP.EditorSelectorRun.GroupByIndex(0).SelectorItems.get_Length()>1?bP.EditorSelectorRun.get_RenderMenu():bm.Element("div",[],[])]),bm.Element("td",[],[bP.EditorSelectorRun.get_Render()])])])]);},this.Mode.v));},Restore:function(bO,bP,bQ,bR){var bS,bT,bU,bV,bW;bS=this;this.EditorSelectorRun.ClearGroups();this.EditorSelectorEdit.ClearGroups();this.Data.get_Clear();bT=this.EditorSelectorRun.GroupByIndex(0);bU=this.EditorSelectorEdit.GroupByIndex(0);bV=this.EditorSelectorEdit.GroupByIndex(1);bW=this.EditorSelectorEdit.GroupByIndex(2);_8.iteri(function(bX,bY){var bZ,b0,b1,b2;function b3(b4,b5,b6){bS.RegisterWidget(b4,b2,b5,bc.find(function(b7){return b7.Key===b5;},_8.ofSeq(b2.PanelContainer.PanelItems)).Children,b6.WithStartRunner());}bZ=V.PanelGroupCreator(bS.Data,bO,null);b0=bZ[1];b1=bZ[0];bh.Set(b1,bY[0]);bU.SelectorItems.Append(J.Create(b1,b0));bT.SelectorItems.Append(J.Create(b1,b0));b2=bc.nth(bX,_8.ofSeq(bS.Data.WidgetGroups));_8.iter(function(b4){var b5;b5=bS.CreatePanel(b2,"Panel",700,{$:1,$0:b4.Key});bh.Set(b5.Left,b4.Left);bh.Set(b5.Top,b4.Top);},bY[1]);return _8.iter(function(b4){return b3(b4[0],b4[1],b4[2]);},bY[2]);},bQ);bp.log("Widgets restored");_8.iteri(function(bX,bY){var bZ,b0,b1;function b2(b3,b4){bS.Data.RegisterEvent(b3,b1,b4);}bZ=V.EventsGroupCreator(bS.Data,bS.PropertyGrid,null);b0=bZ[0];bh.Set(b0,bY[0]);bV.SelectorItems.Append(J.Create(b0,bZ[1]));b1=bc.nth(bX,_8.ofSeq(bS.Data.EventGroups));return _8.iter(function(b3){return b2(b3[0],b3[1]);},bY[1]);},bP);bp.log("Events restored");_8.iteri(function(bX,bY){var bZ,b0;bZ=V.RulesGroupCreator(bS.Data,null);b0=bZ[0];bh.Set(b0,bY[0]);bW.SelectorItems.Append(J.Create(b0,bZ[1]));return U.Restore(bS.Data,bc.nth(bX,_8.ofSeq(bS.Data.RulesGroups)).RulesRowItems,bY[1]);},bR);this.Data.WidgetGroups.get_Length()>0?(bh.Set(this.EditorSelectorEdit.OptSelectedItem,{$:1,$0:_8.head(_8.ofSeq(this.EditorSelectorEdit.GroupByIndex(0).SelectorItems))}),bh.Set(this.EditorSelectorRun.OptSelectedItem,{$:1,$0:_8.head(_8.ofSeq(this.EditorSelectorRun.GroupByIndex(0).SelectorItems))})):(bh.Set(this.EditorSelectorEdit.OptSelectedItem,null),bh.Set(this.EditorSelectorRun.OptSelectedItem,null));bp.log("Connectors restored");},Store:function(bO){return[_8.map(function(bP){return[bP.Name.c,_8.map(function(bQ){return[bQ.Worker.Key,bO(bQ.Worker)];},_8.ofSeq(bP.EventItems))];},_8.ofSeq(this.Data.EventGroups)),_8.map(function(bP){return[bP.Name.c,_8.map(function(bQ){return bQ.get_PanelData();},_8.ofSeq(bP.PanelContainer.PanelItems)),_8.map(function(bQ){return[bQ.Widget.Key,bQ.Panel,bO(bQ.Widget)];},_8.ofSeq(bP.WidgetItems))];},_8.ofSeq(this.Data.WidgetGroups)),_8.map(function(bP){return[bP.Name.c,U.CopyToRules(bP.RulesRowItems)];},_8.ofSeq(this.Data.RulesGroups))];},CreatePanel:function(bO,bP,bQ,bR){var bS,bT,bU,bV,bW,bX;bS=this;bm.ConvertBy(bO.WidgetItems.key,function(bY){return bm.Element("div",[],[bm.TextView(bY.Widget.Name.v)]);},bO.WidgetItems.v);bT=(bU=(bV=bk.NewGuid(),a.String(bV)),bR==null?bU:bR.$0);bW=bI.get_Create().WithLayoutManager(bJ.StackPanelLayoutManager()).WithAttributes([bD.Style("border","1px solid white"),bD.Style("display","flex")]);bX=bK.get_Create().WithKey(bT).WithPannelAttrs([bD.Style("Width",a.String(bQ)+"px"),bD.Style("position","absolute")]).WithTitle(this.PanelTitleVisibility).WithTitleContent(bm.TextNode(bP)).WithTitleButtons(_8.ofArray([bL.New("add",function(bY){var bZ,b0;bZ=_8.ofSeq(bS.Factory.WidgetItems);b0=bh.Create$1(_8.head(bZ));bS.Dialog.ShowDialog("Select widget",bm.Element("div",[],[bm.Select([bD.Class("form-control")],function(b1){return b1.Worker.Name.c;},bZ,b0)]),function(){bp.log("Dialog.IsOK");bS.RegisterWidget(_6.UniqueKey(),bO,bY.Key,bY.Children,b0.c.Worker.get_CloneAndRun());});}),bL.New("edit",function(bY){bp.log("Edit");bS.PropertyGrid.Edit(_8.concat(_8.map(function(bZ){return bZ.Widget.get_Properties();},_8.filter(function(bZ){return bZ.Panel===bY.Key;},_8.ofSeq(bO.WidgetItems)))));}),bL.New("clear",function(bY){bO.PanelContainer.PanelItems.Remove(bO.PanelContainer.FindPanelItem(bY));})])).WithChildPanelContainer(bW);bO.PanelContainer.AddPanel(bX);return bX;},RegisterWidget:function(bO,bP,bQ,bR,bS){var bT;this.Data.RegisterWidget(bO,bP,bQ,bS);bT=bK.get_Create().WithPanelContent(bS.get_Render());bh.Set(bT.IsWithTitle,false);bR.AddPanel(bT);}},null,W);W.Create=function(bO){var bP,bQ,bR,bS,bT,bU;function bV(){return V.PanelGroupCreator(bQ,bO,void 0);}function bW(){return V.EventsGroupCreator(bQ,bR,void 0);}function bX(){return V.RulesGroupCreator(bQ,void 0);}bP=bM.get_Create();bQ=S.get_Create();bR=bN.get_Create();bS=L.get_Create();bT=L.get_Create().WithGroupOnClick(function(bY){bR.Edit(_8.mapi(function(bZ,b0){var b1;return bj.string((b1=bZ+1,a.String(b1)),b0.Name);},_8.ofSeq(bY.SelectorItems)));}).WithItemOnSelected(function(){bR.Edit(_8.T.Empty);}).WithItemOnCreated(function(bY){return function(bZ){return bY===0?_8.head(_8.ofSeq(bS.SelectorGroups)).SelectorItems.Append(bZ):null;};});bU=bV();bT.AppenGroup("Panels",_8.ofArray([bU]),{$:1,$0:bV});bS.AppenGroup("Panels",_8.ofArray([bU]),null);bT.AppenGroup("Events",_8.ofArray([bW()]),{$:1,$0:bW});bT.AppenGroup("Rules",_8.ofArray([bX()]),{$:1,$0:bX});bh.Set(bT.OptSelectedItem,{$:1,$0:_8.head(_8.ofSeq(bT.GroupByIndex(0).SelectorItems))});bh.Set(bS.OptSelectedItem,{$:1,$0:_8.head(_8.ofSeq(bS.GroupByIndex(0).SelectorItems))});return W.New(I.get_Create(),bQ,bR,bP,bS,bT,bh.Create$1({$:0}),bh.Create$1(false));};W.New=function(bO,bP,bQ,bR,bS,bT,bU,bV){return new W({Factory:bO,Data:bP,PropertyGrid:bQ,Dialog:bR,EditorSelectorRun:bS,EditorSelectorEdit:bT,Mode:bU,PanelTitleVisibility:bV});};X=d.AppModelLib=_3.Class({get_Worker:function(){var bO;return this.$==1?s.CreateWithRunner(this.$0):this.$==2?s.CreateWithRunner(this.$0):this.$==3?s.CreateWithRenderer(this.$0):this.$==4?(bO=this.$0,s.Create(bO).WithRunner(bO).WithRenderer(bO)):this.$==5?s.CreateWithRenderer(this.$0):s.CreateWithRunner(this.$0);}},null,X);X.FromWorker=function(bO){var bP;bP=bO.DataContext;return bP instanceof u?{$:1,$0:new X({$:0,$0:(u.get_FromPorts())(bO)})}:bP instanceof x?{$:1,$0:new X({$:1,$0:(x.get_FromPorts())(bO)})}:bP instanceof z?{$:1,$0:new X({$:2,$0:(z.get_FromPorts())(bO)})}:bP instanceof C?{$:1,$0:new X({$:3,$0:(C.get_FromPorts())(bO)})}:bP instanceof B?{$:1,$0:new X({$:4,$0:(B.get_FromPorts())(bO)})}:bP instanceof D?{$:1,$0:new X({$:5,$0:(D.get_FromPorts())(bO)})}:null;};X.FromDataContext=function(bO){return bO instanceof u?{$:1,$0:new X({$:0,$0:bO})}:bO instanceof x?{$:1,$0:new X({$:1,$0:bO})}:bO instanceof z?{$:1,$0:new X({$:2,$0:bO})}:bO instanceof C?{$:1,$0:new X({$:3,$0:bO})}:bO instanceof B?{$:1,$0:new X({$:4,$0:bO})}:bO instanceof D?{$:1,$0:new X({$:5,$0:bO})}:null;};Y.CreateDashboard=function(){Z.$cctor();return Z.CreateDashboard;};Y.PanelContainerCreator=function(bO){return bI.get_Create().WithLayoutManager(bJ.FloatingPanelLayoutManager(5)).WithWidth(800).WithHeight(420).WithAttributes([bD.Style("border","1px solid white")]);};Y.Register=function(bO){function bP(bS,bT){var bU;{bU=X.FromDataContext(bT),bU==null?null:{$:1,$0:bS(bU.$0.get_Worker())};return;}}function bQ(bS){var bT;bP((bT=bO.Factory,function(bU){bT.RegisterEvent(bU);}),bS);}function bR(bS){var bT;bP((bT=bO.Factory,function(bU){bT.RegisterWidget(bU);}),bS);}bQ(x.Create("London",""));bQ(u.Create(50,5));bQ(z.get_Create());bR(C.get_Create());bR(B.Create(300,100,50));bR(D.get_Create());};Z.$cctor=_3.Cctor(function(){var bO;Z.CreateDashboard=(bO=W.Create(function(){return Y.PanelContainerCreator();}),(Y.Register(bO),bO));Z.$cctor=a.ignore;});_0.RecreatWidgetsOnServer=function(bO,bP){function bQ(bS,bT,bU){return bU;}function bR(bS,bT,bU){return bU;}return _8.map(function(bS){return bQ(bS[0],bS[1],bS[2]);},_8.concat(_8.map(function(bS){return bR(bS[0],bS[1],bS[2]);},_0.RecreateWidgets(bO,bP))));};_0.RecreateEventsOnServer=function(bO,bP){function bQ(bS,bT){return bT;}function bR(bS,bT){return bT;}return _8.map(function(bS){return bQ(bS[0],bS[1]);},_8.concat(_8.map(function(bS){return bR(bS[0],bS[1]);},_0.RecreateEvents(a.id,bO,bP))));};_0.RecreateOnClient=function(bO,bP,bQ,bR,bS,bT,bU){var bV;e.set_Role(f.Client);bV=h.Agent();bV.mailbox.AddLast({$:3,$0:function(bW){(new $.New()).Send("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.MessageBus.SendToServer:-1358505674",[bW]);}});bV.resume();bP.Restore(bQ,_0.RecreateEvents(bO,bR,bS),_0.RecreateWidgets(bR,bT),bU);};_0.RecreateWidgets=function(bO,bP){function bQ(bR,bS,bT){function bU(bV,bW,bX){return[bV,bW,bO(bX)];}return[bR,bS,_8.map(function(bV){return bU(bV[0],bV[1],bV[2]);},bT)];}return _8.map(function(bR){return bQ(bR[0],bR[1],bR[2]);},bP);};_0.RecreateEvents=function(bO,bP,bQ){function bR(bS,bT){function bU(bV,bW){return[bV,bO(bP(bW))];}return[bS,_8.map(function(bV){return bU(bV[0],bV[1]);},bT)];}return _8.map(function(bS){return bR(bS[0],bS[1]);},bQ);};_1=d.AppData=_3.Class({RecreateOnServer:function(bO){var bP,bQ;function bR(bS,bT){bT.Reconnect(bQ);}bP=_0.RecreateEventsOnServer(bO,this.Events);bQ=_8.map(function(bS){return bS.WithStartRunner();},_8.append(bP,_0.RecreatWidgetsOnServer(bO,this.Widgets)));_8.iter(function(bS){return bR(bS[0],bS[1]);},this.Rules);return bP;},RecreateOnClientEventsRunning:function(bO,bP,bQ){_0.RecreateOnClient(function(bR){return bR.WithStartRunner();},bO,bP,bQ,this.Events,this.Widgets,this.Rules);},RecreateOnClientEventsNotRunning:function(bO,bP,bQ){_0.RecreateOnClient(a.id,bO,bP,bQ,this.Events,this.Widgets,this.Rules);}},null,_1);_1.Create=function(bO,bP){var bQ;bQ=bO.Store(bP);return _1.New(bQ[0],bQ[1],bQ[2]);};_1.empty=function(){return _1.New(_8.T.Empty,_8.T.Empty,_8.T.Empty);};_1.New=function(bO,bP,bQ){return new _1({Events:bO,Widgets:bP,Rules:bQ});};}());
