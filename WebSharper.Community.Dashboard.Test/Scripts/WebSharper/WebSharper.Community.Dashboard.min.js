(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Community=b.Community||{};d=c.Dashboard=c.Dashboard||{};e=d.Environment=d.Environment||{};f=e.Role=e.Role||{};g=a.StartupCode$WebSharper_Community_Dashboard$Environment=a.StartupCode$WebSharper_Community_Dashboard$Environment||{};h=d.MessageBus=d.MessageBus||{};i=h.Value=h.Value||{};j=h.Message=h.Message||{};k=h.ListenerInfo=h.ListenerInfo||{};l=h.SystemStatus=h.SystemStatus||{};m=h.AgentMessage=h.AgentMessage||{};n=h.AgentState=h.AgentState||{};o=a.StartupCode$WebSharper_Community_Dashboard$MessageBus=a.StartupCode$WebSharper_Community_Dashboard$MessageBus||{};p=d.InPortData=d.InPortData||{};q=d.InPort=d.InPort||{};r=d.OutPort=d.OutPort||{};s=d.WorkerData=d.WorkerData||{};t=d.Worker=d.Worker||{};u=d.Workers=d.Workers||{};v=d.RuleEntry=d.RuleEntry||{};w=d.RuleChain=d.RuleChain||{};x=d.RuleContainer=d.RuleContainer||{};y=d.WorkerItem=d.WorkerItem||{};z=d.Factory=d.Factory||{};A=d.RulesCellItem=d.RulesCellItem||{};B=d.RulesRowItem=d.RulesRowItem||{};C=d.SelectorGroup=d.SelectorGroup||{};D=d.WindowSelector=d.WindowSelector||{};E=d.WidgetItem=d.WidgetItem||{};F=d.EventsGroupItem=d.EventsGroupItem||{};G=d.WidgetsGroupItem=d.WidgetsGroupItem||{};H=d.RulesGroupItem=d.RulesGroupItem||{};I=d.DshData=d.DshData||{};J=d.RulesEditor=d.RulesEditor||{};K=d.DshHelper=d.DshHelper||{};L=d.Dashboard=d.Dashboard||{};M=d.Events=d.Events||{};N=M.RandomEvent=M.RandomEvent||{};O=M.DatabaseEventContext=M.DatabaseEventContext||{};P=M.DatabaseEvent=M.DatabaseEvent||{};Q=M.OpenWeather=M.OpenWeather||{};R=Q.Forecast=Q.Forecast||{};S=M.OpenWeatherEvent=M.OpenWeatherEvent||{};T=M.ClockEvent=M.ClockEvent||{};U=d.Widgets=d.Widgets||{};V=U.TextBoxWidget=U.TextBoxWidget||{};W=U.ChartWidgetContext=U.ChartWidgetContext||{};X=U.ChartWidget=U.ChartWidget||{};Y=U.ButtonWidget=U.ButtonWidget||{};Z=U.GaugeWidget=U.GaugeWidget||{};_0=d.AppModelLib=d.AppModelLib||{};_1=d.App=d.App||{};_2=a.StartupCode$WebSharper_Community_Dashboard$AppModelLib=a.StartupCode$WebSharper_Community_Dashboard$AppModelLib||{};_3=d.AppDataHelper=d.AppDataHelper||{};_4=d.AppData=d.AppData||{};_5=a.IntelliFactory;_6=_5&&_5.Runtime;_7=b&&b.Operators;_8=c&&c.Panel;_9=_8&&_8.Helper;_=a.Date;$=b&&b.List;ba=b&&b.Concurrency;bb=b&&b.Remoting;bc=bb&&bb.AjaxRemotingProvider;bd=b&&b.Utils;be=b&&b.Control;bf=be&&be.MailboxProcessor;bg=b&&b.Seq;bh=b&&b.UI;bi=bh&&bh.Next;bj=bi&&bi.View;bk=bi&&bi.Var;bl=c&&c.PropertyGrid;bm=bl&&bl.Properties;bn=b&&b.MatchFailureException;bo=a.System;bp=bo&&bo.Guid;bq=bi&&bi.Doc;br=b&&b.Enumerator;bs=bi&&bi.Key;bt=bi&&bi.ListModel;bu=b&&b.Unchecked;bv=bi&&bi.AttrModule;bw=b&&b.Option;bx=_8&&_8.WrapControls;by=a.console;bz=_8&&_8.PanelContainer;bA=_8&&_8.LayoutManagers;bB=_8&&_8.Panel;bC=_8&&_8.TitleButton;bD=_8&&_8.Dialog;bE=bl&&bl.PropertyGrid;bF=b&&b.Random;bG=a.Math;bH=b&&b.Data;bI=bH&&bH.TxtRuntime;bJ=a.FSharp;bK=bJ&&bJ.Data;bL=bK&&bK.Runtime;bM=bL&&bL.IO;bN=a.JSON;bO=b&&b.Arrays;bP=b&&b.DateUtil;bQ=b&&b.Charting;bR=bQ&&bQ.Renderers;bS=bR&&bR.ChartJs;bT=be&&be.FSharpEvent;bU=bQ&&bQ.Chart;bV=bQ&&bQ.LiveChart;bW=bQ&&bQ.Pervasives;bX=b&&b.FormatException;bY=bi&&bi.AttrProxy;f.Server={$:1};f.Client={$:0};e.UpdateConfiguration=function(){g.$cctor();return g.UpdateConfiguration;};e.set_UpdateConfiguration=function(bZ){g.$cctor();g.UpdateConfiguration=bZ;};e.DataDirectory=function(){g.$cctor();return g.DataDirectory;};e.set_DataDirectory=function(bZ){g.$cctor();g.DataDirectory=bZ;};e.Log=function(){g.$cctor();return g.Log;};e.set_Log=function(bZ){g.$cctor();g.Log=bZ;};e.Role$1=function(){g.$cctor();return g.Role;};e.set_Role=function(bZ){g.$cctor();g.Role=bZ;};g.$cctor=function(){g.$cctor=a.ignore;g.Role=f.Server;g.Log=a.ignore;g.DataDirectory="";g.UpdateConfiguration=a.ignore;};i=h.Value=_6.Class({get_trySystem:function(){return this.$==4?{$:1,$0:this.$0}:null;},get_AsSelect:function(){return this.$==3?this.$0:_7.FailWith("MessageBus.Value: unexpected type");},get_AsBoolean:function(){return this.$==2?this.$0:((h.log())("MessageBus.Value: unexpected type"),false);},get_AsString:function(){return this.$==1?this.$0:((h.log())("MessageBus.Value: unexpected type"),"Invalid");},get_AsNumber:function(){return this.$==0?this.$0:((h.log())("MessageBus.Value: unexpected type"),0);}},null,i);j=h.Message=_6.Class({WithTime:function(bZ){return j.New(this.Key,bZ,this.Value);},WithKey:function(bZ){return j.New(bZ,this.Time,this.Value);}},null,j);j.Create=function(bZ){return j.New(_9.UniqueKey(),_.now(),bZ);};j.New=function(bZ,b0,b1){return new j({Key:bZ,Time:b0,Value:b1});};k.Create=function(bZ,b0,b1){return k.New(bZ,b0,b1);};k.New=function(bZ,b0,b1){return{Key:bZ,Name:b0,CacheSize:b1};};l.Running={$:1};l.Inactive={$:0};m.Start={$:5};m.Stop={$:4};n.get_initListeners=function(){return $.ofArray([[k.Create("system","Configuration",1),function(bZ){var b0;b0=bZ.Value.get_trySystem();b0==null?void 0:(e.UpdateConfiguration())(b0.$0.$0);},$.T.Empty]]);};n.get_empty=function(){return n.New(l.Inactive,null,n.get_initListeners(),(new _(1,1-1,1)).getTime());};n.New=function(bZ,b0,b1,b2){return{SystemStatus:bZ,ServerCallback:b0,Listeners:b1,LastConfigurationTime:b2};};h.RunServerRequests=function(){var bZ;ba.Start((bZ=null,ba.Delay(function(){return ba.While(function(){return true;},ba.Delay(function(){return ba.Bind(ba.Sleep(2*1000),function(){return ba.Bind(h.Agent().PostAndAsyncReply(function(b0){return{$:8,$0:b0};},null),function(b0){return ba.TryWith(ba.Delay(function(){return ba.Bind((new bc.New()).Async("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.MessageBus.GetMessages:214660718",[b0[0],b0[1]]),function(b1){var b2;$.iter(function(b3){var b4;b4=h.Agent();b4.mailbox.AddLast({$:1,$0:b3});b4.resume();},b1);return b1.get_Length()>0?($.iter(function(b3){var b4;b4=(((_6.Curried3(function(b5,b6,b7){return b5(bd.toSafe(b6)+" "+bd.toSafe(b7));}))(a.id))(b3.Key))(a.String(b3.Time));(h.log())(b4);},b1),b2=(function(b3){return function(b4){return b3("Values from server requested messages received:"+a.String(b4));};}(a.id))(b1.get_Length()),(h.log())(b2),ba.Zero()):ba.Zero();});}),function(){return ba.Zero();});});});}));})),null);};h.Agent=function(){o.$cctor();return o.Agent;};h.CreateMessage=function(bZ){return j.New(_9.UniqueKey(),_.now(),bZ);};h.log=function(){o.$cctor();return o.log;};o.$cctor=function(){o.$cctor=a.ignore;o.log=e.Log();o.Agent=bf.Start(function(bZ){function b0(b5,b6){return bg.fold(function(b7,b8){var b9;return(b9=b8.Time-b5,b9/1000)>0.01?new $.T({$:1,$0:b8,$1:b7}):b7;},$.T.Empty,b6);}function b1(b5,b6){return b5<b6.get_Length()?($.splitAt(b5,b6))[0]:b6;}function b2(b5,b6,b7){return b5===1?$.ofArray([b7]):b1(b5,new $.T({$:1,$0:b7,$1:b6}));}function b3(b5,b6){function b7(b8,b9,b_){var b$,ca;b$=a.Array.prototype.slice.call(arguments);if(b8.Key===b5.Key){try{b9(b5);}catch(cb){ca=(function(cc){return function(cd){return cc("Fails send message. It might be that receiver doesn't expect message of this type: "+bd.toSafe(cd));};}(a.id))(b8.Name);(h.log())(ca);}return[b8,b9,b2(b8.CacheSize,b_,b5)];}else return b$;}return $.map(function(b8){return b7(b8[0],b8[1],b8[2]);},b6);}function b4(b5){var b6;b6=null;return ba.Delay(function(){return ba.Bind(bZ.Receive(null),function(b7){var b8,b9,b_,b$,ca,cb,cc;function cd(ch,ci){function cj(ck,cl,cm){return b0(ch,cm);}return $.sortBy(function(ck){return ck.Time;},bg.fold(function(ck,cl){return!$.contains(cl,ck)?new $.T({$:1,$0:cl,$1:ck}):ck;},$.T.Empty,$.concat($.map(function(ck){return cj(ck[0],ck[1],ck[2]);},ci))));}function ce(ch,ci,cj){return ch.Key==="system";}function cf(ch,ci,cj){return ch.Key!=="system";}function cg(ch,ci,cj){return cj.$==0?(new _(1,1-1,1)).getTime():$.maxBy(function(ck){return ck.Time;},cj).Time;}return b7.$==5?b4(n.New(l.Running,b5.ServerCallback,b5.Listeners,b5.LastConfigurationTime)):b7.$==6?(b7.$0(b5.SystemStatus),b4(b5)):b7.$==2?(b8=b7.$0[0],(b9=(((_6.Curried3(function(ch,ci,cj){return ch("RegisterListener:"+bd.toSafe(ci)+" "+bd.toSafe(cj));}))(a.id))(b8.Name))(b8.Key),(h.log())(b9),b4(n.New(b5.SystemStatus,b5.ServerCallback,new $.T({$:1,$0:[b8,b7.$0[1],$.T.Empty],$1:b5.Listeners}),b5.LastConfigurationTime)))):b7.$==3?b4(n.New(b5.SystemStatus,{$:1,$0:b7.$0},b5.Listeners,b5.LastConfigurationTime)):b7.$==7?(b7.$0[2]($.append(cd(b7.$0[0],$.filter(function(ch){return ce(ch[0],ch[1],ch[2]);},b5.Listeners)),cd(b7.$0[1],$.filter(function(ch){return cf(ch[0],ch[1],ch[2]);},b5.Listeners)))),b4(b5)):b7.$==8?(b_=$.map(function(ch){return cg(ch[0],ch[1],ch[2]);},b5.Listeners),(b7.$0([b5.LastConfigurationTime,b_.$==0?(new _(1,1-1,1)).getTime():$.max(b_)]),b4(b5))):b7.$==1?(b$=b7.$0,(ca=b$.Value.get_trySystem(),ca==null?b4(n.New(b5.SystemStatus,b5.ServerCallback,b3(b$,b5.Listeners),b5.LastConfigurationTime)):ba.Combine(((e.UpdateConfiguration())(ca.$0.$0),ba.Zero()),ba.Delay(function(){return b4(n.New(b5.SystemStatus,b5.ServerCallback,b5.Listeners,b$.Time));})))):b7.$==0?(cb=b7.$0,(cc=b5.ServerCallback,cc==null?void 0:cc.$0(cb),b4(n.New(b5.SystemStatus,b5.ServerCallback,b3(cb,b5.Listeners),b5.LastConfigurationTime)))):b4(n.New(l.Inactive,b5.ServerCallback,n.get_initListeners(),b5.LastConfigurationTime));});});}return b4(n.get_empty());},null);};p=d.InPortData=_6.Class({WithCacheSize:function(bZ){return p.New(this.Key,this.Name,this.Value,bZ);}},null,p);p.CreateSelect=function(bZ,b0){return p.Create(bZ,new i({$:3,$0:b0}));};p.CreateBoolean=function(bZ,b0){return p.Create(bZ,new i({$:2,$0:b0}));};p.CreateString=function(bZ,b0){return p.Create(bZ,new i({$:1,$0:b0}));};p.CreateNumber=function(bZ,b0){return p.Create(bZ,new i({$:0,$0:b0}));};p.Create=function(bZ,b0){var b1;b1=h.CreateMessage(b0);return p.New(b1.Key,bZ,b1.WithTime((new _(1,1-1,1)).getTime()),1);};p.New=function(bZ,b0,b1,b2){return new p({Key:bZ,Name:b0,Value:b1,CacheSize:b2});};q=d.InPort=_6.Class({get_SelectView:function(){return bj.Map(function(bZ){return bZ.Value.get_AsSelect();},this.PortValue.v);},get_Select:function(){return this.PortValue.c.Value.get_AsSelect();},get_BooleanView:function(){return bj.Map(function(bZ){return bZ.Value.get_AsBoolean();},this.PortValue.v);},get_Boolean:function(){return this.PortValue.c.Value.get_AsBoolean();},get_StringView:function(){return bj.Map(function(bZ){return bZ.Value.get_AsString();},this.PortValue.v);},get_String:function(){return this.PortValue.c.Value.get_AsString();},get_NumberView:function(){return bj.Map(function(bZ){return bZ.Value.get_AsNumber();},this.PortValue.v);},get_Number:function(){return this.PortValue.c.Value.get_AsNumber();},Receive:function(bZ){bk.Set(this.PortValue,bZ);},get_Property:function(){var bZ,b0,b1,b2,b3,b4,b5;b4=this;b5=this.PortValue.c.Value;if(b5.$==0){bZ=bk.Create$1(this.get_Number());bj.Sink(function(b6){var b7;bk.Set(b4.PortValue,(b7=b4.PortValue.c,j.New(b7.Key,b7.Time,new i({$:0,$0:b6}))));},bZ.v);return bm["double"](this.Data.Name,bZ);}else if(b5.$==1){b0=bk.Create$1(this.get_String());bj.Sink(function(b6){var b7;bk.Set(b4.PortValue,(b7=b4.PortValue.c,j.New(b7.Key,b7.Time,new i({$:1,$0:b6}))));},b0.v);return bm.string(this.Data.Name,b0);}else if(b5.$==2){b1=bk.Create$1(this.get_Boolean());bj.Sink(function(b6){var b7;bk.Set(b4.PortValue,(b7=b4.PortValue.c,j.New(b7.Key,b7.Time,new i({$:2,$0:b6}))));},b1.v);return bm.check(this.Data.Name,b1);}else if(b5.$==3){b2=b5.$0[1];b3=bk.Create$1(b2.get_Item(b5.$0[0]));bj.Sink(function(b6){var b7;bk.Set(b4.PortValue,(b7=b4.PortValue.c,j.New(b7.Key,b7.Time,new i({$:3,$0:[bg.findIndex(function(b8){return b8===b6;},b2),b2]}))));},b3.v);return bm.select(this.Data.Name,a.id,b2,b3);}else throw new bn.New("Port.fs",38,30);},get_Key:function(){return this.Data.Key;},get_Name:function(){return this.Data.Name;}},null,q);q.Clone=function(bZ){var b0,b1;return q.New((b0=bZ.Data,p.New((b1=bp.NewGuid(),a.String(b1)),b0.Name,b0.Value,b0.CacheSize)),bk.Create$1(bZ.PortValue.c));};q.ToData=function(bZ){var b0;b0=bZ.Data;return p.New(b0.Key,b0.Name,bZ.PortValue.c,b0.CacheSize);};q.FromData=function(bZ){return q.New(bZ,bk.Create$1(bZ.Value));};q.New=function(bZ,b0){return new q({Data:bZ,PortValue:b0});};r=d.OutPort=_6.Class({Trigger:function(bZ){var b0,b1;b0={$:0,$0:h.CreateMessage(bZ).WithKey(this.Key)};b1=h.Agent();b1.mailbox.AddLast(b0);b1.resume();}},null,r);r.Clone=function(bZ){return r.New(_9.UniqueKey(),bZ.Name);};r.Create=function(bZ){return r.New(_9.UniqueKey(),bZ);};r.New=function(bZ,b0){return new r({Key:bZ,Name:b0});};s.Create=function(bZ,b0,b1){return s.New(bZ,b0,b1);};s.New=function(bZ,b0,b1){return{WorkerName:bZ,InPorts:b0,OutPorts:b1};};t=d.Worker=_6.Class({get_Properties:function(){return new $.T({$:1,$0:bm.group(""),$1:new $.T({$:1,$0:bm.string("Name",this.Name),$1:$.map(function(bZ){return bZ.get_Property();},this.InPorts)})});},get_Render:function(){var bZ;bZ=this.Data.WebSharper_Community_Dashboard_IWorkerData$get_Render();return bZ==null?bq.Empty():bZ.$0(this);},get_Clone:function(){return t.New(_9.UniqueKey(),bk.Create$1(this.Name.c),$.map(q.Clone,this.InPorts),$.map(r.Clone,this.OutPorts),this.Data,bk.Create$1(null));},get_ToData:function(){return s.New(this.Name.c,$.map(q.ToData,this.InPorts),this.OutPorts);},StartRunner:function(){var bZ;bZ=this.Data.WebSharper_Community_Dashboard_IWorkerData$get_Run();bZ==null?void 0:bk.Set(this.RunnerContext,bZ.$0(this));},WithKey:function(bZ){return t.New(bZ,this.Name,this.InPorts,this.OutPorts,this.Data,this.RunnerContext);}},null,t);t.Create=function(bZ){return t.New(_9.UniqueKey(),bk.Create$1(bZ.WebSharper_Community_Dashboard_IWorkerData$get_Data().WorkerName),$.map(q.FromData,bZ.WebSharper_Community_Dashboard_IWorkerData$get_Data().InPorts),bZ.WebSharper_Community_Dashboard_IWorkerData$get_Data().OutPorts,bZ,bk.Create$1(null));};t.New=function(bZ,b0,b1,b2,b3,b4){return new t({Key:bZ,Name:b0,InPorts:b1,OutPorts:b2,Data:b3,RunnerContext:b4});};u.allInPorts=function(bZ){return u.allPorts(bZ,function(b0){return b0.InPorts;});};u.allOutPorts=function(bZ){return u.allPorts(bZ,function(b0){return b0.OutPorts;});};u.allPorts=function(bZ,b0){return $.concat($.map(b0,bZ));};v.New=function(bZ,b0,b1){return{InPortKey:bZ,OutPortKey:b0,WorkerKey:b1};};w.New=function(bZ){return{RuleChain:bZ};};x=d.RuleContainer=_6.Class({Reconnect:function(bZ){var b0,b1,b2;b0=e.Log();b1=u.allOutPorts(bZ);b2=u.allInPorts(bZ);$.iter(function(b3){var b4,b5,b6;b4=$.ofSeq(b3.RuleChain);b5=$.ofSeq(_7.range(1,b4.get_Length()-1));b6=br.Get(b5);try{while(b6.MoveNext())(function(){var b7,b8,b9,b_,b$,ca,cb,cc;b7=b6.Current();b8=b4.get_Item(b7-1);b9=b4.get_Item(b7);b_=bg.tryFind(function(cd){return cd.Key===b8.OutPortKey;},b1),b_==null?null:{$:1,$0:(b$=b_.$0,(ca=bg.tryFind(function(cd){return cd.Data.Key===b9.InPortKey;},b2),ca==null?null:{$:1,$0:(cb=ca.$0,(b0("Found inPort"),cb.PortValue.c.Key!==cb.Data.Key?bk.Set(cb.PortValue,cb.PortValue.c.WithKey(cb.Data.Key)):void 0,cc=h.Agent(),cc.mailbox.AddLast({$:2,$0:[k.Create(b$.Key,b$.Name+"->"+cb.get_Name(),cb.Data.CacheSize),function(cd){cb.Receive(cd);}]}),cc.resume()))}))};}());}finally{if("Dispose"in b6)b6.Dispose();}},$.ofSeq(this.RuleContainer));}},null,x);x.New=function(bZ){return new x({RuleContainer:bZ});};y.Create=function(bZ){return y.New(bs.Fresh(),bZ);};y.New=function(bZ,b0){return{Key:bZ,Worker:b0};};z=d.Factory=_6.Class({RegisterEvent:function(bZ){this.EventItems.Append(y.Create(bZ));},RegisterWidget:function(bZ){this.WidgetItems.Append(y.Create(bZ));}},null,z);z.get_Create=function(){return z.New(bt.Create(function(bZ){return bZ.Key;},$.T.Empty),bt.Create(function(bZ){return bZ.Key;},$.T.Empty));};z.New=function(bZ,b0){return new z({EventItems:bZ,WidgetItems:b0});};A=d.RulesCellItem=_6.Class({Render:function(bZ,b0){var b1,b2,b3,b4,b5;b1=this;bj.Sink(function(b6){var b7,b8,b9,b_,b$;if(b6==null);else{b7=b6.$0;b8=b1.OptInPort.c;b8==null?bk.Set(b1.OptInPort,$.tryHead(b7.Worker.InPorts)):(b9=b8.$0,!$.exists(function(ca){return bu.Equals(ca,b9);},b7.Worker.InPorts)?bk.Set(b1.OptInPort,$.tryHead(b7.Worker.InPorts)):void 0);b_=b1.OptOutPort.c;b_==null?bk.Set(b1.OptOutPort,$.tryHead(b7.Worker.OutPorts)):(b$=b_.$0,!$.exists(function(ca){return bu.Equals(ca,b$);},b7.Worker.OutPorts)?bk.Set(b1.OptOutPort,$.tryHead(b7.Worker.OutPorts)):void 0);b0();}},this.OptWorker.v);bj.Sink(function(){b0();},this.OptInPort.v);bj.Sink(function(){b0();},this.OptOutPort.v);b2=(b3=bj.Map(function(b6){var b7;return b6==null?$.ofArray([null]):(b7=$.map(function(b8){return{$:1,$0:b8};},b6.$0.Worker.InPorts),b7.get_Length()>0?b7:$.ofArray([null]));},this.OptWorker.v),(b4=bj.Map(function(b6){var b7;return b6==null?$.ofArray([null]):(b7=$.map(function(b8){return{$:1,$0:b8};},b6.$0.Worker.OutPorts),b7.get_Length()>0?b7:$.ofArray([null]));},this.OptWorker.v),(b5=bj.Map(function(b6){return new $.T({$:1,$0:null,$1:$.map(function(b7){return{$:1,$0:b7};},$.ofSeq(b6))});},bZ.v),bq.Element("table",[],[bq.Element("tr",[],[bq.Element("td",[],[bq.SelectDyn([bv.Class("form-control")],function(b6){return bw.fold(function(b7,b8){return b8.get_Name();}," ",b6);},b3,this.OptInPort)]),bq.Element("td",[],[bq.SelectDyn([bv.Class("form-control")],function(b6){return bw.fold(function(b7,b8){return b8.Worker.Name.c;}," ",b6);},b5,this.OptWorker)]),bq.Element("td",[],[bq.SelectDyn([bv.Class("form-control")],function(b6){return bw.fold(function(b7,b8){return b8.Name;}," ",b6);},b4,this.OptOutPort)])])]))));return bq.Element("td",[bv.Class("td DshEditorCell")],[bq.Element("div",[bv.Class("div DshEditorCell")],[bq.Element("table",[],[bq.Element("tr",[],[bq.Element("td",[],[b2])])])])]);}},null,A);A.get_Create=function(){return A.New(bs.Fresh(),bk.Create$1(null),bk.Create$1(null),bk.Create$1(null));};A.New=function(bZ,b0,b1,b2){return new A({Key:bZ,OptInPort:b0,OptWorker:b1,OptOutPort:b2});};B=d.RulesRowItem=_6.Class({Render:function(bZ,b0){var b1;b1=this;return bq.Element("tr",[],[bq.ConvertBy(function(b2){return b2.Key;},function(b2){return b2.Render(bZ,b0);},this.CellItems.v),_9.IconNormal("add",function(){b1.CellItems.Append(A.get_Create());})]);}},null,B);B.Create=function(bZ){return B.New(bs.Fresh(),bt.Create(function(b0){return b0.Key;},bZ));};B.New=function(bZ,b0){return new B({Key:bZ,CellItems:b0});};C=d.SelectorGroup=_6.Class({RenderMenu:function(bZ,b0,b1){var b2,b3,b4,b5,b6,b7;function b8(b9){return $.ofArray([_9.IconSmall("keyboard_arrow_down",function(){(b3(true))(b9);(b2.ItemOnMove(b9))({$:1});}),_9.IconSmall("keyboard_arrow_up",function(){(b3(false))(b9);(b2.ItemOnMove(b9))({$:0});}),_9.IconSmall("clear",function(){b2.SelectorItems.Remove(b9);b2.ItemOnDelete(b9);})]);}b2=this;b3=(b4=this.SelectorItems,(_6.Curried3(_9.MoveItemInModelList))(b4));b5=(b6=this.ItemCreatator,b6==null?bq.Element("tr",[],[]):(b7=b6.$0,bq.Element("tr",[],[bq.Element("td",[],[bq.Element("div",[bv.Style("margin-left","20px")],[_9.IconSmall("add",function(){var b9;b9=b7();b2.ItemOnCreated(b9);b2.SelectorItems.Append(b9);})])])])));return bq.Element("table",[],[bq.ConvertBy(function(b9){return b9.WebSharper_Community_Dashboard_ISelectorItem$get_Key();},function(b9){var b_,b$,ca,cb;b_=bj.Map(function(cc){return bZ+cc;},b9.WebSharper_Community_Dashboard_ISelectorItem$get_Name().v);return bq.Element("tr",[],[bq.Element("td",[bv.DynamicStyle("Color",bj.Map(function(cc){return cc==null?"#7D4600":bu.Equals(cc.$0.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),b9.WebSharper_Community_Dashboard_ISelectorItem$get_Key())?"#FB8C00":"#7D4600";},b0.v))],[(b$=bq.Element("div",[bv.Style("margin-left","10px"),bv.Style("margin-right","5px"),bv.Style("cursor","pointer"),bv.Handler("click",function(){return function(){b2.ItemOnSelected(b9);return bk.Set(b0,{$:1,$0:b9});};})],[bq.TextView(b_)]),(b1?(ca=b8(b9),(cb=_8.WrapControlsAligment.Horizontal,function(cc){return bx.Render(ca,cb,cc);})):a.id)(b$))])]);},this.SelectorItems.v),b5]);},Render:function(bZ){return bq.ConvertBy(function(b0){return b0.WebSharper_Community_Dashboard_ISelectorItem$get_Key();},function(b0){return bq.Element("div",[bv.DynamicStyle("display",bj.Map(function(b1){return b1==null?"none":bu.Equals(b1.$0,b0)?"block":"none";},bZ.v))],[b0.WebSharper_Community_Dashboard_ISelectorItem$get_Render()]);},this.SelectorItems.v);}},null,C);C.Create=function(bZ,b0,b1,b2,b3,b4,b5){var b6;b6=bt.Create(function(b7){return b7.WebSharper_Community_Dashboard_ISelectorItem$get_Key();},b0);return C.New(bs.Fresh(),bk.Create$1(bZ),b6,b1,b2,b3,b4,b5);};C.New=function(bZ,b0,b1,b2,b3,b4,b5,b6){return new C({Key:bZ,Name:b0,SelectorItems:b1,ItemCreatator:b2,ItemOnCreated:b3,ItemOnSelected:b4,ItemOnDelete:b5,ItemOnMove:b6});};D=d.WindowSelector=_6.Class({get_RenderMenu:function(){var bZ;bZ=this;return this.SelectorGroups.get_Length()===1?$.head($.ofSeq(this.SelectorGroups)).RenderMenu("",this.OptSelectedItem,this.IsWithControls):bq.Element("div",[],[bq.ConvertBy(function(b0){return b0.Key;},function(b0){return bq.Element("div",[],[bq.Element("div",[bv.Style("cursor","pointer"),bv.Handler("click",function(){return function(){return bZ.GroupOnClick(b0);};})],[bq.TextView(b0.Name.v)]),b0.RenderMenu("    ",bZ.OptSelectedItem,bZ.IsWithControls)]);},this.SelectorGroups.v)]);},get_Render:function(){var bZ;bZ=this;return bq.Element("div",[],[bq.ConvertBy(function(b0){return b0.Key;},function(b0){return b0.Render(bZ.OptSelectedItem);},this.SelectorGroups.v)]);},GroupByIndex:function(bZ){return bg.nth(bZ,$.ofSeq(this.SelectorGroups));},get_SelectedIndex:function(){var bZ;bZ=this;return bg.findIndex(function(b0){return bu.Equals(b0.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bZ.get_SelectedItem().WebSharper_Community_Dashboard_ISelectorItem$get_Key());},$.concat($.map(function(b0){return $.ofSeq(b0.SelectorItems);},$.ofSeq(this.SelectorGroups))));},get_SelectedIndexInGroup:function(){var bZ;bZ=this;return bg.findIndex(function(b0){return bu.Equals(b0.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bZ.get_SelectedItem().WebSharper_Community_Dashboard_ISelectorItem$get_Key());},$.ofSeq(this.get_SelectedGroup().SelectorItems));},get_SelectedGroupIndex:function(){var bZ;bZ=this;return bg.findIndex(function(b0){return bu.Equals(b0.Key,bZ.get_SelectedGroup().Key);},$.ofSeq(this.SelectorGroups));},get_SelectedGroup:function(){return this.GroupFromItem(this.get_SelectedItem());},GroupFromItem:function(bZ){return bg.find(function(b0){return $.exists(function(b1){return bu.Equals(b1.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bZ.WebSharper_Community_Dashboard_ISelectorItem$get_Key());},$.ofSeq(b0.SelectorItems));},$.ofSeq(this.SelectorGroups));},AppenGroup:function(bZ,b0,b1){var b2;b2=this.SelectorGroups.get_Length();this.SelectorGroups.Append(C.Create(bZ,b0,b1,this.ItemOnCreated(b2),this.ItemOnSelected,this.ItemOnDeleted(b2),this.ItemOnMove(b2)));},get_SelectedItem:function(){var bZ;bZ=this.OptSelectedItem.c;return bZ==null?_7.FailWith("Something really wrong with WindowSelector"):bZ.$0;},ClearGroups:function(){bk.Set(this.OptSelectedItem,null);$.iter(function(bZ){bZ.SelectorItems.Clear();},$.ofSeq(this.SelectorGroups));},WithControls:function(bZ){return D.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,bZ);},WithItemOnMove:function(bZ){return D.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,bZ,this.IsWithControls);},WithItemOnDeleted:function(bZ){return D.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,bZ,this.ItemOnMove,this.IsWithControls);},WithItemOnSelected:function(bZ){return D.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,bZ,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);},WithGroupOnClick:function(bZ){return D.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,bZ,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);},WithItemOnCreated:function(bZ){return D.New(this.OptSelectedItem,this.SelectorGroups,bZ,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);}},null,D);D.get_Create=function(){var bZ;bZ=bt.Create(function(b0){return b0.Key;},$.T.Empty);return D.New(bk.Create$1(null),bZ,function(){return function(){return null;};},a.ignore,a.ignore,function(){return function(){return null;};},_6.Curried3(function(b0,b1,b2){return null;}),false);};D.New=function(bZ,b0,b1,b2,b3,b4,b5,b6){return new D({OptSelectedItem:bZ,SelectorGroups:b0,ItemOnCreated:b1,GroupOnClick:b2,ItemOnSelected:b3,ItemOnDeleted:b4,ItemOnMove:b5,IsWithControls:b6});};E.Create=function(bZ,b0){return E.New(bs.Fresh(),bZ,b0);};E.New=function(bZ,b0,b1){return{Key:bZ,Panel:b0,Widget:b1};};F=d.EventsGroupItem=_6.Class({get_Render:function(){var bZ,b0,b1;function b2(b3){return $.ofArray([_9.IconSmall("keyboard_arrow_down",function(){(b0(true))(b3);}),_9.IconSmall("keyboard_arrow_up",function(){(b0(false))(b3);}),_9.IconSmall("clear",function(){bZ.EventItems.Remove(b3);})]);}bZ=this;b0=(b1=this.EventItems,(_6.Curried3(_9.MoveItemInModelList))(b1));return bq.Element("table",[],[bq.ConvertBy(function(b3){return b3.Key;},function(b3){var b4;return bq.Element("tr",[],[(b4=bq.Element("div",_9.AttrsClick(function(){bZ.PropertyGrid.Edit(b3.Worker.get_Properties());}),[bq.TextView(b3.Worker.Name.v)]),bx.Render(b2(b3),_8.WrapControlsAligment.Horizontal,b4))]);},this.EventItems.v)]);},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,F);F.Create=function(bZ,b0){return F.New(bs.Fresh(),bk.Create$1(bZ),bt.Create(function(b1){return b1.Key;},$.T.Empty),b0);};F.New=function(bZ,b0,b1,b2){return new F({Key:bZ,Name:b0,EventItems:b1,PropertyGrid:b2});};G=d.WidgetsGroupItem=_6.Class({get_Render:function(){return this.PanelContainer.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,G);G.Create=function(bZ,b0){return G.New(bs.Fresh(),bk.Create$1(bZ),bt.Create(function(b1){return b1.Key;},$.T.Empty),b0);};G.New=function(bZ,b0,b1,b2){return new G({Key:bZ,Name:b0,WidgetItems:b1,PanelContainer:b2});};H=d.RulesGroupItem=_6.Class({Equals:function(bZ){return bZ instanceof H&&bu.Equals(this.Key,bZ.Key);},get_Render:function(){return this.Renderer(this.RulesRowItems);},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,H);H.Create=function(bZ,b0){return H.New(bs.Fresh(),bk.Create$1(bZ),bt.Create(function(b1){return b1.Key;},$.T.Empty),b0);};H.New=function(bZ,b0,b1,b2){return new H({Key:bZ,Name:b0,RulesRowItems:b1,Renderer:b2});};I=d.DshData=_6.Class({RegisterWidget:function(bZ,b0,b1,b2){var b3;b3=b2.WithKey(bZ);b0.WidgetItems.Append(E.Create(b1,b3));this.WorkItems.Append(y.Create(b3));},RegisterEvent:function(bZ,b0,b1){var b2;b2=y.Create(b1.WithKey(bZ));b0.EventItems.Append(b2);this.WorkItems.Append(b2);},get_Clear:function(){this.WorkItems.Clear();this.WidgetGroups.Clear();this.EventGroups.Clear();this.RulesGroups.Clear();}},null,I);I.get_Create=function(){return I.New(bt.Create(function(bZ){return bZ.Key;},$.T.Empty),bt.Create(function(bZ){return bZ.Key;},$.T.Empty),bt.Create(function(bZ){return bZ.Key;},$.T.Empty),bt.Create(function(bZ){return bZ.Key;},$.T.Empty));};I.New=function(bZ,b0,b1,b2){return new I({WorkItems:bZ,WidgetGroups:b0,EventGroups:b1,RulesGroups:b2});};J.Render=function(bZ,b0){function b1(b4,b5){return _9.MoveItemInModelList(b0,b4,b5);}function b2(b4){return $.ofArray([_9.IconSmall("keyboard_arrow_down",function(){b1(true,b4);}),_9.IconSmall("keyboard_arrow_up",function(){b1(false,b4);}),_9.IconSmall("clear",function(){b0.Remove(b4);})]);}function b3(){var b4;ba.Start((b4=null,ba.Delay(function(){return ba.Bind(h.Agent().PostAndAsyncReply(function(b5){return{$:6,$0:b5};},null),function(b5){var b6,b7,b8;return b5.$==1?(b6=h.Agent(),b6.mailbox.AddLast(m.Stop),b6.resume(),b7=$.map(function(b9){return b9.Worker;},$.ofSeq(bZ.WorkItems)),J.CopyToRules(b0).Reconnect(b7),b8=h.Agent(),b8.mailbox.AddLast(m.Start),b8.resume(),ba.Zero()):ba.Zero();});})),null);}return bq.Element("table",[],[bq.ConvertBy(function(b4){return b4.Key;},function(b4){var b5;return bq.Element("tr",[],[(b5=b4.Render(bZ.WorkItems,function(){b3();}),bx.Render(b2(b4),_8.WrapControlsAligment.Horizontal,b5))]);},b0.v)]);};J.Restore=function(bZ,b0,b1){var b2,b3,b4;b0.Clear();b2=$.map(function(b5){return b5.Worker;},$.ofSeq(bZ.WorkItems));b3=u.allOutPorts(b2);b4=u.allInPorts(b2);$.iter(function(b5){var b6;b6=B.Create([]);$.iter(function(b7){var b8;b8=A.get_Create();bk.Set(b8.OptWorker,bg.tryFind(function(b9){return b9.Worker.Key===b7.WorkerKey;},$.ofSeq(bZ.WorkItems)));bk.Set(b8.OptInPort,bg.tryFind(function(b9){return b9.get_Key()===b7.InPortKey;},b4));bk.Set(b8.OptOutPort,bg.tryFind(function(b9){return b9.Key===b7.OutPortKey;},b3));b6.CellItems.Append(b8);},b5.RuleChain);b0.Append(b6);},b1.RuleContainer);};J.CopyToRules=function(bZ){return x.New($.map(function(b0){return w.New($.map(function(b1){var b2,b3,b4;return v.New((b2=b1.OptInPort.c,b2==null?"":b2.$0.get_Key()),(b3=b1.OptOutPort.c,b3==null?"":b3.$0.Key),(b4=b1.OptWorker.c,b4==null?"":b4.$0.Worker.Key));},$.ofSeq(b0.CellItems)));},$.ofSeq(bZ)));};K.RulesGroupCreator=function(bZ,b0){var b1;b1=H.Create("rules"+a.String($.length($.ofSeq(bZ.RulesGroups))+1),function(b2){return J.Render(bZ,b2);});bZ.RulesGroups.Append(b1);return b1;};K.EventsGroupCreator=function(bZ,b0,b1){var b2;b2=F.Create("event"+a.String($.length($.ofSeq(bZ.EventGroups))+1),b0);bZ.EventGroups.Append(b2);return b2;};K.PanelGroupCreator=function(bZ,b0,b1){var b2;b2=G.Create("panel"+a.String($.length($.ofSeq(bZ.WidgetGroups))+1),b0());bZ.WidgetGroups.Append(b2);return b2;};L=d.Dashboard=_6.Class({Render:function(bZ){var b0;b0=this;return bq.EmbedView(bj.Map(function(b1){return b1.$==1?bq.Element("div",[],[bq.Element("table",[bv.Style("White-space","nowrap")],[bq.Element("tr",[],[bq.Element("td",[bv.Style("vertical-align","top")],[bq.Element("table",[],bg.concat([$.ofArray([bq.Element("tr",[],[bq.Element("td",[],[_9.IconNormal("dehaze",function(){bk.Set(b0.PanelTitleVisibility,false);bk.Set(b0.Mode,{$:0});})])])]),$.ofArray([b0.EditorSelectorEdit.get_RenderMenu()]),$.ofArray([bq.Element("tr",[],[bq.Element("td",[],[])]),bq.Element("tr",[],[bq.Element("td",[],[b0.PropertyGrid.get_Render()])])])]))]),bq.Element("td",[bv.Style("vertical-align","top")],[bZ,_9.IconNormal("add",function(){var b2,b3,b4,b5,b6;b2=b0.EditorSelectorEdit.get_SelectedGroupIndex();b2===1?(b3=$.ofSeq(b0.Factory.EventItems),b4=bk.Create$1($.head(b3)),b0.Dialog.ShowDialog("Select source",bq.Element("div",[],[bq.Select([bv.Class("form-control")],function(b7){return b7.Worker.Name.c;},b3,b4)]),function(){var b7,b8,b9;b7=b4.c.Worker.get_Clone();b7.StartRunner();b8=(b9=$.ofSeq(b0.Data.EventGroups),bg.nth(b0.EditorSelectorEdit.get_SelectedIndexInGroup(),b9));b0.Data.RegisterEvent(_9.UniqueKey(),b8,b7);})):b2===0?bk.Set(b0.CreatePanel((b5=$.ofSeq(b0.Data.WidgetGroups),bg.nth(b0.EditorSelectorEdit.get_SelectedIndexInGroup(),b5)),"Panel",null).IsWithInitialAutoLayout,true):b2===2?(b6=$.ofSeq(b0.Data.RulesGroups),bg.nth(b0.EditorSelectorEdit.get_SelectedIndexInGroup(),b6)).RulesRowItems.Append(B.Create([A.get_Create(),A.get_Create()])):void 0;}),b0.EditorSelectorEdit.get_Render()])])]),bq.Element("div",[],[b0.Dialog.get_Render()])]):bq.Element("div",[],[bq.Element("table",[bv.Style("White-space","nowrap")],[bq.Element("tr",[],[bq.Element("td",[bv.Style("vertical-align","top")],[_9.IconNormal("dehaze",function(){bk.Set(b0.PanelTitleVisibility,true);bk.Set(b0.Mode,{$:1});}),b0.EditorSelectorRun.get_RenderMenu()]),bq.Element("td",[],[b0.EditorSelectorRun.get_Render()])])])]);},this.Mode.v));},Restore:function(bZ,b0,b1,b2){var b3,b4,b5,b6,b7,b8,b9,b_;function b$(ca,cb){cb.Reconnect(b9);}b3=this;b4=h.Agent();b4.mailbox.AddLast(m.Stop);b4.resume();this.EditorSelectorRun.ClearGroups();this.EditorSelectorEdit.ClearGroups();this.Data.get_Clear();this.PropertyGrid.Edit($.T.Empty);b5=this.EditorSelectorRun.GroupByIndex(0);b6=this.EditorSelectorEdit.GroupByIndex(0);b7=this.EditorSelectorEdit.GroupByIndex(1);b8=this.EditorSelectorEdit.GroupByIndex(2);$.iteri(function(ca,cb){var cc,cd;function ce(cf,cg,ch){b3.RegisterWidget(cf,cd,cg,bg.find(function(ci){return ci.Key===cg;},$.ofSeq(cd.PanelContainer.PanelItems)).Children,(ch.StartRunner(),ch));}cc=K.PanelGroupCreator(b3.Data,bZ,null);bk.Set(cc.WebSharper_Community_Dashboard_ISelectorItem$get_Name(),cb[0]);b6.SelectorItems.Append(cc);b5.SelectorItems.Append(cc);cd=bg.nth(ca,$.ofSeq(b3.Data.WidgetGroups));$.iter(function(cf){var cg;cg=b3.CreatePanel(cd,"Panel",{$:1,$0:cf.Key});bk.Set(cg.Left,cf.Left);bk.Set(cg.Top,cf.Top);},cb[1]);return $.iter(function(cf){return ce(cf[0],cf[1],cf[2]);},cb[2]);},b1);by.log("Widgets restored");$.iteri(function(ca,cb){var cc,cd;function ce(cf,cg){b3.Data.RegisterEvent(cf,cd,cg);}cc=K.EventsGroupCreator(b3.Data,b3.PropertyGrid,null);bk.Set(cc.WebSharper_Community_Dashboard_ISelectorItem$get_Name(),cb[0]);b7.SelectorItems.Append(cc);cd=bg.nth(ca,$.ofSeq(b3.Data.EventGroups));return $.iter(function(cf){return ce(cf[0],cf[1]);},cb[1]);},b0);by.log("Events restored");$.iteri(function(ca,cb){var cc;cc=K.RulesGroupCreator(b3.Data,null);bk.Set(cc.WebSharper_Community_Dashboard_ISelectorItem$get_Name(),cb[0]);b8.SelectorItems.Append(cc);return J.Restore(b3.Data,bg.nth(ca,$.ofSeq(b3.Data.RulesGroups)).RulesRowItems,cb[1]);},b2);this.Data.WidgetGroups.get_Length()>0?(bk.Set(this.EditorSelectorEdit.OptSelectedItem,{$:1,$0:$.head($.ofSeq(this.EditorSelectorEdit.GroupByIndex(0).SelectorItems))}),bk.Set(this.EditorSelectorRun.OptSelectedItem,{$:1,$0:$.head($.ofSeq(this.EditorSelectorRun.GroupByIndex(0).SelectorItems))})):(bk.Set(this.EditorSelectorEdit.OptSelectedItem,null),bk.Set(this.EditorSelectorRun.OptSelectedItem,null));b9=$.map(function(ca){return ca.Worker;},$.ofSeq(this.Data.WorkItems));$.iter(function(ca){return b$(ca[0],ca[1]);},b2);b_=h.Agent();b_.mailbox.AddLast(m.Start);b_.resume();by.log("Connectors restored");return[$.concat($.map(function(ca){return $.map(function(cb){return cb.Worker;},$.ofSeq(ca.EventItems));},$.ofSeq(this.Data.EventGroups))),$.concat($.map(function(ca){return $.map(function(cb){return cb.Widget;},$.ofSeq(ca.WidgetItems));},$.ofSeq(this.Data.WidgetGroups)))];},Store:function(bZ){function b0(b2,b3){var b4;b4=bZ(b3);return b4==null?b2:new $.T({$:1,$0:[b3.Key,b4.$0],$1:b2});}function b1(b2,b3,b4){var b5;b5=bZ(b4);return b5==null?b2:new $.T({$:1,$0:[b4.Key,b3,b5.$0],$1:b2});}return[$.map(function(b2){return[b2.Name.c,$.rev(bg.fold(function(b3,b4){return b0(b3,b4.Worker);},$.T.Empty,$.ofSeq(b2.EventItems)))];},$.ofSeq(this.Data.EventGroups)),$.map(function(b2){return[b2.Name.c,$.map(function(b3){return b3.get_PanelData();},$.ofSeq(b2.PanelContainer.PanelItems)),$.rev(bg.fold(function(b3,b4){return b1(b3,b4.Panel,b4.Widget);},$.T.Empty,$.ofSeq(b2.WidgetItems)))];},$.ofSeq(this.Data.WidgetGroups)),$.map(function(b2){return[b2.Name.c,J.CopyToRules(b2.RulesRowItems)];},$.ofSeq(this.Data.RulesGroups))];},CreatePanel:function(bZ,b0,b1){var b2,b3,b4,b5,b6,b7;b2=this;bq.ConvertBy(bZ.WidgetItems.key,function(b8){return bq.Element("div",[],[bq.TextView(b8.Widget.Name.v)]);},bZ.WidgetItems.v);b3=(b4=(b5=bp.NewGuid(),a.String(b5)),b1==null?b4:b1.$0);b6=bz.get_Create().WithLayoutManager(bA.StackPanelLayoutManager()).WithAttributes([bv.Style("display","flex")]);b7=bB.get_Create().WithKey(b3).WithPannelAttrs([bv.Style("position","absolute"),bv.Style("Background","#2a2a2a")]).WithTitle(this.PanelTitleVisibility).WithTitleContent(bq.TextNode(b0)).WithTitleButtons($.ofArray([bC.New("add",function(b8){var b9,b_;b9=$.ofSeq(b2.Factory.WidgetItems);b_=bk.Create$1($.head(b9));b2.Dialog.ShowDialog("Select widget",bq.Element("div",[],[bq.Select([bv.Class("form-control")],function(b$){return b$.Worker.Name.c;},b9,b_)]),function(){var b$;by.log("Dialog.IsOK");b$=b_.c.Worker.get_Clone();b$.StartRunner();b2.RegisterWidget(_9.UniqueKey(),bZ,b8.Key,b8.Children,b$);});}),bC.New("edit",function(b8){by.log("Edit");b2.PropertyGrid.Edit($.concat($.map(function(b9){return b9.Widget.get_Properties();},$.filter(function(b9){return b9.Panel===b8.Key;},$.ofSeq(bZ.WidgetItems)))));}),bC.New("clear",function(b8){bZ.PanelContainer.PanelItems.Remove(bZ.PanelContainer.FindPanelItem(b8));bZ.WidgetItems.RemoveBy(function(b9){return b9.Panel===b8.Key;});})])).WithChildPanelContainer(b6);bZ.PanelContainer.AddPanel(b7);return b7;},RegisterWidget:function(bZ,b0,b1,b2,b3){var b4;this.Data.RegisterWidget(bZ,b0,b1,b3);b4=bB.get_Create().WithPanelContent(b3.get_Render());bk.Set(b4.IsWithTitle,false);b2.AddPanel(b4);}},null,L);L.Create=function(bZ){var b0,b1,b2,b3,b4,b5;function b6(){return K.PanelGroupCreator(b1,bZ,void 0);}function b7(){return K.EventsGroupCreator(b1,b2,void 0);}function b8(){return K.RulesGroupCreator(b1,void 0);}b0=bD.get_Create();b1=I.get_Create();b2=bE.get_Create();b3=D.get_Create();b4=D.get_Create().WithGroupOnClick(function(b9){b2.Edit($.mapi(function(b_,b$){var ca;return bm.string((ca=b_+1,a.String(ca)),b$.WebSharper_Community_Dashboard_ISelectorItem$get_Name());},$.ofSeq(b9.SelectorItems)));}).WithItemOnSelected(function(){b2.Edit($.T.Empty);}).WithItemOnCreated(function(b9){return function(b_){return b9===0?$.head($.ofSeq(b3.SelectorGroups)).SelectorItems.Append(b_):null;};}).WithItemOnDeleted(function(){return function(){return null;};}).WithItemOnDeleted(function(b9){return function(b_){b_ instanceof G?b1.WidgetGroups.Remove(b_):b_ instanceof F?b1.EventGroups.Remove(b_):b_ instanceof H?b1.RulesGroups.Remove(b_):_7.FailWith("WithItemOnDeleted, type unknown");return b9===0?$.head($.ofSeq(b3.SelectorGroups)).SelectorItems.Remove(b_):null;};}).WithItemOnMove(_6.Curried3(function(b9,b_,b$){var ca;ca=b$.$==1&&true;return b_ instanceof G?(_9.MoveItemInModelList(b1.WidgetGroups,ca,b_),_9.MoveItemInModelList($.head($.ofSeq(b3.SelectorGroups)).SelectorItems,ca,b_)):b_ instanceof F?_9.MoveItemInModelList(b1.EventGroups,ca,b_):b_ instanceof H?_9.MoveItemInModelList(b1.RulesGroups,ca,b_):_7.FailWith("WithItemOnDeleted, type unknown");})).WithControls(true);b5=b6();b4.AppenGroup("Panels",$.ofArray([b5]),{$:1,$0:b6});b3.AppenGroup("Panels",$.ofArray([b5]),null);b4.AppenGroup("Events",$.ofArray([b7()]),{$:1,$0:b7});b4.AppenGroup("Rules",$.ofArray([b8()]),{$:1,$0:b8});bk.Set(b4.OptSelectedItem,{$:1,$0:$.head($.ofSeq(b4.GroupByIndex(0).SelectorItems))});bk.Set(b3.OptSelectedItem,{$:1,$0:$.head($.ofSeq(b3.GroupByIndex(0).SelectorItems))});return L.New(z.get_Create(),b1,b2,b0,b3,b4,bk.Create$1({$:0}),bk.Create$1(false));};L.New=function(bZ,b0,b1,b2,b3,b4,b5,b6){return new L({Factory:bZ,Data:b0,PropertyGrid:b1,Dialog:b2,EditorSelectorRun:b3,EditorSelectorEdit:b4,Mode:b5,PanelTitleVisibility:b6});};N=M.RandomEvent=_6.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bZ){var b0;new bF.New();ba.Start((b0=null,ba.Delay(function(){return ba.While(function(){return true;},ba.Delay(function(){return ba.Bind(ba.Sleep(bZ.InPorts.get_Item(2).get_Number()*1000>>0),function(){var b1,b2,b3;b1=bZ.InPorts.get_Item(0).get_Number();b2=bZ.InPorts.get_Item(1).get_Number();b3=bG.random()*b2+b1;bZ.OutPorts.get_Item(0).Trigger(new i({$:0,$0:b3}));return ba.Zero();});}));})),null);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.RandomEventData;}},null,N);N.get_FromWorker=function(){return function(bZ){return N.New(bZ.get_ToData());};};N.get_Create=function(){return N.New(s.Create("Random",$.ofArray([p.CreateNumber("Middle value",100),p.CreateNumber("Dispersion",10),p.CreateNumber("Delay sec.",2)]),$.ofArray([r.Create("Random value")])));};N.New=function(bZ){return new N({RandomEventData:bZ});};O.New=function(bZ){return{DatabaseEventRun:bZ};};P=M.DatabaseEvent=_6.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bZ){var b0,b1;b0=true;b1=bZ.InPorts.get_Item(0).PortValue.c.Time;bj.Sink(function(b2){var b3;b3=bZ.InPorts.get_Item(1).get_String();b0?($.iter(function(b4){var b5;b5=h.Agent();b5.mailbox.AddLast({$:0,$0:b4});b5.resume();},(new bc.New()).Sync("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.Events.ServerDatabase.ReadAllMessages:965639103",[b3])),b0=false):b2.Time>b1?(new bc.New()).Send("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.Events.ServerDatabase.WriteMessage:-353093100",[b3,b2]):void 0;},bZ.InPorts.get_Item(0).PortValue.v);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.DatabaseEventData;}},null,P);P.get_FromWorker=function(){return function(bZ){return P.New(bZ.get_ToData());};};P.get_Create=function(){return P.New(s.Create("Database",$.ofArray([p.CreateNumber(" in Value",100),p.CreateString("Database name","Database.txt")]),$.T.Empty));};P.New=function(bZ){return new P({DatabaseEventData:bZ});};R.New=function(bZ,b0,b1,b2,b3){return{Title:bZ,Description:b0,ImageUrl:b1,Temperature:b2,TemparatureMinMax:b3};};Q.get=function(bZ,b0){var b1;b1=null;return ba.Delay(function(){var b2;b2=(((_6.Curried3(function(b3,b4,b5){return b3("http://api.openweathermap.org/data/2.5/weather?q="+bd.toSafe(b4)+"&units=metric&appid="+bd.toSafe(b5));}))(a.id))(b0))(bZ);(e.Log())("get key city "+b2);return ba.TryWith(ba.Delay(function(){return ba.Bind(bI.AsyncMap(bM.asyncReadTextAtRuntime(false,"C:\\Users\\jaipr\\Source\\Repos\\WebSharper.Community.Dashboard\\WebSharper.Community.Dashboard","","JSON","",b2),function(b3){return bu.Equals(typeof b3,"string")?bN.parse(b3):b3;}),function(b3){var b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co;(e.Log())("get key city 2");return ba.Return((b4=bO.tryHead(b3.weather),b4==null?null:{$:1,$0:(b5=b4.$0,R.New((((_6.Curried3(function(cp,cq,cr){return cp(bd.toSafe(cq)+", "+bd.toSafe(cr));}))(a.id))((b7=(b6="name",b6 in b3?{$:1,$0:b3[b6]}:null),b7==null?null:b7.$0)))((b_=(b8=b3.sys,(b9="country",b9 in b8?{$:1,$0:b8[b9]}:null)),b_==null?null:b_.$0)),(ca=(b$="main",b$ in b5?{$:1,$0:b5[b$]}:null),ca==null?null:ca.$0),(function(cp){return function(cq){return cp("http://openweathermap.org/img/w/"+bd.toSafe(cq)+".png");};}(a.id))((cc=(cb="icon",cb in b5?{$:1,$0:b5[cb]}:null),cc==null?null:cc.$0)),(cd=(ce=b3.main,(cf="temp",cf in ce?{$:1,$0:ce[cf]}:null)),(cg=cd==null?null:{$:1,$0:1*cd.$0},cg==null?null:cg.$0)),[(ch=(ci=b3.main,(cj="temp_min",cj in ci?{$:1,$0:ci[cj]}:null)),(ck=ch==null?null:{$:1,$0:1*ch.$0},ck==null?null:ck.$0)),(cl=(cm=b3.main,(cn="temp_max",cn in cm?{$:1,$0:cm[cn]}:null)),(co=cl==null?null:{$:1,$0:1*cl.$0},co==null?null:co.$0))]))}));});}),function(b3){(e.Log())(b3.message);return ba.Return(null);});});};S=M.OpenWeatherEvent=_6.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bZ){var b0;ba.Start((b0=null,ba.Delay(function(){return ba.While(function(){return true;},ba.Delay(function(){var b1,b2,b3;b1=bZ.InPorts.get_Item(0);b2=bZ.InPorts.get_Item(1);b3=bZ.OutPorts.get_Item(0);return ba.Bind(Q.get(b2.get_String(),b1.get_String()),function(b4){return ba.Combine(b4==null?ba.Zero():((e.Log())("Value generated:"+b4.$0.Title),b3.Trigger(new i({$:0,$0:+b4.$0.Temperature})),ba.Zero()),ba.Delay(function(){return ba.Bind(ba.Sleep(1000*15),function(){return ba.Return(null);});}));});}));})),null);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.OpenWeatherEventData;}},null,S);S.get_FromWorker=function(){return function(bZ){return S.New(bZ.get_ToData());};};S.Create=function(bZ,b0){return S.New(s.Create("OpenWeatherMap",$.ofArray([p.CreateString("City",bZ),p.CreateString("ApiKey",b0)]),$.ofArray([r.Create("Temperature")])));};S.New=function(bZ){return new S({OpenWeatherEventData:bZ});};T=M.ClockEvent=_6.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bZ){var b0;ba.Start((b0=null,ba.Delay(function(){return ba.While(function(){return true;},ba.Delay(function(){var b1,b2,b3;b1=(bZ.InPorts.get_Item(0).PortValue.c.Value.get_AsSelect())[0];b2=_.now();b3=b1===0?bP.LongTime(b2):b1===1?bP.ShortTime(b2):b1===2?bP.LongDate(b2):b1===3?(new _(b2)).toLocaleDateString():"";bZ.OutPorts.get_Item(0).Trigger(new i({$:1,$0:b3}));return ba.Bind(ba.Sleep(bZ.InPorts.get_Item(1).get_Number()*1000>>0),function(){return ba.Return(null);});}));})),null);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.ClockEventData;}},null,T);T.get_FromWorker=function(){return function(bZ){return T.New(bZ.get_ToData());};};T.get_Create=function(){return T.New(s.Create("Clock",$.ofArray([p.CreateSelect("Format",[0,$.ofArray(["long time","short time","long date","short date"])]),p.CreateNumber("Delay sec.",1)]),$.ofArray([r.Create("Date Time")])));};T.New=function(bZ){return new T({ClockEventData:bZ});};V=U.TextBoxWidget=_6.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bZ){var b0,b1,b2,b3;b0=bj.Map(function(b4){var b5,b6;b5=b4.Value;return b5.$==0?(b6=b5.$0>>0,a.String(b6)):b5.$==1?b5.$0:b5.$==2?a.String(b5.$0):"Wrong port value format";},bZ.InPorts.get_Item(0).PortValue.v);b1=bj.Map(function(b4){var b5;return(b5=b4.Value.get_AsNumber(),a.String(b5))+"px";},bZ.InPorts.get_Item(1).PortValue.v);b2=bj.Map(function(b4){var b5;return(b5=b4.Value.get_AsNumber(),a.String(b5))+"px";},bZ.InPorts.get_Item(2).PortValue.v);b3=bj.Map(function(b4){var b5;b5=b4.Value.get_AsSelect();return b5[1].get_Item(b5[0]);},bZ.InPorts.get_Item(3).PortValue.v);return bq.Element("div",[bv.Class("bigvalue"),bv.DynamicStyle("width",b1),bv.DynamicStyle("font-size",b2),bv.DynamicStyle("font-family",b3)],[bq.TextView(b0)]);}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.TextBoxWidgetData;}},null,V);V.get_FromWorker=function(){return function(bZ){return V.New(bZ.get_ToData());};};V.get_Create=function(){return V.New(s.Create("Text",$.ofArray([p.CreateString("in Text","txt"),p.CreateNumber("Width",200),p.CreateNumber("Font-Size",100),p.CreateSelect("Font-Family",[0,$.ofArray(["Times New Roman","Courier New","Arial","Freestyle Script"])])]),$.T.Empty));};V.New=function(bZ){return new V({TextBoxWidgetData:bZ});};W.New=function(bZ,b0){return{LineChart:bZ,Sources:b0};};X=U.ChartWidget=_6.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bZ){var b0,b1,b2,b3,b4,b5,b6,b7,b8;(e.Log())("Chart Render");b0=bZ.InPorts.get_Item(3).get_Number()>>0;b1=bZ.RunnerContext.c.$0;b2=(b3={},b3.title=(b4={},b4.display=false,b4),b3.legend=(b5={},b5.display=false,b5),b3.elements=(b6={},b6.point=(b7={},b7.radius=0,b7),b6.line=(b8={},b8.borderWidth=1,b8),b6),b3);return bS.Render$2(b1.LineChart,{$:1,$0:{$:0,$0:bZ.InPorts.get_Item(1).get_Number()>>0,$1:bZ.InPorts.get_Item(2).get_Number()>>0}},{$:1,$0:b2},{$:1,$0:b0});}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){var bZ;bZ=this;return{$:1,$0:function(b0){var b1,b2,b3,b4;function b5(b6,b7){var b8,b9,b_;b8=(b0.InPorts.get_Item(4).PortValue.c.Value.get_AsSelect())[0];b9=(b_=b7.Time,b8===0?bP.LongTime(b_):b8===1?bP.ShortTime(b_):b8===2?bP.LongDate(b_):b8===3?(new _(b_)).toLocaleDateString():"");(e.Log())("Chart observe "+b9);return b1.get_Item(bg.findIndex(function(b$){return bu.Equals(b$,b6);},b3)).event.Trigger([b9,b7.Value.get_AsNumber()]);}(e.Log())("Chart run");b0.InPorts.get_Item(3).get_Number();b1=$.init((bZ.ChartWidgetData.InPorts.get_Item(5).Value.Value.get_AsNumber()>>0)+1,function(){return new bT.New();});b2=($.splitAt(6,b0.InPorts))[1];b3=new $.T({$:1,$0:b0.InPorts.get_Item(0),$1:b2});b4=bU.Combine($.ofSeq(bg.delay(function(){return bg.map(function(b6){return bV.Line$1(b6.event).WithFill(false).__WithStrokeColor(new bW.Color({$:1,$0:"#FB8C00"})).__WithPointColor(new bW.Color({$:2,$0:"black"}));},b1);})));$.iter(function(b6){bj.Sink(function(b7){return b5(b6,b7);},b6.PortValue.v);},b3);return{$:1,$0:W.New(b4,b1)};}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){var bZ,b0,b1,b2,b3,b4;bZ=this;b0=this.ChartWidgetData.InPorts.get_Item(3).Value.Value.get_AsNumber()>>0;b1=(this.ChartWidgetData.InPorts.get_Item(5).Value.Value.get_AsNumber()>>0)+6;b2=b1<this.ChartWidgetData.InPorts.get_Length()?($.splitAt(b1,this.ChartWidgetData.InPorts))[0]:b1>this.ChartWidgetData.InPorts.get_Length()?(b3=this.ChartWidgetData.InPorts.get_Length()-6+1,$.append(this.ChartWidgetData.InPorts,$.ofSeq(bg.delay(function(){return bg.map(function(b5){var b6;return p.CreateNumber(" in Value "+(b6=b3+b5,a.String(b6)),0).WithCacheSize(b0);},_7.range(0,b1-bZ.ChartWidgetData.InPorts.get_Length()-1));})))):this.ChartWidgetData.InPorts;b4=this.ChartWidgetData;return s.New(b4.WorkerName,$.mapi(function(b5,b6){return b5===0||b5>5?b6.WithCacheSize(b0):b6;},b2),b4.OutPorts);}},null,X);X.get_FromWorker=function(){return function(bZ){return X.New(bZ.get_ToData());};};X.get_Create=function(){var bZ;bZ=20;return X.New(s.Create("Chart",$.ofArray([p.CreateNumber(" in Value",100).WithCacheSize(bZ),p.CreateNumber("cx",300),p.CreateNumber("cy",150),p.CreateNumber("BufferSize",bZ),p.CreateSelect("X-Axis",[0,$.ofArray(["long time","short time","long date","short date"])]),p.CreateNumber("Number of additional ports",0)]),$.T.Empty));};X.New=function(bZ){return new X({ChartWidgetData:bZ});};Y=U.ButtonWidget=_6.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bZ){return bq.ButtonView(bZ.InPorts.get_Item(0).get_String(),[],bZ.InPorts.get_Item(1).get_BooleanView(),function(b0){bZ.OutPorts.get_Item(0).Trigger(new i({$:2,$0:b0}));});}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.ButtonWidgetData;}},null,Y);Y.get_FromWorker=function(){return function(bZ){return Y.New(bZ.get_ToData());};};Y.get_Create=function(){return Y.New(s.Create("Button",$.ofArray([p.CreateString("Caption","Button"),p.CreateNumber("State",0)]),$.ofArray([r.Create("Button value")])));};Y.New=function(bZ){return new Y({ButtonWidgetData:bZ});};Z=U.GaugeWidget=_6.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bZ){var b0,b1,b2,b3;function b4(b8){var b9,b_,b$,ca,cb;b9=b8*3.14159265358979/180;return[(b_=100+(b$=a.Number(b0),a.isNaN(b$)?new bX.New("Input string was not in a correct format."):b$)*bG.cos(b9),a.String(b_)),(ca=100-(cb=a.Number(b0),a.isNaN(cb)?new bX.New("Input string was not in a correct format."):cb)*bG.sin(b9),a.String(ca))];}function b5(b8){var b9;b9=b4(b8);return b1+b9[0]+","+b9[1];}function b6(b8){return b8===90?"yellow":b8>90?"red":b8<90&&b8>0?"orange":"whitesmoke";}function b7(b8){var b9,b_;b9=bZ.InPorts.get_Item(1).PortValue.c.Value.get_AsNumber();b_=bZ.InPorts.get_Item(2).PortValue.c.Value.get_AsNumber();return b8>=b_?180:b8<=b9?0:180*(b8/(b_+b9));}b0="80";b1=(b2=b4(180),"M"+b2[0]+","+b2[1]+"A"+b0+","+b0+","+"0, 0 , 1,");b3=bj.Map(function(b8){return b6(b7(b8.Value.get_AsNumber()));},bZ.InPorts.get_Item(0).PortValue.v);return bq.EmbedView(bj.Map(function(b8){var b9,b_,b$;return bq.SvgElement("svg",$.T.Empty,$.ofArray([bq.SvgElement("path",$.ofArray([bY.Create("d",b5(0)),bv.Style("stroke","whitesmoke"),bv.Style("stroke-width","30"),bv.Style("fill","none")]),$.T.Empty),bq.SvgElement("path",$.ofArray([bY.Create("d",b5(180-b7(b8.Value.get_AsNumber()))),bv.DynamicStyle("stroke",b3),bv.Style("stroke-width","30"),bv.Style("fill","none")]),$.T.Empty),bq.SvgElement("text",$.ofArray([bY.Create("x","20"),bY.Create("y","120"),bY.Create("text-anchor","middle"),bv.Style("Stroke","Whitesmoke")]),$.ofArray([bq.TextNode((b9=bZ.InPorts.get_Item(1).PortValue.c.Value.get_AsNumber(),a.String(b9)))])),bq.SvgElement("text",$.ofArray([bY.Create("x","180"),bY.Create("y","120"),bY.Create("text-anchor","middle"),bv.Style("Stroke","Whitesmoke")]),$.ofArray([bq.TextNode((b_=bZ.InPorts.get_Item(2).PortValue.c.Value.get_AsNumber(),a.String(b_)))])),bq.SvgElement("text",$.ofArray([bY.Create("x","100"),bY.Create("y","80"),bY.Create("text-anchor","middle"),bv.Style("Stroke","Whitesmoke"),bv.Style("font-size","x-large")]),$.ofArray([bq.TextNode((b$=_7.Truncate(bZ.InPorts.get_Item(0).PortValue.c.Value.get_AsNumber()),a.String(b$)))]))]));},bZ.InPorts.get_Item(0).PortValue.v));}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.GaugeWidgetData;}},null,Z);Z.get_FromWorker=function(){return function(bZ){return Z.New(bZ.get_ToData());};};Z.get_Create=function(){return Z.New(s.Create("Gauge",$.ofArray([p.CreateNumber("Angle",0),p.CreateNumber("Min Temp",0),p.CreateNumber("Max Temp",100)]),$.T.Empty));};Z.New=function(bZ){return new Z({GaugeWidgetData:bZ});};_0.FromWorker=function(bZ){var b0;b0=bZ.Data;return b0 instanceof N?{$:1,$0:{$:0,$0:(N.get_FromWorker())(bZ)}}:b0 instanceof T?{$:1,$0:{$:1,$0:(T.get_FromWorker())(bZ)}}:b0 instanceof S?{$:1,$0:{$:2,$0:(S.get_FromWorker())(bZ)}}:b0 instanceof P?{$:1,$0:{$:3,$0:(P.get_FromWorker())(bZ)}}:b0 instanceof V?{$:1,$0:{$:4,$0:(V.get_FromWorker())(bZ)}}:b0 instanceof X?{$:1,$0:{$:5,$0:(X.get_FromWorker())(bZ)}}:b0 instanceof Y?{$:1,$0:{$:6,$0:(Y.get_FromWorker())(bZ)}}:b0 instanceof Z?{$:1,$0:{$:7,$0:(Z.get_FromWorker())(bZ)}}:null;};_0.ToWorker=function(bZ){return bZ.$==1?t.Create(bZ.$0):bZ.$==2?t.Create(bZ.$0):bZ.$==3?t.Create(bZ.$0):bZ.$==4?t.Create(bZ.$0):bZ.$==5?t.Create(bZ.$0):bZ.$==6?t.Create(bZ.$0):bZ.$==7?t.Create(bZ.$0):t.Create(bZ.$0);};_1.CreateDashboard=function(){_2.$cctor();return _2.CreateDashboard;};_1.PanelContainerCreator=function(bZ){return bz.get_Create().WithLayoutManager(bA.FloatingPanelLayoutManager(5)).WithWidth(2800).WithHeight(2420).WithAttributes([]);};_1.RegisterAppModelLib=function(bZ){function b0(b2){_1.RegisterEventGeneral(bZ,b2);}function b1(b2){_1.RegisterWidgetGeneral(bZ,b2);}b0(S.Create("London",""));b0(N.get_Create());b0(T.get_Create());b0(P.get_Create());b1(V.get_Create());b1(X.get_Create());b1(Y.get_Create());b1(Z.get_Create());return bZ;};_1.RegisterWidgetGeneral=function(bZ,b0){var b1;_1.Register((b1=bZ.Factory,function(b2){b1.RegisterWidget(b2);}),b0);};_1.RegisterEventGeneral=function(bZ,b0){var b1;_1.Register((b1=bZ.Factory,function(b2){b1.RegisterEvent(b2);}),b0);};_1.Register=function(bZ,b0){return bZ(t.Create(b0));};_2.$cctor=function(){_2.$cctor=a.ignore;_2.CreateDashboard=_1.RegisterAppModelLib(L.Create(function(){return _1.PanelContainerCreator();}));};_3.RecreatWidgetsOnServer=function(bZ,b0){function b1(b3,b4,b5){return b5;}function b2(b3,b4,b5){return b5;}return $.map(function(b3){return b1(b3[0],b3[1],b3[2]);},$.concat($.map(function(b3){return b2(b3[0],b3[1],b3[2]);},_3.RecreateWidgets(bZ,b0))));};_3.RecreateEventsOnServer=function(bZ,b0){function b1(b3,b4){return b4;}function b2(b3,b4){return b4;}return $.map(function(b3){return b1(b3[0],b3[1]);},$.concat($.map(function(b3){return b2(b3[0],b3[1]);},_3.RecreateEvents(bZ,b0))));};_3.RecreateOnClient=function(bZ,b0,b1,b2,b3,b4,b5){var b6;e.set_Role(f.Client);b6=h.Agent();b6.mailbox.AddLast({$:3,$0:function(b7){(new bc.New()).Send("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.MessageBus.SendToServer:-1358505674",[b7]);}});b6.resume();$.iter(bZ,(b0.Restore(b1,_3.RecreateEvents(b2,b3),_3.RecreateWidgets(b2,b4),b5))[0]);};_3.RecreateWidgets=function(bZ,b0){function b1(b2,b3,b4){function b5(b6,b7,b8){return[b6,b7,bZ(b8)];}return[b2,b3,$.map(function(b6){return b5(b6[0],b6[1],b6[2]);},b4)];}return $.map(function(b2){return b1(b2[0],b2[1],b2[2]);},b0);};_3.RecreateEvents=function(bZ,b0){function b1(b2,b3){function b4(b5,b6){return[b5,bZ(b6)];}return[b2,$.map(function(b5){return b4(b5[0],b5[1]);},b3)];}return $.map(function(b2){return b1(b2[0],b2[1]);},b0);};_4=d.AppData=_6.Class({RecreateOnServer:function(bZ,b0){var b1,b2,b3;function b4(b5,b6){b6.Reconnect(b1);}b1=$.append(_3.RecreateEventsOnServer(b0,this.Events),_3.RecreatWidgetsOnServer(b0,this.Widgets));$.iter(function(b5){return b4(b5[0],b5[1]);},this.Rules);$.iter(function(b5){b5.StartRunner();},b1);b2={$:0,$0:h.CreateMessage(new i({$:4,$0:{$:0,$0:bZ}})).WithKey("system")};b3=h.Agent();b3.mailbox.AddLast(b2);b3.resume();return b1;},RecreateOnClientEventsRunning:function(bZ,b0,b1){_3.RecreateOnClient(function(b2){b2.StartRunner();},bZ,b0,b1,this.Events,this.Widgets,this.Rules);},RecreateOnClientEventsNotRunning:function(bZ,b0,b1){_3.RecreateOnClient(a.ignore,bZ,b0,b1,this.Events,this.Widgets,this.Rules);}},null,_4);_4.Create=function(bZ,b0){var b1;b1=bZ.Store(b0);return _4.New(b1[0],b1[1],b1[2]);};_4.empty=function(){return _4.New($.T.Empty,$.T.Empty,$.T.Empty);};_4.New=function(bZ,b0,b1){return new _4({Events:bZ,Widgets:b0,Rules:b1});};}());
