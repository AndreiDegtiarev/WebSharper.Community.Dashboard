(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Community=b.Community||{};d=c.Dashboard=c.Dashboard||{};e=d.Environment=d.Environment||{};f=e.Role=e.Role||{};g=a.StartupCode$WebSharper_Community_Dashboard$Environment=a.StartupCode$WebSharper_Community_Dashboard$Environment||{};h=d.MessageBus=d.MessageBus||{};i=h.Value=h.Value||{};j=h.Message=h.Message||{};k=h.ListenerInfo=h.ListenerInfo||{};l=h.AgentMessage=h.AgentMessage||{};m=h.AgentState=h.AgentState||{};n=a.StartupCode$WebSharper_Community_Dashboard$MessageBus=a.StartupCode$WebSharper_Community_Dashboard$MessageBus||{};o=d.InPortData=d.InPortData||{};p=d.InPort=d.InPort||{};q=d.OutPort=d.OutPort||{};r=d.WorkerData=d.WorkerData||{};s=d.Worker=d.Worker||{};t=d.Workers=d.Workers||{};u=d.RandomRunner=d.RandomRunner||{};v=d.OpenWeather=d.OpenWeather||{};w=v.Forecast=v.Forecast||{};x=d.OpenWeatherRunner=d.OpenWeatherRunner||{};y=d.DatabaseRunnerContext=d.DatabaseRunnerContext||{};z=d.DatabaseRunner=d.DatabaseRunner||{};A=d.ChartRunnerContext=d.ChartRunnerContext||{};B=d.ChartRenderer=d.ChartRenderer||{};C=d.TextBoxRenderer=d.TextBoxRenderer||{};D=d.ButtonRenderer=d.ButtonRenderer||{};E=d.RuleEntry=d.RuleEntry||{};F=d.RuleChain=d.RuleChain||{};G=d.RuleContainer=d.RuleContainer||{};H=d.WorkerItem=d.WorkerItem||{};I=d.Factory=d.Factory||{};J=d.RulesCellItem=d.RulesCellItem||{};K=d.RulesRowItem=d.RulesRowItem||{};L=d.SelectorGroup=d.SelectorGroup||{};M=d.WindowSelector=d.WindowSelector||{};N=d.WidgetItem=d.WidgetItem||{};O=d.EventsGroupItem=d.EventsGroupItem||{};P=d.WidgetsGroupItem=d.WidgetsGroupItem||{};Q=d.RulesGroupItem=d.RulesGroupItem||{};R=d.DshData=d.DshData||{};S=d.RulesEditor=d.RulesEditor||{};T=d.DshHelper=d.DshHelper||{};U=d.Dashboard=d.Dashboard||{};V=d.AppModelLib=d.AppModelLib||{};W=d.App=d.App||{};X=a.StartupCode$WebSharper_Community_Dashboard$AppModelLib=a.StartupCode$WebSharper_Community_Dashboard$AppModelLib||{};Y=d.AppDataHelper=d.AppDataHelper||{};Z=d.AppData=d.AppData||{};_0=a.IntelliFactory;_1=_0&&_0.Runtime;_2=b&&b.Operators;_3=c&&c.Panel;_4=_3&&_3.Helper;_5=a.Date;_6=b&&b.List;_7=b&&b.Concurrency;_8=b&&b.Remoting;_9=_8&&_8.AjaxRemotingProvider;_=b&&b.Control;$=_&&_.MailboxProcessor;ba=b&&b.Seq;bb=b&&b.Utils;bc=b&&b.UI;bd=bc&&bc.Next;be=bd&&bd.View;bf=bd&&bd.Var;bg=c&&c.PropertyGrid;bh=bg&&bg.Properties;bi=b&&b.Guid;bj=b&&b.Unchecked;bk=bd&&bd.Doc;bl=b&&b.Random;bm=a.Math;bn=a.console;bo=b&&b.Data;bp=bo&&bo.TxtRuntime;bq=a.FSharp;br=bq&&bq.Data;bs=br&&br.Runtime;bt=bs&&bs.IO;bu=a.JSON;bv=b&&b.Arrays;bw=b&&b.Charting;bx=bw&&bw.Renderers;by=bx&&bx.ChartJs;bz=bw&&bw.Chart;bA=bw&&bw.Pervasives;bB=bd&&bd.AttrModule;bC=b&&b.Enumerator;bD=bd&&bd.Key;bE=bd&&bd.ListModel;bF=b&&b.Option;bG=_3&&_3.WrapControls;bH=_3&&_3.PanelContainer;bI=_3&&_3.LayoutManagers;bJ=_3&&_3.Panel;bK=_3&&_3.TitleButton;bL=_3&&_3.Dialog;bM=bg&&bg.PropertyGrid;f.Server={$:1};f.Client={$:0};e.DataDirectory=function(){g.$cctor();return g.DataDirectory;};e.set_DataDirectory=function(bN){g.$cctor();g.DataDirectory=bN;};e.Log=function(){g.$cctor();return g.Log;};e.set_Log=function(bN){g.$cctor();g.Log=bN;};e.Role$1=function(){g.$cctor();return g.Role;};e.set_Role=function(bN){g.$cctor();g.Role=bN;};g.$cctor=_1.Cctor(function(){g.Role=f.Server;g.Log=a.ignore;g.DataDirectory="";g.$cctor=a.ignore;});i=h.Value=_1.Class({get_AsBoolean:function(){return this.$==2?this.$0:_2.FailWith("MessageBus.Value: unexpected type");},get_AsString:function(){return this.$==1?this.$0:_2.FailWith("MessageBus.Value: unexpected type");},get_AsNumber:function(){return this.$==0?this.$0:_2.FailWith("MessageBus.Value: unexpected type");}},null,i);j=h.Message=_1.Class({WithTime:function(bN){return j.New(this.Key,bN,this.Value);},WithKey:function(bN){return j.New(bN,this.Time,this.Value);}},null,j);j.Create=function(bN){return j.New(_4.UniqueKey(),_5.now(),bN);};j.New=function(bN,bO,bP){return new j({Key:bN,Time:bO,Value:bP});};k.Create=function(bN,bO,bP){return k.New(bN,bO,bP);};k.New=function(bN,bO,bP){return{Key:bN,Name:bO,CacheSize:bP};};l.Clear={$:4};m.get_empty=function(){return m.New(null,_6.T.Empty);};m.New=function(bN,bO){return{ServerCallback:bN,Listeners:bO};};h.RunServerRequests=function(){var bN;_7.Start((bN=null,_7.Delay(function(){return _7.While(function(){return true;},_7.Delay(function(){return _7.Bind(_7.Sleep(2*1000),function(){return _7.Bind(h.Agent().PostAndAsyncReply(function(bO){return{$:6,$0:bO};},null),function(bO){return _7.Bind((new _9.New()).Async("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.MessageBus.GetMessages:1550733476",[bO]),function(bP){var bQ;_6.iter(function(bR){var bS;bS=h.Agent();bS.mailbox.AddLast({$:1,$0:bR});bS.resume();},bP);return bP.get_Length()>0?(bQ=(function(bR){return function(bS){return bR("Values from server requested messages received:"+a.String(bS));};}(a.id))(bP.get_Length()),(h.log())(bQ),_7.Zero()):_7.Zero();});});});}));})),null);};h.Agent=function(){n.$cctor();return n.Agent;};h.StringMessage=function(bN){return h.StringKeyMessage(_4.UniqueKey(),bN);};h.NumberMessage=function(bN){return h.NumberKeyMessage(_4.UniqueKey(),bN);};h.BooleanKeyMesage=function(bN,bO){return h.CreateMessage(bN,new i({$:2,$0:bO}));};h.StringKeyMessage=function(bN,bO){return h.CreateMessage(bN,new i({$:1,$0:bO}));};h.NumberKeyMessage=function(bN,bO){return h.CreateMessage(bN,new i({$:0,$0:bO}));};h.CreateMessage=function(bN,bO){return j.New(bN,_5.now(),bO);};h.log=function(){n.$cctor();return n.log;};n.$cctor=_1.Cctor(function(){n.log=e.Log();n.Agent=$.Start(function(bN){function bO(bT,bU){return ba.fold(function(bV,bW){var bX;return(bX=bW.Time-bT,bX/1000)>0.01?new _6.T({$:1,$0:bW,$1:bV}):bV;},_6.T.Empty,bU);}function bP(bT,bU){return bT<bU.get_Length()?(_6.splitAt(bT,bU))[0]:bU;}function bQ(bT,bU,bV){return bT===1?_6.ofArray([bV]):bP(bT,new _6.T({$:1,$0:bV,$1:bU}));}function bR(bT,bU){function bV(bW,bX,bY){var bZ;bZ=a.Array.prototype.slice.call(arguments);return bW.Key===bT.Key?(bX(bT),[bW,bX,bQ(bW.CacheSize,bY,bT)]):bZ;}return _6.map(function(bW){return bV(bW[0],bW[1],bW[2]);},bU);}function bS(bT){var bU;bU=null;return _7.Delay(function(){return _7.Bind(bN.Receive(null),function(bV){var bW,bX,bY,bZ,b0,b1,b2;function b3(b5,b6,b7){return bO(bY,b7);}function b4(b5,b6,b7){return b7.$==0?(new _5(0,0-1,0)).getTime():_6.maxBy(function(b8){return b8.Time;},b7).Time;}return bV.$==2?(bW=bV.$0[0],(bX=(((_1.Curried3(function(b5,b6,b7){return b5("RegisterListener:"+bb.toSafe(b6)+" "+bb.toSafe(b7));}))(a.id))(bW.Name))(bW.Key),(h.log())(bX),bS(m.New(bT.ServerCallback,new _6.T({$:1,$0:[bW,bV.$0[2],_6.T.Empty],$1:bT.Listeners}))))):bV.$==3?bS(m.New({$:1,$0:bV.$0},bT.Listeners)):bV.$==5?(bY=bV.$0[0],(bV.$0[1](ba.fold(function(b5,b6){return!_6.contains(b6,b5)?new _6.T({$:1,$0:b6,$1:b5}):b5;},_6.T.Empty,_6.concat(_6.map(function(b5){return b3(b5[0],b5[1],b5[2]);},bT.Listeners)))),bS(bT))):bV.$==6?(bZ=_6.map(function(b5){return b4(b5[0],b5[1],b5[2]);},bT.Listeners),(bV.$0(bZ.$==0?(new _5(0,0-1,0)).getTime():_6.max(bZ)),bS(bT))):bV.$==1?bS(m.New(bT.ServerCallback,bR(bV.$0,bT.Listeners))):bV.$==0?(b0=bV.$0,(b1=(((_1.Curried3(function(b5,b6,b7){return b5("Num listeners:"+a.String(b6)+" msg:"+bb.toSafe(b7));}))(a.id))(bT.Listeners.get_Length()))(b0.Key),(h.log())(b1),(b2=bT.ServerCallback,b2==null?void 0:b2.$0(b0)),bS(m.New(bT.ServerCallback,bR(b0,bT.Listeners))))):bS(m.get_empty());});});}return bS(m.get_empty());},null);n.$cctor=a.ignore;});o.Create=function(bN,bO,bP){return o.New(bO.Key,bN,bO,bP);};o.New=function(bN,bO,bP,bQ){return{Key:bN,Name:bO,Value:bP,CacheSize:bQ};};p=d.InPort=_1.Class({Equals:function(bN){return bN instanceof p&&this.Data.Name===bN.Data.Name;},get_BooleanView:function(){return be.Map(function(bN){return bN.Value.get_AsBoolean();},this.PortValue.v);},get_Boolean:function(){return this.PortValue.c.Value.get_AsBoolean();},get_StringView:function(){return be.Map(function(bN){return bN.Value.get_AsString();},this.PortValue.v);},get_String:function(){return this.PortValue.c.Value.get_AsString();},get_NumberView:function(){return be.Map(function(bN){return bN.Value.get_AsNumber();},this.PortValue.v);},get_Number:function(){return this.PortValue.c.Value.get_AsNumber();},Receive:function(bN){bf.Set(this.PortValue,bN);},get_Property:function(){var bN,bO,bP,bQ,bR;bN=this;bO=this.PortValue.c.Value;return bO.$==1?(bP=bf.Create$1(this.get_String()),(be.Sink(function(bS){var bT;bf.Set(bN.PortValue,(bT=bN.PortValue.c,j.New(bT.Key,bT.Time,new i({$:1,$0:bS}))));},bP.v),bh.string(this.Data.Name,bP))):bO.$==2?(bQ=bf.Create$1(this.get_Boolean()),(be.Sink(function(bS){var bT;bf.Set(bN.PortValue,(bT=bN.PortValue.c,j.New(bT.Key,bT.Time,new i({$:2,$0:bS}))));},bQ.v),bh.check(this.Data.Name,bQ))):(bR=bf.Create$1(this.get_Number()),(be.Sink(function(bS){var bT;bf.Set(bN.PortValue,(bT=bN.PortValue.c,j.New(bT.Key,bT.Time,new i({$:0,$0:bS}))));},bR.v),bh["double"](this.Data.Name,bR)));},get_Key:function(){return this.Data.Key;},get_Name:function(){return this.Data.Name;}},null,p);p.Clone=function(bN){var bO,bP;return p.New((bO=bN.Data,o.New((bP=bi.NewGuid(),a.String(bP)),bO.Name,bO.Value,bO.CacheSize)),bf.Create$1(bN.PortValue.c));};p.ToData=function(bN){var bO;bO=bN.Data;return o.New(bO.Key,bO.Name,bN.PortValue.c,bO.CacheSize);};p.FromData=function(bN){return p.New(bN,bf.Create$1(bN.Value));};p.New=function(bN,bO){return new p({Data:bN,PortValue:bO});};q=d.OutPort=_1.Class({Equals:function(bN){return bN instanceof q&&this.Name===bN.Name;},Trigger:function(bN){var bO;bO=h.Agent();bO.mailbox.AddLast({$:0,$0:h.CreateMessage(this.Key,bN)});bO.resume();}},null,q);q.Clone=function(bN){return q.New(_4.UniqueKey(),bN.Name,bN.Type);};q.ToData=function(bN){return[bN.Name,bN.Type];};q.FromData=function(bN,bO){return q.New(bO.Key,bN,bO);};q.New=function(bN,bO,bP){return new q({Key:bN,Name:bO,Type:bP});};r.CreateWithCache=function(bN,bO,bP){return r.New(bN,_6.map(function(bQ){return o.Create(bQ[0],bQ[1],bQ[2]);},bO),bP);};r.Create=function(bN,bO,bP){function bQ(bR,bS){return o.Create(bR,bS,1);}return r.New(bN,_6.map(function(bR){return bQ(bR[0],bR[1]);},bO),bP);};r.New=function(bN,bO,bP){return{WorkerName:bN,InPorts:bO,OutPorts:bP};};s=d.Worker=_1.Class({Equals:function(bN){return bN instanceof s&&bj.Equals(this.Name,bN.Name);},get_Properties:function(){return new _6.T({$:1,$0:bh.string("Name",this.Name),$1:_6.map(function(bN){return bN.get_Property();},this.InPorts)});},get_Render:function(){var bN;bN=this.Data.WebSharper_Community_Dashboard_IWorkerData$get_Render();return bN==null?bk.Empty():bN.$0(this);},get_Clone:function(){return s.New(_4.UniqueKey(),bf.Create$1(this.Name.c),_6.map(p.Clone,this.InPorts),_6.map(q.Clone,this.OutPorts),this.Data,bf.Create$1(null));},get_ToData:function(){return r.New(this.Name.c,_6.map(p.ToData,this.InPorts),_6.map(q.ToData,this.OutPorts));},StartRunner:function(){var bN;bN=this.Data.WebSharper_Community_Dashboard_IWorkerData$get_Run();bN==null?void 0:bf.Set(this.RunnerContext,bN.$0(this));},WithKey:function(bN){return s.New(bN,this.Name,this.InPorts,this.OutPorts,this.Data,this.RunnerContext);}},null,s);s.Create=function(bN){return s.New(_4.UniqueKey(),bf.Create$1(bN.WebSharper_Community_Dashboard_IWorkerData$get_Data().WorkerName),_6.map(p.FromData,bN.WebSharper_Community_Dashboard_IWorkerData$get_Data().InPorts),_6.map(function(bO){return q.FromData(bO[0],bO[1]);},bN.WebSharper_Community_Dashboard_IWorkerData$get_Data().OutPorts),bN,bf.Create$1(null));};s.New=function(bN,bO,bP,bQ,bR,bS){return new s({Key:bN,Name:bO,InPorts:bP,OutPorts:bQ,Data:bR,RunnerContext:bS});};t.allInPorts=function(bN){return t.allPorts(bN,function(bO){return bO.InPorts;});};t.allOutPorts=function(bN){return t.allPorts(bN,function(bO){return bO.OutPorts;});};t.allPorts=function(bN,bO){return _6.concat(_6.map(bO,bN));};u=d.RandomRunner=_1.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bN){var bO;new bl.New();_7.Start((bO=null,_7.Delay(function(){return _7.While(function(){return true;},_7.Delay(function(){return _7.Bind(_7.Sleep(bN.InPorts.get_Item(2).get_Number()*1000>>0),function(){var bP,bQ,bR;bP=bN.InPorts.get_Item(0).get_Number();bQ=bN.InPorts.get_Item(1).get_Number();bR=bm.random()*bQ+bP;bN.OutPorts.get_Item(0).Trigger(new i({$:0,$0:bR}));return _7.Zero();});}));})),null);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.RandomRunnerData;}},null,u);u.get_FromWorker=function(){return function(bN){return u.New(bN.get_ToData());};};u.get_Create=function(){return u.New(r.Create("Random",_6.ofArray([["Middle value",h.NumberMessage(100)],["Dispersion",h.NumberMessage(10)],["Delay sec.",h.NumberMessage(2)]]),_6.ofArray([["Random value",h.NumberMessage(0)]])));};u.New=function(bN){return new u({RandomRunnerData:bN});};w.New=function(bN,bO,bP,bQ,bR){return{Title:bN,Description:bO,ImageUrl:bP,Temperature:bQ,TemparatureMinMax:bR};};v.get=function(bN,bO){var bP;bP=null;return _7.Delay(function(){var bQ;bQ=(((_1.Curried3(function(bR,bS,bT){return bR("http://api.openweathermap.org/data/2.5/weather?q="+bb.toSafe(bS)+"&units=metric&appid="+bb.toSafe(bT));}))(a.id))(bO))(bN);bn.log("get key city "+bQ);return _7.TryWith(_7.Delay(function(){return _7.Bind(bp.AsyncMap(bt.asyncReadTextAtRuntime(false,"C:\\AEAFrame\\WebSharper.Community.Dashboard\\WebSharper.Community.Dashboard","","JSON","",bQ),function(bR){return bj.Equals(typeof bR,"string")?bu.parse(bR):bR;}),function(bR){var bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc;bn.log("get key city 2");return _7.Return((bS=bv.tryHead(bR.weather),bS==null?null:{$:1,$0:(bT=bS.$0,w.New((((_1.Curried3(function(cd,ce,cf){return cd(bb.toSafe(ce)+", "+bb.toSafe(cf));}))(a.id))((bV=(bU="name",bU in bR?{$:1,$0:bR[bU]}:null),bV==null?null:bV.$0)))((bY=(bW=bR.sys,(bX="country",bX in bW?{$:1,$0:bW[bX]}:null)),bY==null?null:bY.$0)),(b0=(bZ="main",bZ in bT?{$:1,$0:bT[bZ]}:null),b0==null?null:b0.$0),(function(cd){return function(ce){return cd("http://openweathermap.org/img/w/"+bb.toSafe(ce)+".png");};}(a.id))((b2=(b1="icon",b1 in bT?{$:1,$0:bT[b1]}:null),b2==null?null:b2.$0)),(b3=(b4=bR.main,(b5="temp",b5 in b4?{$:1,$0:b4[b5]}:null)),(b6=b3==null?null:{$:1,$0:1*b3.$0},b6==null?null:b6.$0)),[(b7=(b8=bR.main,(b9="temp_min",b9 in b8?{$:1,$0:b8[b9]}:null)),(b_=b7==null?null:{$:1,$0:1*b7.$0},b_==null?null:b_.$0)),(b$=(ca=bR.main,(cb="temp_max",cb in ca?{$:1,$0:ca[cb]}:null)),(cc=b$==null?null:{$:1,$0:1*b$.$0},cc==null?null:cc.$0))]))}));});}),function(bR){bn.log(bR.message);return _7.Return(null);});});};x=d.OpenWeatherRunner=_1.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bN){var bO;_7.Start((bO=null,_7.Delay(function(){return _7.While(function(){return true;},_7.Delay(function(){var bP,bQ,bR;bP=bN.InPorts.get_Item(0);bQ=bN.InPorts.get_Item(1);bR=bN.OutPorts.get_Item(0);return _7.Bind(v.get(bQ.get_String(),bP.get_String()),function(bS){return _7.Combine(bS==null?_7.Zero():(bn.log("Value generated:"+bS.$0.Title),bR.Trigger(new i({$:0,$0:+bS.$0.Temperature})),_7.Zero()),_7.Delay(function(){return _7.Bind(_7.Sleep(1000*15),function(){return _7.Return(null);});}));});}));})),null);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.OpenWeatherRunnerData;}},null,x);x.get_FromWorker=function(){return function(bN){return x.New(bN.get_ToData());};};x.Create=function(bN,bO){return x.New(r.Create("OpenWeatherMap",_6.ofArray([["City",h.StringMessage(bN)],["ApiKey",h.StringMessage(bO)]]),_6.ofArray([["Temperature",h.NumberMessage(0)]])));};x.New=function(bN){return new x({OpenWeatherRunnerData:bN});};y.New=function(bN){return{DatabaseRunnerRun:bN};};z=d.DatabaseRunner=_1.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bN){var bO;bO=true;be.Sink(function(bP){bO?(_6.iter(function(bQ){var bR;bR=h.Agent();bR.mailbox.AddLast({$:0,$0:bQ});bR.resume();},(new _9.New()).Sync("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.ServerDatabase.ReadAllMessages:965639103",[bN.InPorts.get_Item(1).get_String()])),bO=false):((new _9.New()).Send("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.ServerDatabase.WriteMessage:-353093100",[bN.InPorts.get_Item(1).get_String(),bP.WithKey(bN.OutPorts.get_Item(0).Key)]),bN.OutPorts.get_Item(0).Trigger(bP.Value));},bN.InPorts.get_Item(0).PortValue.v);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.DatabaseData;}},null,z);z.get_FromWorker=function(){return function(bN){return z.New(bN.get_ToData());};};z.get_Create=function(){return z.New(r.Create("Database",_6.ofArray([[" in Value",h.NumberMessage(100)],["Database name",h.StringMessage("Database.txt")]]),_6.ofArray([["Number value",h.NumberMessage(0)]])));};z.New=function(bN){return new z({DatabaseData:bN});};A.New=function(bN,bO){return{LineChart:bN,Queue:bO};};B=d.ChartRenderer=_1.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bN){var bO,bP,bQ,bR,bS,bT,bU,bV;bO=bN.InPorts.get_Item(3).get_Number()>>0;bP=bN.RunnerContext.c.$0;be.Sink(function(bW){bP.Queue.push(bW);bP.Queue.length>bO?bP.Queue.shift():void 0;ba.iteri(function(bX,bY){return bP.LineChart.__UpdateData(bX,function(){return bY;});},bP.Queue);},bN.InPorts.get_Item(0).get_NumberView());return by.Render$8(bP.LineChart,{$:1,$0:{$:0,$0:bN.InPorts.get_Item(1).get_Number()>>0,$1:bN.InPorts.get_Item(2).get_Number()>>0}},{$:1,$0:(bQ={},bQ.title=(bR={},bR.display=false,bR),bQ.legend=(bS={},bS.display=false,bS),bQ.elements=(bT={},bT.point=(bU={},bU.radius=0,bU),bT.line=(bV={},bV.borderWidth=1,bV),bT),bQ)},null);}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bN){var bO,bP,bQ,bR;bO=bN.InPorts.get_Item(3).get_Number()>>0;bP=_6.ofSeq(ba.delay(function(){return ba.map(function(){return 0;},_2.range(0,bO-1));}));bQ=(bR=[],(ba.iter(function(bS){bR.push(bS);},bP),bR));return{$:1,$0:A.New(bz.Line(bP).WithFill(false).__WithStrokeColor(new bA.Color({$:1,$0:"#FB8C00"})).__WithPointColor(new bA.Color({$:2,$0:"black"})),bQ)};}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.ChartRendererData;}},null,B);B.get_FromWorker=function(){return function(bN){return B.New(bN.get_ToData());};};B.Create=function(bN,bO,bP){return B.New(r.CreateWithCache("Chart",_6.ofArray([[" in Value",h.NumberMessage(100),bP>>0],["cx",h.NumberMessage(bN),1],["cy",h.NumberMessage(bO),1],["BufferSize",h.NumberMessage(bP),1]]),_6.T.Empty));};B.New=function(bN){return new B({ChartRendererData:bN});};C=d.TextBoxRenderer=_1.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bN){var bO;bO=be.Map(function(bP){var bQ;bQ=bP>>0;return a.String(bQ);},bN.InPorts.get_Item(0).get_NumberView());return bk.Element("div",[bB.Class("bigvalue")],[bk.TextView(bO)]);}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.TextBoxRendererData;}},null,C);C.get_FromWorker=function(){return function(bN){return C.New(bN.get_ToData());};};C.get_Create=function(){return C.New(r.Create("Text",_6.ofArray([["in Value",h.NumberMessage(0)]]),_6.T.Empty));};C.New=function(bN){return new C({TextBoxRendererData:bN});};D=d.ButtonRenderer=_1.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bN){return bk.ButtonView(bN.InPorts.get_Item(0).get_String(),[],bN.InPorts.get_Item(1).get_BooleanView(),function(bO){bN.OutPorts.get_Item(0).Trigger(new i({$:2,$0:bO}));});}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.ButtonRendererData;}},null,D);D.get_FromWorker=function(){return function(bN){return D.New(bN.get_ToData());};};D.get_Create=function(){return D.New(r.Create("Button",_6.ofArray([["Caption",h.StringMessage("Button")],["State",h.NumberMessage(0)]]),_6.ofArray([["Button value",h.NumberMessage(0)]])));};D.New=function(bN){return new D({ButtonRendererData:bN});};E.New=function(bN,bO,bP){return{InPortKey:bN,OutPortKey:bO,WorkerKey:bP};};F.New=function(bN){return{RuleChain:bN};};G=d.RuleContainer=_1.Class({Reconnect:function(bN){var bO,bP,bQ,bR;bO=e.Log();bP=t.allOutPorts(bN);bQ=t.allInPorts(bN);_6.iter(function(bS){(e.Log())((((_1.Curried3(function(bT,bU,bV){return bT("InPort: "+bb.toSafe(bU)+" "+bb.toSafe(bV));}))(a.id))(bS.get_Name()))(bS.Data.Key));},bQ);_6.iter(function(bS){(e.Log())((((_1.Curried3(function(bT,bU,bV){return bT("outPort: "+bb.toSafe(bU)+" "+bb.toSafe(bV));}))(a.id))(bS.Name))(bS.Key));},bP);bR=h.Agent();bR.mailbox.AddLast(l.Clear);bR.resume();_6.iter(function(bS){var bT,bU,bV;bT=_6.ofSeq(bS.RuleChain);bU=_6.ofSeq(_2.range(1,bT.get_Length()-1));bV=bC.Get(bU);try{while(bV.MoveNext())(function(){var bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5;bW=bV.Current();bX=bT.get_Item(bW-1);bY=bT.get_Item(bW);{bZ=ba.tryFind(function(b6){return b6.Key===bX.OutPortKey;},bP),bZ==null?null:{$:1,$0:(b0=bZ.$0,(bO((((_1.Curried3(function(b6,b7,b8){return b6("Found outPort "+bb.toSafe(b7)+" try to find inPort:"+bb.toSafe(b8));}))(a.id))(bX.OutPortKey))(bY.InPortKey)),b1=ba.tryFind(function(b6){return b6.Data.Key===bY.InPortKey;},bQ),b1==null?null:{$:1,$0:(b2=b1.$0,(bO("Found inPort"),b2.PortValue.c.Key!==b2.Data.Key?bf.Set(b2.PortValue,b2.PortValue.c.WithKey(b2.Data.Key)):void 0,b3=(b4=b2.PortValue.c.Value,b4.$==1?j.Create(new i({$:1,$0:""})):b4.$==2?j.Create(new i({$:2,$0:false})):j.Create(new i({$:0,$0:0}))),b5=h.Agent(),b5.mailbox.AddLast({$:2,$0:[k.Create(b0.Key,b0.Name+"->"+b2.get_Name(),b2.Data.CacheSize),b3,function(b6){b2.Receive(b6);}]}),b5.resume()))}))};return;}}());}finally{if("Dispose"in bV)bV.Dispose();}},_6.ofSeq(this.RuleContainer));}},null,G);G.New=function(bN){return new G({RuleContainer:bN});};H.Create=function(bN){return H.New(bD.Fresh(),bN);};H.New=function(bN,bO){return{Key:bN,Worker:bO};};I=d.Factory=_1.Class({RegisterEvent:function(bN){this.EventItems.Append(H.Create(bN));},RegisterWidget:function(bN){this.WidgetItems.Append(H.Create(bN));}},null,I);I.get_Create=function(){return I.New(bE.Create(function(bN){return bN.Key;},_6.T.Empty),bE.Create(function(bN){return bN.Key;},_6.T.Empty));};I.New=function(bN,bO){return new I({EventItems:bN,WidgetItems:bO});};J=d.RulesCellItem=_1.Class({Render:function(bN,bO){var bP,bQ,bR,bS,bT;bP=this;be.Sink(function(bU){var bV;if(bU==null);else{bV=bU.$0;bn.log("Workitem selected");bf.Set(bP.OptInPort,_6.tryHead(bV.Worker.InPorts));bf.Set(bP.OptOutPort,_6.tryHead(bV.Worker.OutPorts));bO();}},this.OptWorker.v);be.Sink(function(){bO();},this.OptInPort.v);be.Sink(function(){bO();},this.OptOutPort.v);bQ=(bR=be.Map(function(bU){var bV;return bU==null?_6.ofArray([null]):(bV=_6.map(function(bW){return{$:1,$0:bW};},bU.$0.Worker.InPorts),bV.get_Length()>0?bV:_6.ofArray([null]));},this.OptWorker.v),(bS=be.Map(function(bU){var bV;return bU==null?_6.ofArray([null]):(bV=_6.map(function(bW){return{$:1,$0:bW};},bU.$0.Worker.OutPorts),bV.get_Length()>0?bV:_6.ofArray([null]));},this.OptWorker.v),(bT=be.Map(function(bU){return new _6.T({$:1,$0:null,$1:_6.map(function(bV){return{$:1,$0:bV};},_6.ofSeq(bU))});},bN.v),bk.Element("table",[],[bk.Element("tr",[],[bk.Element("td",[],[bk.SelectDyn([bB.Class("form-control")],function(bU){return bF.fold(function(bV,bW){return bW.get_Name();}," ",bU);},bR,this.OptInPort)]),bk.Element("td",[],[bk.SelectDyn([bB.Class("form-control")],function(bU){return bF.fold(function(bV,bW){return bW.Worker.Name.c;}," ",bU);},bT,this.OptWorker)]),bk.Element("td",[],[bk.SelectDyn([bB.Class("form-control")],function(bU){return bF.fold(function(bV,bW){return bW.Name;}," ",bU);},bS,this.OptOutPort)])])]))));return bk.Element("td",[bB.Class("td DshEditorCell")],[bk.Element("div",[bB.Class("div DshEditorCell")],[bk.Element("table",[],[bk.Element("tr",[],[bk.Element("td",[],[bQ])])])])]);}},null,J);J.get_Create=function(){return J.New(bD.Fresh(),bf.Create$1(null),bf.Create$1(null),bf.Create$1(null));};J.New=function(bN,bO,bP,bQ){return new J({Key:bN,OptInPort:bO,OptWorker:bP,OptOutPort:bQ});};K=d.RulesRowItem=_1.Class({Render:function(bN,bO){var bP;bP=this;return bk.Element("tr",[],[bk.ConvertBy(function(bQ){return bQ.Key;},function(bQ){return bQ.Render(bN,bO);},this.CellItems.v),_4.IconNormal("add",function(){bP.CellItems.Append(J.get_Create());})]);}},null,K);K.Create=function(bN){return K.New(bD.Fresh(),bE.Create(function(bO){return bO.Key;},bN));};K.New=function(bN,bO){return new K({Key:bN,CellItems:bO});};L=d.SelectorGroup=_1.Class({RenderMenu:function(bN,bO,bP){var bQ,bR,bS,bT,bU,bV;function bW(bX){return _6.ofArray([_4.IconSmall("keyboard_arrow_down",function(){(bR(true))(bX);(bQ.ItemOnMove(bX))({$:1});}),_4.IconSmall("keyboard_arrow_up",function(){(bR(false))(bX);(bQ.ItemOnMove(bX))({$:0});}),_4.IconSmall("clear",function(){bQ.SelectorItems.Remove(bX);bQ.ItemOnDelete(bX);})]);}bQ=this;bR=(bS=this.SelectorItems,(_1.Curried3(_4.MoveItemInModelList))(bS));bT=(bU=this.ItemCreatator,bU==null?bk.Element("tr",[],[]):(bV=bU.$0,bk.Element("tr",[],[bk.Element("td",[],[bk.Element("div",[bB.Style("margin-left","20px")],[_4.IconSmall("add",function(){var bX;bX=bV();bQ.ItemOnCreated(bX);bQ.SelectorItems.Append(bX);})])])])));return bk.Element("table",[],[bk.ConvertBy(function(bX){return bX.WebSharper_Community_Dashboard_ISelectorItem$get_Key();},function(bX){var bY,bZ,b0,b1;bY=be.Map(function(b2){return bN+b2;},bX.WebSharper_Community_Dashboard_ISelectorItem$get_Name().v);return bk.Element("tr",[],[bk.Element("td",[bB.DynamicStyle("Color",be.Map(function(b2){return b2==null?"#7D4600":bj.Equals(b2.$0.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bX.WebSharper_Community_Dashboard_ISelectorItem$get_Key())?"#FB8C00":"#7D4600";},bO.v))],[(bZ=bk.Element("div",[bB.Style("margin-left","10px"),bB.Style("margin-right","5px"),bB.Style("cursor","pointer"),bB.Handler("click",function(){return function(){bQ.ItemOnSelected(bX);return bf.Set(bO,{$:1,$0:bX});};})],[bk.TextView(bY)]),(bP?(b0=bW(bX),(b1=_3.WrapControlsAligment.Horizontal,function(b2){return bG.Render(b0,b1,b2);})):a.id)(bZ))])]);},this.SelectorItems.v),bT]);}},null,L);L.Create=function(bN,bO,bP,bQ,bR,bS,bT){var bU;bU=bE.Create(function(bV){return bV.WebSharper_Community_Dashboard_ISelectorItem$get_Key();},bO);return L.New(bD.Fresh(),bf.Create$1(bN),bU,bP,bQ,bR,bS,bT);};L.New=function(bN,bO,bP,bQ,bR,bS,bT,bU){return new L({Key:bN,Name:bO,SelectorItems:bP,ItemCreatator:bQ,ItemOnCreated:bR,ItemOnSelected:bS,ItemOnDelete:bT,ItemOnMove:bU});};M=d.WindowSelector=_1.Class({get_RenderMenu:function(){var bN;bN=this;return this.SelectorGroups.get_Length()===1?_6.head(_6.ofSeq(this.SelectorGroups)).RenderMenu("",this.OptSelectedItem,this.IsWithControls):bk.Element("div",[],[bk.ConvertBy(function(bO){return bO.Key;},function(bO){return bk.Element("div",[],[bk.Element("div",[bB.Style("cursor","pointer"),bB.Handler("click",function(){return function(){return bN.GroupOnClick(bO);};})],[bk.TextView(bO.Name.v)]),bO.RenderMenu("    ",bN.OptSelectedItem,bN.IsWithControls)]);},this.SelectorGroups.v)]);},get_Render:function(){return bk.Element("div",[],[bk.BindView(function(bN){return bN==null?bk.Empty():bN.$0.WebSharper_Community_Dashboard_ISelectorItem$get_Render();},this.OptSelectedItem.v)]);},GroupByIndex:function(bN){return ba.nth(bN,_6.ofSeq(this.SelectorGroups));},get_SelectedIndex:function(){var bN;bN=this;return ba.findIndex(function(bO){return bj.Equals(bO.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bN.get_SelectedItem().WebSharper_Community_Dashboard_ISelectorItem$get_Key());},_6.concat(_6.map(function(bO){return _6.ofSeq(bO.SelectorItems);},_6.ofSeq(this.SelectorGroups))));},get_SelectedIndexInGroup:function(){var bN;bN=this;return ba.findIndex(function(bO){return bj.Equals(bO.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bN.get_SelectedItem().WebSharper_Community_Dashboard_ISelectorItem$get_Key());},_6.ofSeq(this.get_SelectedGroup().SelectorItems));},get_SelectedGroupIndex:function(){var bN;bN=this;return ba.findIndex(function(bO){return bj.Equals(bO.Key,bN.get_SelectedGroup().Key);},_6.ofSeq(this.SelectorGroups));},get_SelectedGroup:function(){return this.GroupFromItem(this.get_SelectedItem());},GroupFromItem:function(bN){return ba.find(function(bO){return _6.exists(function(bP){return bj.Equals(bP.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bN.WebSharper_Community_Dashboard_ISelectorItem$get_Key());},_6.ofSeq(bO.SelectorItems));},_6.ofSeq(this.SelectorGroups));},AppenGroup:function(bN,bO,bP){var bQ;bQ=this.SelectorGroups.get_Length();this.SelectorGroups.Append(L.Create(bN,bO,bP,this.ItemOnCreated(bQ),this.ItemOnSelected,this.ItemOnDeleted(bQ),this.ItemOnMove(bQ)));},get_SelectedItem:function(){var bN;bN=this.OptSelectedItem.c;return bN==null?_2.FailWith("Something really wrong with WindowSelector"):bN.$0;},ClearGroups:function(){bf.Set(this.OptSelectedItem,null);_6.iter(function(bN){bN.SelectorItems.Clear();},_6.ofSeq(this.SelectorGroups));},WithControls:function(bN){return M.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,bN);},WithItemOnMove:function(bN){return M.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,bN,this.IsWithControls);},WithItemOnDeleted:function(bN){return M.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,bN,this.ItemOnMove,this.IsWithControls);},WithItemOnSelected:function(bN){return M.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,bN,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);},WithGroupOnClick:function(bN){return M.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,bN,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);},WithItemOnCreated:function(bN){return M.New(this.OptSelectedItem,this.SelectorGroups,bN,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);}},null,M);M.get_Create=function(){var bN;bN=bE.Create(function(bO){return bO.Key;},_6.T.Empty);return M.New(bf.Create$1(null),bN,function(){return function(){return null;};},a.ignore,a.ignore,function(){return function(){return null;};},_1.Curried3(function(bO,bP,bQ){return null;}),false);};M.New=function(bN,bO,bP,bQ,bR,bS,bT,bU){return new M({OptSelectedItem:bN,SelectorGroups:bO,ItemOnCreated:bP,GroupOnClick:bQ,ItemOnSelected:bR,ItemOnDeleted:bS,ItemOnMove:bT,IsWithControls:bU});};N.Create=function(bN,bO){return N.New(bD.Fresh(),bN,bO);};N.New=function(bN,bO,bP){return{Key:bN,Panel:bO,Widget:bP};};O=d.EventsGroupItem=_1.Class({get_Render:function(){var bN,bO,bP;function bQ(bR){return _6.ofArray([_4.IconSmall("keyboard_arrow_down",function(){(bO(true))(bR);}),_4.IconSmall("keyboard_arrow_up",function(){(bO(false))(bR);}),_4.IconSmall("clear",function(){bN.EventItems.Remove(bR);})]);}bN=this;bO=(bP=this.EventItems,(_1.Curried3(_4.MoveItemInModelList))(bP));return bk.Element("table",[],[bk.ConvertBy(function(bR){return bR.Key;},function(bR){var bS;return bk.Element("tr",[],[(bS=bk.Element("div",_4.AttrsClick(function(){bN.PropertyGrid.Edit(bR.Worker.get_Properties());}),[bk.TextView(bR.Worker.Name.v)]),bG.Render(bQ(bR),_3.WrapControlsAligment.Horizontal,bS))]);},this.EventItems.v)]);},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,O);O.Create=function(bN,bO){return O.New(bD.Fresh(),bf.Create$1(bN),bE.Create(function(bP){return bP.Key;},_6.T.Empty),bO);};O.New=function(bN,bO,bP,bQ){return new O({Key:bN,Name:bO,EventItems:bP,PropertyGrid:bQ});};P=d.WidgetsGroupItem=_1.Class({get_Render:function(){return this.PanelContainer.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,P);P.Create=function(bN,bO){return P.New(bD.Fresh(),bf.Create$1(bN),bE.Create(function(bP){return bP.Key;},_6.T.Empty),bO);};P.New=function(bN,bO,bP,bQ){return new P({Key:bN,Name:bO,WidgetItems:bP,PanelContainer:bQ});};Q=d.RulesGroupItem=_1.Class({Equals:function(bN){return bN instanceof Q&&bj.Equals(this.Key,bN.Key);},get_Render:function(){return this.Renderer(this.RulesRowItems);},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,Q);Q.Create=function(bN,bO){return Q.New(bD.Fresh(),bf.Create$1(bN),bE.Create(function(bP){return bP.Key;},_6.T.Empty),bO);};Q.New=function(bN,bO,bP,bQ){return new Q({Key:bN,Name:bO,RulesRowItems:bP,Renderer:bQ});};R=d.DshData=_1.Class({RegisterWidget:function(bN,bO,bP,bQ){var bR;bR=bQ.WithKey(bN);bO.WidgetItems.Append(N.Create(bP,bR));this.WorkItems.Append(H.Create(bR));},RegisterEvent:function(bN,bO,bP){var bQ;bQ=H.Create(bP.WithKey(bN));bO.EventItems.Append(bQ);this.WorkItems.Append(bQ);},get_Clear:function(){this.WorkItems.Clear();this.WidgetGroups.Clear();this.EventGroups.Clear();this.RulesGroups.Clear();}},null,R);R.get_Create=function(){return R.New(bE.Create(function(bN){return bN.Key;},_6.T.Empty),bE.Create(function(bN){return bN.Key;},_6.T.Empty),bE.Create(function(bN){return bN.Key;},_6.T.Empty),bE.Create(function(bN){return bN.Key;},_6.T.Empty));};R.New=function(bN,bO,bP,bQ){return new R({WorkItems:bN,WidgetGroups:bO,EventGroups:bP,RulesGroups:bQ});};S.Render=function(bN,bO){function bP(bS,bT){return _4.MoveItemInModelList(bO,bS,bT);}function bQ(bS){return _6.ofArray([_4.IconSmall("keyboard_arrow_down",function(){bP(true,bS);}),_4.IconSmall("keyboard_arrow_up",function(){bP(false,bS);}),_4.IconSmall("clear",function(){bO.Remove(bS);})]);}function bR(){var bS;bS=_6.map(function(bT){return bT.Worker;},_6.ofSeq(bN.WorkItems));S.CopyToRules(bO).Reconnect(bS);}return bk.Element("table",[],[bk.ConvertBy(function(bS){return bS.Key;},function(bS){var bT;return bk.Element("tr",[],[(bT=bS.Render(bN.WorkItems,function(){bR();}),bG.Render(bQ(bS),_3.WrapControlsAligment.Horizontal,bT))]);},bO.v)]);};S.Restore=function(bN,bO,bP){var bQ,bR,bS;bO.Clear();bQ=_6.map(function(bT){return bT.Worker;},_6.ofSeq(bN.WorkItems));bR=t.allOutPorts(bQ);bS=t.allInPorts(bQ);_6.iter(function(bT){var bU;bU=K.Create([]);_6.iter(function(bV){var bW;bW=J.get_Create();bf.Set(bW.OptWorker,ba.tryFind(function(bX){return bX.Worker.Key===bV.WorkerKey;},_6.ofSeq(bN.WorkItems)));bf.Set(bW.OptInPort,ba.tryFind(function(bX){return bX.get_Key()===bV.InPortKey;},bS));bf.Set(bW.OptOutPort,ba.tryFind(function(bX){return bX.Key===bV.OutPortKey;},bR));bU.CellItems.Append(bW);},bT.RuleChain);bO.Append(bU);},bP.RuleContainer);bP.Reconnect(bQ);};S.CopyToRules=function(bN){return G.New(_6.map(function(bO){return F.New(_6.map(function(bP){var bQ,bR,bS;return E.New((bQ=bP.OptInPort.c,bQ==null?"":bQ.$0.get_Key()),(bR=bP.OptOutPort.c,bR==null?"":bR.$0.Key),(bS=bP.OptWorker.c,bS==null?"":bS.$0.Worker.Key));},_6.ofSeq(bO.CellItems)));},_6.ofSeq(bN)));};T.RulesGroupCreator=function(bN,bO){var bP;bP=Q.Create("rules"+a.String(_6.length(_6.ofSeq(bN.RulesGroups))+1),function(bQ){return S.Render(bN,bQ);});bN.RulesGroups.Append(bP);return bP;};T.EventsGroupCreator=function(bN,bO,bP){var bQ;bQ=O.Create("event"+a.String(_6.length(_6.ofSeq(bN.EventGroups))+1),bO);bN.EventGroups.Append(bQ);return bQ;};T.PanelGroupCreator=function(bN,bO,bP){var bQ;bQ=P.Create("panel"+a.String(_6.length(_6.ofSeq(bN.WidgetGroups))+1),bO());bN.WidgetGroups.Append(bQ);return bQ;};U=d.Dashboard=_1.Class({Render:function(bN){var bO;bO=this;return bk.EmbedView(be.Map(function(bP){return bP.$==1?bk.Element("div",[],[bk.Element("table",[],[bk.Element("tr",[],[bk.Element("td",[bB.Style("vertical-align","top")],[bk.Element("table",[],ba.concat([_6.ofArray([bk.Element("tr",[],[bk.Element("td",[],[_4.IconNormal("dehaze",function(){bf.Set(bO.PanelTitleVisibility,false);bf.Set(bO.Mode,{$:0});})])])]),_6.ofArray([bO.EditorSelectorEdit.get_RenderMenu()]),_6.ofArray([bk.Element("tr",[],[bk.Element("td",[],[])]),bk.Element("tr",[],[bk.Element("td",[],[bO.PropertyGrid.get_Render()])])])]))]),bk.Element("td",[bB.Style("vertical-align","top")],[bN,_4.IconNormal("add",function(){var bQ,bR,bS,bT,bU;bQ=bO.EditorSelectorEdit.get_SelectedGroupIndex();bQ===1?(bR=_6.ofSeq(bO.Factory.EventItems),bS=bf.Create$1(_6.head(bR)),bO.Dialog.ShowDialog("Select source",bk.Element("div",[],[bk.Select([bB.Class("form-control")],function(bV){return bV.Worker.Name.c;},bR,bS)]),function(){var bV,bW,bX;bV=bS.c.Worker.get_Clone();bV.StartRunner();bW=(bX=_6.ofSeq(bO.Data.EventGroups),ba.nth(bO.EditorSelectorEdit.get_SelectedIndexInGroup(),bX));bO.Data.RegisterEvent(_4.UniqueKey(),bW,bV);})):bQ===0?bO.CreatePanel((bT=_6.ofSeq(bO.Data.WidgetGroups),ba.nth(bO.EditorSelectorEdit.get_SelectedIndexInGroup(),bT)),"Panel",700,null):bQ===2?(bU=_6.ofSeq(bO.Data.RulesGroups),ba.nth(bO.EditorSelectorEdit.get_SelectedIndexInGroup(),bU)).RulesRowItems.Append(K.Create([J.get_Create(),J.get_Create()])):void 0;}),bO.EditorSelectorEdit.get_Render()])])]),bk.Element("div",[],[bO.Dialog.get_Render()])]):bk.Element("div",[],[bk.Element("table",[],[bk.Element("tr",[],[bk.Element("td",[bB.Style("vertical-align","top")],[_4.IconNormal("dehaze",function(){bf.Set(bO.PanelTitleVisibility,true);bf.Set(bO.Mode,{$:1});}),bO.EditorSelectorRun.GroupByIndex(0).SelectorItems.get_Length()>1?bO.EditorSelectorRun.get_RenderMenu():bk.Element("div",[],[])]),bk.Element("td",[],[bO.EditorSelectorRun.get_Render()])])])]);},this.Mode.v));},Restore:function(bN,bO,bP,bQ){var bR,bS,bT,bU,bV;bR=this;this.EditorSelectorRun.ClearGroups();this.EditorSelectorEdit.ClearGroups();this.Data.get_Clear();bS=this.EditorSelectorRun.GroupByIndex(0);bT=this.EditorSelectorEdit.GroupByIndex(0);bU=this.EditorSelectorEdit.GroupByIndex(1);bV=this.EditorSelectorEdit.GroupByIndex(2);_6.iteri(function(bW,bX){var bY,bZ;function b0(b1,b2,b3){bR.RegisterWidget(b1,bZ,b2,ba.find(function(b4){return b4.Key===b2;},_6.ofSeq(bZ.PanelContainer.PanelItems)).Children,(b3.StartRunner(),b3));}bY=T.PanelGroupCreator(bR.Data,bN,null);bf.Set(bY.WebSharper_Community_Dashboard_ISelectorItem$get_Name(),bX[0]);bT.SelectorItems.Append(bY);bS.SelectorItems.Append(bY);bZ=ba.nth(bW,_6.ofSeq(bR.Data.WidgetGroups));_6.iter(function(b1){var b2;b2=bR.CreatePanel(bZ,"Panel",700,{$:1,$0:b1.Key});bf.Set(b2.Left,b1.Left);bf.Set(b2.Top,b1.Top);},bX[1]);return _6.iter(function(b1){return b0(b1[0],b1[1],b1[2]);},bX[2]);},bP);bn.log("Widgets restored");_6.iteri(function(bW,bX){var bY,bZ;function b0(b1,b2){bR.Data.RegisterEvent(b1,bZ,b2);}bY=T.EventsGroupCreator(bR.Data,bR.PropertyGrid,null);bf.Set(bY.WebSharper_Community_Dashboard_ISelectorItem$get_Name(),bX[0]);bU.SelectorItems.Append(bY);bZ=ba.nth(bW,_6.ofSeq(bR.Data.EventGroups));return _6.iter(function(b1){return b0(b1[0],b1[1]);},bX[1]);},bO);bn.log("Events restored");_6.iteri(function(bW,bX){var bY;bY=T.RulesGroupCreator(bR.Data,null);bf.Set(bY.WebSharper_Community_Dashboard_ISelectorItem$get_Name(),bX[0]);bV.SelectorItems.Append(bY);return S.Restore(bR.Data,ba.nth(bW,_6.ofSeq(bR.Data.RulesGroups)).RulesRowItems,bX[1]);},bQ);this.Data.WidgetGroups.get_Length()>0?(bf.Set(this.EditorSelectorEdit.OptSelectedItem,{$:1,$0:_6.head(_6.ofSeq(this.EditorSelectorEdit.GroupByIndex(0).SelectorItems))}),bf.Set(this.EditorSelectorRun.OptSelectedItem,{$:1,$0:_6.head(_6.ofSeq(this.EditorSelectorRun.GroupByIndex(0).SelectorItems))})):(bf.Set(this.EditorSelectorEdit.OptSelectedItem,null),bf.Set(this.EditorSelectorRun.OptSelectedItem,null));bn.log("Connectors restored");return[_6.concat(_6.map(function(bW){return _6.map(function(bX){return bX.Worker;},_6.ofSeq(bW.EventItems));},_6.ofSeq(this.Data.EventGroups))),_6.concat(_6.map(function(bW){return _6.map(function(bX){return bX.Widget;},_6.ofSeq(bW.WidgetItems));},_6.ofSeq(this.Data.WidgetGroups)))];},Store:function(bN){function bO(bQ,bR){var bS;bS=bN(bR);return bS==null?bQ:new _6.T({$:1,$0:[bR.Key,bS.$0],$1:bQ});}function bP(bQ,bR,bS){var bT;bT=bN(bS);return bT==null?bQ:new _6.T({$:1,$0:[bS.Key,bR,bT.$0],$1:bQ});}return[_6.map(function(bQ){return[bQ.Name.c,_6.rev(ba.fold(function(bR,bS){return bO(bR,bS.Worker);},_6.T.Empty,_6.ofSeq(bQ.EventItems)))];},_6.ofSeq(this.Data.EventGroups)),_6.map(function(bQ){return[bQ.Name.c,_6.map(function(bR){return bR.get_PanelData();},_6.ofSeq(bQ.PanelContainer.PanelItems)),_6.rev(ba.fold(function(bR,bS){return bP(bR,bS.Panel,bS.Widget);},_6.T.Empty,_6.ofSeq(bQ.WidgetItems)))];},_6.ofSeq(this.Data.WidgetGroups)),_6.map(function(bQ){return[bQ.Name.c,S.CopyToRules(bQ.RulesRowItems)];},_6.ofSeq(this.Data.RulesGroups))];},CreatePanel:function(bN,bO,bP,bQ){var bR,bS,bT,bU,bV,bW;bR=this;bk.ConvertBy(bN.WidgetItems.key,function(bX){return bk.Element("div",[],[bk.TextView(bX.Widget.Name.v)]);},bN.WidgetItems.v);bS=(bT=(bU=bi.NewGuid(),a.String(bU)),bQ==null?bT:bQ.$0);bV=bH.get_Create().WithLayoutManager(bI.StackPanelLayoutManager()).WithAttributes([bB.Style("border","1px solid white"),bB.Style("display","flex")]);bW=bJ.get_Create().WithKey(bS).WithPannelAttrs([bB.Style("Width",a.String(bP)+"px"),bB.Style("position","absolute")]).WithTitle(this.PanelTitleVisibility).WithTitleContent(bk.TextNode(bO)).WithTitleButtons(_6.ofArray([bK.New("add",function(bX){var bY,bZ;bY=_6.ofSeq(bR.Factory.WidgetItems);bZ=bf.Create$1(_6.head(bY));bR.Dialog.ShowDialog("Select widget",bk.Element("div",[],[bk.Select([bB.Class("form-control")],function(b0){return b0.Worker.Name.c;},bY,bZ)]),function(){var b0;bn.log("Dialog.IsOK");b0=bZ.c.Worker.get_Clone();b0.StartRunner();bR.RegisterWidget(_4.UniqueKey(),bN,bX.Key,bX.Children,b0);});}),bK.New("edit",function(bX){bn.log("Edit");bR.PropertyGrid.Edit(_6.concat(_6.map(function(bY){return bY.Widget.get_Properties();},_6.filter(function(bY){return bY.Panel===bX.Key;},_6.ofSeq(bN.WidgetItems)))));}),bK.New("clear",function(bX){bN.PanelContainer.PanelItems.Remove(bN.PanelContainer.FindPanelItem(bX));bN.WidgetItems.RemoveBy(function(bY){return bY.Panel===bX.Key;});})])).WithChildPanelContainer(bV);bN.PanelContainer.AddPanel(bW);return bW;},RegisterWidget:function(bN,bO,bP,bQ,bR){var bS;this.Data.RegisterWidget(bN,bO,bP,bR);bS=bJ.get_Create().WithPanelContent(bR.get_Render());bf.Set(bS.IsWithTitle,false);bQ.AddPanel(bS);}},null,U);U.Create=function(bN){var bO,bP,bQ,bR,bS,bT;function bU(){return T.PanelGroupCreator(bP,bN,void 0);}function bV(){return T.EventsGroupCreator(bP,bQ,void 0);}function bW(){return T.RulesGroupCreator(bP,void 0);}bO=bL.get_Create();bP=R.get_Create();bQ=bM.get_Create();bR=M.get_Create();bS=M.get_Create().WithGroupOnClick(function(bX){bQ.Edit(_6.mapi(function(bY,bZ){var b0;return bh.string((b0=bY+1,a.String(b0)),bZ.WebSharper_Community_Dashboard_ISelectorItem$get_Name());},_6.ofSeq(bX.SelectorItems)));}).WithItemOnSelected(function(){bQ.Edit(_6.T.Empty);}).WithItemOnCreated(function(bX){return function(bY){return bX===0?_6.head(_6.ofSeq(bR.SelectorGroups)).SelectorItems.Append(bY):null;};}).WithItemOnDeleted(function(){return function(){return null;};}).WithItemOnDeleted(function(bX){return function(bY){bY instanceof P?bP.WidgetGroups.Remove(bY):bY instanceof O?bP.EventGroups.Remove(bY):bY instanceof Q?bP.RulesGroups.Remove(bY):_2.FailWith("WithItemOnDeleted, type unknown");return bX===0?_6.head(_6.ofSeq(bR.SelectorGroups)).SelectorItems.Remove(bY):null;};}).WithItemOnMove(_1.Curried3(function(bX,bY,bZ){var b0;b0=bZ.$==1&&true;return bY instanceof P?(_4.MoveItemInModelList(bP.WidgetGroups,b0,bY),_4.MoveItemInModelList(_6.head(_6.ofSeq(bR.SelectorGroups)).SelectorItems,b0,bY)):bY instanceof O?_4.MoveItemInModelList(bP.EventGroups,b0,bY):bY instanceof Q?_4.MoveItemInModelList(bP.RulesGroups,b0,bY):_2.FailWith("WithItemOnDeleted, type unknown");})).WithControls(true);bT=bU();bS.AppenGroup("Panels",_6.ofArray([bT]),{$:1,$0:bU});bR.AppenGroup("Panels",_6.ofArray([bT]),null);bS.AppenGroup("Events",_6.ofArray([bV()]),{$:1,$0:bV});bS.AppenGroup("Rules",_6.ofArray([bW()]),{$:1,$0:bW});bf.Set(bS.OptSelectedItem,{$:1,$0:_6.head(_6.ofSeq(bS.GroupByIndex(0).SelectorItems))});bf.Set(bR.OptSelectedItem,{$:1,$0:_6.head(_6.ofSeq(bR.GroupByIndex(0).SelectorItems))});return U.New(I.get_Create(),bP,bQ,bO,bR,bS,bf.Create$1({$:0}),bf.Create$1(false));};U.New=function(bN,bO,bP,bQ,bR,bS,bT,bU){return new U({Factory:bN,Data:bO,PropertyGrid:bP,Dialog:bQ,EditorSelectorRun:bR,EditorSelectorEdit:bS,Mode:bT,PanelTitleVisibility:bU});};V.FromWorker=function(bN){var bO;bO=bN.Data;return bO instanceof u?{$:1,$0:{$:0,$0:(u.get_FromWorker())(bN)}}:bO instanceof x?{$:1,$0:{$:1,$0:(x.get_FromWorker())(bN)}}:bO instanceof z?{$:1,$0:{$:2,$0:(z.get_FromWorker())(bN)}}:bO instanceof C?{$:1,$0:{$:3,$0:(C.get_FromWorker())(bN)}}:bO instanceof B?{$:1,$0:{$:4,$0:(B.get_FromWorker())(bN)}}:bO instanceof D?{$:1,$0:{$:5,$0:(D.get_FromWorker())(bN)}}:null;};V.ToWorker=function(bN){return bN.$==1?s.Create(bN.$0):bN.$==2?s.Create(bN.$0):bN.$==3?s.Create(bN.$0):bN.$==4?s.Create(bN.$0):bN.$==5?s.Create(bN.$0):s.Create(bN.$0);};W.CreateDashboard=function(){X.$cctor();return X.CreateDashboard;};W.PanelContainerCreator=function(bN){return bH.get_Create().WithLayoutManager(bI.FloatingPanelLayoutManager(5)).WithWidth(800).WithHeight(420).WithAttributes([bB.Style("border","1px solid white")]);};W.RegisterAppModelLib=function(bN){function bO(bQ){W.RegisterEventGeneral(bN,bQ);}function bP(bQ){W.RegisterWidgetGeneral(bN,bQ);}bO(x.Create("London",""));bO(u.get_Create());bO(z.get_Create());bP(C.get_Create());bP(B.Create(300,150,50));bP(D.get_Create());return bN;};W.RegisterWidgetGeneral=function(bN,bO){var bP;W.Register((bP=bN.Factory,function(bQ){bP.RegisterWidget(bQ);}),bO);};W.RegisterEventGeneral=function(bN,bO){var bP;W.Register((bP=bN.Factory,function(bQ){bP.RegisterEvent(bQ);}),bO);};W.Register=function(bN,bO){return bN(s.Create(bO));};X.$cctor=_1.Cctor(function(){X.CreateDashboard=W.RegisterAppModelLib(U.Create(function(){return W.PanelContainerCreator();}));X.$cctor=a.ignore;});Y.RecreatWidgetsOnServer=function(bN,bO){function bP(bR,bS,bT){return bT;}function bQ(bR,bS,bT){return bT;}return _6.map(function(bR){return bP(bR[0],bR[1],bR[2]);},_6.concat(_6.map(function(bR){return bQ(bR[0],bR[1],bR[2]);},Y.RecreateWidgets(bN,bO))));};Y.RecreateEventsOnServer=function(bN,bO){function bP(bR,bS){return bS;}function bQ(bR,bS){return bS;}return _6.map(function(bR){return bP(bR[0],bR[1]);},_6.concat(_6.map(function(bR){return bQ(bR[0],bR[1]);},Y.RecreateEvents(bN,bO))));};Y.RecreateOnClient=function(bN,bO,bP,bQ,bR,bS,bT){var bU;e.set_Role(f.Client);bU=h.Agent();bU.mailbox.AddLast({$:3,$0:function(bV){(new _9.New()).Send("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.MessageBus.SendToServer:-1358505674",[bV]);}});bU.resume();_6.iter(bN,(bO.Restore(bP,Y.RecreateEvents(bQ,bR),Y.RecreateWidgets(bQ,bS),bT))[0]);};Y.RecreateWidgets=function(bN,bO){function bP(bQ,bR,bS){function bT(bU,bV,bW){return[bU,bV,bN(bW)];}return[bQ,bR,_6.map(function(bU){return bT(bU[0],bU[1],bU[2]);},bS)];}return _6.map(function(bQ){return bP(bQ[0],bQ[1],bQ[2]);},bO);};Y.RecreateEvents=function(bN,bO){function bP(bQ,bR){function bS(bT,bU){return[bT,bN(bU)];}return[bQ,_6.map(function(bT){return bS(bT[0],bT[1]);},bR)];}return _6.map(function(bQ){return bP(bQ[0],bQ[1]);},bO);};Z=d.AppData=_1.Class({RecreateOnServer:function(bN){var bO,bP;function bQ(bR,bS){bS.Reconnect(bP);}bO=Y.RecreateEventsOnServer(bN,this.Events);bP=_6.append(bO,Y.RecreatWidgetsOnServer(bN,this.Widgets));_6.iter(function(bR){return bQ(bR[0],bR[1]);},this.Rules);_6.iter(function(bR){bR.StartRunner();},bP);return bO;},RecreateOnClientEventsRunning:function(bN,bO,bP){Y.RecreateOnClient(function(bQ){bQ.StartRunner();},bN,bO,bP,this.Events,this.Widgets,this.Rules);},RecreateOnClientEventsNotRunning:function(bN,bO,bP){Y.RecreateOnClient(a.ignore,bN,bO,bP,this.Events,this.Widgets,this.Rules);}},null,Z);Z.Create=function(bN,bO){var bP;bP=bN.Store(bO);return Z.New(bP[0],bP[1],bP[2]);};Z.empty=function(){return Z.New(_6.T.Empty,_6.T.Empty,_6.T.Empty);};Z.New=function(bN,bO,bP){return new Z({Events:bN,Widgets:bO,Rules:bP});};}());
