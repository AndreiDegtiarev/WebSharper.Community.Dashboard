(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn;a=window.WebSharper=window.WebSharper||{};b=a.Community=a.Community||{};c=b.Dashboard=b.Dashboard||{};d=c.MessageBus=c.MessageBus||{};e=d.KeyValue=d.KeyValue||{};f=d.Message=d.Message||{};g=d.AgentState=d.AgentState||{};h=window.StartupCode$WebSharper_Community_Dashboard$MessageBus=window.StartupCode$WebSharper_Community_Dashboard$MessageBus||{};i=c.InPort=c.InPort||{};j=c.OutPortType=c.OutPortType||{};k=c.OutPort=c.OutPort||{};l=c.Ports=c.Ports||{};m=c.Worker=c.Worker||{};n=c.RandomRunner=c.RandomRunner||{};o=c.OpenWeather=c.OpenWeather||{};p=o.Forecast=o.Forecast||{};q=c.OpenWeatherRunner=c.OpenWeatherRunner||{};r=c.ChartRunnerContext=c.ChartRunnerContext||{};s=c.ChartRenderer=c.ChartRenderer||{};t=c.TextBoxRenderer=c.TextBoxRenderer||{};u=c.WorkerItem=c.WorkerItem||{};v=c.Factory=c.Factory||{};w=c.WidgetItem=c.WidgetItem||{};x=c.DshData=c.DshData||{};y=c.DshEditorCellItem=c.DshEditorCellItem||{};z=c.DshEditorRowItem=c.DshEditorRowItem||{};A=c.DshEditor=c.DshEditor||{};B=c.DshEditorCellData=c.DshEditorCellData||{};C=c.DshEditorRowData=c.DshEditorRowData||{};D=c.DshEditorData=c.DshEditorData||{};E=c.Dashboard=c.Dashboard||{};F=b&&b.Panel;G=F&&F.Helper;H=window.IntelliFactory;I=H&&H.Runtime;J=a&&a.Control;K=J&&J.MailboxProcessor;L=a&&a.Concurrency;M=a&&a.List;N=a&&a.Operators;O=a&&a.UI;P=O&&O.Next;Q=P&&P.Var;R=b&&b.PropertyGrid;S=R&&R.Properties;T=a&&a.Guid;U=a&&a.Unchecked;V=P&&P.Doc;W=a&&a.Random;X=window.Math;Y=a&&a.PrintfHelpers;Z=window.console;_0=a&&a.Data;_1=_0&&_0.TxtRuntime;_2=window.FSharp;_3=_2&&_2.Data;_4=_3&&_3.Runtime;_5=_4&&_4.IO;_6=window.JSON;_7=a&&a.Arrays;_8=a&&a.Charting;_9=_8&&_8.Renderers;_=_9&&_9.ChartJs;$=a&&a.Seq;ba=_8&&_8.Chart;bb=_8&&_8.Pervasives;bc=P&&P.View;bd=P&&P.AttrModule;be=P&&P.Key;bf=P&&P.ListModel;bg=a&&a.Option;bh=a&&a.Enumerator;bi=F&&F.PanelContainer;bj=F&&F.LayoutManagers;bk=F&&F.Panel;bl=F&&F.TitleButton;bm=F&&F.Dialog;bn=R&&R.PropertyGrid;e.New=function(bo,bp){return{Key:bo,Value:bp};};f.Clear={$:2};g.New=function(bo){return{Listeners:bo};};d.Agent=function(){h.$cctor();return h.Agent;};d.CreateString=function(bo){return d.CreateStrPair(G.UniqueKey(),bo);};d.CreateNumber=function(bo){return d.CreateNumPair(G.UniqueKey(),bo);};d.CreateStrPair=function(bo,bp){return d.CreateKeyValue(bo,{$:1,$0:bp});};d.CreateNumPair=function(bo,bp){return d.CreateKeyValue(bo,{$:0,$0:bp});};d.CreateKeyValue=function(bo,bp){return e.New(bo,bp);};h.$cctor=I.Cctor(function(){h.Agent=K.Start(function(bo){function bp(bq){var br;br=null;return L.Delay(function(){return L.Bind(bo.Receive(null),function(bs){var bt,bu,bv;return bs.$==1?bp(g.New(new M.T({$:1,$0:bs.$0,$1:bq.Listeners}))):bs.$==0?(bt=bs.$0,(bu=function(bw,bx){bx(bt.Value);},M.iter(function(bw){return bu(bw[0],bw[1]);},(bv=function(bw){return bw===bt.Key;},M.filter(function(bw){return bv(bw[0],bw[1]);},bq.Listeners))),bp(bq))):bp(g.New(M.T.Empty));});});}return bp(g.New(M.T.Empty));},null);h.$cctor=window.ignore;});i=c.InPort=I.Class({Equals:function(bo){return bo instanceof i&&this.Name===bo.Name;},get_StringValue:function(){var bo;bo=this;return this.ExtractPortStringValue(function(bp){return d.CreateStrPair(bo.Key,bp.c);});},get_StringVar:function(){return this.ExtractPortStringValue(window.id);},get_String:function(){return this.ExtractPortStringValue(function(bo){return bo.c;});},ExtractPortStringValue:function(bo){var bp;bp=this.PortValue;return bp.$==1?bo(bp.$0):N.FailWith("unexpected type");},get_NumberValue:function(){var bo;bo=this;return this.ExtractPortNumberValue(function(bp){return d.CreateNumPair(bo.Key,bp.c);});},get_NumberVar:function(){return this.ExtractPortNumberValue(window.id);},get_Number:function(){return this.ExtractPortNumberValue(function(bo){return bo.c;});},ExtractPortNumberValue:function(bo){var bp;bp=this.PortValue;return bp.$==0?bo(bp.$0):N.FailWith("unexpected type");},Receive:function(bo){var bp;bp=this.PortValue;bp.$==1?bo.$==1?Q.Set(bp.$0,bo.$0):N.FailWith("incompatible types"):bo.$==0?Q.Set(bp.$0,bo.$0):N.FailWith("incompatible types");},get_Property:function(){var bo;bo=this.PortValue;return bo.$==1?S.string(this.Name,bo.$0):S["double"](this.Name,bo.$0);},get_Clone:function(){var bo,bp;return i.New((bo=T.NewGuid(),window.String(bo)),this.Name,(bp=this.PortValue,bp.$==1?{$:1,$0:Q.Create$1(bp.$0.c)}:{$:0,$0:Q.Create$1(bp.$0.c)}));}},null,i);i.Create=function(bo,bp,bq){return i.New(bo,bp,bq);};i.New=function(bo,bp,bq){return new i({Key:bo,Name:bp,PortValue:bq});};j=c.OutPortType=I.Class({IsCompatible:function(bo){return this.$==1?bo.PortValue.$==1&&true:bo.PortValue.$==0&&true;}},null,j);j.StringOutPort=new j({$:1});j.NumberOutPort=new j({$:0});k=c.OutPort=I.Class({Equals:function(bo){return bo instanceof k&&this.Name===bo.Name;},Trigger:function(bo){var bp;bp=d.Agent();bp.mailbox.AddLast({$:0,$0:d.CreateKeyValue(this.Key,bo)});bp.resume();},get_Clone:function(){return k.New(G.UniqueKey(),this.Name,this.Type);}},null,k);k.CreateString=function(bo,bp){return k.Create(bo,bp,j.StringOutPort);};k.CreateNumber=function(bo,bp){return k.Create(bo,bp,j.NumberOutPort);};k.Create=function(bo,bp,bq){return k.New(bo,bp,bq);};k.New=function(bo,bp,bq){return new k({Key:bo,Name:bp,Type:bq});};l.Create=function(bo){var bp;bp=function(bq,br){var bs;bs=br.Value;return bs.$==1?i.Create(br.Key,bq,{$:1,$0:Q.Create$1(bs.$0)}):i.Create(br.Key,bq,{$:0,$0:Q.Create$1(bs.$0)});};return M.map(function(bq){return bp(bq[0],bq[1]);},bo);};m=c.Worker=I.Class({Equals:function(bo){return bo instanceof m&&U.Equals(this.Name,bo.Name);},get_Properties:function(){return new M.T({$:1,$0:S.string("Name",this.Name),$1:M.map(function(bo){return bo.get_Property();},this.InPorts)});},get_Render:function(){var bo;bo=this.Renderer;return bo==null?V.Empty():(bo.$0.WebSharper_Community_Dashboard_IRenderer$get_Render())(this);},get_CloneAndRun:function(){var bo,bp,bq;bo=Q.Create$1(this.Name.c);bp=M.map(function(br){return br.get_Clone();},this.InPorts);bq=M.map(function(br){return br.get_Clone();},this.OutPorts);return m.New(G.UniqueKey(),bo,bp,bq,this.Runner,this.Renderer,this.DataContext,null).WithStartRunner();},WithStartRunner:function(){var bo;bo=this.Runner;return bo==null?this:m.New(this.Key,this.Name,this.InPorts,this.OutPorts,this.Runner,this.Renderer,this.DataContext,(bo.$0.WebSharper_Community_Dashboard_IRunner$get_Run())(this));},WithRenderer:function(bo){return m.New(this.Key,this.Name,this.InPorts,this.OutPorts,this.Runner,{$:1,$0:bo},this.DataContext,this.RunnerContext);},WithRunner:function(bo){return m.New(this.Key,this.Name,this.InPorts,this.OutPorts,{$:1,$0:bo},this.Renderer,this.DataContext,this.RunnerContext);},WithKey:function(bo){return m.New(bo,this.Name,this.InPorts,this.OutPorts,this.Runner,this.Renderer,this.DataContext,this.RunnerContext);}},null,m);m.Create=function(bo){return m.New(G.UniqueKey(),Q.Create$1(bo.WebSharper_Community_Dashboard_IWorkerContext$get_Name()),bo.WebSharper_Community_Dashboard_IWorkerContext$get_InPorts(),bo.WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts(),null,null,bo,null);};m.New=function(bo,bp,bq,br,bs,bt,bu,bv){return new m({Key:bo,Name:bp,InPorts:bq,OutPorts:br,Runner:bs,Renderer:bt,DataContext:bu,RunnerContext:bv});};n=c.RandomRunner=I.Class({WithMiddleValue:function(bo){return n.New(this.Name,d.CreateNumber(bo),this.Dispersion,this.OutPortKey);},WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bo){var bp;new W.New();L.Start((bp=null,L.Delay(function(){return L.While(function(){return true;},L.Delay(function(){return L.Bind(L.Sleep(600),function(){var bq,br,bs;bq=bo.InPorts.get_Item(1).get_Number();br=bo.InPorts.get_Item(0).get_Number();bs=X.random()*bq+br;bo.OutPorts.get_Item(0).Trigger({$:0,$0:bs});return L.Zero();});}));})),null);return null;};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return M.ofArray([k.CreateNumber(this.OutPortKey,"Random value")]);},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return l.Create(M.ofArray([["Middle value",this.MiddleValue],["Dispersion",this.Dispersion]]));},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return this.Name;}},null,n);n.get_FromPorts=function(){return function(bo){return n.New(bo.Name.c,bo.InPorts.get_Item(0).get_NumberValue(),bo.InPorts.get_Item(1).get_NumberValue(),bo.OutPorts.get_Item(0).Key);};};n.Create=function(bo,bp){var bq;return n.New("Random",d.CreateNumber(bo),d.CreateNumber(bp),(bq=T.NewGuid(),window.String(bq)));};n.New=function(bo,bp,bq,br){return new n({Name:bo,MiddleValue:bp,Dispersion:bq,OutPortKey:br});};p.New=function(bo,bp,bq,br,bs){return{Title:bo,Description:bp,ImageUrl:bq,Temperature:br,TemparatureMinMax:bs};};o.get=function(bo,bp){var bq;bq=null;return L.Delay(function(){var br;br=(((I.Curried3(function(bs,bt,bu){return bs("http://api.openweathermap.org/data/2.5/weather?q="+Y.toSafe(bt)+"&units=metric&appid="+Y.toSafe(bu));}))(window.id))(bp))(bo);Z.log("get key city "+br);return L.TryWith(L.Delay(function(){return L.Bind(_1.AsyncMap(_5.asyncReadTextAtRuntime(false,"C:\\Users\\Andrey\\Private\\VS_Projects\\WebSharper.Community.Dashboard\\WebSharper.Community.Dashboard","","JSON","",br),function(bs){return U.Equals(typeof bs,"string")?_6.parse(bs):bs;}),function(bs){var bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP;Z.log("get key city 2");return L.Return((bt=_7.tryHead(bs.weather),bt==null?null:{$:1,$0:(bu=bt.$0,p.New((((I.Curried3(function(bQ,bR,bS){return bQ(Y.toSafe(bR)+", "+Y.toSafe(bS));}))(window.id))((bw=(bv="name",bv in bs?{$:1,$0:bs[bv]}:null),bw==null?null:bw.$0)))((bz=(bx=bs.sys,(by="country",by in bx?{$:1,$0:bx[by]}:null)),bz==null?null:bz.$0)),(bB=(bA="main",bA in bu?{$:1,$0:bu[bA]}:null),bB==null?null:bB.$0),(function(bQ){return function(bR){return bQ("http://openweathermap.org/img/w/"+Y.toSafe(bR)+".png");};}(window.id))((bD=(bC="icon",bC in bu?{$:1,$0:bu[bC]}:null),bD==null?null:bD.$0)),(bE=(bF=bs.main,(bG="temp",bG in bF?{$:1,$0:bF[bG]}:null)),(bH=bE==null?null:{$:1,$0:1*bE.$0},bH==null?null:bH.$0)),[(bI=(bJ=bs.main,(bK="temp_min",bK in bJ?{$:1,$0:bJ[bK]}:null)),(bL=bI==null?null:{$:1,$0:1*bI.$0},bL==null?null:bL.$0)),(bM=(bN=bs.main,(bO="temp_max",bO in bN?{$:1,$0:bN[bO]}:null)),(bP=bM==null?null:{$:1,$0:1*bM.$0},bP==null?null:bP.$0))]))}));});}),function(bs){Z.log(bs.message);return L.Return(null);});});};q=c.OpenWeatherRunner=I.Class({WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bo){var bp;L.Start((bp=null,L.Delay(function(){return L.While(function(){return true;},L.Delay(function(){var bq,br,bs;bq=bo.InPorts.get_Item(0);br=bo.InPorts.get_Item(1);bs=bo.OutPorts.get_Item(0);return L.Bind(o.get(br.get_String(),bq.get_String()),function(bt){return L.Combine(bt==null?L.Zero():(Z.log("Value generated:"+bt.$0.Title),bs.Trigger({$:0,$0:+bt.$0.Temperature}),L.Zero()),L.Delay(function(){return L.Bind(L.Sleep(1000*15),function(){return L.Return(null);});}));});}));})),null);return null;};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return M.ofArray([k.CreateNumber(this.OutPortKey,"Temperature")]);},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return l.Create(M.ofArray([["City",this.OpenWeatherCity],["ApiKey",this.OpenWeatherApiKey]]));},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return this.Name;}},null,q);q.get_FromPorts=function(){return function(bo){return q.New(bo.Name.c,bo.InPorts.get_Item(0).get_StringValue(),bo.InPorts.get_Item(1).get_StringValue(),bo.OutPorts.get_Item(0).Key);};};q.Create=function(bo,bp){var bq;return q.New("OpenWeatherMap",d.CreateString(bo),d.CreateString(bp),(bq=T.NewGuid(),window.String(bq)));};q.New=function(bo,bp,bq,br){return new q({Name:bo,OpenWeatherCity:bp,OpenWeatherApiKey:bq,OutPortKey:br});};r.New=function(bo){return{LineChart:bo};};s=c.ChartRenderer=I.Class({WebSharper_Community_Dashboard_IRenderer$get_Render:function(){return function(bo){return _.Render$8(bo.RunnerContext.$0.LineChart,{$:1,$0:{$:0,$0:bo.InPorts.get_Item(1).get_Number()<<0,$1:bo.InPorts.get_Item(2).get_Number()<<0}},null,null);};},WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bo){var bp,bq,br,bs,bt;bp=bo.InPorts.get_Item(3).get_Number()<<0;bq=M.ofSeq($.delay(function(){return $.map(function(){return 0;},N.range(0,bp-1));}));br=(bs=[],($.iter(function(bu){bs.push(bu);},bq),bs));bt=ba.Line(bq).__WithFillColor(new bb.Color({$:2,$0:"white"}));bc.Sink(function(bu){br.push(bu);br.length>bp?br.shift():void 0;$.iteri(function(bv,bw){return bt.__UpdateData(bv,function(){return bw;});},br);},bo.InPorts.get_Item(0).get_NumberVar().v);return{$:1,$0:r.New(bt)};};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return M.T.Empty;},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return l.Create(M.ofArray([["in Value",d.CreateNumber(0)],["cx",this.Cx],["cy",this.Cy],["BufferSize",this.ChartBufferSize]]));},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return"Chart";}},null,s);s.get_FromPorts=function(){return function(bo){return s.New(bo.InPorts.get_Item(1).get_NumberValue(),bo.InPorts.get_Item(1).get_NumberValue(),bo.InPorts.get_Item(2).get_NumberValue(),bo.InPorts.get_Item(3).get_NumberValue());};};s.Create=function(bo,bp,bq){return s.New(d.CreateNumber(0),d.CreateNumber(bo),d.CreateNumber(bp),d.CreateNumber(bq));};s.New=function(bo,bp,bq,br){return new s({Number:bo,Cx:bp,Cy:bq,ChartBufferSize:br});};t=c.TextBoxRenderer=I.Class({WebSharper_Community_Dashboard_IRenderer$get_Render:function(){return function(bo){var bp;bp=bc.Map(function(bq){var br;br=bq<<0;return window.String(br);},bo.InPorts.get_Item(0).get_NumberVar().v);return V.Element("div",[bd.Class("bigvalue")],[V.TextView(bp)]);};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return M.T.Empty;},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return l.Create(M.ofArray([["in Value",this.TextBoxValue]]));},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return"Text";}},null,t);t.get_FromPorts=function(){return function(bo){return t.New(bo.InPorts.get_Item(0).get_NumberValue());};};t.get_Create=function(){return t.New(d.CreateNumber(0));};t.New=function(bo){return new t({TextBoxValue:bo});};u.Create=function(bo){return u.New(be.Fresh(),bo);};u.New=function(bo,bp){return{Key:bo,Worker:bp};};v=c.Factory=I.Class({RegisterEvent:function(bo){this.EventItems.Append(u.Create(bo));},RegisterWidget:function(bo){this.WidgetItems.Append(u.Create(bo));}},null,v);v.get_Create=function(){return v.New(bf.Create(function(bo){return bo.Key;},M.T.Empty),bf.Create(function(bo){return bo.Key;},M.T.Empty));};v.New=function(bo,bp){return new v({EventItems:bo,WidgetItems:bp});};w.Create=function(bo,bp){return w.New(be.Fresh(),bo,bp);};w.New=function(bo,bp,bq){return{Key:bo,Panel:bp,Widget:bq};};x=c.DshData=I.Class({ConnectPorts:function(bo,bp){var bq;Z.log("Connect ports:"+bo.Name+" "+bp.Name);bq=d.Agent();bq.mailbox.AddLast({$:1,$0:[bo.Key,function(br){bp.Receive(br);}]});bq.resume();},RegisterWidget:function(bo,bp,bq){var br;br=bq.WithKey(bo);this.WidgetItems.Append(w.Create(bp,br));this.WorkItems.Append(u.Create(br));},RegisterEvent:function(bo,bp){var bq;bq=u.Create(bp.WithKey(bo));this.EventItems.Append(bq);this.WorkItems.Append(bq);},get_Clear:function(){this.WorkItems.Clear();this.WidgetItems.Clear();this.EventItems.Clear();}},null,x);x.get_Create=function(){return x.New(bf.Create(function(bo){return bo.Key;},M.T.Empty),bf.Create(function(bo){return bo.Key;},M.T.Empty),bf.Create(function(bo){return bo.Key;},M.T.Empty));};x.New=function(bo,bp,bq){return new x({WorkItems:bo,WidgetItems:bp,EventItems:bq});};y=c.DshEditorCellItem=I.Class({Render:function(bo,bp){var bq,br,bs,bt,bu;bq=this;bc.Sink(function(bv){var bw;if(bv==null);else{bw=bv.$0;Z.log("Workitem selected");Q.Set(bq.OptInPort,M.tryHead(bw.Worker.InPorts));Q.Set(bq.OptOutPort,M.tryHead(bw.Worker.OutPorts));bp();}},this.OptWorker.v);bc.Sink(function(){bp();},this.OptInPort.v);bc.Sink(function(){bp();},this.OptOutPort.v);br=(bs=bc.Map(function(bv){var bw;return bv==null?M.ofArray([null]):(bw=M.map(function(bx){return{$:1,$0:bx};},bv.$0.Worker.InPorts),bw.get_Length()>0?bw:M.ofArray([null]));},this.OptWorker.v),(bt=bc.Map(function(bv){var bw;return bv==null?M.ofArray([null]):(bw=M.map(function(bx){return{$:1,$0:bx};},bv.$0.Worker.OutPorts),bw.get_Length()>0?bw:M.ofArray([null]));},this.OptWorker.v),(bu=bc.Map(function(bv){return new M.T({$:1,$0:null,$1:M.map(function(bw){return{$:1,$0:bw};},M.ofSeq(bv))});},bo.WorkItems.v),V.Element("table",[],[V.Element("tr",[],[V.Element("td",[],[V.SelectDyn([bd.Class("form-control")],function(bv){return bg.fold(function(bw,bx){return bx.Name;}," ",bv);},bs,this.OptInPort)]),V.Element("td",[],[V.SelectDyn([bd.Class("form-control")],function(bv){return bg.fold(function(bw,bx){return bx.Worker.Name.c;}," ",bv);},bu,this.OptWorker)]),V.Element("td",[],[V.SelectDyn([bd.Class("form-control")],function(bv){return bg.fold(function(bw,bx){return bx.Name;}," ",bv);},bt,this.OptOutPort)])])]))));return V.Element("td",[bd.Class("td DshEditorCell")],[V.Element("div",[bd.Class("div DshEditorCell")],[V.Element("table",[],[V.Element("tr",[],[V.Element("td",[],[G.IconNormal("add",function(){})]),V.Element("td",[],[br])])])])]);}},null,y);y.get_Create=function(){return y.New(be.Fresh(),Q.Create$1(null),Q.Create$1(null),Q.Create$1(null));};y.New=function(bo,bp,bq,br){return new y({Key:bo,OptInPort:bp,OptWorker:bq,OptOutPort:br});};z=c.DshEditorRowItem=I.Class({Render:function(bo,bp){var bq;bq=this;return V.Element("tr",[],[V.ConvertBy(function(br){return br.Key;},function(br){return br.Render(bo,bp);},this.CellItems.v),G.IconNormal("add",function(){bq.CellItems.Append(y.get_Create());})]);}},null,z);z.get_Create=function(){return z.New(be.Fresh(),bf.Create(function(bo){return bo.Key;},M.T.Empty));};z.New=function(bo,bp){return new z({Key:bo,CellItems:bp});};A=c.DshEditor=I.Class({Render:function(bo){var bp;bp=this;return V.Element("table",[],[V.ConvertBy(function(bq){return bq.Key;},function(bq){return V.Element("tr",[],[bq.Render(bo,function(){bp.Reconnect(bo);})]);},this.RowItems.v),V.Element("tr",[],[V.Element("td",[],[G.IconNormal("add",function(){bp.RowItems.Append(z.get_Create());})])])]);},Recreate:function(bo){this.RowItems.Clear();},Restore:function(bo,bp){var bq,br,bs;function bt(bu){return M.concat(M.map(function(bv){return bu(bv.Worker);},M.ofSeq(bo.WorkItems)));}bq=this;this.RowItems.Clear();br=bt(function(bu){return bu.OutPorts;});bs=bt(function(bu){return bu.InPorts;});M.iter(function(bu){var bv;bv=z.get_Create();M.iter(function(bw){var bx;bx=y.get_Create();Q.Set(bx.OptWorker,$.tryFind(function(by){return by.Worker.Key===bw.CellWorkerKey;},M.ofSeq(bo.WorkItems)));Q.Set(bx.OptInPort,$.tryFind(function(by){return by.Key===bw.CellInPortKey;},bs));Q.Set(bx.OptOutPort,$.tryFind(function(by){return by.Key===bw.CellOutPortKey;},br));bv.CellItems.Append(bx);},bu.DshEditorCells);bq.RowItems.Append(bv);},bp.DshEditorRows);this.Reconnect(bo);},Reconnect:function(bo){var bp;bp=d.Agent();bp.mailbox.AddLast(f.Clear);bp.resume();M.iter(function(bq){var br,bs,bt;br=M.ofSeq(bq.CellItems);bs=M.ofSeq(N.range(1,br.get_Length()-1));bt=bh.Get(bs);try{while(bt.MoveNext())(function(){var bu,bv,bw,bx,by;bu=bt.Current();bv=br.get_Item(bu-1);bw=br.get_Item(bu);bx=bv.OptOutPort.c,bx==null?null:{$:1,$0:(by=bw.OptInPort.c,by==null?null:{$:1,$0:bo.ConnectPorts(bx.$0,by.$0)})};}());}finally{if("Dispose"in bt)bt.Dispose();}},M.ofSeq(this.RowItems));}},null,A);A.get_Create=function(){return A.New(bf.Create(function(bo){return bo.Key;},M.T.Empty));};A.New=function(bo){return new A({RowItems:bo});};B.New=function(bo,bp,bq){return{CellInPortKey:bo,CellOutPortKey:bp,CellWorkerKey:bq};};C.New=function(bo){return{DshEditorCells:bo};};D.Create=function(bo){return D.New(M.map(function(bp){return C.New(M.map(function(bq){var br,bs,bt;return B.New((br=bq.OptInPort.c,br==null?"":br.$0.Key),(bs=bq.OptOutPort.c,bs==null?"":bs.$0.Key),(bt=bq.OptWorker.c,bt==null?"":bt.$0.Worker.Key));},M.ofSeq(bp.CellItems)));},M.ofSeq(bo.RowItems)));};D.New=function(bo){return{DshEditorRows:bo};};E=c.Dashboard=I.Class({get_Render:function(){var bo,bp,bq,br,bs,bt,bu;function bv(bw,bx){var by;by=Q.Create$1(bw);return[by,V.Element("div",[bd.DynamicStyle("display",bc.Map(function(bz){return bz?"initial":"none";},by.v))],[bx])];}bo=this;bp=V.Element("table",[],[V.ConvertBy(function(bw){return bw.Key;},function(bw){return V.Element("tr",[],[V.Element("i",G.AttrsClick(function(){bo.PropertyGrid.Edit(bw.Worker.get_Properties());}),[V.TextView(bw.Worker.Name.v)])]);},this.Data.EventItems.v)]);bq=M.ofArray([["Board",bv(true,this.PanelContainer.get_Render())],["Events",bv(false,bp)],["Rules",bv(false,this.Editor.Render(this.Data))]]);br=(bs=function(bw,bx){var by;by=bx[0];return V.Element("tr",[],[V.Element("td",[bd.DynamicStyle("Color",bc.Map(function(bz){return bz?"#FB8C00":"#7D4600";},by.v)),bd.Style("cursor","pointer"),bd.Handler("click",function(){return function(){var bz;bo.PropertyGrid.Edit(M.T.Empty);bz=function(bA,bB){var bC;bC=bB[0];!U.Equals(bC,by)?Q.Set(bC,false):Q.Set(bC,true);};return M.iter(function(bA){return bz(bA[0],bA[1]);},bq);};})],[V.TextNode(bw)])]);},M.map(function(bw){return bs(bw[0],bw[1]);},bq));bt=(bu=function(bw,bx){return bx[1];},M.map(function(bw){return bu(bw[0],bw[1]);},bq));return V.Element("div",[],[V.Element("table",[],[V.Element("tr",[],[V.Element("td",[bd.Style("vertical-align","top")],[V.Element("table",[],$.concat([M.ofArray([V.Element("tr",[],[V.Element("td",[],[G.IconNormal("dehaze",function(){})])]),V.Element("tr",[],[V.Element("td",[],[G.IconNormal("add",function(){var bw,bx,by;bw=(bq.get_Item(0))[1][0];(bq.get_Item(1))[1][0].c?(bx=M.ofSeq(bo.Factory.EventItems),by=Q.Create$1(M.head(bx)),bo.Dialog.ShowDialog("Select source",V.Element("div",[],[V.Select([bd.Class("form-control")],function(bz){return bz.Worker.Name.c;},bx,by)]),function(){var bz;bz=by.c.Worker.get_CloneAndRun();bo.Data.RegisterEvent(G.UniqueKey(),bz);})):bw.c?bo.CreatePanel("Panel",700,null):void 0;})])]),V.Element("tr",[],[V.Element("td",[],[])]),V.Element("tr",[],[V.Element("td",[],[this.PropertyGrid.get_Render()])])]),br]))]),V.Element("td",[],bt)])]),V.Element("div",[],[this.Dialog.get_Render()])]);},Restore:function(bo,bp,bq,br){var bs,bt,bu;bs=this;this.PanelContainer.PanelItems.Clear();this.Data.get_Clear();M.iter(function(bv){var bw;bw=bs.CreatePanel("Panel",700,{$:1,$0:bv.Key});Q.Set(bw.Left,bv.Left);Q.Set(bw.Top,bv.Top);},bo);bt=function(bv,bw){bs.Data.RegisterEvent(bv,bw.WithStartRunner());};M.iter(function(bv){return bt(bv[0],bv[1]);},bp);Z.log("Events restored");bu=function(bv,bw,bx){bs.RegisterWidget(bv,bw,$.find(function(by){return by.Key===bw;},M.ofSeq(bs.PanelContainer.PanelItems)).Children,bx.WithStartRunner());};M.iter(function(bv){return bu(bv[0],bv[1],bv[2]);},bq);Z.log("Widgets restored");this.Editor.Restore(this.Data,br);Z.log("Connectors restored");M.iter(function(bv){var bw;bw=bv.Worker.Runner;bw==null?void 0:(bw.$0.WebSharper_Community_Dashboard_IRunner$get_Run())(bv.Worker);},M.ofSeq(this.Data.WorkItems));},CreatePanel:function(bo,bp,bq){var br,bs,bt,bu,bv,bw;br=this;V.ConvertBy(this.Data.WidgetItems.key,function(bx){return V.Element("div",[],[V.TextView(bx.Widget.Name.v)]);},this.Data.WidgetItems.v);bs=(bt=(bu=T.NewGuid(),window.String(bu)),bq==null?bt:bq.$0);bv=bi.get_Create().WithLayoutManager(bj.StackPanelLayoutManager()).WithAttributes([bd.Style("border","1px solid white"),bd.Style("display","flex")]);bw=bk.get_Create().WithKey(bs).WithPannelAttrs([bd.Style("Width",window.String(bp)+"px"),bd.Style("position","absolute")]).WithTitleContent(V.TextNode(bo)).WithTitleButtons(M.ofArray([bl.New("add",function(bx){var by,bz;by=M.ofSeq(br.Factory.WidgetItems);bz=Q.Create$1(M.head(by));br.Dialog.ShowDialog("Select widget",V.Element("div",[],[V.Select([bd.Class("form-control")],function(bA){return bA.Worker.Name.c;},by,bz)]),function(){Z.log("Dialog.IsOK");br.RegisterWidget(G.UniqueKey(),bx.Key,bx.Children,bz.c.Worker.get_CloneAndRun());});}),bl.New("edit",function(bx){Z.log("Edit");bx.EditProperties(br.PropertyGrid);}),bl.New("clear",function(bx){br.PanelContainer.PanelItems.Remove(br.PanelContainer.FindPanelItem(bx));})])).WithChildPanelContainer(bv);this.PanelContainer.AddPanel(bw);return bw;},RegisterWidget:function(bo,bp,bq,br){this.Data.RegisterWidget(bo,bp,br);bq.AddPanel(bk.get_Create().WithTitle(false).WithPanelContent(br.get_Render()));}},null,E);E.Create=function(bo){var bp;bp=bm.get_Create();return E.New(v.get_Create(),x.get_Create(),bo,A.get_Create(),bn.get_Create(),bp);};E.New=function(bo,bp,bq,br,bs,bt){return new E({Factory:bo,Data:bp,PanelContainer:bq,Editor:br,PropertyGrid:bs,Dialog:bt});};}());
