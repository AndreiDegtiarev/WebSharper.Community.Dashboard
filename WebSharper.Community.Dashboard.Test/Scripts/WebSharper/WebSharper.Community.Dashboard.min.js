(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Community=b.Community||{};d=c.Dashboard=c.Dashboard||{};e=d.IInPortNumber=d.IInPortNumber||{};f=d.IOutPortNumber=d.IOutPortNumber||{};g=d.Sources=d.Sources||{};h=d.SrcOpenWeather=d.SrcOpenWeather||{};i=h.Forecast=h.Forecast||{};j=d.Widgets=d.Widgets||{};k=d.SourceItem=d.SourceItem||{};l=d.ReceiverItem=d.ReceiverItem||{};m=d.Factory=d.Factory||{};n=d.Dashboard=d.Dashboard||{};o=a.IntelliFactory;p=o&&o.Runtime;q=b&&b.Control;r=q&&q.FSharpEvent;s=b&&b.UI;t=s&&s.Next;u=t&&t.Var;v=b&&b.Random;w=b&&b.Concurrency;x=b&&b.List;y=c&&c.PropertyGrid;z=y&&y.Properties;A=b&&b.PrintfHelpers;B=b&&b.Data;C=B&&B.TxtRuntime;D=a.FSharp;E=D&&D.Data;F=E&&E.Runtime;G=F&&F.IO;H=b&&b.Unchecked;I=b&&b.Arrays;J=b&&b.Seq;K=b&&b.Operators;L=b&&b.Charting;M=L&&L.Chart;N=L&&L.Pervasives;O=L&&L.Renderers;P=O&&O.ChartJs;Q=t&&t.AttrProxy;R=t&&t.Doc;S=t&&t.Key;T=t&&t.ListModel;U=t&&t.AttrModule;V=t&&t.View;W=c&&c.Panel;X=W&&W.PanelContainer;Y=W&&W.LayoutManagers;Z=W&&W.Panel;_0=W&&W.TitleButton;_1=y&&y.PropertyGrid;_2=W&&W.Dialog;e=d.IInPortNumber=p.Class({Disconnect:function(){this.Disconnector();this.Disconnector=function(){};},RegisterDisconnector:function(_3){this.Disconnector=_3;},get_Callback:function(){return this.callback;},WebSharper_Community_Dashboard_IInPort$get_Name:function(){return this.name;}},null,e);e.New=p.Ctor(function(_3,_4){this.name=_3;this.callback=_4;this.Disconnector=function(){};},e);f=d.IOutPortNumber=p.Class({Trigger:function(_3){this.event.event.Trigger(_3);},WebSharper_Community_Dashboard_IOutPort$Connect:function(_3){var _4,_5;_4=this;_3.Disconnect();_5=function(_6,_7){return(_3.get_Callback())(_7);};this.event.event.AddHandler(_5);_3.RegisterDisconnector(function(){_4.event.event.RemoveHandler(_5);});},WebSharper_Community_Dashboard_IOutPort$IsCompatible:function(_3){return _3 instanceof e;},WebSharper_Community_Dashboard_IOutPort$get_Name:function(){return this.name;}},null,f);f.New=p.Ctor(function(_3){this.name=_3;this.event=new r.New();},f);g.RandomValueSource=function(_3,_4){var _5,_6,_7;_5=new f.New("Random value");_6=u.Create$1(100);_7=u.Create$1(0.1);return{WebSharper_Community_Dashboard_ISource$Run:function(){var _8;_8=new v.New();return w.Start(w.Delay(function(){return w.While(function(){return true;},w.Delay(function(){return w.Bind(w.Sleep(600),function(){var _9;_9=a.Math.random()*_7.c+_6.c;_5.Trigger(_9);return w.Return(null);});}));}),null);},WebSharper_Community_Dashboard_ISource$get_Properties:function(){return x.ofArray([z["double"]("Middle value",_6),z["double"]("Dispersion value",_7)]);},WebSharper_Community_Dashboard_ISource$get_OutPorts:function(){return x.ofArray([_5]);},WebSharper_Community_Dashboard_ISource$get_Name:function(){return u.Create$1("Random");}};};i.New=function(_3,_4,_5,_6,_7){return{Title:_3,Description:_4,ImageUrl:_5,Temperature:_6,TemparatureMinMax:_7};};h.Create=function(_3){var _4,_5,_6;_4=new f.New("Temperature");_5=u.Create$1("");_6=u.Create$1("London");return{WebSharper_Community_Dashboard_ISource$Run:function(){var _7;_7=new v.New();return w.Start(w.Delay(function(){return w.While(function(){return true;},w.Delay(function(){var _8;_8=h.get(_5.c,_6.c);return w.Bind(_8,function(_9){var _;_="Value generated:"+_9.$0.Title;a.console.log(_);_4.Trigger(+_9.$0.Temperature);return w.Bind(w.Sleep(1000*15),function(){return w.Return(null);});});}));}),null);},WebSharper_Community_Dashboard_ISource$get_Properties:function(){return x.ofArray([z.string("ApiKey",_5),z.string("City",_6)]);},WebSharper_Community_Dashboard_ISource$get_OutPorts:function(){return x.ofArray([_4]);},WebSharper_Community_Dashboard_ISource$get_Name:function(){return u.Create$1("OpenWeatherMap");}};};h.get=function(_3,_4){return w.Delay(function(){var _5,_6,_7;_5=((_6=function(_8,_9,_){return _8("http://api.openweathermap.org/data/2.5/weather?q="+A.toSafe(_9)+"&units=metric&appid="+A.toSafe(_));},(p.Curried3(_6))(a.id))(_4))(_3);a.console.log("get key city "+_5);_7=C.AsyncMap(G.asyncReadTextAtRuntime(false,"C:\\Users\\Andrey\\Private\\VS_Projects\\WebSharper.Community.Dashboard\\WebSharper.Community.Dashboard","","JSON","",_5),function(_8){return H.Equals(typeof _8,"string")?a.JSON.parse(_8):_8;});return w.Bind(_7,function(_8){var _9;a.console.log("get key city 2");return w.Return((_9=function(_){var $,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv;return i.New((($=function(bw,bx,by){return bw(A.toSafe(bx)+", "+A.toSafe(by));},(p.Curried3($))(a.id))((ba=(bb="name",bb in _8?{$:1,$0:_8[bb]}:null),ba==null?null:ba.$0)))((bc=_8.sys,(bd=(be="country",be in bc?{$:1,$0:bc[be]}:null),bd==null?null:bd.$0))),(bf=(bg="main",bg in _?{$:1,$0:_[bg]}:null),bf==null?null:bf.$0),(bh=function(bw,bx){return bw("http://openweathermap.org/img/w/"+A.toSafe(bx)+".png");},(function(bw){return function(bx){return bh(bw,bx);};}(a.id))((bi=(bj="icon",bj in _?{$:1,$0:_[bj]}:null),bi==null?null:bi.$0))),(bk=_8.main,(bl=(bm="temp",bm in bk?{$:1,$0:bk[bm]}:null),(bn=bl==null?null:{$:1,$0:1*bl.$0},bn==null?null:bn.$0))),[(bo=_8.main,(bp=(bq="temp_min",bq in bo?{$:1,$0:bo[bq]}:null),(br=bp==null?null:{$:1,$0:1*bp.$0},br==null?null:br.$0))),(bs=_8.main,(bt=(bu="temp_max",bu in bs?{$:1,$0:bs[bu]}:null),(bv=bt==null?null:{$:1,$0:1*bt.$0},bv==null?null:bv.$0)))]);},function(_){return _==null?null:{$:1,$0:_9(_.$0)};}(I.tryHead(_8.weather))));});});};j.chart=function(_3,_4,_5){var _6,_7,_8,_9,_,$;_6=x.ofSeq(J.delay(function(){return J.map(function(){return 0;},K.range(0,_5-1));}));_7=(_8=[],(_9=function(ba){_8.push(ba);},function(ba){J.iter(_9,ba);}(_6),_8));_=M.Line(_6).__WithFillColor(new N.Color({$:2,$0:"white"}));$=new e.New("in Value",function(ba){var bb,bc;_7.push(ba);_7.length>_5?bb=_7.shift():void 0;bc=function(bd,be){return _.__UpdateData(bd,function(){return be;});};(function(bd){J.iteri(bc,bd);}(_7));});return{WebSharper_Community_Dashboard_IReceiver$get_Properties:function(){return x.T.Empty;},WebSharper_Community_Dashboard_IReceiver$Render:function(){return P.Render$8(_,{$:1,$0:{$:0,$0:_3,$1:_4}},null,null);},WebSharper_Community_Dashboard_IReceiver$get_InPorts:function(){return x.ofArray([$]);},WebSharper_Community_Dashboard_IReceiver$get_Name:function(){return u.Create$1("Chart");}};};j.text=function(){var _3,_4;_3=u.Create$1("");_4=new e.New("in Value",function(_5){var _6,_7;_6=(_7=_5<<0,a.String(_7));u.Set(_3,_6);});return{WebSharper_Community_Dashboard_IReceiver$get_Properties:function(){return x.T.Empty;},WebSharper_Community_Dashboard_IReceiver$Render:function(){var _5,_6;_5=[Q.Create("class","bigvalue")];_6=[R.TextView(_3.v)];return R.Element("div",_5,_6);},WebSharper_Community_Dashboard_IReceiver$get_InPorts:function(){return x.ofArray([_4]);},WebSharper_Community_Dashboard_IReceiver$get_Name:function(){return u.Create$1("Text");}};};k.Create=function(_3){return k.New(S.Fresh(),_3);};k.New=function(_3,_4){return{Key:_3,Source:_4};};l.Create=function(_3){return l.New(S.Fresh(),_3);};l.New=function(_3,_4){return{Key:_3,Receiver:_4};};m=d.Factory=p.Class({RegisterSource:function(_3){this.SourceItems.Append(k.Create(_3));},RegisterReceiver:function(_3){this.ReceiverItems.Append(l.Create(_3));}},null,m);m.get_Create=function(){var _3,_4;return m.New((_3=x.T.Empty,T.Create(function(_5){return _5.Key;},_3)),(_4=x.T.Empty,T.Create(function(_5){return _5.Key;},_4)));};m.New=function(_3,_4){return new m({SourceItems:_3,ReceiverItems:_4});};n=d.Dashboard=p.Class({get_Render:function(){var _3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp;function bq(bs,bt){var bu,bv;bu=new x.T({$:1,$0:U.Class("material-icons orange600"),$1:_4(bt)});bv=[R.TextNode(bs)];return R.Element("i",bu,bv);}function br(bs,bt){var bu,bv,bw;bu=u.Create$1(bs);return[bu,(bv=[U.DynamicStyle("display",(bw=bu.v,V.Map(function(bx){return bx?"initial":"none";},bw)))],R.Element("div",bv,[bt]))];}_3=this;_4=function(bs){return x.ofArray([U.Style("Color","#FB8C00"),U.Style("cursor","pointer"),U.Handler("click",function(){return function(){return bs();};})]);};_5=(_6=[(_7=function(bs){return bs.Key;},(_8=function(bs){var bt,bu,bv;bt=[(bu=_4(function(){_3.PropertyGrid.Edit(bs.Source.WebSharper_Community_Dashboard_ISource$get_Properties());}),(bv=[R.TextNode(bs.Source.WebSharper_Community_Dashboard_ISource$get_Name().c)],R.Element("i",bu,bv)))];return R.Element("tr",[],bt);},function(bs){return R.ConvertBy(_7,_8,bs);})(this.SourceItems.v))],R.Element("table",[],_6));_9=x.ofArray([["Board",br(true,this.PanelContainer.get_Render())],["Sources",br(false,_5)]]);_=($=function(bs,bt){var bu,bv,bw,bx,by;bu=bt[0];bv=[(bw=[U.DynamicStyle("Color",(bx=bu.v,V.Map(function(bz){return bz?"#FB8C00":"#7D4600";},bx))),U.Style("cursor","pointer"),U.Handler("click",function(){return function(){var bz;bz=function(bA,bB){var bC;bC=bB[0];!H.Equals(bC,bu)?u.Set(bC,false):u.Set(bC,true);};return function(bA){x.iter(function(bB){return bz(bB[0],bB[1]);},bA);}(_9);};})],(by=[R.TextNode(bs)],R.Element("td",bw,by)))];return R.Element("tr",[],bv);},function(bs){return x.map(function(bt){return $(bt[0],bt[1]);},bs);}(_9));ba=(bb=function(bs,bt){return bt[1];},function(bs){return x.map(function(bt){return bb(bt[0],bt[1]);},bs);}(_9));bc=[(bd=[(be=[(bf=[U.Style("vertical-align","top")],(bg=[(bh=J.concat([x.ofArray([(bi=[(bj=[bq("dehaze",function(){})],R.Element("td",[],bj))],R.Element("tr",[],bi)),(bk=[(bl=[bq("add",function(){var bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC;bs=_9.get_Item(0);bt=bs[1][0];bu=_9.get_Item(1);bv=bu[1][0];bv.c?(bw=x.ofSeq(_3.Factory.SourceItems),bx=u.Create$1(x.head(bw)),by=_3.Dialog,bz=(bA=[(bB=[U.Class("form-control")],R.Select(bB,function(bD){return bD.Source.WebSharper_Community_Dashboard_ISource$get_Name().c;},bw,bx))],R.Element("div",[],bA)),by.ShowDialog("Select source",bz,function(){bx.c.Source.WebSharper_Community_Dashboard_ISource$Run();_3.RegisterSource(bx.c.Source);})):bt.c?bC=_3.CreatePanel("Panel",700,{$:1,$0:function(){}}):void 0;})],R.Element("td",[],bl))],R.Element("tr",[],bk)),(bm=[R.Element("td",[],[])],R.Element("tr",[],bm)),(bn=[(bo=[this.PropertyGrid.get_Render()],R.Element("td",[],bo))],R.Element("tr",[],bn))]),_]),R.Element("table",[],bh))],R.Element("td",bf,bg))),R.Element("td",[],ba)],R.Element("tr",[],be))],R.Element("table",[],bd)),(bp=[this.Dialog.get_Render()],R.Element("div",[],bp))];return R.Element("div",[],bc);},CreatePanel:function(_3,_4,_5){var _6,_7,_8,_9,_;_6=this;_7=(_8=this.Factory.ReceiverItems.v,(_9=this.ReceiverItems.key,R.ConvertBy(_9,function($){var ba;ba=[R.TextView($.Receiver.WebSharper_Community_Dashboard_IReceiver$get_Name().v)];return R.Element("div",[],ba);},_8)));_=X.get_Create().WithLayoutManager(Y.StackPanelLayoutManager()).WithAttributes([U.Style("border","1px solid white"),U.Style("display","flex")]);this.PanelContainer.AddPanel(Z.get_Create().WithPannelAttrs([U.Style("Width",a.String(_4)+"px"),U.Style("position","absolute")]).WithTitleContent(R.TextNode(_3)).WithTitleButtons(x.ofArray([_0.New("add",function($){var ba,bb,bc,bd,be,bf;ba=x.ofSeq(_6.Factory.ReceiverItems);bb=u.Create$1(x.head(ba));bc=_6.Dialog;bd=(be=[(bf=[U.Class("form-control")],R.Select(bf,function(bg){return bg.Receiver.WebSharper_Community_Dashboard_IReceiver$get_Name().c;},ba,bb))],R.Element("div",[],be));bc.ShowDialog("Select widget",bd,function(){a.console.log("Dialog.IsOK");_6.RegisterReceiver($.Children,bb.c.Receiver);});}),_0.New("edit",function($){a.console.log("Edit");$.EditProperties(_6.PropertyGrid);}),_0.New("clear",function($){_6.PanelContainer.PanelItems.Remove(_6.PanelContainer.FindPanelItem($));})])).WithChildPanelContainer(_).WithOnAfterRender(K.DefaultArg(_5,function(){})));return _;},RegisterReceiver:function(_3,_4){var _5,_6,_7,_8,_9;this.ReceiverItems.Append(l.Create(_4));_3.AddPanel(Z.get_Create().WithTitle(false).WithPanelContent(_4.WebSharper_Community_Dashboard_IReceiver$Render()).WithProperties((_5=x.concat((_6=function(_){var $;$=function(ba){return[_,ba];};return function(ba){return x.map($,ba);}(_.Source.WebSharper_Community_Dashboard_ISource$get_OutPorts());},function(_){return x.map(_6,_);}(x.ofSeq(this.SourceItems)))),(_7=u.Create$1(x.head(_5)),(_8=function(_,$){var ba;ba=_.Source.WebSharper_Community_Dashboard_ISource$get_Name().c;a.console.log(ba);$.WebSharper_Community_Dashboard_IOutPort$Connect(_4.WebSharper_Community_Dashboard_IReceiver$get_InPorts().get_Item(0));},(_9=_7.v,V.Sink(function(_){return _8(_[0],_[1]);},_9),new x.T({$:1,$0:z.select("Source",function(_){var $;$=_[1];return _[0].Source.WebSharper_Community_Dashboard_ISource$get_Name().c+"\\"+$.WebSharper_Community_Dashboard_IOutPort$get_Name();},_5,_7),$1:_4.WebSharper_Community_Dashboard_IReceiver$get_Properties()})))))));},RegisterSource:function(_3){this.SourceItems.Append(k.Create(_3));_3.WebSharper_Community_Dashboard_ISource$Run();}},null,n);n.Create=function(_3){var _4,_5;return n.New(m.get_Create(),(_4=x.T.Empty,T.Create(function(_6){return _6.Key;},_4)),(_5=x.T.Empty,T.Create(function(_6){return _6.Key;},_5)),_3,_1.get_Create(),_2.get_Create());};n.New=function(_3,_4,_5,_6,_7,_8){return new n({Factory:_3,SourceItems:_4,ReceiverItems:_5,PanelContainer:_6,PropertyGrid:_7,Dialog:_8});};}());
