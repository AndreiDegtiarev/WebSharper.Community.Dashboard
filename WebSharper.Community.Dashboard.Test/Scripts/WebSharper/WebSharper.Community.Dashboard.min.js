(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Community=b.Community||{};d=c.Dashboard=c.Dashboard||{};e=d.Environment=d.Environment||{};f=e.Role=e.Role||{};g=a.StartupCode$WebSharper_Community_Dashboard$Environment=a.StartupCode$WebSharper_Community_Dashboard$Environment||{};h=d.MessageBus=d.MessageBus||{};i=h.Value=h.Value||{};j=h.Message=h.Message||{};k=h.ListenerInfo=h.ListenerInfo||{};l=h.SystemStatus=h.SystemStatus||{};m=h.AgentMessage=h.AgentMessage||{};n=h.AgentState=h.AgentState||{};o=a.StartupCode$WebSharper_Community_Dashboard$MessageBus=a.StartupCode$WebSharper_Community_Dashboard$MessageBus||{};p=d.InPortData=d.InPortData||{};q=d.InPort=d.InPort||{};r=d.OutPort=d.OutPort||{};s=d.WorkerData=d.WorkerData||{};t=d.Worker=d.Worker||{};u=d.Workers=d.Workers||{};v=d.RuleEntry=d.RuleEntry||{};w=d.RuleChain=d.RuleChain||{};x=d.RuleContainer=d.RuleContainer||{};y=d.WorkerItem=d.WorkerItem||{};z=d.Factory=d.Factory||{};A=d.RulesCellItem=d.RulesCellItem||{};B=d.RulesRowItem=d.RulesRowItem||{};C=d.SelectorGroup=d.SelectorGroup||{};D=d.WindowSelector=d.WindowSelector||{};E=d.WidgetItem=d.WidgetItem||{};F=d.EventsGroupItem=d.EventsGroupItem||{};G=d.WidgetsGroupItem=d.WidgetsGroupItem||{};H=d.RulesGroupItem=d.RulesGroupItem||{};I=d.DshData=d.DshData||{};J=d.RulesEditor=d.RulesEditor||{};K=d.DshHelper=d.DshHelper||{};L=d.Dashboard=d.Dashboard||{};M=d.Events=d.Events||{};N=M.RandomEvent=M.RandomEvent||{};O=M.DatabaseEventContext=M.DatabaseEventContext||{};P=M.DatabaseEvent=M.DatabaseEvent||{};Q=M.OpenWeather=M.OpenWeather||{};R=Q.Forecast=Q.Forecast||{};S=M.OpenWeatherEvent=M.OpenWeatherEvent||{};T=M.ClockEvent=M.ClockEvent||{};U=d.Widgets=d.Widgets||{};V=U.TextBoxWidget=U.TextBoxWidget||{};W=U.ChartWidgetContext=U.ChartWidgetContext||{};X=U.ChartWidget=U.ChartWidget||{};Y=U.ButtonWidget=U.ButtonWidget||{};Z=d.AppModelLib=d.AppModelLib||{};_0=d.App=d.App||{};_1=a.StartupCode$WebSharper_Community_Dashboard$AppModelLib=a.StartupCode$WebSharper_Community_Dashboard$AppModelLib||{};_2=d.AppDataHelper=d.AppDataHelper||{};_3=d.AppData=d.AppData||{};_4=a.IntelliFactory;_5=_4&&_4.Runtime;_6=b&&b.Operators;_7=c&&c.Panel;_8=_7&&_7.Helper;_9=a.Date;_=b&&b.List;$=b&&b.Concurrency;ba=b&&b.Remoting;bb=ba&&ba.AjaxRemotingProvider;bc=b&&b.Utils;bd=b&&b.Control;be=bd&&bd.MailboxProcessor;bf=b&&b.Seq;bg=b&&b.UI;bh=bg&&bg.Next;bi=bh&&bh.View;bj=bh&&bh.Var;bk=c&&c.PropertyGrid;bl=bk&&bk.Properties;bm=b&&b.MatchFailureException;bn=b&&b.Guid;bo=bh&&bh.Doc;bp=b&&b.Enumerator;bq=bh&&bh.Key;br=bh&&bh.ListModel;bs=bh&&bh.AttrModule;bt=b&&b.Option;bu=b&&b.Unchecked;bv=_7&&_7.WrapControls;bw=a.console;bx=_7&&_7.PanelContainer;by=_7&&_7.LayoutManagers;bz=_7&&_7.Panel;bA=_7&&_7.TitleButton;bB=_7&&_7.Dialog;bC=bk&&bk.PropertyGrid;bD=b&&b.Random;bE=a.Math;bF=b&&b.Data;bG=bF&&bF.TxtRuntime;bH=a.FSharp;bI=bH&&bH.Data;bJ=bI&&bI.Runtime;bK=bJ&&bJ.IO;bL=a.JSON;bM=b&&b.Arrays;bN=b&&b.DateUtil;bO=b&&b.Charting;bP=bO&&bO.Renderers;bQ=bP&&bP.ChartJs;bR=bd&&bd.FSharpEvent;bS=bO&&bO.LiveChart;bT=bO&&bO.Pervasives;f.Server={$:1};f.Client={$:0};e.UpdateConfiguration=function(){g.$cctor();return g.UpdateConfiguration;};e.set_UpdateConfiguration=function(bU){g.$cctor();g.UpdateConfiguration=bU;};e.DataDirectory=function(){g.$cctor();return g.DataDirectory;};e.set_DataDirectory=function(bU){g.$cctor();g.DataDirectory=bU;};e.Log=function(){g.$cctor();return g.Log;};e.set_Log=function(bU){g.$cctor();g.Log=bU;};e.Role$1=function(){g.$cctor();return g.Role;};e.set_Role=function(bU){g.$cctor();g.Role=bU;};g.$cctor=_5.Cctor(function(){g.Role=f.Server;g.Log=a.ignore;g.DataDirectory="";g.UpdateConfiguration=a.ignore;g.$cctor=a.ignore;});i=h.Value=_5.Class({get_trySystem:function(){return this.$==4?{$:1,$0:this.$0}:null;},get_AsSelect:function(){return this.$==3?this.$0:_6.FailWith("MessageBus.Value: unexpected type");},get_AsBoolean:function(){return this.$==2?this.$0:_6.FailWith("MessageBus.Value: unexpected type");},get_AsString:function(){return this.$==1?this.$0:_6.FailWith("MessageBus.Value: unexpected type");},get_AsNumber:function(){return this.$==0?this.$0:_6.FailWith("MessageBus.Value: unexpected type");}},null,i);j=h.Message=_5.Class({WithTime:function(bU){return j.New(this.Key,bU,this.Value);},WithKey:function(bU){return j.New(bU,this.Time,this.Value);}},null,j);j.Create=function(bU){return j.New(_8.UniqueKey(),_9.now(),bU);};j.New=function(bU,bV,bW){return new j({Key:bU,Time:bV,Value:bW});};k.Create=function(bU,bV,bW){return k.New(bU,bV,bW);};k.New=function(bU,bV,bW){return{Key:bU,Name:bV,CacheSize:bW};};l.Running={$:1};l.Inactive={$:0};m.Start={$:5};m.Stop={$:4};n.get_initListeners=function(){return _.ofArray([[k.Create("system","Configuration",1),function(bU){var bV;bV=bU.Value.get_trySystem();bV==null?void 0:(e.UpdateConfiguration())(bV.$0.$0);},_.T.Empty]]);};n.get_empty=function(){return n.New(l.Inactive,null,n.get_initListeners(),(new _9(1,1-1,1)).getTime());};n.New=function(bU,bV,bW,bX){return{SystemStatus:bU,ServerCallback:bV,Listeners:bW,LastConfigurationTime:bX};};h.RunServerRequests=function(){var bU;$.Start((bU=null,$.Delay(function(){return $.While(function(){return true;},$.Delay(function(){return $.Bind($.Sleep(2*1000),function(){return $.Bind(h.Agent().PostAndAsyncReply(function(bV){return{$:8,$0:bV};},null),function(bV){return $.TryWith($.Delay(function(){return $.Bind((new bb.New()).Async("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.MessageBus.GetMessages:1550733476",[bV]),function(bW){var bX;_.iter(function(bY){var bZ;bZ=h.Agent();bZ.mailbox.AddLast({$:1,$0:bY});bZ.resume();},bW);return bW.get_Length()>0?(_.iter(function(bY){var bZ;bZ=(((_5.Curried3(function(b0,b1,b2){return b0(bc.toSafe(b1)+" "+bc.toSafe(b2));}))(a.id))(bY.Key))(a.String(bY.Time));(h.log())(bZ);},bW),bX=(function(bY){return function(bZ){return bY("Values from server requested messages received:"+a.String(bZ));};}(a.id))(bW.get_Length()),(h.log())(bX),$.Zero()):$.Zero();});}),function(){return $.Zero();});});});}));})),null);};h.Agent=function(){o.$cctor();return o.Agent;};h.CreateMessage=function(bU){return j.New(_8.UniqueKey(),_9.now(),bU);};h.log=function(){o.$cctor();return o.log;};o.$cctor=_5.Cctor(function(){o.log=e.Log();o.Agent=be.Start(function(bU){function bV(b0,b1){return bf.fold(function(b2,b3){var b4;return(b4=b3.Time-b0,b4/1000)>0.01?new _.T({$:1,$0:b3,$1:b2}):b2;},_.T.Empty,b1);}function bW(b0,b1){return b0<b1.get_Length()?(_.splitAt(b0,b1))[0]:b1;}function bX(b0,b1,b2){return b0===1?_.ofArray([b2]):bW(b0,new _.T({$:1,$0:b2,$1:b1}));}function bY(b0,b1){function b2(b3,b4,b5){var b6,b7;b6=a.Array.prototype.slice.call(arguments);if(b3.Key===b0.Key){try{b4(b0);}catch(b8){b7=(function(b9){return function(b_){return b9("Fails send message. It might be that receiver doesn't expect message of this type: "+bc.toSafe(b_));};}(a.id))(b3.Name);(h.log())(b7);}return[b3,b4,bX(b3.CacheSize,b5,b0)];}else return b6;}return _.map(function(b3){return b2(b3[0],b3[1],b3[2]);},b1);}function bZ(b0){var b1;b1=null;return $.Delay(function(){return $.Bind(bU.Receive(null),function(b2){var b3,b4,b5,b6,b7,b8,b9,b_;function b$(cb,cc,cd){return bV(b5,cd);}function ca(cb,cc,cd){return cd.$==0?b0.LastConfigurationTime:_.maxBy(function(ce){return ce.Time;},cd).Time;}return b2.$==5?bZ(n.New(l.Running,b0.ServerCallback,b0.Listeners,b0.LastConfigurationTime)):b2.$==6?(b2.$0(b0.SystemStatus),bZ(b0)):b2.$==2?(b3=b2.$0[0],(b4=(((_5.Curried3(function(cb,cc,cd){return cb("RegisterListener:"+bc.toSafe(cc)+" "+bc.toSafe(cd));}))(a.id))(b3.Name))(b3.Key),(h.log())(b4),bZ(n.New(b0.SystemStatus,b0.ServerCallback,new _.T({$:1,$0:[b3,b2.$0[2],_.T.Empty],$1:b0.Listeners}),b0.LastConfigurationTime)))):b2.$==3?bZ(n.New(b0.SystemStatus,{$:1,$0:b2.$0},b0.Listeners,b0.LastConfigurationTime)):b2.$==7?(b5=b2.$0[0],(b2.$0[1](_.sortBy(function(cb){return cb.Time;},bf.fold(function(cb,cc){return!_.contains(cc,cb)?new _.T({$:1,$0:cc,$1:cb}):cb;},_.T.Empty,_.concat(_.map(function(cb){return b$(cb[0],cb[1],cb[2]);},b0.Listeners))))),bZ(b0))):b2.$==8?(b6=_.map(function(cb){return ca(cb[0],cb[1],cb[2]);},b0.Listeners),(b2.$0(b6.$==0?b0.LastConfigurationTime:_.max(b6)),bZ(b0))):b2.$==1?(b7=b2.$0,(b8=b7.Value.get_trySystem(),b8==null?bZ(n.New(b0.SystemStatus,b0.ServerCallback,bY(b7,b0.Listeners),b0.LastConfigurationTime)):$.Combine(((e.UpdateConfiguration())(b8.$0.$0),$.Zero()),$.Delay(function(){return bZ(n.New(b0.SystemStatus,b0.ServerCallback,b0.Listeners,b7.Time));})))):b2.$==0?(b9=b2.$0,(b_=b0.ServerCallback,b_==null?void 0:b_.$0(b9),bZ(n.New(b0.SystemStatus,b0.ServerCallback,bY(b9,b0.Listeners),b0.LastConfigurationTime)))):bZ(n.New(l.Inactive,b0.ServerCallback,n.get_initListeners(),b0.LastConfigurationTime));});});}return bZ(n.get_empty());},null);o.$cctor=a.ignore;});p=d.InPortData=_5.Class({WithCacheSize:function(bU){return p.New(this.Key,this.Name,this.Value,bU);}},null,p);p.CreateSelect=function(bU,bV){return p.Create(bU,new i({$:3,$0:bV}));};p.CreateBoolean=function(bU,bV){return p.Create(bU,new i({$:2,$0:bV}));};p.CreateString=function(bU,bV){return p.Create(bU,new i({$:1,$0:bV}));};p.CreateNumber=function(bU,bV){return p.Create(bU,new i({$:0,$0:bV}));};p.Create=function(bU,bV){var bW;bW=h.CreateMessage(bV);return p.New(bW.Key,bU,bW.WithTime((new _9(0,0-1,0)).getTime()),1);};p.New=function(bU,bV,bW,bX){return new p({Key:bU,Name:bV,Value:bW,CacheSize:bX});};q=d.InPort=_5.Class({get_SelectView:function(){return bi.Map(function(bU){return bU.Value.get_AsSelect();},this.PortValue.v);},get_Select:function(){return this.PortValue.c.Value.get_AsSelect();},get_BooleanView:function(){return bi.Map(function(bU){return bU.Value.get_AsBoolean();},this.PortValue.v);},get_Boolean:function(){return this.PortValue.c.Value.get_AsBoolean();},get_StringView:function(){return bi.Map(function(bU){return bU.Value.get_AsString();},this.PortValue.v);},get_String:function(){return this.PortValue.c.Value.get_AsString();},get_NumberView:function(){return bi.Map(function(bU){return bU.Value.get_AsNumber();},this.PortValue.v);},get_Number:function(){return this.PortValue.c.Value.get_AsNumber();},Receive:function(bU){bj.Set(this.PortValue,bU);},get_Property:function(){var bU,bV,bW,bX,bY,bZ,b0;bZ=this;b0=this.PortValue.c.Value;if(b0.$==0){bU=bj.Create$1(this.get_Number());bi.Sink(function(b1){var b2;bj.Set(bZ.PortValue,(b2=bZ.PortValue.c,j.New(b2.Key,b2.Time,new i({$:0,$0:b1}))));},bU.v);return bl["double"](this.Data.Name,bU);}else if(b0.$==1){bV=bj.Create$1(this.get_String());bi.Sink(function(b1){var b2;bj.Set(bZ.PortValue,(b2=bZ.PortValue.c,j.New(b2.Key,b2.Time,new i({$:1,$0:b1}))));},bV.v);return bl.string(this.Data.Name,bV);}else if(b0.$==2){bW=bj.Create$1(this.get_Boolean());bi.Sink(function(b1){var b2;bj.Set(bZ.PortValue,(b2=bZ.PortValue.c,j.New(b2.Key,b2.Time,new i({$:2,$0:b1}))));},bW.v);return bl.check(this.Data.Name,bW);}else if(b0.$==3){bX=b0.$0[1];bY=bj.Create$1(bX.get_Item(b0.$0[0]));bi.Sink(function(b1){var b2;bj.Set(bZ.PortValue,(b2=bZ.PortValue.c,j.New(b2.Key,b2.Time,new i({$:3,$0:[bf.findIndex(function(b3){return b3===b1;},bX),bX]}))));},bY.v);return bl.select(this.Data.Name,a.id,bX,bY);}else throw new bm.New("Port.fs",38,30);},get_Key:function(){return this.Data.Key;},get_Name:function(){return this.Data.Name;}},null,q);q.Clone=function(bU){var bV,bW;return q.New((bV=bU.Data,p.New((bW=bn.NewGuid(),a.String(bW)),bV.Name,bV.Value,bV.CacheSize)),bj.Create$1(bU.PortValue.c));};q.ToData=function(bU){var bV;bV=bU.Data;return p.New(bV.Key,bV.Name,bU.PortValue.c,bV.CacheSize);};q.FromData=function(bU){return q.New(bU,bj.Create$1(bU.Value));};q.New=function(bU,bV){return new q({Data:bU,PortValue:bV});};r=d.OutPort=_5.Class({Trigger:function(bU){var bV,bW;bV={$:0,$0:h.CreateMessage(bU).WithKey(this.Key)};bW=h.Agent();bW.mailbox.AddLast(bV);bW.resume();}},null,r);r.Clone=function(bU){return r.New(_8.UniqueKey(),bU.Name);};r.Create=function(bU){return r.New(_8.UniqueKey(),bU);};r.New=function(bU,bV){return new r({Key:bU,Name:bV});};s.Create=function(bU,bV,bW){return s.New(bU,bV,bW);};s.New=function(bU,bV,bW){return{WorkerName:bU,InPorts:bV,OutPorts:bW};};t=d.Worker=_5.Class({get_Properties:function(){return new _.T({$:1,$0:bl.string("Name",this.Name),$1:_.map(function(bU){return bU.get_Property();},this.InPorts)});},get_Render:function(){var bU;bU=this.Data.WebSharper_Community_Dashboard_IWorkerData$get_Render();return bU==null?bo.Empty():bU.$0(this);},get_Clone:function(){return t.New(_8.UniqueKey(),bj.Create$1(this.Name.c),_.map(q.Clone,this.InPorts),_.map(r.Clone,this.OutPorts),this.Data,bj.Create$1(null));},get_ToData:function(){return s.New(this.Name.c,_.map(q.ToData,this.InPorts),this.OutPorts);},StartRunner:function(){var bU;bU=this.Data.WebSharper_Community_Dashboard_IWorkerData$get_Run();bU==null?void 0:bj.Set(this.RunnerContext,bU.$0(this));},WithKey:function(bU){return t.New(bU,this.Name,this.InPorts,this.OutPorts,this.Data,this.RunnerContext);}},null,t);t.Create=function(bU){return t.New(_8.UniqueKey(),bj.Create$1(bU.WebSharper_Community_Dashboard_IWorkerData$get_Data().WorkerName),_.map(q.FromData,bU.WebSharper_Community_Dashboard_IWorkerData$get_Data().InPorts),bU.WebSharper_Community_Dashboard_IWorkerData$get_Data().OutPorts,bU,bj.Create$1(null));};t.New=function(bU,bV,bW,bX,bY,bZ){return new t({Key:bU,Name:bV,InPorts:bW,OutPorts:bX,Data:bY,RunnerContext:bZ});};u.allInPorts=function(bU){return u.allPorts(bU,function(bV){return bV.InPorts;});};u.allOutPorts=function(bU){return u.allPorts(bU,function(bV){return bV.OutPorts;});};u.allPorts=function(bU,bV){return _.concat(_.map(bV,bU));};v.New=function(bU,bV,bW){return{InPortKey:bU,OutPortKey:bV,WorkerKey:bW};};w.New=function(bU){return{RuleChain:bU};};x=d.RuleContainer=_5.Class({Reconnect:function(bU){var bV,bW,bX;bV=e.Log();bW=u.allOutPorts(bU);bX=u.allInPorts(bU);_.iter(function(bY){var bZ,b0,b1;bZ=_.ofSeq(bY.RuleChain);b0=_.ofSeq(_6.range(1,bZ.get_Length()-1));b1=bp.Get(b0);try{while(b1.MoveNext())(function(){var b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc;b7=b1.Current();b8=bZ.get_Item(b7-1);b9=bZ.get_Item(b7);b_=bf.tryFind(function(cd){return cd.Key===b8.OutPortKey;},bW);if(b_==null)null;else{b$=b_.$0;ca=bf.tryFind(function(cd){return cd.Data.Key===b9.InPortKey;},bX);if(ca==null)b2=null;else{cb=ca.$0;bV("Found inPort");cb.PortValue.c.Key!==cb.Data.Key?bj.Set(cb.PortValue,cb.PortValue.c.WithKey(cb.Data.Key)):null;cc=cb.PortValue.c.Value;if(cc.$==0)b5=j.Create(new i({$:0,$0:0}));else if(cc.$==1)b5=j.Create(new i({$:1,$0:""}));else if(cc.$==2)b5=j.Create(new i({$:2,$0:false}));else if(cc.$==3)b5=j.Create(new i({$:3,$0:[0,_.T.Empty]}));else throw new bm.New("Rules.fs",38,106);b4=(b6=h.Agent(),(b6.mailbox.AddLast({$:2,$0:[k.Create(b$.Key,b$.Name+"->"+cb.get_Name(),cb.Data.CacheSize),b5,function(cd){cb.Receive(cd);}]}),b6.resume()));b2={$:1,$0:b4};}({$:1,$0:b2});}}());}finally{if("Dispose"in b1)b1.Dispose();}},_.ofSeq(this.RuleContainer));}},null,x);x.New=function(bU){return new x({RuleContainer:bU});};y.Create=function(bU){return y.New(bq.Fresh(),bU);};y.New=function(bU,bV){return{Key:bU,Worker:bV};};z=d.Factory=_5.Class({RegisterEvent:function(bU){this.EventItems.Append(y.Create(bU));},RegisterWidget:function(bU){this.WidgetItems.Append(y.Create(bU));}},null,z);z.get_Create=function(){return z.New(br.Create(function(bU){return bU.Key;},_.T.Empty),br.Create(function(bU){return bU.Key;},_.T.Empty));};z.New=function(bU,bV){return new z({EventItems:bU,WidgetItems:bV});};A=d.RulesCellItem=_5.Class({Render:function(bU,bV){var bW,bX,bY,bZ,b0;bW=this;(e.Log())("Render rule item");bi.Sink(function(b1){var b2;if(b1==null);else{b2=b1.$0;bj.Set(bW.OptInPort,_.tryHead(b2.Worker.InPorts));bj.Set(bW.OptOutPort,_.tryHead(b2.Worker.OutPorts));bV();}},this.OptWorker.v);bi.Sink(function(){bV();},this.OptInPort.v);bi.Sink(function(){bV();},this.OptOutPort.v);bX=(bY=bi.Map(function(b1){var b2;return b1==null?_.ofArray([null]):(b2=_.map(function(b3){return{$:1,$0:b3};},b1.$0.Worker.InPorts),b2.get_Length()>0?b2:_.ofArray([null]));},this.OptWorker.v),(bZ=bi.Map(function(b1){var b2;return b1==null?_.ofArray([null]):(b2=_.map(function(b3){return{$:1,$0:b3};},b1.$0.Worker.OutPorts),b2.get_Length()>0?b2:_.ofArray([null]));},this.OptWorker.v),(b0=bi.Map(function(b1){return new _.T({$:1,$0:null,$1:_.map(function(b2){return{$:1,$0:b2};},_.ofSeq(b1))});},bU.v),bo.Element("table",[],[bo.Element("tr",[],[bo.Element("td",[],[bo.SelectDyn([bs.Class("form-control")],function(b1){return bt.fold(function(b2,b3){return b3.get_Name();}," ",b1);},bY,this.OptInPort)]),bo.Element("td",[],[bo.SelectDyn([bs.Class("form-control")],function(b1){return bt.fold(function(b2,b3){return b3.Worker.Name.c;}," ",b1);},b0,this.OptWorker)]),bo.Element("td",[],[bo.SelectDyn([bs.Class("form-control")],function(b1){return bt.fold(function(b2,b3){return b3.Name;}," ",b1);},bZ,this.OptOutPort)])])]))));return bo.Element("td",[bs.Class("td DshEditorCell")],[bo.Element("div",[bs.Class("div DshEditorCell")],[bo.Element("table",[],[bo.Element("tr",[],[bo.Element("td",[],[bX])])])])]);}},null,A);A.get_Create=function(){return A.New(bq.Fresh(),bj.Create$1(null),bj.Create$1(null),bj.Create$1(null));};A.New=function(bU,bV,bW,bX){return new A({Key:bU,OptInPort:bV,OptWorker:bW,OptOutPort:bX});};B=d.RulesRowItem=_5.Class({Render:function(bU,bV){var bW;bW=this;return bo.Element("tr",[],[bo.ConvertBy(function(bX){return bX.Key;},function(bX){return bX.Render(bU,bV);},this.CellItems.v),_8.IconNormal("add",function(){bW.CellItems.Append(A.get_Create());})]);}},null,B);B.Create=function(bU){return B.New(bq.Fresh(),br.Create(function(bV){return bV.Key;},bU));};B.New=function(bU,bV){return new B({Key:bU,CellItems:bV});};C=d.SelectorGroup=_5.Class({RenderMenu:function(bU,bV,bW){var bX,bY,bZ,b0,b1,b2;function b3(b4){return _.ofArray([_8.IconSmall("keyboard_arrow_down",function(){(bY(true))(b4);(bX.ItemOnMove(b4))({$:1});}),_8.IconSmall("keyboard_arrow_up",function(){(bY(false))(b4);(bX.ItemOnMove(b4))({$:0});}),_8.IconSmall("clear",function(){bX.SelectorItems.Remove(b4);bX.ItemOnDelete(b4);})]);}bX=this;bY=(bZ=this.SelectorItems,(_5.Curried3(_8.MoveItemInModelList))(bZ));b0=(b1=this.ItemCreatator,b1==null?bo.Element("tr",[],[]):(b2=b1.$0,bo.Element("tr",[],[bo.Element("td",[],[bo.Element("div",[bs.Style("margin-left","20px")],[_8.IconSmall("add",function(){var b4;b4=b2();bX.ItemOnCreated(b4);bX.SelectorItems.Append(b4);})])])])));return bo.Element("table",[],[bo.ConvertBy(function(b4){return b4.WebSharper_Community_Dashboard_ISelectorItem$get_Key();},function(b4){var b5,b6,b7,b8;b5=bi.Map(function(b9){return bU+b9;},b4.WebSharper_Community_Dashboard_ISelectorItem$get_Name().v);return bo.Element("tr",[],[bo.Element("td",[bs.DynamicStyle("Color",bi.Map(function(b9){return b9==null?"#7D4600":bu.Equals(b9.$0.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),b4.WebSharper_Community_Dashboard_ISelectorItem$get_Key())?"#FB8C00":"#7D4600";},bV.v))],[(b6=bo.Element("div",[bs.Style("margin-left","10px"),bs.Style("margin-right","5px"),bs.Style("cursor","pointer"),bs.Handler("click",function(){return function(){bX.ItemOnSelected(b4);return bj.Set(bV,{$:1,$0:b4});};})],[bo.TextView(b5)]),(bW?(b7=b3(b4),(b8=_7.WrapControlsAligment.Horizontal,function(b9){return bv.Render(b7,b8,b9);})):a.id)(b6))])]);},this.SelectorItems.v),b0]);}},null,C);C.Create=function(bU,bV,bW,bX,bY,bZ,b0){var b1;b1=br.Create(function(b2){return b2.WebSharper_Community_Dashboard_ISelectorItem$get_Key();},bV);return C.New(bq.Fresh(),bj.Create$1(bU),b1,bW,bX,bY,bZ,b0);};C.New=function(bU,bV,bW,bX,bY,bZ,b0,b1){return new C({Key:bU,Name:bV,SelectorItems:bW,ItemCreatator:bX,ItemOnCreated:bY,ItemOnSelected:bZ,ItemOnDelete:b0,ItemOnMove:b1});};D=d.WindowSelector=_5.Class({get_RenderMenu:function(){var bU;bU=this;return this.SelectorGroups.get_Length()===1?_.head(_.ofSeq(this.SelectorGroups)).RenderMenu("",this.OptSelectedItem,this.IsWithControls):bo.Element("div",[],[bo.ConvertBy(function(bV){return bV.Key;},function(bV){return bo.Element("div",[],[bo.Element("div",[bs.Style("cursor","pointer"),bs.Handler("click",function(){return function(){return bU.GroupOnClick(bV);};})],[bo.TextView(bV.Name.v)]),bV.RenderMenu("    ",bU.OptSelectedItem,bU.IsWithControls)]);},this.SelectorGroups.v)]);},get_Render:function(){return bo.Element("div",[],[bo.BindView(function(bU){return bU==null?bo.Empty():bU.$0.WebSharper_Community_Dashboard_ISelectorItem$get_Render();},this.OptSelectedItem.v)]);},GroupByIndex:function(bU){return bf.nth(bU,_.ofSeq(this.SelectorGroups));},get_SelectedIndex:function(){var bU;bU=this;return bf.findIndex(function(bV){return bu.Equals(bV.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bU.get_SelectedItem().WebSharper_Community_Dashboard_ISelectorItem$get_Key());},_.concat(_.map(function(bV){return _.ofSeq(bV.SelectorItems);},_.ofSeq(this.SelectorGroups))));},get_SelectedIndexInGroup:function(){var bU;bU=this;return bf.findIndex(function(bV){return bu.Equals(bV.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bU.get_SelectedItem().WebSharper_Community_Dashboard_ISelectorItem$get_Key());},_.ofSeq(this.get_SelectedGroup().SelectorItems));},get_SelectedGroupIndex:function(){var bU;bU=this;return bf.findIndex(function(bV){return bu.Equals(bV.Key,bU.get_SelectedGroup().Key);},_.ofSeq(this.SelectorGroups));},get_SelectedGroup:function(){return this.GroupFromItem(this.get_SelectedItem());},GroupFromItem:function(bU){return bf.find(function(bV){return _.exists(function(bW){return bu.Equals(bW.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bU.WebSharper_Community_Dashboard_ISelectorItem$get_Key());},_.ofSeq(bV.SelectorItems));},_.ofSeq(this.SelectorGroups));},AppenGroup:function(bU,bV,bW){var bX;bX=this.SelectorGroups.get_Length();this.SelectorGroups.Append(C.Create(bU,bV,bW,this.ItemOnCreated(bX),this.ItemOnSelected,this.ItemOnDeleted(bX),this.ItemOnMove(bX)));},get_SelectedItem:function(){var bU;bU=this.OptSelectedItem.c;return bU==null?_6.FailWith("Something really wrong with WindowSelector"):bU.$0;},ClearGroups:function(){bj.Set(this.OptSelectedItem,null);_.iter(function(bU){bU.SelectorItems.Clear();},_.ofSeq(this.SelectorGroups));},WithControls:function(bU){return D.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,bU);},WithItemOnMove:function(bU){return D.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,bU,this.IsWithControls);},WithItemOnDeleted:function(bU){return D.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,bU,this.ItemOnMove,this.IsWithControls);},WithItemOnSelected:function(bU){return D.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,bU,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);},WithGroupOnClick:function(bU){return D.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,bU,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);},WithItemOnCreated:function(bU){return D.New(this.OptSelectedItem,this.SelectorGroups,bU,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);}},null,D);D.get_Create=function(){var bU;bU=br.Create(function(bV){return bV.Key;},_.T.Empty);return D.New(bj.Create$1(null),bU,function(){return function(){return null;};},a.ignore,a.ignore,function(){return function(){return null;};},_5.Curried3(function(bV,bW,bX){return null;}),false);};D.New=function(bU,bV,bW,bX,bY,bZ,b0,b1){return new D({OptSelectedItem:bU,SelectorGroups:bV,ItemOnCreated:bW,GroupOnClick:bX,ItemOnSelected:bY,ItemOnDeleted:bZ,ItemOnMove:b0,IsWithControls:b1});};E.Create=function(bU,bV){return E.New(bq.Fresh(),bU,bV);};E.New=function(bU,bV,bW){return{Key:bU,Panel:bV,Widget:bW};};F=d.EventsGroupItem=_5.Class({get_Render:function(){var bU,bV,bW;function bX(bY){return _.ofArray([_8.IconSmall("keyboard_arrow_down",function(){(bV(true))(bY);}),_8.IconSmall("keyboard_arrow_up",function(){(bV(false))(bY);}),_8.IconSmall("clear",function(){bU.EventItems.Remove(bY);})]);}bU=this;bV=(bW=this.EventItems,(_5.Curried3(_8.MoveItemInModelList))(bW));return bo.Element("table",[],[bo.ConvertBy(function(bY){return bY.Key;},function(bY){var bZ;return bo.Element("tr",[],[(bZ=bo.Element("div",_8.AttrsClick(function(){bU.PropertyGrid.Edit(bY.Worker.get_Properties());}),[bo.TextView(bY.Worker.Name.v)]),bv.Render(bX(bY),_7.WrapControlsAligment.Horizontal,bZ))]);},this.EventItems.v)]);},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,F);F.Create=function(bU,bV){return F.New(bq.Fresh(),bj.Create$1(bU),br.Create(function(bW){return bW.Key;},_.T.Empty),bV);};F.New=function(bU,bV,bW,bX){return new F({Key:bU,Name:bV,EventItems:bW,PropertyGrid:bX});};G=d.WidgetsGroupItem=_5.Class({get_Render:function(){return this.PanelContainer.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,G);G.Create=function(bU,bV){return G.New(bq.Fresh(),bj.Create$1(bU),br.Create(function(bW){return bW.Key;},_.T.Empty),bV);};G.New=function(bU,bV,bW,bX){return new G({Key:bU,Name:bV,WidgetItems:bW,PanelContainer:bX});};H=d.RulesGroupItem=_5.Class({Equals:function(bU){return bU instanceof H&&bu.Equals(this.Key,bU.Key);},get_Render:function(){return this.Renderer(this.RulesRowItems);},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,H);H.Create=function(bU,bV){return H.New(bq.Fresh(),bj.Create$1(bU),br.Create(function(bW){return bW.Key;},_.T.Empty),bV);};H.New=function(bU,bV,bW,bX){return new H({Key:bU,Name:bV,RulesRowItems:bW,Renderer:bX});};I=d.DshData=_5.Class({RegisterWidget:function(bU,bV,bW,bX){var bY;bY=bX.WithKey(bU);bV.WidgetItems.Append(E.Create(bW,bY));this.WorkItems.Append(y.Create(bY));},RegisterEvent:function(bU,bV,bW){var bX;bX=y.Create(bW.WithKey(bU));bV.EventItems.Append(bX);this.WorkItems.Append(bX);},get_Clear:function(){this.WorkItems.Clear();this.WidgetGroups.Clear();this.EventGroups.Clear();this.RulesGroups.Clear();}},null,I);I.get_Create=function(){return I.New(br.Create(function(bU){return bU.Key;},_.T.Empty),br.Create(function(bU){return bU.Key;},_.T.Empty),br.Create(function(bU){return bU.Key;},_.T.Empty),br.Create(function(bU){return bU.Key;},_.T.Empty));};I.New=function(bU,bV,bW,bX){return new I({WorkItems:bU,WidgetGroups:bV,EventGroups:bW,RulesGroups:bX});};J.Render=function(bU,bV){function bW(bZ,b0){return _8.MoveItemInModelList(bV,bZ,b0);}function bX(bZ){return _.ofArray([_8.IconSmall("keyboard_arrow_down",function(){bW(true,bZ);}),_8.IconSmall("keyboard_arrow_up",function(){bW(false,bZ);}),_8.IconSmall("clear",function(){bV.Remove(bZ);})]);}function bY(){var bZ;$.Start((bZ=null,$.Delay(function(){return $.Bind(h.Agent().PostAndAsyncReply(function(b0){return{$:6,$0:b0};},null),function(b0){var b1;return b0.$==1?(b1=_.map(function(b2){return b2.Worker;},_.ofSeq(bU.WorkItems)),J.CopyToRules(bV).Reconnect(b1),$.Zero()):$.Zero();});})),null);}return bo.Element("table",[],[bo.ConvertBy(function(bZ){return bZ.Key;},function(bZ){var b0;return bo.Element("tr",[],[(b0=bZ.Render(bU.WorkItems,function(){bY();}),bv.Render(bX(bZ),_7.WrapControlsAligment.Horizontal,b0))]);},bV.v)]);};J.Restore=function(bU,bV,bW){var bX,bY,bZ;bV.Clear();bX=_.map(function(b0){return b0.Worker;},_.ofSeq(bU.WorkItems));bY=u.allOutPorts(bX);bZ=u.allInPorts(bX);_.iter(function(b0){var b1;b1=B.Create([]);_.iter(function(b2){var b3;b3=A.get_Create();bj.Set(b3.OptWorker,bf.tryFind(function(b4){return b4.Worker.Key===b2.WorkerKey;},_.ofSeq(bU.WorkItems)));bj.Set(b3.OptInPort,bf.tryFind(function(b4){return b4.get_Key()===b2.InPortKey;},bZ));bj.Set(b3.OptOutPort,bf.tryFind(function(b4){return b4.Key===b2.OutPortKey;},bY));b1.CellItems.Append(b3);},b0.RuleChain);bV.Append(b1);},bW.RuleContainer);};J.CopyToRules=function(bU){return x.New(_.map(function(bV){return w.New(_.map(function(bW){var bX,bY,bZ;return v.New((bX=bW.OptInPort.c,bX==null?"":bX.$0.get_Key()),(bY=bW.OptOutPort.c,bY==null?"":bY.$0.Key),(bZ=bW.OptWorker.c,bZ==null?"":bZ.$0.Worker.Key));},_.ofSeq(bV.CellItems)));},_.ofSeq(bU)));};K.RulesGroupCreator=function(bU,bV){var bW;bW=H.Create("rules"+a.String(_.length(_.ofSeq(bU.RulesGroups))+1),function(bX){return J.Render(bU,bX);});bU.RulesGroups.Append(bW);return bW;};K.EventsGroupCreator=function(bU,bV,bW){var bX;bX=F.Create("event"+a.String(_.length(_.ofSeq(bU.EventGroups))+1),bV);bU.EventGroups.Append(bX);return bX;};K.PanelGroupCreator=function(bU,bV,bW){var bX;bX=G.Create("panel"+a.String(_.length(_.ofSeq(bU.WidgetGroups))+1),bV());bU.WidgetGroups.Append(bX);return bX;};L=d.Dashboard=_5.Class({Render:function(bU){var bV;bV=this;return bo.EmbedView(bi.Map(function(bW){return bW.$==1?bo.Element("div",[],[bo.Element("table",[],[bo.Element("tr",[],[bo.Element("td",[bs.Style("vertical-align","top")],[bo.Element("table",[],bf.concat([_.ofArray([bo.Element("tr",[],[bo.Element("td",[],[_8.IconNormal("dehaze",function(){bj.Set(bV.PanelTitleVisibility,false);bj.Set(bV.Mode,{$:0});})])])]),_.ofArray([bV.EditorSelectorEdit.get_RenderMenu()]),_.ofArray([bo.Element("tr",[],[bo.Element("td",[],[])]),bo.Element("tr",[],[bo.Element("td",[],[bV.PropertyGrid.get_Render()])])])]))]),bo.Element("td",[bs.Style("vertical-align","top")],[bU,_8.IconNormal("add",function(){var bX,bY,bZ,b0,b1;bX=bV.EditorSelectorEdit.get_SelectedGroupIndex();bX===1?(bY=_.ofSeq(bV.Factory.EventItems),bZ=bj.Create$1(_.head(bY)),bV.Dialog.ShowDialog("Select source",bo.Element("div",[],[bo.Select([bs.Class("form-control")],function(b2){return b2.Worker.Name.c;},bY,bZ)]),function(){var b2,b3,b4;b2=bZ.c.Worker.get_Clone();b2.StartRunner();b3=(b4=_.ofSeq(bV.Data.EventGroups),bf.nth(bV.EditorSelectorEdit.get_SelectedIndexInGroup(),b4));bV.Data.RegisterEvent(_8.UniqueKey(),b3,b2);})):bX===0?bV.CreatePanel((b0=_.ofSeq(bV.Data.WidgetGroups),bf.nth(bV.EditorSelectorEdit.get_SelectedIndexInGroup(),b0)),"Panel",700,null):bX===2?(b1=_.ofSeq(bV.Data.RulesGroups),bf.nth(bV.EditorSelectorEdit.get_SelectedIndexInGroup(),b1)).RulesRowItems.Append(B.Create([A.get_Create(),A.get_Create()])):void 0;}),bV.EditorSelectorEdit.get_Render()])])]),bo.Element("div",[],[bV.Dialog.get_Render()])]):bo.Element("div",[],[bo.Element("table",[],[bo.Element("tr",[],[bo.Element("td",[bs.Style("vertical-align","top")],[_8.IconNormal("dehaze",function(){bj.Set(bV.PanelTitleVisibility,true);bj.Set(bV.Mode,{$:1});}),bV.EditorSelectorRun.GroupByIndex(0).SelectorItems.get_Length()>1?bV.EditorSelectorRun.get_RenderMenu():bo.Element("div",[],[])]),bo.Element("td",[],[bV.EditorSelectorRun.get_Render()])])])]);},this.Mode.v));},Restore:function(bU,bV,bW,bX){var bY,bZ,b0,b1,b2,b3,b4,b5;function b6(b7,b8){b8.Reconnect(b4);}bY=this;bZ=h.Agent();bZ.mailbox.AddLast(m.Stop);bZ.resume();this.EditorSelectorRun.ClearGroups();this.EditorSelectorEdit.ClearGroups();this.Data.get_Clear();b0=this.EditorSelectorRun.GroupByIndex(0);b1=this.EditorSelectorEdit.GroupByIndex(0);b2=this.EditorSelectorEdit.GroupByIndex(1);b3=this.EditorSelectorEdit.GroupByIndex(2);_.iteri(function(b7,b8){var b9,b_;function b$(ca,cb,cc){bY.RegisterWidget(ca,b_,cb,bf.find(function(cd){return cd.Key===cb;},_.ofSeq(b_.PanelContainer.PanelItems)).Children,(cc.StartRunner(),cc));}b9=K.PanelGroupCreator(bY.Data,bU,null);bj.Set(b9.WebSharper_Community_Dashboard_ISelectorItem$get_Name(),b8[0]);b1.SelectorItems.Append(b9);b0.SelectorItems.Append(b9);b_=bf.nth(b7,_.ofSeq(bY.Data.WidgetGroups));_.iter(function(ca){var cb;cb=bY.CreatePanel(b_,"Panel",700,{$:1,$0:ca.Key});bj.Set(cb.Left,ca.Left);bj.Set(cb.Top,ca.Top);},b8[1]);return _.iter(function(ca){return b$(ca[0],ca[1],ca[2]);},b8[2]);},bW);bw.log("Widgets restored");_.iteri(function(b7,b8){var b9,b_;function b$(ca,cb){bY.Data.RegisterEvent(ca,b_,cb);}b9=K.EventsGroupCreator(bY.Data,bY.PropertyGrid,null);bj.Set(b9.WebSharper_Community_Dashboard_ISelectorItem$get_Name(),b8[0]);b2.SelectorItems.Append(b9);b_=bf.nth(b7,_.ofSeq(bY.Data.EventGroups));return _.iter(function(ca){return b$(ca[0],ca[1]);},b8[1]);},bV);bw.log("Events restored");_.iteri(function(b7,b8){var b9;b9=K.RulesGroupCreator(bY.Data,null);bj.Set(b9.WebSharper_Community_Dashboard_ISelectorItem$get_Name(),b8[0]);b3.SelectorItems.Append(b9);return J.Restore(bY.Data,bf.nth(b7,_.ofSeq(bY.Data.RulesGroups)).RulesRowItems,b8[1]);},bX);this.Data.WidgetGroups.get_Length()>0?(bj.Set(this.EditorSelectorEdit.OptSelectedItem,{$:1,$0:_.head(_.ofSeq(this.EditorSelectorEdit.GroupByIndex(0).SelectorItems))}),bj.Set(this.EditorSelectorRun.OptSelectedItem,{$:1,$0:_.head(_.ofSeq(this.EditorSelectorRun.GroupByIndex(0).SelectorItems))})):(bj.Set(this.EditorSelectorEdit.OptSelectedItem,null),bj.Set(this.EditorSelectorRun.OptSelectedItem,null));b4=_.map(function(b7){return b7.Worker;},_.ofSeq(this.Data.WorkItems));_.iter(function(b7){return b6(b7[0],b7[1]);},bX);b5=h.Agent();b5.mailbox.AddLast(m.Start);b5.resume();bw.log("Connectors restored");return[_.concat(_.map(function(b7){return _.map(function(b8){return b8.Worker;},_.ofSeq(b7.EventItems));},_.ofSeq(this.Data.EventGroups))),_.concat(_.map(function(b7){return _.map(function(b8){return b8.Widget;},_.ofSeq(b7.WidgetItems));},_.ofSeq(this.Data.WidgetGroups)))];},Store:function(bU){function bV(bX,bY){var bZ;bZ=bU(bY);return bZ==null?bX:new _.T({$:1,$0:[bY.Key,bZ.$0],$1:bX});}function bW(bX,bY,bZ){var b0;b0=bU(bZ);return b0==null?bX:new _.T({$:1,$0:[bZ.Key,bY,b0.$0],$1:bX});}return[_.map(function(bX){return[bX.Name.c,_.rev(bf.fold(function(bY,bZ){return bV(bY,bZ.Worker);},_.T.Empty,_.ofSeq(bX.EventItems)))];},_.ofSeq(this.Data.EventGroups)),_.map(function(bX){return[bX.Name.c,_.map(function(bY){return bY.get_PanelData();},_.ofSeq(bX.PanelContainer.PanelItems)),_.rev(bf.fold(function(bY,bZ){return bW(bY,bZ.Panel,bZ.Widget);},_.T.Empty,_.ofSeq(bX.WidgetItems)))];},_.ofSeq(this.Data.WidgetGroups)),_.map(function(bX){return[bX.Name.c,J.CopyToRules(bX.RulesRowItems)];},_.ofSeq(this.Data.RulesGroups))];},CreatePanel:function(bU,bV,bW,bX){var bY,bZ,b0,b1,b2,b3;bY=this;bo.ConvertBy(bU.WidgetItems.key,function(b4){return bo.Element("div",[],[bo.TextView(b4.Widget.Name.v)]);},bU.WidgetItems.v);bZ=(b0=(b1=bn.NewGuid(),a.String(b1)),bX==null?b0:bX.$0);b2=bx.get_Create().WithLayoutManager(by.StackPanelLayoutManager()).WithAttributes([bs.Style("border","1px solid white"),bs.Style("display","flex")]);b3=bz.get_Create().WithKey(bZ).WithPannelAttrs([bs.Style("Width",a.String(bW)+"px"),bs.Style("position","absolute")]).WithTitle(this.PanelTitleVisibility).WithTitleContent(bo.TextNode(bV)).WithTitleButtons(_.ofArray([bA.New("add",function(b4){var b5,b6;b5=_.ofSeq(bY.Factory.WidgetItems);b6=bj.Create$1(_.head(b5));bY.Dialog.ShowDialog("Select widget",bo.Element("div",[],[bo.Select([bs.Class("form-control")],function(b7){return b7.Worker.Name.c;},b5,b6)]),function(){var b7;bw.log("Dialog.IsOK");b7=b6.c.Worker.get_Clone();b7.StartRunner();bY.RegisterWidget(_8.UniqueKey(),bU,b4.Key,b4.Children,b7);});}),bA.New("edit",function(b4){bw.log("Edit");bY.PropertyGrid.Edit(_.concat(_.map(function(b5){return b5.Widget.get_Properties();},_.filter(function(b5){return b5.Panel===b4.Key;},_.ofSeq(bU.WidgetItems)))));}),bA.New("clear",function(b4){bU.PanelContainer.PanelItems.Remove(bU.PanelContainer.FindPanelItem(b4));bU.WidgetItems.RemoveBy(function(b5){return b5.Panel===b4.Key;});})])).WithChildPanelContainer(b2);bU.PanelContainer.AddPanel(b3);return b3;},RegisterWidget:function(bU,bV,bW,bX,bY){var bZ;this.Data.RegisterWidget(bU,bV,bW,bY);bZ=bz.get_Create().WithPanelContent(bY.get_Render());bj.Set(bZ.IsWithTitle,false);bX.AddPanel(bZ);}},null,L);L.Create=function(bU){var bV,bW,bX,bY,bZ,b0;function b1(){return K.PanelGroupCreator(bW,bU,void 0);}function b2(){return K.EventsGroupCreator(bW,bX,void 0);}function b3(){return K.RulesGroupCreator(bW,void 0);}bV=bB.get_Create();bW=I.get_Create();bX=bC.get_Create();bY=D.get_Create();bZ=D.get_Create().WithGroupOnClick(function(b4){bX.Edit(_.mapi(function(b5,b6){var b7;return bl.string((b7=b5+1,a.String(b7)),b6.WebSharper_Community_Dashboard_ISelectorItem$get_Name());},_.ofSeq(b4.SelectorItems)));}).WithItemOnSelected(function(){bX.Edit(_.T.Empty);}).WithItemOnCreated(function(b4){return function(b5){return b4===0?_.head(_.ofSeq(bY.SelectorGroups)).SelectorItems.Append(b5):null;};}).WithItemOnDeleted(function(){return function(){return null;};}).WithItemOnDeleted(function(b4){return function(b5){b5 instanceof G?bW.WidgetGroups.Remove(b5):b5 instanceof F?bW.EventGroups.Remove(b5):b5 instanceof H?bW.RulesGroups.Remove(b5):_6.FailWith("WithItemOnDeleted, type unknown");return b4===0?_.head(_.ofSeq(bY.SelectorGroups)).SelectorItems.Remove(b5):null;};}).WithItemOnMove(_5.Curried3(function(b4,b5,b6){var b7;b7=b6.$==1&&true;return b5 instanceof G?(_8.MoveItemInModelList(bW.WidgetGroups,b7,b5),_8.MoveItemInModelList(_.head(_.ofSeq(bY.SelectorGroups)).SelectorItems,b7,b5)):b5 instanceof F?_8.MoveItemInModelList(bW.EventGroups,b7,b5):b5 instanceof H?_8.MoveItemInModelList(bW.RulesGroups,b7,b5):_6.FailWith("WithItemOnDeleted, type unknown");})).WithControls(true);b0=b1();bZ.AppenGroup("Panels",_.ofArray([b0]),{$:1,$0:b1});bY.AppenGroup("Panels",_.ofArray([b0]),null);bZ.AppenGroup("Events",_.ofArray([b2()]),{$:1,$0:b2});bZ.AppenGroup("Rules",_.ofArray([b3()]),{$:1,$0:b3});bj.Set(bZ.OptSelectedItem,{$:1,$0:_.head(_.ofSeq(bZ.GroupByIndex(0).SelectorItems))});bj.Set(bY.OptSelectedItem,{$:1,$0:_.head(_.ofSeq(bY.GroupByIndex(0).SelectorItems))});return L.New(z.get_Create(),bW,bX,bV,bY,bZ,bj.Create$1({$:0}),bj.Create$1(false));};L.New=function(bU,bV,bW,bX,bY,bZ,b0,b1){return new L({Factory:bU,Data:bV,PropertyGrid:bW,Dialog:bX,EditorSelectorRun:bY,EditorSelectorEdit:bZ,Mode:b0,PanelTitleVisibility:b1});};N=M.RandomEvent=_5.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bU){var bV;new bD.New();$.Start((bV=null,$.Delay(function(){return $.While(function(){return true;},$.Delay(function(){return $.Bind($.Sleep(bU.InPorts.get_Item(2).get_Number()*1000>>0),function(){var bW,bX,bY;bW=bU.InPorts.get_Item(0).get_Number();bX=bU.InPorts.get_Item(1).get_Number();bY=bE.random()*bX+bW;bU.OutPorts.get_Item(0).Trigger(new i({$:0,$0:bY}));return $.Zero();});}));})),null);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.RandomEventData;}},null,N);N.get_FromWorker=function(){return function(bU){return N.New(bU.get_ToData());};};N.get_Create=function(){return N.New(s.Create("Random",_.ofArray([p.CreateNumber("Middle value",100),p.CreateNumber("Dispersion",10),p.CreateNumber("Delay sec.",2)]),_.ofArray([r.Create("Random value")])));};N.New=function(bU){return new N({RandomEventData:bU});};O.New=function(bU){return{DatabaseEventRun:bU};};P=M.DatabaseEvent=_5.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bU){var bV;bV=true;bi.Sink(function(bW){bV?(_.iter(function(bX){var bY;bY=h.Agent();bY.mailbox.AddLast({$:0,$0:bX});bY.resume();},(new bb.New()).Sync("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.Events.ServerDatabase.ReadAllMessages:965639103",[bU.InPorts.get_Item(1).get_String()])),bV=false):((new bb.New()).Send("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.Events.ServerDatabase.WriteMessage:-353093100",[bU.InPorts.get_Item(1).get_String(),bW.WithKey(bU.OutPorts.get_Item(0).Key)]),bU.OutPorts.get_Item(0).Trigger(bW.Value));},bU.InPorts.get_Item(0).PortValue.v);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.DatabaseEventData;}},null,P);P.get_FromWorker=function(){return function(bU){return P.New(bU.get_ToData());};};P.get_Create=function(){return P.New(s.Create("Database",_.ofArray([p.CreateNumber(" in Value",100),p.CreateString("Database name","Database.txt")]),_.ofArray([r.Create("Number value")])));};P.New=function(bU){return new P({DatabaseEventData:bU});};R.New=function(bU,bV,bW,bX,bY){return{Title:bU,Description:bV,ImageUrl:bW,Temperature:bX,TemparatureMinMax:bY};};Q.get=function(bU,bV){var bW;bW=null;return $.Delay(function(){var bX;bX=(((_5.Curried3(function(bY,bZ,b0){return bY("http://api.openweathermap.org/data/2.5/weather?q="+bc.toSafe(bZ)+"&units=metric&appid="+bc.toSafe(b0));}))(a.id))(bV))(bU);(e.Log())("get key city "+bX);return $.TryWith($.Delay(function(){return $.Bind(bG.AsyncMap(bK.asyncReadTextAtRuntime(false,"C:\\AEAFrame\\WebSharper.Community.Dashboard\\WebSharper.Community.Dashboard","","JSON","",bX),function(bY){return bu.Equals(typeof bY,"string")?bL.parse(bY):bY;}),function(bY){var bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj;(e.Log())("get key city 2");return $.Return((bZ=bM.tryHead(bY.weather),bZ==null?null:{$:1,$0:(b0=bZ.$0,R.New((((_5.Curried3(function(ck,cl,cm){return ck(bc.toSafe(cl)+", "+bc.toSafe(cm));}))(a.id))((b2=(b1="name",b1 in bY?{$:1,$0:bY[b1]}:null),b2==null?null:b2.$0)))((b5=(b3=bY.sys,(b4="country",b4 in b3?{$:1,$0:b3[b4]}:null)),b5==null?null:b5.$0)),(b7=(b6="main",b6 in b0?{$:1,$0:b0[b6]}:null),b7==null?null:b7.$0),(function(ck){return function(cl){return ck("http://openweathermap.org/img/w/"+bc.toSafe(cl)+".png");};}(a.id))((b9=(b8="icon",b8 in b0?{$:1,$0:b0[b8]}:null),b9==null?null:b9.$0)),(b_=(b$=bY.main,(ca="temp",ca in b$?{$:1,$0:b$[ca]}:null)),(cb=b_==null?null:{$:1,$0:1*b_.$0},cb==null?null:cb.$0)),[(cc=(cd=bY.main,(ce="temp_min",ce in cd?{$:1,$0:cd[ce]}:null)),(cf=cc==null?null:{$:1,$0:1*cc.$0},cf==null?null:cf.$0)),(cg=(ch=bY.main,(ci="temp_max",ci in ch?{$:1,$0:ch[ci]}:null)),(cj=cg==null?null:{$:1,$0:1*cg.$0},cj==null?null:cj.$0))]))}));});}),function(bY){(e.Log())(bY.message);return $.Return(null);});});};S=M.OpenWeatherEvent=_5.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bU){var bV;$.Start((bV=null,$.Delay(function(){return $.While(function(){return true;},$.Delay(function(){var bW,bX,bY;bW=bU.InPorts.get_Item(0);bX=bU.InPorts.get_Item(1);bY=bU.OutPorts.get_Item(0);return $.Bind(Q.get(bX.get_String(),bW.get_String()),function(bZ){return $.Combine(bZ==null?$.Zero():((e.Log())("Value generated:"+bZ.$0.Title),bY.Trigger(new i({$:0,$0:+bZ.$0.Temperature})),$.Zero()),$.Delay(function(){return $.Bind($.Sleep(1000*15),function(){return $.Return(null);});}));});}));})),null);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.OpenWeatherEventData;}},null,S);S.get_FromWorker=function(){return function(bU){return S.New(bU.get_ToData());};};S.Create=function(bU,bV){return S.New(s.Create("OpenWeatherMap",_.ofArray([p.CreateString("City",bU),p.CreateString("ApiKey",bV)]),_.ofArray([r.Create("Temperature")])));};S.New=function(bU){return new S({OpenWeatherEventData:bU});};T=M.ClockEvent=_5.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bU){var bV;$.Start((bV=null,$.Delay(function(){return $.While(function(){return true;},$.Delay(function(){var bW,bX,bY;bW=(bU.InPorts.get_Item(0).PortValue.c.Value.get_AsSelect())[0];bX=_9.now();bY=bW===0?bN.LongTime(bX):bW===1?bN.ShortTime(bX):bW===2?bN.LongDate(bX):bW===3?(new _9(bX)).toLocaleDateString():"";bU.OutPorts.get_Item(0).Trigger(new i({$:1,$0:bY}));return $.Bind($.Sleep(bU.InPorts.get_Item(1).get_Number()*1000>>0),function(){var bZ;bZ=(function(b0){return function(b1){return b0("Time value generated "+bc.toSafe(b1));};}(a.id))(bY);(e.Log())(bZ);return $.Zero();});}));})),null);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.ClockEventData;}},null,T);T.get_FromWorker=function(){return function(bU){return T.New(bU.get_ToData());};};T.get_Create=function(){return T.New(s.Create("Clock",_.ofArray([p.CreateSelect("Format",[0,_.ofArray(["long time","short time","long date","short date"])]),p.CreateNumber("Delay sec.",1)]),_.ofArray([r.Create("Date Time")])));};T.New=function(bU){return new T({ClockEventData:bU});};V=U.TextBoxWidget=_5.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bU){var bV;bV=bi.Map(function(bW){var bX,bY;bX=bW.Value;return bX.$==0?(bY=bX.$0>>0,a.String(bY)):bX.$==1?bX.$0:bX.$==2?a.String(bX.$0):"Wrong port value format";},bU.InPorts.get_Item(0).PortValue.v);return bo.Element("div",[bs.Class("bigvalue")],[bo.TextView(bV)]);}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.TextBoxWidgetData;}},null,V);V.get_FromWorker=function(){return function(bU){return V.New(bU.get_ToData());};};V.get_Create=function(){return V.New(s.Create("Text",_.ofArray([p.CreateNumber("in Value",0)]),_.T.Empty));};V.New=function(bU){return new V({TextBoxWidgetData:bU});};W.New=function(bU,bV){return{LineChart:bU,Source:bV};};X=U.ChartWidget=_5.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bU){var bV,bW,bX,bY,bZ,b0,b1,b2,b3;bV=bU.InPorts.get_Item(3).get_Number()>>0;bW=bU.RunnerContext.c.$0;bX=(bY={},bY.title=(bZ={},bZ.display=false,bZ),bY.legend=(b0={},b0.display=false,b0),bY.elements=(b1={},b1.point=(b2={},b2.radius=0,b2),b1.line=(b3={},b3.borderWidth=1,b3),b1),bY);return bQ.Render$8(bW.LineChart,{$:1,$0:{$:0,$0:bU.InPorts.get_Item(1).get_Number()>>0,$1:bU.InPorts.get_Item(2).get_Number()>>0}},{$:1,$0:bX},{$:1,$0:bV});}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bU){var bV,bW,bX;bU.InPorts.get_Item(3).get_Number();bV=bU.InPorts.get_Item(0).PortValue.v;bW=new bR.New();bX=bS.Line$1(bW.event).WithFill(false).__WithStrokeColor(new bT.Color({$:1,$0:"#FB8C00"})).__WithPointColor(new bT.Color({$:2,$0:"black"}));bi.Sink(function(bY){var bZ;bZ=(bU.InPorts.get_Item(4).PortValue.c.Value.get_AsSelect())[0];bW.event.Trigger([bZ===0?bN.LongTime(bY.Time):bZ===1?bN.ShortTime(bY.Time):bZ===2?bN.LongDate(bY.Time):bZ===3?(new _9(bY.Time)).toLocaleDateString():"",bY.Value.get_AsNumber()]);},bV);return{$:1,$0:W.New(bX,bW)};}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.ChartWidgetData;}},null,X);X.get_FromWorker=function(){return function(bU){return X.New(bU.get_ToData());};};X.get_Create=function(){var bU;bU=20;return X.New(s.Create("Chart",_.ofArray([p.CreateNumber(" in Value",100).WithCacheSize(bU),p.CreateNumber("cx",300),p.CreateNumber("cy",150),p.CreateNumber("BufferSize",bU),p.CreateSelect("X-Axis",[0,_.ofArray(["long time","short time","long date","short date"])])]),_.T.Empty));};X.New=function(bU){return new X({ChartWidgetData:bU});};Y=U.ButtonWidget=_5.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bU){return bo.ButtonView(bU.InPorts.get_Item(0).get_String(),[],bU.InPorts.get_Item(1).get_BooleanView(),function(bV){bU.OutPorts.get_Item(0).Trigger(new i({$:2,$0:bV}));});}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.ButtonWidgetData;}},null,Y);Y.get_FromWorker=function(){return function(bU){return Y.New(bU.get_ToData());};};Y.get_Create=function(){return Y.New(s.Create("Button",_.ofArray([p.CreateString("Caption","Button"),p.CreateNumber("State",0)]),_.ofArray([r.Create("Button value")])));};Y.New=function(bU){return new Y({ButtonWidgetData:bU});};Z.FromWorker=function(bU){var bV;bV=bU.Data;return bV instanceof N?{$:1,$0:{$:0,$0:(N.get_FromWorker())(bU)}}:bV instanceof T?{$:1,$0:{$:1,$0:(T.get_FromWorker())(bU)}}:bV instanceof S?{$:1,$0:{$:2,$0:(S.get_FromWorker())(bU)}}:bV instanceof P?{$:1,$0:{$:3,$0:(P.get_FromWorker())(bU)}}:bV instanceof V?{$:1,$0:{$:4,$0:(V.get_FromWorker())(bU)}}:bV instanceof X?{$:1,$0:{$:5,$0:(X.get_FromWorker())(bU)}}:bV instanceof Y?{$:1,$0:{$:6,$0:(Y.get_FromWorker())(bU)}}:null;};Z.ToWorker=function(bU){return bU.$==1?t.Create(bU.$0):bU.$==2?t.Create(bU.$0):bU.$==3?t.Create(bU.$0):bU.$==4?t.Create(bU.$0):bU.$==5?t.Create(bU.$0):bU.$==6?t.Create(bU.$0):t.Create(bU.$0);};_0.CreateDashboard=function(){_1.$cctor();return _1.CreateDashboard;};_0.PanelContainerCreator=function(bU){return bx.get_Create().WithLayoutManager(by.FloatingPanelLayoutManager(5)).WithWidth(800).WithHeight(420).WithAttributes([bs.Style("border","1px solid white")]);};_0.RegisterAppModelLib=function(bU){function bV(bX){_0.RegisterEventGeneral(bU,bX);}function bW(bX){_0.RegisterWidgetGeneral(bU,bX);}bV(S.Create("London",""));bV(N.get_Create());bV(T.get_Create());bV(P.get_Create());bW(V.get_Create());bW(X.get_Create());bW(Y.get_Create());return bU;};_0.RegisterWidgetGeneral=function(bU,bV){var bW;_0.Register((bW=bU.Factory,function(bX){bW.RegisterWidget(bX);}),bV);};_0.RegisterEventGeneral=function(bU,bV){var bW;_0.Register((bW=bU.Factory,function(bX){bW.RegisterEvent(bX);}),bV);};_0.Register=function(bU,bV){return bU(t.Create(bV));};_1.$cctor=_5.Cctor(function(){_1.CreateDashboard=_0.RegisterAppModelLib(L.Create(function(){return _0.PanelContainerCreator();}));_1.$cctor=a.ignore;});_2.RecreatWidgetsOnServer=function(bU,bV){function bW(bY,bZ,b0){return b0;}function bX(bY,bZ,b0){return b0;}return _.map(function(bY){return bW(bY[0],bY[1],bY[2]);},_.concat(_.map(function(bY){return bX(bY[0],bY[1],bY[2]);},_2.RecreateWidgets(bU,bV))));};_2.RecreateEventsOnServer=function(bU,bV){function bW(bY,bZ){return bZ;}function bX(bY,bZ){return bZ;}return _.map(function(bY){return bW(bY[0],bY[1]);},_.concat(_.map(function(bY){return bX(bY[0],bY[1]);},_2.RecreateEvents(bU,bV))));};_2.RecreateOnClient=function(bU,bV,bW,bX,bY,bZ,b0){var b1;e.set_Role(f.Client);b1=h.Agent();b1.mailbox.AddLast({$:3,$0:function(b2){(new bb.New()).Send("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.MessageBus.SendToServer:-1358505674",[b2]);}});b1.resume();_.iter(bU,(bV.Restore(bW,_2.RecreateEvents(bX,bY),_2.RecreateWidgets(bX,bZ),b0))[0]);};_2.RecreateWidgets=function(bU,bV){function bW(bX,bY,bZ){function b0(b1,b2,b3){return[b1,b2,bU(b3)];}return[bX,bY,_.map(function(b1){return b0(b1[0],b1[1],b1[2]);},bZ)];}return _.map(function(bX){return bW(bX[0],bX[1],bX[2]);},bV);};_2.RecreateEvents=function(bU,bV){function bW(bX,bY){function bZ(b0,b1){return[b0,bU(b1)];}return[bX,_.map(function(b0){return bZ(b0[0],b0[1]);},bY)];}return _.map(function(bX){return bW(bX[0],bX[1]);},bV);};_3=d.AppData=_5.Class({RecreateOnServer:function(bU,bV){var bW,bX,bY,bZ;function b0(b1,b2){b2.Reconnect(bX);}bW=_2.RecreateEventsOnServer(bV,this.Events);bX=_.append(bW,_2.RecreatWidgetsOnServer(bV,this.Widgets));_.iter(function(b1){return b0(b1[0],b1[1]);},this.Rules);_.iter(function(b1){b1.StartRunner();},bX);bY={$:0,$0:h.CreateMessage(new i({$:4,$0:{$:0,$0:bU}})).WithKey("system")};bZ=h.Agent();bZ.mailbox.AddLast(bY);bZ.resume();return bW;},RecreateOnClientEventsRunning:function(bU,bV,bW){_2.RecreateOnClient(function(bX){bX.StartRunner();},bU,bV,bW,this.Events,this.Widgets,this.Rules);},RecreateOnClientEventsNotRunning:function(bU,bV,bW){_2.RecreateOnClient(a.ignore,bU,bV,bW,this.Events,this.Widgets,this.Rules);}},null,_3);_3.Create=function(bU,bV){var bW;bW=bU.Store(bV);return _3.New(bW[0],bW[1],bW[2]);};_3.empty=function(){return _3.New(_.T.Empty,_.T.Empty,_.T.Empty);};_3.New=function(bU,bV,bW){return new _3({Events:bU,Widgets:bV,Rules:bW});};}());
