(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;a=window.WebSharper=window.WebSharper||{};b=a.Community=a.Community||{};c=b.Panel=b.Panel||{};d=c.Helper=c.Helper||{};e=c.PanelData=c.PanelData||{};f=c.TitleButton=c.TitleButton||{};g=c.Panel=c.Panel||{};h=c.PanelContainer=c.PanelContainer||{};i=c.Rect=c.Rect||{};j=c.LayoutManagers=c.LayoutManagers||{};k=window.StartupCode$WebSharper_Community_Panel$LayoutManagers=window.StartupCode$WebSharper_Community_Panel$LayoutManagers||{};l=c.Dialog=c.Dialog||{};m=a&&a.Guid;n=a&&a.UI;o=n&&n.Next;p=o&&o.Doc;q=o&&o.AttrModule;r=a&&a.List;s=window.IntelliFactory;t=s&&s.Runtime;u=o&&o.Var;v=a&&a.Unchecked;w=o&&o.View;x=o&&o.Input;y=x&&x.Mouse;z=a&&a.Seq;A=o&&o.ListModel;B=window.console;d.UniqueKey=function(){var C;C=m.NewGuid();return window.String(C);};d.TxtIconNormal=function(C,D,E){return d.TxtIcon("material-icons orange600",C,D,E);};d.TxtIcon=function(C,D,E,F){return p.Element("div",d.AttrsClick(F),[p.Element("i",[q.Class(C)],[p.TextNode(D)]),p.TextNode(E)]);};d.IconSmall=function(C,D){return d.Icon("material-icons orange600 small",C,D);};d.IconNormal=function(C,D){return d.Icon("material-icons orange600",C,D);};d.Icon=function(C,D,E){return p.Element("i",new r.T({$:1,$0:q.Class(C),$1:d.AttrsClick(E)}),[p.TextNode(D)]);};d.AttrsClick=function(C){return r.ofArray([q.Style("Color","#FB8C00"),q.Style("cursor","pointer"),q.Handler("click",function(){return function(){return C();};})]);};e.Create=function(C,D,E,F){return e.New(C,D,E,F);};e.New=function(C,D,E,F){return{Key:C,Left:D,Top:E,Children:F};};f=c.TitleButton=t.Class({Render:function(C){var D;D=this;return d.IconSmall(this.Icon,function(){D.Action(C);});}},null,f);f.New=function(C,D){return new f({Icon:C,Action:D});};g=c.Panel=t.Class({get_Render:function(){var C,D,E,F,G,H,I,J,K,L,M,N,O;C=this;D=u.Create$1(false);E=u.Create$1(false);F=u.Create$1(0);G=u.Create$1(0);H=(I=function(P,Q){var R,S,T,U,V,W,X,Y,Z,_0,_1,_2;return D.c?(R=C.Element.c.getBoundingClientRect(),(S=C.Element.c.parentElement.getBoundingClientRect(),(T=S.width-R.width,(U=S.height-R.height,(V=(W=(X=0,(Y=+P-F.c,v.Compare(X,Y)===1?X:Y)),v.Compare(T,W)===-1?T:W),(Z=(_0=(_1=0,(_2=+Q-G.c,v.Compare(_1,_2)===1?_1:_2)),v.Compare(U,_0)===-1?U:_0),(u.Set(C.Left,V),u.Set(C.Top,Z),C.Relayout(C),[V,Z]))))))):[C.Left.c,C.Top.c];},w.Map(function(P){return I(P[0],P[1]);},w.UpdateWhile([0,0],w.Map(function(P){return P&&D.c;},y.get_LeftPressed()),y.get_Position())));J=z.concat([this.TitleAttrs,r.ofArray([q.Style("cursor","grab"),q.Handler("mouseenter",function(){return function(){return u.Set(E,true);};}),q.Handler("mouseleave",function(){return function(){return!D.c?u.Set(E,false):null;};}),q.Handler("mouseup",function(){return function(){u.Set(E,false);return u.Set(D,false);};}),q.Handler("mousedown",function(){return function(P){E.c&&!v.Equals(C.Element.c.parentElement,null)&&!v.Equals(C.Element.c.parentElement.parentElement,null)?u.Set(D,true):void 0;u.Set(F,+P.clientX-C.Left.c);return u.Set(G,+P.clientY-C.Top.c);};})])]);K=p.Element("table",[q.Style("width","100%")],[p.Element("tr",[],[p.Element("td",[],[this.TitleContent]),p.Element("td",[q.Style("text-align","right"),q.Style("vertical-align","middle")],r.map(function(P){return P.Render(C);},this.TitleButtons))])]);L=this.Width>0?r.ofArray([q.Style("width",(function(P){return function(Q){return P(Q.toFixed(6)+"px");};}(window.id))(this.Width))]):r.T.Empty;M=p.Element("div",z.concat([this.PannelAttrs,z.concat([L,this.Height>0?r.ofArray([q.Style("height",(function(P){return function(Q){return P(Q.toFixed(6)+"px");};}(window.id))(this.Height))]):r.T.Empty]),r.ofArray([q.DynamicStyle("left",w.Map(function(P){return(function(Q){return function(R){return Q(R.toFixed(6)+"px");};}(window.id))(P);},this.Left.v)),q.DynamicStyle("left",(N=function(P){return(function(Q){return function(R){return Q(R.toFixed(6)+"px");};}(window.id))(P);},w.Map(function(P){return N(P[0],P[1]);},H))),q.DynamicStyle("top",(O=function(P,Q){return(function(R){return function(S){return R(S.toFixed(6)+"px");};}(window.id))(Q);},w.Map(function(P){return O(P[0],P[1]);},H))),q.DynamicStyle("top",w.Map(function(P){return(function(Q){return function(R){return Q(R.toFixed(6)+"px");};}(window.id))(P);},this.Top.v))])]),[p.Element("table",[],[p.Element("tr",[],[p.Element("td",L,[this.IsWithTitle?p.Element("div",J,[K]):p.Element("div",[],[])])]),p.Element("tr",[],[p.Element("td",[],[this.PanelContent,this.Children.get_Render()])])])]);u.Set(this.Element,M.elt);return M.OnAfterRender(function(){C.onAfterRender(C);});},get_PanelData:function(){return e.Create(this.Key,this.Left.c,this.Top.c,r.map(function(C){return C.get_PanelData();},r.ofSeq(this.Children.PanelItems)));},EditProperties:function(C){C.Edit(r.concat([this.Properties,r.concat(r.map(function(D){return D.Properties;},r.ofSeq(this.Children.PanelItems)))]));},WithHeight:function(C){return g.New(this.Key,this.Left,this.Top,this.Width,C,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithWidth:function(C){return g.New(this.Key,this.Left,this.Top,C,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithProperties:function(C){return g.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,C);},WithOnAfterRender:function(C){return g.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,C,this.Properties);},WithInternalName:function(C){return g.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,C,this.onAfterRender,this.Properties);},WithTitle:function(C){return g.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,C,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithChildPanelContainer:function(C){return g.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,C,this.InternalName,this.onAfterRender,this.Properties);},WithRelayoutFnc:function(C){return g.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,C,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithPanelContent:function(C){return g.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,C,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithTitleButtons:function(C){return g.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,C,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithTitleContent:function(C){return g.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,C,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithTitleAttrs:function(C){return g.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,C,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithPannelAttrs:function(C){return g.New(this.Key,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,C,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);},WithKey:function(C){return g.New(C,this.Left,this.Top,this.Width,this.Height,this.Element,this.Relayout,this.PannelAttrs,this.IsWithTitle,this.TitleAttrs,this.TitleContent,this.TitleButtons,this.PanelContent,this.Children,this.InternalName,this.onAfterRender,this.Properties);}},null,g);g.get_Create=function(){var C;return g.New((C=m.NewGuid(),window.String(C)),u.Create$1(0),u.Create$1(0),0,0,u.Create$1(null),function(){},r.T.Empty,true,r.ofArray([q.Class("panelTitle")]),p.Element("div",[],[]),r.T.Empty,p.Element("div",[],[]),h.get_Create(),"",function(){},r.T.Empty);};g.New=function(C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S){return new g({Key:C,Left:D,Top:E,Width:F,Height:G,Element:H,Relayout:I,PannelAttrs:J,IsWithTitle:K,TitleAttrs:L,TitleContent:M,TitleButtons:N,PanelContent:O,Children:P,InternalName:Q,onAfterRender:R,Properties:S});};h=c.PanelContainer=t.Class({get_Render:function(){var C;C=this;return p.Element("div",z.concat([this.ContainerAttributes,this.Width>0?r.ofArray([q.Style("width",(function(D){return function(E){return D(E.toFixed(6)+"px");};}(window.id))(this.Width))]):r.T.Empty,this.Height>0?r.ofArray([q.Style("height",(function(D){return function(E){return D(E.toFixed(6)+"px");};}(window.id))(this.Height))]):r.T.Empty,r.ofArray([q.Style("position","relative")])]),[p.ConvertBy(function(D){return D.Key;},function(D){return D.get_Render().OnAfterRender(function(){C.LayoutManager.WebSharper_Community_Panel_ILayoutManager$PlacePanel(C,D);});},this.PanelItems.v)]);},AddPanel:function(C){var D,E;this.PanelItems.Append(C.WithRelayoutFnc((D=this.LayoutManager,(E=this,function(F){D.WebSharper_Community_Panel_ILayoutManager$Relayout(E,F);}))));},FindPanelItem:function(C){return z.find(function(D){return v.Equals(D.Element,C.Element);},r.ofSeq(this.PanelItems));},WithHeight:function(C){return h.New(this.Width,C,this.PanelItems,this.LayoutManager,this.ContainerAttributes);},WithWidth:function(C){return h.New(C,this.Height,this.PanelItems,this.LayoutManager,this.ContainerAttributes);},WithLayoutManager:function(C){return h.New(this.Width,this.Height,this.PanelItems,C,this.ContainerAttributes);},WithAttributes:function(C){return h.New(this.Width,this.Height,this.PanelItems,this.LayoutManager,C);}},null,h);h.get_Create=function(){return h.New(0,0,A.Create(function(C){return C.Key;},r.T.Empty),{WebSharper_Community_Panel_ILayoutManager$Relayout:function(){return null;},WebSharper_Community_Panel_ILayoutManager$PlacePanel:function(){return null;}},r.T.Empty);};h.New=function(C,D,E,F,G){return new h({Width:C,Height:D,PanelItems:E,LayoutManager:F,ContainerAttributes:G});};i=c.Rect=t.Class({toString:function(){return"left:"+window.String(this.left)+" "+" top:"+window.String(this.top)+" right:"+window.String(this.right)+" bottom:"+window.String(this.bottom);},inflate:function(C,D){return i.New(this.left-C,this.right+C,this.top-D,this.bottom+D);},get_height:function(){return this.bottom-this.top;},get_width:function(){return this.right-this.left;},intersect:function(C){var D,E,F,G,H,I,J,K,L,M,N,O;D=(E=this.left,(F=C.left,v.Compare(E,F)===1?E:F));G=(H=this.right,(I=C.right,v.Compare(H,I)===-1?H:I));J=(K=this.top,(L=C.top,v.Compare(K,L)===1?K:L));M=(N=this.bottom,(O=C.bottom,v.Compare(N,O)===-1?N:O));return i.New(D,v.Compare(D,G)===1?D:G,J,v.Compare(J,M)===1?J:M);},offset:function(C,D){return i.New(this.left+C,this.right+C,this.top+D,this.bottom+D);},get_isEmpty:function(){return this.left>=this.right||this.top>=this.bottom;}},null,i);i.fromPanel=function(C){return i.fromDomRect(C.Element.c).offset(C.Left.c,C.Top.c);};i.fromDomRect=function(C){var D;return!v.Equals(C,null)?(D=C.getBoundingClientRect(),i.New(0,D.width,0,D.height)):i.Create(0,0,0,0);};i.Create=function(C,D,E,F){return i.New(C,E,D,F);};i.New=function(C,D,E,F){return new i({left:C,right:D,top:E,bottom:F});};j.StackPanelLayoutManager=function(){k.$cctor();return k.StackPanelLayoutManager;};j.FloatingPanelLayoutManager=function(C){return{WebSharper_Community_Panel_ILayoutManager$Relayout:function(D,E){return j.relayout(D,E,C);},WebSharper_Community_Panel_ILayoutManager$PlacePanel:function(D,E){return j.placePanel(D,E,C);}};};j.relayout=function(C,D,E){var F,G,H;F=C.PanelItems;G=z.find(function(I){return I.Key===D.Key;},r.ofSeq(F));H=z.tryFind(function(I){return I.Key!==G.Key&&!i.fromPanel(I).intersect(i.fromPanel(G)).get_isEmpty();},r.ofSeq(F));H!=null&&H.$==1?j.movePanelToFreeSpace(F,H.$0,E):void 0;};j.placePanel=function(C,D,E){var F,G,H;F=i.fromPanel(D);G=z.tryFind(function(I){return I.get_width()>=F.get_width()&&I.get_height()>=F.get_height();},j.collectFreeSpace(C.PanelItems,i.Create(0,0,C.Width,C.Height),D,E));G!=null&&G.$==1?(H=G.$0,u.Set(D.Left,H.left+E),u.Set(D.Top,H.top+E)):void 0;};j.movePanelToFreeSpace=function(C,D,E){var F,G,H;F=i.fromPanel(D);G=z.tryFind(function(I){return I.get_width()>=F.get_width()&&I.get_height()>=F.get_height();},j.collectFreeSpace(C,i.fromDomRect(D.Element.c.parentElement),D,E));G!=null&&G.$==1?(H=G.$0,u.Set(D.Left,H.left+E),u.Set(D.Top,H.top+E)):void 0;};j.collectFreeSpace=function(C,D,E,F){var G;G=r.filter(function(H){return H.Key!==E.Key;},r.ofSeq(C));return z.fold(function(H,I){var J,K,L;J=j.panelRect(I,0);K=i.New(0,D.right,0,J.top);L=i.New(0,J.left,0,D.bottom);return r.concat(r.map(function(M){return r.filter(function(N){return!N.get_isEmpty();},r.map(function(N){return N.intersect(M);},H));},r.ofArray([K,L,i.New(J.right,D.right,L.top,L.bottom),i.New(K.left,K.right,J.bottom,D.bottom)])));},r.ofArray([D]),G);};j.calcClientArea=function(C,D,E){var F;F=r.map(function(G){B.log(G.InternalName);return j.panelRect(G,E);},function(G,H){var I,J;while(true)if(H.$==1){I=H.$1;J=H.$0;if(J.Key===D.Key)return G;else{G=new r.T({$:1,$0:J,$1:G});H=I;}}else return G;}(r.T.Empty,r.ofSeq(C)));return F.$==0?i.Create(0,0,0,0):i.Create(r.min(r.map(function(G){return G.left;},F)),r.min(r.map(function(G){return G.top;},F)),r.max(r.map(function(G){return G.right;},F)),r.max(r.map(function(G){return G.bottom;},F)));};j.panelRect=function(C,D){return i.fromPanel(C).inflate(D,D);};k.$cctor=t.Cctor(function(){k.StackPanelLayoutManager={WebSharper_Community_Panel_ILayoutManager$Relayout:function(C,D){return j.relayout(C,D,0);},WebSharper_Community_Panel_ILayoutManager$PlacePanel:function(){return null;}};k.$cctor=window.ignore;});l=c.Dialog=t.Class({get_Render:function(){var C;C=this;return p.Element("div",[q.Style("position","absolute"),q.Style("left","50%"),q.Style("top","50%"),q.Style("z-index","1"),q.Style("background-color","white"),q.Style("min-height","100px"),q.Style("min-width","200px"),q.DynamicStyle("display",w.Map(function(D){return D?"block":"none";},this.Visibility.v))],[p.Element("table",[q.Style("background-color","grey"),q.Style("display","block"),q.Style("min-height","100px"),q.Style("min-width","200px")],[p.Element("table",[],[p.Element("tr",[],[p.Element("td",[q.Style("border-style","hidden"),q.Style("background","#404040"),q.Style("color","rgb(200,200,200)"),q.Style("padding","0px 2px 5px 2px"),q.Style("Width","200px"),q.Style("font-size","medium")],[p.TextView(this.Title.v)])])]),p.Element("table",[],[p.Element("tr",[],[p.Element("td",[q.Style("padding","5px 0px 0px 2px")],[p.BindView(window.id,this.Content.v)])]),p.Element("tr",[],[p.Element("td",[q.Style("padding","20px 12px 2px 20px")],[p.Element("button",[q.Style("border-radius","2px"),q.Handler("click",function(){return function(){u.Set(C.Visibility,false);return C.OKCallback.c();};})],[p.TextNode("OK")])]),p.Element("td",[q.Style("padding","20px 12px 2px 50px")],[p.Element("button",[q.Style("border-radius","2px"),q.Handler("click",function(){return function(){return u.Set(C.Visibility,false);};})],[p.TextNode("Cancel")])])])])])]);},ShowDialog:function(C,D,E){u.Set(this.Title,C);u.Set(this.Content,D);u.Set(this.Visibility,true);u.Set(this.OKCallback,E);}},null,l);l.get_Create=function(){return l.New(u.Create$1(""),u.Create$1(p.Element("div",[],[])),u.Create$1(false),u.Create$1(function(){}));};l.New=function(C,D,E,F){return new l({Title:C,Content:D,Visibility:E,OKCallback:F});};}());
