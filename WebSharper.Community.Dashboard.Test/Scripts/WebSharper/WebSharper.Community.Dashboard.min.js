(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Community=b.Community||{};d=c.Dashboard=c.Dashboard||{};e=d.Environment=d.Environment||{};f=e.Role=e.Role||{};g=a.StartupCode$WebSharper_Community_Dashboard$Environment=a.StartupCode$WebSharper_Community_Dashboard$Environment||{};h=d.MessageBus=d.MessageBus||{};i=h.Value=h.Value||{};j=h.Message=h.Message||{};k=h.ListenerInfo=h.ListenerInfo||{};l=h.AgentMessage=h.AgentMessage||{};m=h.AgentState=h.AgentState||{};n=a.StartupCode$WebSharper_Community_Dashboard$MessageBus=a.StartupCode$WebSharper_Community_Dashboard$MessageBus||{};o=d.InPortData=d.InPortData||{};p=d.InPort=d.InPort||{};q=d.OutPort=d.OutPort||{};r=d.WorkerData=d.WorkerData||{};s=d.Worker=d.Worker||{};t=d.Workers=d.Workers||{};u=d.RandomRunner=d.RandomRunner||{};v=d.OpenWeather=d.OpenWeather||{};w=v.Forecast=v.Forecast||{};x=d.OpenWeatherRunner=d.OpenWeatherRunner||{};y=d.DatabaseRunnerContext=d.DatabaseRunnerContext||{};z=d.DatabaseRunner=d.DatabaseRunner||{};A=d.ChartRunnerContext=d.ChartRunnerContext||{};B=d.ChartRenderer=d.ChartRenderer||{};C=d.TextBoxRenderer=d.TextBoxRenderer||{};D=d.ButtonRenderer=d.ButtonRenderer||{};E=d.RuleEntry=d.RuleEntry||{};F=d.RuleChain=d.RuleChain||{};G=d.RuleContainer=d.RuleContainer||{};H=d.WorkerItem=d.WorkerItem||{};I=d.Factory=d.Factory||{};J=d.SelectorItem=d.SelectorItem||{};K=d.SelectorGroup=d.SelectorGroup||{};L=d.WindowSelector=d.WindowSelector||{};M=d.RulesCellItem=d.RulesCellItem||{};N=d.RulesRowItem=d.RulesRowItem||{};O=d.WidgetItem=d.WidgetItem||{};P=d.EventsGroupItem=d.EventsGroupItem||{};Q=d.WidgetsGroupItem=d.WidgetsGroupItem||{};R=d.RulesGroupItem=d.RulesGroupItem||{};S=d.DshData=d.DshData||{};T=d.EventsEditor=d.EventsEditor||{};U=d.RulesEditor=d.RulesEditor||{};V=d.DshHelper=d.DshHelper||{};W=d.Dashboard=d.Dashboard||{};X=d.AppModelLib=d.AppModelLib||{};Y=d.App=d.App||{};Z=d.AppDataHelper=d.AppDataHelper||{};_0=d.AppData=d.AppData||{};_1=a.IntelliFactory;_2=_1&&_1.Runtime;_3=b&&b.Operators;_4=c&&c.Panel;_5=_4&&_4.Helper;_6=a.Date;_7=b&&b.List;_8=b&&b.Concurrency;_9=b&&b.Remoting;_=_9&&_9.AjaxRemotingProvider;$=b&&b.Control;ba=$&&$.MailboxProcessor;bb=b&&b.Seq;bc=b&&b.PrintfHelpers;bd=b&&b.UI;be=bd&&bd.Next;bf=be&&be.View;bg=be&&be.Var;bh=c&&c.PropertyGrid;bi=bh&&bh.Properties;bj=b&&b.Guid;bk=b&&b.Unchecked;bl=be&&be.Doc;bm=b&&b.Random;bn=a.Math;bo=a.console;bp=b&&b.Data;bq=bp&&bp.TxtRuntime;br=a.FSharp;bs=br&&br.Data;bt=bs&&bs.Runtime;bu=bt&&bt.IO;bv=a.JSON;bw=b&&b.Arrays;bx=b&&b.Charting;by=bx&&bx.Renderers;bz=by&&by.ChartJs;bA=bx&&bx.Chart;bB=bx&&bx.Pervasives;bC=be&&be.AttrModule;bD=b&&b.Enumerator;bE=be&&be.Key;bF=be&&be.ListModel;bG=b&&b.Option;bH=_4&&_4.PanelContainer;bI=_4&&_4.LayoutManagers;bJ=_4&&_4.Panel;bK=_4&&_4.TitleButton;bL=_4&&_4.Dialog;bM=bh&&bh.PropertyGrid;f.Server={$:1};f.Client={$:0};e.DataDirectory=function(){g.$cctor();return g.DataDirectory;};e.set_DataDirectory=function(bN){g.$cctor();g.DataDirectory=bN;};e.Log=function(){g.$cctor();return g.Log;};e.set_Log=function(bN){g.$cctor();g.Log=bN;};e.Role$1=function(){g.$cctor();return g.Role;};e.set_Role=function(bN){g.$cctor();g.Role=bN;};g.$cctor=_2.Cctor(function(){g.Role=f.Server;g.Log=a.ignore;g.DataDirectory="";g.$cctor=a.ignore;});i=h.Value=_2.Class({get_AsBoolean:function(){return this.$==2?this.$0:_3.FailWith("MessageBus.Value: unexpected type");},get_AsString:function(){return this.$==1?this.$0:_3.FailWith("MessageBus.Value: unexpected type");},get_AsNumber:function(){return this.$==0?this.$0:_3.FailWith("MessageBus.Value: unexpected type");}},null,i);j=h.Message=_2.Class({WithTime:function(bN){return j.New(this.Key,bN,this.Value);},WithKey:function(bN){return j.New(bN,this.Time,this.Value);}},null,j);j.Create=function(bN){return j.New(_5.UniqueKey(),_6.now(),bN);};j.New=function(bN,bO,bP){return new j({Key:bN,Time:bO,Value:bP});};k.Create=function(bN,bO,bP){return k.New(bN,bO,bP);};k.New=function(bN,bO,bP){return{Key:bN,Name:bO,CacheSize:bP};};l.Clear={$:4};m.get_empty=function(){return m.New(null,_7.T.Empty);};m.New=function(bN,bO){return{ServerCallback:bN,Listeners:bO};};h.RunServerRequests=function(){var bN;_8.Start((bN=null,_8.Delay(function(){return _8.While(function(){return true;},_8.Delay(function(){return _8.Bind(_8.Sleep(2*1000),function(){return _8.Bind(h.Agent().PostAndAsyncReply(function(bO){return{$:6,$0:bO};},null),function(bO){return _8.Bind((new _.New()).Async("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.MessageBus.GetMessages:1550733476",[bO]),function(bP){var bQ;_7.iter(function(bR){var bS;bS=h.Agent();bS.mailbox.AddLast({$:1,$0:bR});bS.resume();},bP);return bP.get_Length()>0?(bQ=(function(bR){return function(bS){return bR("Values from server requested messages received:"+a.String(bS));};}(a.id))(bP.get_Length()),(h.log())(bQ),_8.Zero()):_8.Zero();});});});}));})),null);};h.Agent=function(){n.$cctor();return n.Agent;};h.StringMessage=function(bN){return h.StringKeyMessage(_5.UniqueKey(),bN);};h.NumberMessage=function(bN){return h.NumberKeyMessage(_5.UniqueKey(),bN);};h.BooleanKeyMesage=function(bN,bO){return h.CreateMessage(bN,new i({$:2,$0:bO}));};h.StringKeyMessage=function(bN,bO){return h.CreateMessage(bN,new i({$:1,$0:bO}));};h.NumberKeyMessage=function(bN,bO){return h.CreateMessage(bN,new i({$:0,$0:bO}));};h.CreateMessage=function(bN,bO){return j.New(bN,_6.now(),bO);};h.log=function(){n.$cctor();return n.log;};n.$cctor=_2.Cctor(function(){n.log=e.Log();n.Agent=ba.Start(function(bN){function bO(bT,bU){return bb.fold(function(bV,bW){var bX;return(bX=bW.Time-bT,bX/1000)>0.01?new _7.T({$:1,$0:bW,$1:bV}):bV;},_7.T.Empty,bU);}function bP(bT,bU){return bT<bU.get_Length()?(_7.splitAt(bT,bU))[0]:bU;}function bQ(bT,bU,bV){return bT===1?_7.ofArray([bV]):bP(bT,new _7.T({$:1,$0:bV,$1:bU}));}function bR(bT,bU){function bV(bW,bX,bY){var bZ;bZ=a.Array.prototype.slice.call(arguments);return bW.Key===bT.Key?(bX(bT),[bW,bX,bQ(bW.CacheSize,bY,bT)]):bZ;}return _7.map(function(bW){return bV(bW[0],bW[1],bW[2]);},bU);}function bS(bT){var bU;bU=null;return _8.Delay(function(){return _8.Bind(bN.Receive(null),function(bV){var bW,bX,bY,bZ,b0,b1;function b2(b4,b5,b6){return bO(bY,b6);}function b3(b4,b5,b6){return b6.$==0?(new _6(0,0-1,0)).getTime():_7.maxBy(function(b7){return b7.Time;},b6).Time;}return bV.$==2?(bW=bV.$0[0],(bX=(((_2.Curried3(function(b4,b5,b6){return b4("RegisterListener:"+bc.toSafe(b5)+" "+bc.toSafe(b6));}))(a.id))(bW.Name))(bW.Key),(h.log())(bX),bS(m.New(bT.ServerCallback,new _7.T({$:1,$0:[bW,bV.$0[2],_7.T.Empty],$1:bT.Listeners}))))):bV.$==3?bS(m.New({$:1,$0:bV.$0},bT.Listeners)):bV.$==5?(bY=bV.$0[0],(bV.$0[1](bb.fold(function(b4,b5){return!_7.contains(b5,b4)?new _7.T({$:1,$0:b5,$1:b4}):b4;},_7.T.Empty,_7.concat(_7.map(function(b4){return b2(b4[0],b4[1],b4[2]);},bT.Listeners)))),bS(bT))):bV.$==6?(bZ=_7.map(function(b4){return b3(b4[0],b4[1],b4[2]);},bT.Listeners),(bV.$0(bZ.$==0?(new _6(0,0-1,0)).getTime():_7.max(bZ)),bS(bT))):bV.$==1?bS(m.New(bT.ServerCallback,bR(bV.$0,bT.Listeners))):bV.$==0?(b0=bV.$0,(b1=bT.ServerCallback,b1==null?void 0:b1.$0(b0),bS(m.New(bT.ServerCallback,bR(b0,bT.Listeners))))):bS(m.get_empty());});});}return bS(m.get_empty());},null);n.$cctor=a.ignore;});o.Create=function(bN,bO,bP){return o.New(bO.Key,bN,bO,bP);};o.New=function(bN,bO,bP,bQ){return{Key:bN,Name:bO,Value:bP,CacheSize:bQ};};p=d.InPort=_2.Class({Equals:function(bN){return bN instanceof p&&this.Data.Name===bN.Data.Name;},get_BooleanView:function(){return bf.Map(function(bN){return bN.Value.get_AsBoolean();},this.PortValue.v);},get_Boolean:function(){return this.PortValue.c.Value.get_AsBoolean();},get_StringView:function(){return bf.Map(function(bN){return bN.Value.get_AsString();},this.PortValue.v);},get_String:function(){return this.PortValue.c.Value.get_AsString();},get_NumberView:function(){return bf.Map(function(bN){return bN.Value.get_AsNumber();},this.PortValue.v);},get_Number:function(){return this.PortValue.c.Value.get_AsNumber();},Receive:function(bN){bg.Set(this.PortValue,bN);},get_Property:function(){var bN,bO,bP,bQ,bR;bN=this;bO=this.PortValue.c.Value;return bO.$==1?(bP=bg.Create$1(this.get_String()),(bf.Sink(function(bS){var bT;bg.Set(bN.PortValue,(bT=bN.PortValue.c,j.New(bT.Key,bT.Time,new i({$:1,$0:bS}))));},bP.v),bi.string(this.Data.Name,bP))):bO.$==2?(bQ=bg.Create$1(this.get_Boolean()),(bf.Sink(function(bS){var bT;bg.Set(bN.PortValue,(bT=bN.PortValue.c,j.New(bT.Key,bT.Time,new i({$:2,$0:bS}))));},bQ.v),bi.check(this.Data.Name,bQ))):(bR=bg.Create$1(this.get_Number()),(bf.Sink(function(bS){var bT;bg.Set(bN.PortValue,(bT=bN.PortValue.c,j.New(bT.Key,bT.Time,new i({$:0,$0:bS}))));},bR.v),bi["double"](this.Data.Name,bR)));},get_Key:function(){return this.Data.Key;},get_Name:function(){return this.Data.Name;}},null,p);p.Clone=function(bN){var bO,bP;return p.New((bO=bN.Data,o.New((bP=bj.NewGuid(),a.String(bP)),bO.Name,bO.Value,bO.CacheSize)),bg.Create$1(bN.PortValue.c));};p.ToData=function(bN){var bO;bO=bN.Data;return o.New(bO.Key,bO.Name,bN.PortValue.c,bO.CacheSize);};p.FromData=function(bN){return p.New(bN,bg.Create$1(bN.Value));};p.New=function(bN,bO){return new p({Data:bN,PortValue:bO});};q=d.OutPort=_2.Class({Equals:function(bN){return bN instanceof q&&this.Name===bN.Name;},Trigger:function(bN){var bO;bO=h.Agent();bO.mailbox.AddLast({$:0,$0:h.CreateMessage(this.Key,bN)});bO.resume();}},null,q);q.Clone=function(bN){return q.New(_5.UniqueKey(),bN.Name,bN.Type);};q.ToData=function(bN){return[bN.Name,bN.Type];};q.FromData=function(bN,bO){return q.New(bO.Key,bN,bO);};q.New=function(bN,bO,bP){return new q({Key:bN,Name:bO,Type:bP});};r.CreateWithCache=function(bN,bO,bP){return r.New(bN,_7.map(function(bQ){return o.Create(bQ[0],bQ[1],bQ[2]);},bO),bP);};r.Create=function(bN,bO,bP){function bQ(bR,bS){return o.Create(bR,bS,1);}return r.New(bN,_7.map(function(bR){return bQ(bR[0],bR[1]);},bO),bP);};r.New=function(bN,bO,bP){return{WorkerName:bN,InPorts:bO,OutPorts:bP};};s=d.Worker=_2.Class({Equals:function(bN){return bN instanceof s&&bk.Equals(this.Name,bN.Name);},get_Properties:function(){return new _7.T({$:1,$0:bi.string("Name",this.Name),$1:_7.map(function(bN){return bN.get_Property();},this.InPorts)});},get_Render:function(){var bN;bN=this.Renderer;return bN==null?bl.Empty():(bN.$0.WebSharper_Community_Dashboard_IRenderer$get_Render())(this);},get_CloneAndRun:function(){var bN,bO,bP;bN=bg.Create$1(this.Name.c);bO=_7.map(p.Clone,this.InPorts);bP=_7.map(q.Clone,this.OutPorts);return s.New(_5.UniqueKey(),bN,bO,bP,this.Runner,this.Renderer,this.DataContext,null).WithStartRunner();},get_ToData:function(){return r.New(this.Name.c,_7.map(p.ToData,this.InPorts),_7.map(q.ToData,this.OutPorts));},WithStartRunner:function(){var bN;bN=this.Runner;return bN==null?this:s.New(this.Key,this.Name,this.InPorts,this.OutPorts,this.Runner,this.Renderer,this.DataContext,(bN.$0.WebSharper_Community_Dashboard_IRunner$get_Run())(this));},WithRenderer:function(bN){return s.New(this.Key,this.Name,this.InPorts,this.OutPorts,this.Runner,{$:1,$0:bN},this.DataContext,this.RunnerContext);},WithRunner:function(bN){return s.New(this.Key,this.Name,this.InPorts,this.OutPorts,{$:1,$0:bN},this.Renderer,this.DataContext,this.RunnerContext);},WithKey:function(bN){return s.New(bN,this.Name,this.InPorts,this.OutPorts,this.Runner,this.Renderer,this.DataContext,this.RunnerContext);}},null,s);s.CreateWithRenderer=function(bN){(e.Log())("CreateWithRenderer");return s.Create(bN).WithRenderer(bN);};s.CreateWithRunner=function(bN){return s.Create(bN).WithRunner(bN);};s.Create=function(bN){return s.New(_5.UniqueKey(),bg.Create$1(bN.WebSharper_Community_Dashboard_IWorkerContext$get_Data().WorkerName),_7.map(p.FromData,bN.WebSharper_Community_Dashboard_IWorkerContext$get_Data().InPorts),_7.map(function(bO){return q.FromData(bO[0],bO[1]);},bN.WebSharper_Community_Dashboard_IWorkerContext$get_Data().OutPorts),null,null,bN,null);};s.New=function(bN,bO,bP,bQ,bR,bS,bT,bU){return new s({Key:bN,Name:bO,InPorts:bP,OutPorts:bQ,Runner:bR,Renderer:bS,DataContext:bT,RunnerContext:bU});};t.allInPorts=function(bN){return t.allPorts(bN,function(bO){return bO.InPorts;});};t.allOutPorts=function(bN){return t.allPorts(bN,function(bO){return bO.OutPorts;});};t.allPorts=function(bN,bO){return _7.concat(_7.map(bO,bN));};u=d.RandomRunner=_2.Class({WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bN){var bO;new bm.New();_8.Start((bO=null,_8.Delay(function(){return _8.While(function(){return true;},_8.Delay(function(){return _8.Bind(_8.Sleep(bN.InPorts.get_Item(2).get_Number()*1000<<0),function(){var bP,bQ,bR;bP=bN.InPorts.get_Item(0).get_Number();bQ=bN.InPorts.get_Item(1).get_Number();bR=bn.random()*bQ+bP;bN.OutPorts.get_Item(0).Trigger(new i({$:0,$0:bR}));return _8.Zero();});}));})),null);return null;};},WebSharper_Community_Dashboard_IWorkerContext$get_Data:function(){return this.RandomRunnerData;}},null,u);u.get_FromWorker=function(){return function(bN){return u.New(bN.get_ToData());};};u.get_Create=function(){return u.New(r.Create("Random",_7.ofArray([["Middle value",h.NumberMessage(100)],["Dispersion",h.NumberMessage(10)],["Delay sec.",h.NumberMessage(2)]]),_7.ofArray([["Random value",h.NumberMessage(0)]])));};u.New=function(bN){return new u({RandomRunnerData:bN});};w.New=function(bN,bO,bP,bQ,bR){return{Title:bN,Description:bO,ImageUrl:bP,Temperature:bQ,TemparatureMinMax:bR};};v.get=function(bN,bO){var bP;bP=null;return _8.Delay(function(){var bQ;bQ=(((_2.Curried3(function(bR,bS,bT){return bR("http://api.openweathermap.org/data/2.5/weather?q="+bc.toSafe(bS)+"&units=metric&appid="+bc.toSafe(bT));}))(a.id))(bO))(bN);bo.log("get key city "+bQ);return _8.TryWith(_8.Delay(function(){return _8.Bind(bq.AsyncMap(bu.asyncReadTextAtRuntime(false,"C:\\AEAFrame\\WebSharper.Community.Dashboard\\WebSharper.Community.Dashboard","","JSON","",bQ),function(bR){return bk.Equals(typeof bR,"string")?bv.parse(bR):bR;}),function(bR){var bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc;bo.log("get key city 2");return _8.Return((bS=bw.tryHead(bR.weather),bS==null?null:{$:1,$0:(bT=bS.$0,w.New((((_2.Curried3(function(cd,ce,cf){return cd(bc.toSafe(ce)+", "+bc.toSafe(cf));}))(a.id))((bV=(bU="name",bU in bR?{$:1,$0:bR[bU]}:null),bV==null?null:bV.$0)))((bY=(bW=bR.sys,(bX="country",bX in bW?{$:1,$0:bW[bX]}:null)),bY==null?null:bY.$0)),(b0=(bZ="main",bZ in bT?{$:1,$0:bT[bZ]}:null),b0==null?null:b0.$0),(function(cd){return function(ce){return cd("http://openweathermap.org/img/w/"+bc.toSafe(ce)+".png");};}(a.id))((b2=(b1="icon",b1 in bT?{$:1,$0:bT[b1]}:null),b2==null?null:b2.$0)),(b3=(b4=bR.main,(b5="temp",b5 in b4?{$:1,$0:b4[b5]}:null)),(b6=b3==null?null:{$:1,$0:1*b3.$0},b6==null?null:b6.$0)),[(b7=(b8=bR.main,(b9="temp_min",b9 in b8?{$:1,$0:b8[b9]}:null)),(b_=b7==null?null:{$:1,$0:1*b7.$0},b_==null?null:b_.$0)),(b$=(ca=bR.main,(cb="temp_max",cb in ca?{$:1,$0:ca[cb]}:null)),(cc=b$==null?null:{$:1,$0:1*b$.$0},cc==null?null:cc.$0))]))}));});}),function(bR){bo.log(bR.message);return _8.Return(null);});});};x=d.OpenWeatherRunner=_2.Class({WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bN){var bO;_8.Start((bO=null,_8.Delay(function(){return _8.While(function(){return true;},_8.Delay(function(){var bP,bQ,bR;bP=bN.InPorts.get_Item(0);bQ=bN.InPorts.get_Item(1);bR=bN.OutPorts.get_Item(0);return _8.Bind(v.get(bQ.get_String(),bP.get_String()),function(bS){return _8.Combine(bS==null?_8.Zero():(bo.log("Value generated:"+bS.$0.Title),bR.Trigger(new i({$:0,$0:+bS.$0.Temperature})),_8.Zero()),_8.Delay(function(){return _8.Bind(_8.Sleep(1000*15),function(){return _8.Return(null);});}));});}));})),null);return null;};},WebSharper_Community_Dashboard_IWorkerContext$get_Data:function(){return this.OpenWeatherRunnerData;}},null,x);x.get_FromWorker=function(){return function(bN){return x.New(bN.get_ToData());};};x.Create=function(bN,bO){return x.New(r.Create("OpenWeatherMap",_7.ofArray([["City",h.StringMessage(bN)],["ApiKey",h.StringMessage(bO)]]),_7.ofArray([["Temperature",h.NumberMessage(0)]])));};x.New=function(bN){return new x({OpenWeatherRunnerData:bN});};y.New=function(bN){return{DatabaseRunnerRun:bN};};z=d.DatabaseRunner=_2.Class({WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bN){var bO;bO=bN.InPorts.get_Item(1).get_String();_7.iter(function(bP){var bQ;bQ=h.Agent();bQ.mailbox.AddLast({$:0,$0:bP});bQ.resume();},(new _.New()).Sync("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.ServerDatabase.ReadAllMessages:965639103",[bO]));bf.Sink(function(bP){(new _.New()).Send("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.ServerDatabase.WriteMessage:-353093100",[bO,bP]);bN.OutPorts.get_Item(0).Trigger(bP.Value);},bN.InPorts.get_Item(0).PortValue.v);return null;};},WebSharper_Community_Dashboard_IWorkerContext$get_Data:function(){return this.DatabaseData;}},null,z);z.get_FromWorker=function(){return function(bN){return z.New(bN.get_ToData());};};z.get_Create=function(){return z.New(r.Create("Database",_7.ofArray([[" in Value",h.NumberMessage(100)],["Database name",h.StringMessage("Database.txt")]]),_7.ofArray([["Number value",h.NumberMessage(0)]])));};z.New=function(bN){return new z({DatabaseData:bN});};A.New=function(bN,bO){return{LineChart:bN,Queue:bO};};B=d.ChartRenderer=_2.Class({WebSharper_Community_Dashboard_IRenderer$get_Render:function(){return function(bN){var bO,bP,bQ,bR,bS,bT,bU,bV;bO=bN.InPorts.get_Item(3).get_Number()<<0;bP=bN.RunnerContext.$0;bf.Sink(function(bW){bP.Queue.push(bW);bP.Queue.length>bO?bP.Queue.shift():void 0;bb.iteri(function(bX,bY){return bP.LineChart.__UpdateData(bX,function(){return bY;});},bP.Queue);},bN.InPorts.get_Item(0).get_NumberView());return bz.Render$8(bN.RunnerContext.$0.LineChart,{$:1,$0:{$:0,$0:bN.InPorts.get_Item(1).get_Number()<<0,$1:bN.InPorts.get_Item(2).get_Number()<<0}},{$:1,$0:(bQ={},bQ.title=(bR={},bR.display=false,bR),bQ.legend=(bS={},bS.display=false,bS),bQ.elements=(bT={},bT.point=(bU={},bU.radius=0,bU),bT.line=(bV={},bV.borderWidth=1,bV),bT),bQ)},null);};},WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bN){var bO,bP,bQ,bR;bO=bN.InPorts.get_Item(3).get_Number()<<0;bP=_7.ofSeq(bb.delay(function(){return bb.map(function(){return 0;},_3.range(0,bO-1));}));bQ=(bR=[],(bb.iter(function(bS){bR.push(bS);},bP),bR));return{$:1,$0:A.New(bA.Line(bP).WithFill(false).__WithStrokeColor(new bB.Color({$:1,$0:"#FB8C00"})).__WithPointColor(new bB.Color({$:2,$0:"black"})),bQ)};};},WebSharper_Community_Dashboard_IWorkerContext$get_Data:function(){return this.ChartRendererData;}},null,B);B.get_FromWorker=function(){return function(bN){return B.New(bN.get_ToData());};};B.Create=function(bN,bO,bP){return B.New(r.CreateWithCache("Chart",_7.ofArray([[" in Value",h.NumberMessage(100),bP<<0],["cx",h.NumberMessage(bN),1],["cy",h.NumberMessage(bO),1],["BufferSize",h.NumberMessage(bP),1]]),_7.T.Empty));};B.New=function(bN){return new B({ChartRendererData:bN});};C=d.TextBoxRenderer=_2.Class({WebSharper_Community_Dashboard_IRenderer$get_Render:function(){return function(bN){var bO;bO=bf.Map(function(bP){var bQ;bQ=bP<<0;return a.String(bQ);},bN.InPorts.get_Item(0).get_NumberView());return bl.Element("div",[bC.Class("bigvalue")],[bl.TextView(bO)]);};},WebSharper_Community_Dashboard_IWorkerContext$get_Data:function(){return this.TextBoxRendererData;}},null,C);C.get_FromWorker=function(){return function(bN){return C.New(bN.get_ToData());};};C.get_Create=function(){return C.New(r.Create("Text",_7.ofArray([["in Value",h.NumberMessage(0)]]),_7.T.Empty));};C.New=function(bN){return new C({TextBoxRendererData:bN});};D=d.ButtonRenderer=_2.Class({WebSharper_Community_Dashboard_IRenderer$get_Render:function(){return function(bN){return bl.ButtonView(bN.InPorts.get_Item(0).get_String(),[],bN.InPorts.get_Item(1).get_BooleanView(),function(bO){bN.OutPorts.get_Item(0).Trigger(new i({$:2,$0:bO}));});};},WebSharper_Community_Dashboard_IWorkerContext$get_Data:function(){return this.ButtonRendererData;}},null,D);D.get_FromWorker=function(){return function(bN){return D.New(bN.get_ToData());};};D.get_Create=function(){return D.New(r.Create("Button",_7.ofArray([["Caption",h.StringMessage("Button")],["State",h.NumberMessage(0)]]),_7.ofArray([["Button value",h.NumberMessage(0)]])));};D.New=function(bN){return new D({ButtonRendererData:bN});};E.New=function(bN,bO,bP){return{InPortKey:bN,OutPortKey:bO,WorkerKey:bP};};F.New=function(bN){return{RuleChain:bN};};G=d.RuleContainer=_2.Class({Reconnect:function(bN){var bO,bP,bQ,bR;bO=e.Log();bP=t.allOutPorts(bN);bQ=t.allInPorts(bN);_7.iter(function(bS){(e.Log())((((_2.Curried3(function(bT,bU,bV){return bT(bc.toSafe(bU)+" "+bc.toSafe(bV));}))(a.id))(bS.get_Name()))(bS.Data.Key));},bQ);bR=h.Agent();bR.mailbox.AddLast(l.Clear);bR.resume();_7.iter(function(bS){var bT,bU,bV;bT=_7.ofSeq(bS.RuleChain);bU=_7.ofSeq(_3.range(1,bT.get_Length()-1));bV=bD.Get(bU);try{while(bV.MoveNext())(function(){var bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5;bW=bV.Current();bX=bT.get_Item(bW-1);bY=bT.get_Item(bW);{bZ=bb.tryFind(function(b6){return b6.Key===bX.OutPortKey;},bP),bZ==null?null:{$:1,$0:(b0=bZ.$0,(bO((((_2.Curried3(function(b6,b7,b8){return b6("Found outPort "+bc.toSafe(b7)+" try to find inPort:"+bc.toSafe(b8));}))(a.id))(bX.OutPortKey))(bY.InPortKey)),b1=bb.tryFind(function(b6){return b6.Data.Key===bY.InPortKey;},bQ),b1==null?null:{$:1,$0:(b2=b1.$0,(bO("Found inPort"),b2.PortValue.c.Key!==b2.Data.Key?bg.Set(b2.PortValue,b2.PortValue.c.WithKey(b2.Data.Key)):void 0,b3=(b4=b2.PortValue.c.Value,b4.$==1?j.Create(new i({$:1,$0:""})):b4.$==2?j.Create(new i({$:2,$0:false})):j.Create(new i({$:0,$0:0}))),b5=h.Agent(),b5.mailbox.AddLast({$:2,$0:[k.Create(b0.Key,b0.Name+"->"+b2.get_Name(),b2.Data.CacheSize),b3,function(b6){b2.Receive(b6);}]}),b5.resume()))}))};return;}}());}finally{if("Dispose"in bV)bV.Dispose();}},_7.ofSeq(this.RuleContainer));}},null,G);G.New=function(bN){return new G({RuleContainer:bN});};H.Create=function(bN){return H.New(bE.Fresh(),bN);};H.New=function(bN,bO){return{Key:bN,Worker:bO};};I=d.Factory=_2.Class({RegisterEvent:function(bN){this.EventItems.Append(H.Create(bN));},RegisterWidget:function(bN){this.WidgetItems.Append(H.Create(bN));}},null,I);I.get_Create=function(){return I.New(bF.Create(function(bN){return bN.Key;},_7.T.Empty),bF.Create(function(bN){return bN.Key;},_7.T.Empty));};I.New=function(bN,bO){return new I({EventItems:bN,WidgetItems:bO});};J.Create=function(bN,bO){return J.New(bE.Fresh(),bN,bO);};J.New=function(bN,bO,bP){return{Key:bN,Name:bO,SelectorRenderer:bP};};K=d.SelectorGroup=_2.Class({RenderMenu:function(bN,bO){var bP,bQ,bR,bS;bP=this;bQ=(bR=this.ChildCreatator,bR==null?bl.Element("tr",[],[]):(bS=bR.$0,bl.Element("tr",[],[bl.Element("td",[],[bl.Element("div",[bC.Style("margin-left","20px")],[_5.IconSmall("add",function(){var bT,bU;bT=bS();bU=J.Create(bT[0],bT[1]);bP.ItemOnCreated(bU);bP.SelectorItems.Append(bU);})])])])));return bl.Element("table",[],[bl.ConvertBy(function(bT){return bT.Key;},function(bT){var bU;bU=bf.Map(function(bV){return bN+bV;},bT.Name.v);return bl.Element("tr",[],[bl.Element("td",[bC.DynamicStyle("Color",bf.Map(function(bV){return bV==null?"#7D4600":bk.Equals(bV.$0.Key,bT.Key)?"#FB8C00":"#7D4600";},bO.v)),bC.Style("cursor","pointer"),bC.Handler("click",function(){return function(){bP.ItemOnSelected(bT);return bg.Set(bO,{$:1,$0:bT});};})],[bl.Element("div",[bC.Style("margin-left","10px"),bC.Style("margin-right","5px")],[bl.TextView(bU)])])]);},this.SelectorItems.v),bQ]);},ItemByIndex:function(bN){return _7.head(_7.ofSeq(this.SelectorItems));}},null,K);K.Create=function(bN,bO,bP,bQ,bR){var bS;bS=bF.Create(function(bT){return bT.Key;},_7.map(function(bT){return J.Create(bT[0],bT[1]);},bO));return K.New(bE.Fresh(),bg.Create$1(bN),bS,bP,bQ,bR);};K.New=function(bN,bO,bP,bQ,bR,bS){return new K({Key:bN,Name:bO,SelectorItems:bP,ChildCreatator:bQ,ItemOnCreated:bR,ItemOnSelected:bS});};L=d.WindowSelector=_2.Class({get_RenderMenu:function(){var bN;bN=this;return this.SelectorGroups.get_Length()===1?_7.head(_7.ofSeq(this.SelectorGroups)).RenderMenu("",this.OptSelectedItem):bl.Element("div",[],[bl.ConvertBy(function(bO){return bO.Key;},function(bO){return bl.Element("div",[],[bl.Element("div",[bC.Style("cursor","pointer"),bC.Handler("click",function(){return function(){return bN.GroupOnClick(bO);};})],[bl.TextView(bO.Name.v)]),bO.RenderMenu("    ",bN.OptSelectedItem)]);},this.SelectorGroups.v)]);},get_Render:function(){return bl.Element("div",[],[bl.BindView(function(bN){return bN==null?bl.Empty():bN.$0.SelectorRenderer;},this.OptSelectedItem.v)]);},GroupByIndex:function(bN){return bb.nth(bN,_7.ofSeq(this.SelectorGroups));},get_SelectedIndex:function(){var bN;bN=this;return bb.findIndex(function(bO){return bk.Equals(bO.Key,bN.get_SelectedItem().Key);},_7.concat(_7.map(function(bO){return _7.ofSeq(bO.SelectorItems);},_7.ofSeq(this.SelectorGroups))));},get_SelectedIndexInGroup:function(){var bN;bN=this;return bb.findIndex(function(bO){return bk.Equals(bO.Key,bN.get_SelectedItem().Key);},_7.ofSeq(this.get_SelectedGroup().SelectorItems));},get_SelectedGroupIndex:function(){var bN;bN=this;return bb.findIndex(function(bO){return bk.Equals(bO.Key,bN.get_SelectedGroup().Key);},_7.ofSeq(this.SelectorGroups));},get_SelectedGroup:function(){return this.GroupFromItem(this.get_SelectedItem());},GroupFromItem:function(bN){return bb.find(function(bO){return _7.exists(function(bP){return bk.Equals(bP.Key,bN.Key);},_7.ofSeq(bO.SelectorItems));},_7.ofSeq(this.SelectorGroups));},AppenGroup:function(bN,bO,bP){this.SelectorGroups.Append(K.Create(bN,bO,bP,this.ItemOnCreated(this.SelectorGroups.get_Length()),this.ItemOnSelected));},get_SelectedItem:function(){var bN;bN=this.OptSelectedItem.c;return bN==null?_3.FailWith("Something really wrong with WindowSelector"):bN.$0;},ClearGroups:function(){bg.Set(this.OptSelectedItem,null);_7.iter(function(bN){bN.SelectorItems.Clear();},_7.ofSeq(this.SelectorGroups));},WithItemOnSelected:function(bN){return L.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,bN);},WithGroupOnClick:function(bN){return L.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,bN,this.ItemOnSelected);},WithItemOnCreated:function(bN){return L.New(this.OptSelectedItem,this.SelectorGroups,bN,this.GroupOnClick,this.ItemOnSelected);}},null,L);L.get_Create=function(){var bN;bN=bF.Create(function(bO){return bO.Key;},_7.T.Empty);return L.New(bg.Create$1(null),bN,function(){return function(){return null;};},a.ignore,a.ignore);};L.New=function(bN,bO,bP,bQ,bR){return new L({OptSelectedItem:bN,SelectorGroups:bO,ItemOnCreated:bP,GroupOnClick:bQ,ItemOnSelected:bR});};M=d.RulesCellItem=_2.Class({Render:function(bN,bO){var bP,bQ,bR,bS,bT;bP=this;bf.Sink(function(bU){var bV;if(bU==null);else{bV=bU.$0;bo.log("Workitem selected");bg.Set(bP.OptInPort,_7.tryHead(bV.Worker.InPorts));bg.Set(bP.OptOutPort,_7.tryHead(bV.Worker.OutPorts));bO();}},this.OptWorker.v);bf.Sink(function(){bO();},this.OptInPort.v);bf.Sink(function(){bO();},this.OptOutPort.v);bQ=(bR=bf.Map(function(bU){var bV;return bU==null?_7.ofArray([null]):(bV=_7.map(function(bW){return{$:1,$0:bW};},bU.$0.Worker.InPorts),bV.get_Length()>0?bV:_7.ofArray([null]));},this.OptWorker.v),(bS=bf.Map(function(bU){var bV;return bU==null?_7.ofArray([null]):(bV=_7.map(function(bW){return{$:1,$0:bW};},bU.$0.Worker.OutPorts),bV.get_Length()>0?bV:_7.ofArray([null]));},this.OptWorker.v),(bT=bf.Map(function(bU){return new _7.T({$:1,$0:null,$1:_7.map(function(bV){return{$:1,$0:bV};},_7.ofSeq(bU))});},bN.v),bl.Element("table",[],[bl.Element("tr",[],[bl.Element("td",[],[bl.SelectDyn([bC.Class("form-control")],function(bU){return bG.fold(function(bV,bW){return bW.get_Name();}," ",bU);},bR,this.OptInPort)]),bl.Element("td",[],[bl.SelectDyn([bC.Class("form-control")],function(bU){return bG.fold(function(bV,bW){return bW.Worker.Name.c;}," ",bU);},bT,this.OptWorker)]),bl.Element("td",[],[bl.SelectDyn([bC.Class("form-control")],function(bU){return bG.fold(function(bV,bW){return bW.Name;}," ",bU);},bS,this.OptOutPort)])])]))));return bl.Element("td",[bC.Class("td DshEditorCell")],[bl.Element("div",[bC.Class("div DshEditorCell")],[bl.Element("table",[],[bl.Element("tr",[],[bl.Element("td",[],[bQ])])])])]);}},null,M);M.get_Create=function(){return M.New(bE.Fresh(),bg.Create$1(null),bg.Create$1(null),bg.Create$1(null));};M.New=function(bN,bO,bP,bQ){return new M({Key:bN,OptInPort:bO,OptWorker:bP,OptOutPort:bQ});};N=d.RulesRowItem=_2.Class({Render:function(bN,bO){var bP;bP=this;return bl.Element("tr",[],[bl.ConvertBy(function(bQ){return bQ.Key;},function(bQ){return bQ.Render(bN,bO);},this.CellItems.v),_5.IconNormal("add",function(){bP.CellItems.Append(M.get_Create());})]);}},null,N);N.Create=function(bN){return N.New(bE.Fresh(),bF.Create(function(bO){return bO.Key;},bN));};N.New=function(bN,bO){return new N({Key:bN,CellItems:bO});};O.Create=function(bN,bO){return O.New(bE.Fresh(),bN,bO);};O.New=function(bN,bO,bP){return{Key:bN,Panel:bO,Widget:bP};};P.Create=function(bN){return P.New(bE.Fresh(),bg.Create$1(bN),bF.Create(function(bO){return bO.Key;},_7.T.Empty));};P.New=function(bN,bO,bP){return{Key:bN,Name:bO,EventItems:bP};};Q.Create=function(bN,bO){return Q.New(bE.Fresh(),bg.Create$1(bN),bF.Create(function(bP){return bP.Key;},_7.T.Empty),bO);};Q.New=function(bN,bO,bP,bQ){return{Key:bN,Name:bO,WidgetItems:bP,PanelContainer:bQ};};R.Create=function(bN){return R.New(bE.Fresh(),bg.Create$1(bN),bF.Create(function(bO){return bO.Key;},_7.T.Empty));};R.New=function(bN,bO,bP){return{Key:bN,Name:bO,RulesRowItems:bP};};S=d.DshData=_2.Class({RegisterWidget:function(bN,bO,bP,bQ){var bR;bR=bQ.WithKey(bN);bO.WidgetItems.Append(O.Create(bP,bR));this.WorkItems.Append(H.Create(bR));},RegisterEvent:function(bN,bO,bP){var bQ;bQ=H.Create(bP.WithKey(bN));bO.EventItems.Append(bQ);this.WorkItems.Append(bQ);},get_Clear:function(){this.WorkItems.Clear();this.WidgetGroups.Clear();this.EventGroups.Clear();this.RulesGroups.Clear();}},null,S);S.get_Create=function(){return S.New(bF.Create(function(bN){return bN.Key;},_7.T.Empty),bF.Create(function(bN){return bN.Key;},_7.T.Empty),bF.Create(function(bN){return bN.Key;},_7.T.Empty),bF.Create(function(bN){return bN.Key;},_7.T.Empty));};S.New=function(bN,bO,bP,bQ){return new S({WorkItems:bN,WidgetGroups:bO,EventGroups:bP,RulesGroups:bQ});};T.Render=function(bN,bO){return bl.Element("table",[],[bl.ConvertBy(function(bP){return bP.Key;},function(bP){return bl.Element("tr",[],[bl.Element("i",_5.AttrsClick(function(){bO.Edit(bP.Worker.get_Properties());}),[bl.TextView(bP.Worker.Name.v)])]);},bN.v)]);};U.Render=function(bN,bO){function bP(){var bQ;bQ=_7.map(function(bR){return bR.Worker;},_7.ofSeq(bN.WorkItems));U.CopyToRules(bO).Reconnect(bQ);}return bl.Element("table",[],[bl.ConvertBy(function(bQ){return bQ.Key;},function(bQ){return bl.Element("tr",[],[bQ.Render(bN.WorkItems,function(){bP();})]);},bO.v)]);};U.Restore=function(bN,bO,bP){var bQ,bR,bS;bO.Clear();bQ=_7.map(function(bT){return bT.Worker;},_7.ofSeq(bN.WorkItems));bR=t.allOutPorts(bQ);bS=t.allInPorts(bQ);_7.iter(function(bT){var bU;bU=N.Create([]);_7.iter(function(bV){var bW;bW=M.get_Create();bg.Set(bW.OptWorker,bb.tryFind(function(bX){return bX.Worker.Key===bV.WorkerKey;},_7.ofSeq(bN.WorkItems)));bg.Set(bW.OptInPort,bb.tryFind(function(bX){return bX.get_Key()===bV.InPortKey;},bS));bg.Set(bW.OptOutPort,bb.tryFind(function(bX){return bX.Key===bV.OutPortKey;},bR));bU.CellItems.Append(bW);},bT.RuleChain);bO.Append(bU);},bP.RuleContainer);bP.Reconnect(bQ);};U.CopyToRules=function(bN){return G.New(_7.map(function(bO){return F.New(_7.map(function(bP){var bQ,bR,bS;return E.New((bQ=bP.OptInPort.c,bQ==null?"":bQ.$0.get_Key()),(bR=bP.OptOutPort.c,bR==null?"":bR.$0.Key),(bS=bP.OptWorker.c,bS==null?"":bS.$0.Worker.Key));},_7.ofSeq(bO.CellItems)));},_7.ofSeq(bN)));};V.RulesGroupCreator=function(bN,bO){var bP;bP=R.Create("rules"+a.String(_7.length(_7.ofSeq(bN.RulesGroups))+1));bN.RulesGroups.Append(bP);return[bP.Name,U.Render(bN,bP.RulesRowItems)];};V.EventsGroupCreator=function(bN,bO,bP){var bQ;bQ=P.Create("event"+a.String(_7.length(_7.ofSeq(bN.EventGroups))+1));bN.EventGroups.Append(bQ);return[bQ.Name,T.Render(bQ.EventItems,bO)];};V.PanelGroupCreator=function(bN,bO,bP){var bQ,bR,bS;bQ=_7.length(_7.ofSeq(bN.WidgetGroups))+1;bR=bO();bS=Q.Create("panel"+a.String(bQ),bR);bN.WidgetGroups.Append(bS);return[bS.Name,bR.get_Render()];};W=d.Dashboard=_2.Class({Render:function(bN){var bO;bO=this;return bl.EmbedView(bf.Map(function(bP){return bP.$==1?bl.Element("div",[],[bl.Element("table",[],[bl.Element("tr",[],[bl.Element("td",[bC.Style("vertical-align","top")],[bl.Element("table",[],bb.concat([_7.ofArray([bl.Element("tr",[],[bl.Element("td",[],[_5.IconNormal("dehaze",function(){bg.Set(bO.PanelTitleVisibility,false);bg.Set(bO.Mode,{$:0});})])])]),_7.ofArray([bO.EditorSelectorEdit.get_RenderMenu()]),_7.ofArray([bl.Element("tr",[],[bl.Element("td",[],[])]),bl.Element("tr",[],[bl.Element("td",[],[bO.PropertyGrid.get_Render()])])])]))]),bl.Element("td",[bC.Style("vertical-align","top")],[bN,_5.IconNormal("add",function(){var bQ,bR,bS,bT,bU;bQ=bO.EditorSelectorEdit.get_SelectedGroupIndex();bQ===1?(bR=_7.ofSeq(bO.Factory.EventItems),bS=bg.Create$1(_7.head(bR)),bO.Dialog.ShowDialog("Select source",bl.Element("div",[],[bl.Select([bC.Class("form-control")],function(bV){return bV.Worker.Name.c;},bR,bS)]),function(){var bV,bW,bX;bV=bS.c.Worker.get_CloneAndRun();bW=(bX=_7.ofSeq(bO.Data.EventGroups),bb.nth(bO.EditorSelectorEdit.get_SelectedIndexInGroup(),bX));bO.Data.RegisterEvent(_5.UniqueKey(),bW,bV);})):bQ===0?bO.CreatePanel((bT=_7.ofSeq(bO.Data.WidgetGroups),bb.nth(bO.EditorSelectorEdit.get_SelectedIndexInGroup(),bT)),"Panel",700,null):bQ===2?(bU=_7.ofSeq(bO.Data.RulesGroups),bb.nth(bO.EditorSelectorEdit.get_SelectedIndexInGroup(),bU)).RulesRowItems.Append(N.Create([M.get_Create(),M.get_Create()])):void 0;}),bO.EditorSelectorEdit.get_Render()])])]),bl.Element("div",[],[bO.Dialog.get_Render()])]):bl.Element("div",[],[bl.Element("table",[],[bl.Element("tr",[],[bl.Element("td",[bC.Style("vertical-align","top")],[_5.IconNormal("dehaze",function(){bg.Set(bO.PanelTitleVisibility,true);bg.Set(bO.Mode,{$:1});}),bO.EditorSelectorRun.GroupByIndex(0).SelectorItems.get_Length()>1?bO.EditorSelectorRun.get_RenderMenu():bl.Element("div",[],[])]),bl.Element("td",[],[bO.EditorSelectorRun.get_Render()])])])]);},this.Mode.v));},Restore:function(bN,bO,bP,bQ){var bR,bS,bT,bU,bV;bR=this;this.EditorSelectorRun.ClearGroups();this.EditorSelectorEdit.ClearGroups();this.Data.get_Clear();bS=this.EditorSelectorRun.GroupByIndex(0);bT=this.EditorSelectorEdit.GroupByIndex(0);bU=this.EditorSelectorEdit.GroupByIndex(1);bV=this.EditorSelectorEdit.GroupByIndex(2);_7.iteri(function(bW,bX){var bY,bZ,b0,b1;function b2(b3,b4,b5){bR.RegisterWidget(b3,b1,b4,bb.find(function(b6){return b6.Key===b4;},_7.ofSeq(b1.PanelContainer.PanelItems)).Children,b5.WithStartRunner());}bY=V.PanelGroupCreator(bR.Data,bN,null);bZ=bY[1];b0=bY[0];bg.Set(b0,bX[0]);bT.SelectorItems.Append(J.Create(b0,bZ));bS.SelectorItems.Append(J.Create(b0,bZ));b1=bb.nth(bW,_7.ofSeq(bR.Data.WidgetGroups));_7.iter(function(b3){var b4;b4=bR.CreatePanel(b1,"Panel",700,{$:1,$0:b3.Key});bg.Set(b4.Left,b3.Left);bg.Set(b4.Top,b3.Top);},bX[1]);return _7.iter(function(b3){return b2(b3[0],b3[1],b3[2]);},bX[2]);},bP);bo.log("Widgets restored");_7.iteri(function(bW,bX){var bY,bZ,b0;function b1(b2,b3){bR.Data.RegisterEvent(b2,b0,b3);}bY=V.EventsGroupCreator(bR.Data,bR.PropertyGrid,null);bZ=bY[0];bg.Set(bZ,bX[0]);bU.SelectorItems.Append(J.Create(bZ,bY[1]));b0=bb.nth(bW,_7.ofSeq(bR.Data.EventGroups));return _7.iter(function(b2){return b1(b2[0],b2[1]);},bX[1]);},bO);bo.log("Events restored");_7.iteri(function(bW,bX){var bY,bZ;bY=V.RulesGroupCreator(bR.Data,null);bZ=bY[0];bg.Set(bZ,bX[0]);bV.SelectorItems.Append(J.Create(bZ,bY[1]));return U.Restore(bR.Data,bb.nth(bW,_7.ofSeq(bR.Data.RulesGroups)).RulesRowItems,bX[1]);},bQ);this.Data.WidgetGroups.get_Length()>0?(bg.Set(this.EditorSelectorEdit.OptSelectedItem,{$:1,$0:_7.head(_7.ofSeq(this.EditorSelectorEdit.GroupByIndex(0).SelectorItems))}),bg.Set(this.EditorSelectorRun.OptSelectedItem,{$:1,$0:_7.head(_7.ofSeq(this.EditorSelectorRun.GroupByIndex(0).SelectorItems))})):(bg.Set(this.EditorSelectorEdit.OptSelectedItem,null),bg.Set(this.EditorSelectorRun.OptSelectedItem,null));bo.log("Connectors restored");},Store:function(bN){function bO(bQ,bR){var bS;bS=bN(bR);return bS==null?bQ:new _7.T({$:1,$0:[bR.Key,bS.$0],$1:bQ});}function bP(bQ,bR,bS){var bT;bT=bN(bS);return bT==null?bQ:new _7.T({$:1,$0:[bS.Key,bR,bT.$0],$1:bQ});}return[_7.map(function(bQ){return[bQ.Name.c,bb.fold(function(bR,bS){return bO(bR,bS.Worker);},_7.T.Empty,_7.ofSeq(bQ.EventItems))];},_7.ofSeq(this.Data.EventGroups)),_7.map(function(bQ){return[bQ.Name.c,_7.map(function(bR){return bR.get_PanelData();},_7.ofSeq(bQ.PanelContainer.PanelItems)),bb.fold(function(bR,bS){return bP(bR,bS.Panel,bS.Widget);},_7.T.Empty,_7.ofSeq(bQ.WidgetItems))];},_7.ofSeq(this.Data.WidgetGroups)),_7.map(function(bQ){return[bQ.Name.c,U.CopyToRules(bQ.RulesRowItems)];},_7.ofSeq(this.Data.RulesGroups))];},CreatePanel:function(bN,bO,bP,bQ){var bR,bS,bT,bU,bV,bW;bR=this;bl.ConvertBy(bN.WidgetItems.key,function(bX){return bl.Element("div",[],[bl.TextView(bX.Widget.Name.v)]);},bN.WidgetItems.v);bS=(bT=(bU=bj.NewGuid(),a.String(bU)),bQ==null?bT:bQ.$0);bV=bH.get_Create().WithLayoutManager(bI.StackPanelLayoutManager()).WithAttributes([bC.Style("border","1px solid white"),bC.Style("display","flex")]);bW=bJ.get_Create().WithKey(bS).WithPannelAttrs([bC.Style("Width",a.String(bP)+"px"),bC.Style("position","absolute")]).WithTitle(this.PanelTitleVisibility).WithTitleContent(bl.TextNode(bO)).WithTitleButtons(_7.ofArray([bK.New("add",function(bX){var bY,bZ;bY=_7.ofSeq(bR.Factory.WidgetItems);bZ=bg.Create$1(_7.head(bY));bR.Dialog.ShowDialog("Select widget",bl.Element("div",[],[bl.Select([bC.Class("form-control")],function(b0){return b0.Worker.Name.c;},bY,bZ)]),function(){bo.log("Dialog.IsOK");bR.RegisterWidget(_5.UniqueKey(),bN,bX.Key,bX.Children,bZ.c.Worker.get_CloneAndRun());});}),bK.New("edit",function(bX){bo.log("Edit");bR.PropertyGrid.Edit(_7.concat(_7.map(function(bY){return bY.Widget.get_Properties();},_7.filter(function(bY){return bY.Panel===bX.Key;},_7.ofSeq(bN.WidgetItems)))));}),bK.New("clear",function(bX){bN.PanelContainer.PanelItems.Remove(bN.PanelContainer.FindPanelItem(bX));})])).WithChildPanelContainer(bV);bN.PanelContainer.AddPanel(bW);return bW;},RegisterWidget:function(bN,bO,bP,bQ,bR){var bS;this.Data.RegisterWidget(bN,bO,bP,bR);bS=bJ.get_Create().WithPanelContent(bR.get_Render());bg.Set(bS.IsWithTitle,false);bQ.AddPanel(bS);}},null,W);W.Create=function(bN){var bO,bP,bQ,bR,bS,bT;function bU(){return V.PanelGroupCreator(bP,bN,void 0);}function bV(){return V.EventsGroupCreator(bP,bQ,void 0);}function bW(){return V.RulesGroupCreator(bP,void 0);}bO=bL.get_Create();bP=S.get_Create();bQ=bM.get_Create();bR=L.get_Create();bS=L.get_Create().WithGroupOnClick(function(bX){bQ.Edit(_7.mapi(function(bY,bZ){var b0;return bi.string((b0=bY+1,a.String(b0)),bZ.Name);},_7.ofSeq(bX.SelectorItems)));}).WithItemOnSelected(function(){bQ.Edit(_7.T.Empty);}).WithItemOnCreated(function(bX){return function(bY){return bX===0?_7.head(_7.ofSeq(bR.SelectorGroups)).SelectorItems.Append(bY):null;};});bT=bU();bS.AppenGroup("Panels",_7.ofArray([bT]),{$:1,$0:bU});bR.AppenGroup("Panels",_7.ofArray([bT]),null);bS.AppenGroup("Events",_7.ofArray([bV()]),{$:1,$0:bV});bS.AppenGroup("Rules",_7.ofArray([bW()]),{$:1,$0:bW});bg.Set(bS.OptSelectedItem,{$:1,$0:_7.head(_7.ofSeq(bS.GroupByIndex(0).SelectorItems))});bg.Set(bR.OptSelectedItem,{$:1,$0:_7.head(_7.ofSeq(bR.GroupByIndex(0).SelectorItems))});return W.New(I.get_Create(),bP,bQ,bO,bR,bS,bg.Create$1({$:0}),bg.Create$1(false));};W.New=function(bN,bO,bP,bQ,bR,bS,bT,bU){return new W({Factory:bN,Data:bO,PropertyGrid:bP,Dialog:bQ,EditorSelectorRun:bR,EditorSelectorEdit:bS,Mode:bT,PanelTitleVisibility:bU});};X.FromWorker=function(bN){var bO;bO=bN.DataContext;return bO instanceof u?{$:1,$0:{$:0,$0:(u.get_FromWorker())(bN)}}:bO instanceof x?{$:1,$0:{$:1,$0:(x.get_FromWorker())(bN)}}:bO instanceof z?{$:1,$0:{$:2,$0:(z.get_FromWorker())(bN)}}:bO instanceof C?{$:1,$0:{$:3,$0:(C.get_FromWorker())(bN)}}:bO instanceof B?{$:1,$0:{$:4,$0:(B.get_FromWorker())(bN)}}:bO instanceof D?{$:1,$0:{$:5,$0:(D.get_FromWorker())(bN)}}:null;};X.ToWorker=function(bN){var bO;return bN.$==1?s.CreateWithRunner(bN.$0):bN.$==2?s.CreateWithRunner(bN.$0):bN.$==3?s.CreateWithRenderer(bN.$0):bN.$==4?(bO=bN.$0,s.Create(bO).WithRunner(bO).WithRenderer(bO)):bN.$==5?s.CreateWithRenderer(bN.$0):s.CreateWithRunner(bN.$0);};Y.CreateDashboard=function(bN,bO){return Y.RegisterAppModelLib(bN,bO,W.Create(function(){return Y.PanelContainerCreator();}));};Y.PanelContainerCreator=function(bN){return bH.get_Create().WithLayoutManager(bI.FloatingPanelLayoutManager(5)).WithWidth(800).WithHeight(420).WithAttributes([bC.Style("border","1px solid white")]);};Y.RegisterAppModelLib=function(bN,bO,bP){function bQ(bS){Y.RegisterEventGeneral(bP,bN,bO,bS);}function bR(bS){Y.RegisterWidgetGeneral(bP,bN,bO,bS);}bQ(x.Create("London",""));bQ(u.get_Create());bQ(z.get_Create());bR(C.get_Create());bR(B.Create(300,100,50));bR(D.get_Create());return bP;};Y.RegisterWidgetGeneral=function(bN,bO,bP,bQ){var bR;Y.Register((bR=bN.Factory,function(bS){bR.RegisterWidget(bS);}),bO,bP,bQ);};Y.RegisterEventGeneral=function(bN,bO,bP,bQ){var bR;Y.Register((bR=bN.Factory,function(bS){bR.RegisterEvent(bS);}),bO,bP,bQ);};Y.Register=function(bN,bO,bP,bQ){var bR;bR=bO(s.Create(bQ));bR==null?void 0:bN(bP(bR.$0));};Z.RecreatWidgetsOnServer=function(bN,bO){function bP(bR,bS,bT){return bT;}function bQ(bR,bS,bT){return bT;}return _7.map(function(bR){return bP(bR[0],bR[1],bR[2]);},_7.concat(_7.map(function(bR){return bQ(bR[0],bR[1],bR[2]);},Z.RecreateWidgets(bN,bO))));};Z.RecreateEventsOnServer=function(bN,bO){function bP(bR,bS){return bS;}function bQ(bR,bS){return bS;}return _7.map(function(bR){return bP(bR[0],bR[1]);},_7.concat(_7.map(function(bR){return bQ(bR[0],bR[1]);},Z.RecreateEvents(a.id,bN,bO))));};Z.RecreateOnClient=function(bN,bO,bP,bQ,bR,bS,bT){var bU;e.set_Role(f.Client);bU=h.Agent();bU.mailbox.AddLast({$:3,$0:function(bV){(new _.New()).Send("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.MessageBus.SendToServer:-1358505674",[bV]);}});bU.resume();bO.Restore(bP,Z.RecreateEvents(bN,bQ,bR),Z.RecreateWidgets(bQ,bS),bT);};Z.RecreateWidgets=function(bN,bO){function bP(bQ,bR,bS){function bT(bU,bV,bW){return[bU,bV,bN(bW)];}return[bQ,bR,_7.map(function(bU){return bT(bU[0],bU[1],bU[2]);},bS)];}return _7.map(function(bQ){return bP(bQ[0],bQ[1],bQ[2]);},bO);};Z.RecreateEvents=function(bN,bO,bP){function bQ(bR,bS){function bT(bU,bV){return[bU,bN(bO(bV))];}return[bR,_7.map(function(bU){return bT(bU[0],bU[1]);},bS)];}return _7.map(function(bR){return bQ(bR[0],bR[1]);},bP);};_0=d.AppData=_2.Class({RecreateOnServer:function(bN){var bO,bP;function bQ(bR,bS){bS.Reconnect(bP);}bO=Z.RecreateEventsOnServer(bN,this.Events);bP=_7.map(function(bR){return bR.WithStartRunner();},_7.append(bO,Z.RecreatWidgetsOnServer(bN,this.Widgets)));_7.iter(function(bR){return bQ(bR[0],bR[1]);},this.Rules);return bO;},RecreateOnClientEventsRunning:function(bN,bO,bP){Z.RecreateOnClient(function(bQ){return bQ.WithStartRunner();},bN,bO,bP,this.Events,this.Widgets,this.Rules);},RecreateOnClientEventsNotRunning:function(bN,bO,bP){Z.RecreateOnClient(a.id,bN,bO,bP,this.Events,this.Widgets,this.Rules);}},null,_0);_0.Create=function(bN,bO){var bP;bP=bN.Store(bO);return _0.New(bP[0],bP[1],bP[2]);};_0.empty=function(){return _0.New(_7.T.Empty,_7.T.Empty,_7.T.Empty);};_0.New=function(bN,bO,bP){return new _0({Events:bN,Widgets:bO,Rules:bP});};}());
