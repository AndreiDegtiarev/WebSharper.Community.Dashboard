(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Community=b.Community||{};d=c.Dashboard=c.Dashboard||{};e=d.Environment=d.Environment||{};f=e.Role=e.Role||{};g=a.StartupCode$WebSharper_Community_Dashboard$Environment=a.StartupCode$WebSharper_Community_Dashboard$Environment||{};h=d.MessageBus=d.MessageBus||{};i=h.Value=h.Value||{};j=h.Message=h.Message||{};k=h.ListenerInfo=h.ListenerInfo||{};l=h.AgentMessage=h.AgentMessage||{};m=h.AgentState=h.AgentState||{};n=a.StartupCode$WebSharper_Community_Dashboard$MessageBus=a.StartupCode$WebSharper_Community_Dashboard$MessageBus||{};o=d.InPortData=d.InPortData||{};p=d.InPort=d.InPort||{};q=d.OutPort=d.OutPort||{};r=d.WorkerData=d.WorkerData||{};s=d.Worker=d.Worker||{};t=d.Workers=d.Workers||{};u=d.RuleEntry=d.RuleEntry||{};v=d.RuleChain=d.RuleChain||{};w=d.RuleContainer=d.RuleContainer||{};x=d.WorkerItem=d.WorkerItem||{};y=d.Factory=d.Factory||{};z=d.RulesCellItem=d.RulesCellItem||{};A=d.RulesRowItem=d.RulesRowItem||{};B=d.SelectorGroup=d.SelectorGroup||{};C=d.WindowSelector=d.WindowSelector||{};D=d.WidgetItem=d.WidgetItem||{};E=d.EventsGroupItem=d.EventsGroupItem||{};F=d.WidgetsGroupItem=d.WidgetsGroupItem||{};G=d.RulesGroupItem=d.RulesGroupItem||{};H=d.DshData=d.DshData||{};I=d.RulesEditor=d.RulesEditor||{};J=d.DshHelper=d.DshHelper||{};K=d.Dashboard=d.Dashboard||{};L=d.Events=d.Events||{};M=L.RandomEvent=L.RandomEvent||{};N=L.DatabaseEventContext=L.DatabaseEventContext||{};O=L.DatabaseEvent=L.DatabaseEvent||{};P=L.OpenWeather=L.OpenWeather||{};Q=P.Forecast=P.Forecast||{};R=L.OpenWeatherEvent=L.OpenWeatherEvent||{};S=L.ClockEvent=L.ClockEvent||{};T=d.Widgets=d.Widgets||{};U=T.TextBoxWidget=T.TextBoxWidget||{};V=T.ChartWidgetContext=T.ChartWidgetContext||{};W=T.ChartWidget=T.ChartWidget||{};X=T.ButtonWidget=T.ButtonWidget||{};Y=d.AppModelLib=d.AppModelLib||{};Z=d.App=d.App||{};_0=a.StartupCode$WebSharper_Community_Dashboard$AppModelLib=a.StartupCode$WebSharper_Community_Dashboard$AppModelLib||{};_1=d.AppDataHelper=d.AppDataHelper||{};_2=d.AppData=d.AppData||{};_3=a.IntelliFactory;_4=_3&&_3.Runtime;_5=b&&b.Operators;_6=c&&c.Panel;_7=_6&&_6.Helper;_8=a.Date;_9=b&&b.List;_=b&&b.Concurrency;$=b&&b.Remoting;ba=$&&$.AjaxRemotingProvider;bb=b&&b.Control;bc=bb&&bb.MailboxProcessor;bd=b&&b.Seq;be=b&&b.Utils;bf=b&&b.UI;bg=bf&&bf.Next;bh=bg&&bg.View;bi=bg&&bg.Var;bj=c&&c.PropertyGrid;bk=bj&&bj.Properties;bl=b&&b.Guid;bm=b&&b.Unchecked;bn=bg&&bg.Doc;bo=b&&b.Enumerator;bp=b&&b.MatchFailureException;bq=bg&&bg.Key;br=bg&&bg.ListModel;bs=a.console;bt=bg&&bg.AttrModule;bu=b&&b.Option;bv=_6&&_6.WrapControls;bw=_6&&_6.PanelContainer;bx=_6&&_6.LayoutManagers;by=_6&&_6.Panel;bz=_6&&_6.TitleButton;bA=_6&&_6.Dialog;bB=bj&&bj.PropertyGrid;bC=b&&b.Random;bD=a.Math;bE=b&&b.Data;bF=bE&&bE.TxtRuntime;bG=a.FSharp;bH=bG&&bG.Data;bI=bH&&bH.Runtime;bJ=bI&&bI.IO;bK=a.JSON;bL=b&&b.Arrays;bM=b&&b.DateUtil;bN=b&&b.Charting;bO=bN&&bN.Renderers;bP=bO&&bO.ChartJs;bQ=bb&&bb.FSharpEvent;bR=bN&&bN.LiveChart;bS=bN&&bN.Pervasives;f.Server={$:1};f.Client={$:0};e.DataDirectory=function(){g.$cctor();return g.DataDirectory;};e.set_DataDirectory=function(bT){g.$cctor();g.DataDirectory=bT;};e.Log=function(){g.$cctor();return g.Log;};e.set_Log=function(bT){g.$cctor();g.Log=bT;};e.Role$1=function(){g.$cctor();return g.Role;};e.set_Role=function(bT){g.$cctor();g.Role=bT;};g.$cctor=_4.Cctor(function(){g.Role=f.Server;g.Log=a.ignore;g.DataDirectory="";g.$cctor=a.ignore;});i=h.Value=_4.Class({get_AsSelect:function(){return this.$==3?this.$0:_5.FailWith("MessageBus.Value: unexpected type");},get_AsBoolean:function(){return this.$==2?this.$0:_5.FailWith("MessageBus.Value: unexpected type");},get_AsString:function(){return this.$==1?this.$0:_5.FailWith("MessageBus.Value: unexpected type");},get_AsNumber:function(){return this.$==0?this.$0:_5.FailWith("MessageBus.Value: unexpected type");}},null,i);j=h.Message=_4.Class({WithTime:function(bT){return j.New(this.Key,bT,this.Value);},WithKey:function(bT){return j.New(bT,this.Time,this.Value);}},null,j);j.Create=function(bT){return j.New(_7.UniqueKey(),_8.now(),bT);};j.New=function(bT,bU,bV){return new j({Key:bT,Time:bU,Value:bV});};k.Create=function(bT,bU,bV){return k.New(bT,bU,bV);};k.New=function(bT,bU,bV){return{Key:bT,Name:bU,CacheSize:bV};};l.Clear={$:4};m.get_empty=function(){return m.New(null,_9.T.Empty);};m.New=function(bT,bU){return{ServerCallback:bT,Listeners:bU};};h.RunServerRequests=function(){var bT;_.Start((bT=null,_.Delay(function(){return _.While(function(){return true;},_.Delay(function(){return _.Bind(_.Sleep(2*1000),function(){return _.Bind(h.Agent().PostAndAsyncReply(function(bU){return{$:6,$0:bU};},null),function(bU){return _.Bind((new ba.New()).Async("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.MessageBus.GetMessages:1550733476",[bU]),function(bV){var bW;_9.iter(function(bX){var bY;bY=h.Agent();bY.mailbox.AddLast({$:1,$0:bX});bY.resume();},bV);return bV.get_Length()>0?(bW=(function(bX){return function(bY){return bX("Values from server requested messages received:"+a.String(bY));};}(a.id))(bV.get_Length()),(h.log())(bW),_.Zero()):_.Zero();});});});}));})),null);};h.Agent=function(){n.$cctor();return n.Agent;};h.SelectMessage=function(bT,bU){return h.CreateMessage(_7.UniqueKey(),new i({$:3,$0:[bT,bU]}));};h.StringMessage=function(bT){return h.StringKeyMessage(_7.UniqueKey(),bT);};h.NumberMessage=function(bT){return h.NumberKeyMessage(_7.UniqueKey(),bT);};h.BooleanKeyMesage=function(bT,bU){return h.CreateMessage(bT,new i({$:2,$0:bU}));};h.StringKeyMessage=function(bT,bU){return h.CreateMessage(bT,new i({$:1,$0:bU}));};h.NumberKeyMessage=function(bT,bU){return h.CreateMessage(bT,new i({$:0,$0:bU}));};h.CreateMessage=function(bT,bU){return j.New(bT,_8.now(),bU);};h.log=function(){n.$cctor();return n.log;};n.$cctor=_4.Cctor(function(){n.log=e.Log();n.Agent=bc.Start(function(bT){function bU(bZ,b0){return bd.fold(function(b1,b2){var b3;return(b3=b2.Time-bZ,b3/1000)>0.01?new _9.T({$:1,$0:b2,$1:b1}):b1;},_9.T.Empty,b0);}function bV(bZ,b0){return bZ<b0.get_Length()?(_9.splitAt(bZ,b0))[0]:b0;}function bW(bZ,b0,b1){return bZ===1?_9.ofArray([b1]):bV(bZ,new _9.T({$:1,$0:b1,$1:b0}));}function bX(bZ,b0){function b1(b2,b3,b4){var b5;b5=a.Array.prototype.slice.call(arguments);return b2.Key===bZ.Key?(b3(bZ),[b2,b3,bW(b2.CacheSize,b4,bZ)]):b5;}return _9.map(function(b2){return b1(b2[0],b2[1],b2[2]);},b0);}function bY(bZ){var b0;b0=null;return _.Delay(function(){return _.Bind(bT.Receive(null),function(b1){var b2,b3,b4,b5,b6,b7,b8;function b9(b$,ca,cb){return bU(b4,cb);}function b_(b$,ca,cb){return cb.$==0?(new _8(0,0-1,0)).getTime():_9.maxBy(function(cc){return cc.Time;},cb).Time;}return b1.$==2?(b2=b1.$0[0],(b3=(((_4.Curried3(function(b$,ca,cb){return b$("RegisterListener:"+be.toSafe(ca)+" "+be.toSafe(cb));}))(a.id))(b2.Name))(b2.Key),(h.log())(b3),bY(m.New(bZ.ServerCallback,new _9.T({$:1,$0:[b2,b1.$0[2],_9.T.Empty],$1:bZ.Listeners}))))):b1.$==3?bY(m.New({$:1,$0:b1.$0},bZ.Listeners)):b1.$==5?(b4=b1.$0[0],(b1.$0[1](bd.fold(function(b$,ca){return!_9.contains(ca,b$)?new _9.T({$:1,$0:ca,$1:b$}):b$;},_9.T.Empty,_9.concat(_9.map(function(b$){return b9(b$[0],b$[1],b$[2]);},bZ.Listeners)))),bY(bZ))):b1.$==6?(b5=_9.map(function(b$){return b_(b$[0],b$[1],b$[2]);},bZ.Listeners),(b1.$0(b5.$==0?(new _8(0,0-1,0)).getTime():_9.max(b5)),bY(bZ))):b1.$==1?bY(m.New(bZ.ServerCallback,bX(b1.$0,bZ.Listeners))):b1.$==0?(b6=b1.$0,(b7=(((_4.Curried3(function(b$,ca,cb){return b$("Num listeners:"+a.String(ca)+" msg:"+be.toSafe(cb));}))(a.id))(bZ.Listeners.get_Length()))(b6.Key),(h.log())(b7),(b8=bZ.ServerCallback,b8==null?void 0:b8.$0(b6)),bY(m.New(bZ.ServerCallback,bX(b6,bZ.Listeners))))):bY(m.get_empty());});});}return bY(m.get_empty());},null);n.$cctor=a.ignore;});o.Create=function(bT,bU,bV){return o.New(bU.Key,bT,bU,bV);};o.New=function(bT,bU,bV,bW){return{Key:bT,Name:bU,Value:bV,CacheSize:bW};};p=d.InPort=_4.Class({Equals:function(bT){return bT instanceof p&&this.Data.Name===bT.Data.Name;},get_SelectView:function(){return bh.Map(function(bT){return bT.Value.get_AsSelect();},this.PortValue.v);},get_Select:function(){return this.PortValue.c.Value.get_AsSelect();},get_BooleanView:function(){return bh.Map(function(bT){return bT.Value.get_AsBoolean();},this.PortValue.v);},get_Boolean:function(){return this.PortValue.c.Value.get_AsBoolean();},get_StringView:function(){return bh.Map(function(bT){return bT.Value.get_AsString();},this.PortValue.v);},get_String:function(){return this.PortValue.c.Value.get_AsString();},get_NumberView:function(){return bh.Map(function(bT){return bT.Value.get_AsNumber();},this.PortValue.v);},get_Number:function(){return this.PortValue.c.Value.get_AsNumber();},Receive:function(bT){bi.Set(this.PortValue,bT);},get_Property:function(){var bT,bU,bV,bW,bX,bY,bZ;bT=this;bU=this.PortValue.c.Value;return bU.$==1?(bV=bi.Create$1(this.get_String()),(bh.Sink(function(b0){var b1;bi.Set(bT.PortValue,(b1=bT.PortValue.c,j.New(b1.Key,b1.Time,new i({$:1,$0:b0}))));},bV.v),bk.string(this.Data.Name,bV))):bU.$==2?(bW=bi.Create$1(this.get_Boolean()),(bh.Sink(function(b0){var b1;bi.Set(bT.PortValue,(b1=bT.PortValue.c,j.New(b1.Key,b1.Time,new i({$:2,$0:b0}))));},bW.v),bk.check(this.Data.Name,bW))):bU.$==3?(bX=bU.$0[1],(bY=bi.Create$1(bX.get_Item(bU.$0[0])),(bh.Sink(function(b0){var b1;bi.Set(bT.PortValue,(b1=bT.PortValue.c,j.New(b1.Key,b1.Time,new i({$:3,$0:[bd.findIndex(function(b2){return b2===b0;},bX),bX]}))));},bY.v),bk.select(this.Data.Name,a.id,bX,bY)))):(bZ=bi.Create$1(this.get_Number()),(bh.Sink(function(b0){var b1;bi.Set(bT.PortValue,(b1=bT.PortValue.c,j.New(b1.Key,b1.Time,new i({$:0,$0:b0}))));},bZ.v),bk["double"](this.Data.Name,bZ)));},get_Key:function(){return this.Data.Key;},get_Name:function(){return this.Data.Name;}},null,p);p.Clone=function(bT){var bU,bV;return p.New((bU=bT.Data,o.New((bV=bl.NewGuid(),a.String(bV)),bU.Name,bU.Value,bU.CacheSize)),bi.Create$1(bT.PortValue.c));};p.ToData=function(bT){var bU;bU=bT.Data;return o.New(bU.Key,bU.Name,bT.PortValue.c,bU.CacheSize);};p.FromData=function(bT){return p.New(bT,bi.Create$1(bT.Value));};p.New=function(bT,bU){return new p({Data:bT,PortValue:bU});};q=d.OutPort=_4.Class({Equals:function(bT){return bT instanceof q&&this.Name===bT.Name;},Trigger:function(bT){var bU;bU=h.Agent();bU.mailbox.AddLast({$:0,$0:h.CreateMessage(this.Key,bT)});bU.resume();}},null,q);q.Clone=function(bT){return q.New(_7.UniqueKey(),bT.Name,bT.Type);};q.ToData=function(bT){return[bT.Name,bT.Type];};q.FromData=function(bT,bU){return q.New(bU.Key,bT,bU);};q.New=function(bT,bU,bV){return new q({Key:bT,Name:bU,Type:bV});};r.CreateWithCache=function(bT,bU,bV){return r.New(bT,_9.map(function(bW){return o.Create(bW[0],bW[1],bW[2]);},bU),bV);};r.Create=function(bT,bU,bV){function bW(bX,bY){return o.Create(bX,bY,1);}return r.New(bT,_9.map(function(bX){return bW(bX[0],bX[1]);},bU),bV);};r.New=function(bT,bU,bV){return{WorkerName:bT,InPorts:bU,OutPorts:bV};};s=d.Worker=_4.Class({Equals:function(bT){return bT instanceof s&&bm.Equals(this.Name,bT.Name);},get_Properties:function(){return new _9.T({$:1,$0:bk.string("Name",this.Name),$1:_9.map(function(bT){return bT.get_Property();},this.InPorts)});},get_Render:function(){var bT;bT=this.Data.WebSharper_Community_Dashboard_IWorkerData$get_Render();return bT==null?bn.Empty():bT.$0(this);},get_Clone:function(){return s.New(_7.UniqueKey(),bi.Create$1(this.Name.c),_9.map(p.Clone,this.InPorts),_9.map(q.Clone,this.OutPorts),this.Data,bi.Create$1(null));},get_ToData:function(){return r.New(this.Name.c,_9.map(p.ToData,this.InPorts),_9.map(q.ToData,this.OutPorts));},StartRunner:function(){var bT;bT=this.Data.WebSharper_Community_Dashboard_IWorkerData$get_Run();bT==null?void 0:bi.Set(this.RunnerContext,bT.$0(this));},WithKey:function(bT){return s.New(bT,this.Name,this.InPorts,this.OutPorts,this.Data,this.RunnerContext);}},null,s);s.Create=function(bT){return s.New(_7.UniqueKey(),bi.Create$1(bT.WebSharper_Community_Dashboard_IWorkerData$get_Data().WorkerName),_9.map(p.FromData,bT.WebSharper_Community_Dashboard_IWorkerData$get_Data().InPorts),_9.map(function(bU){return q.FromData(bU[0],bU[1]);},bT.WebSharper_Community_Dashboard_IWorkerData$get_Data().OutPorts),bT,bi.Create$1(null));};s.New=function(bT,bU,bV,bW,bX,bY){return new s({Key:bT,Name:bU,InPorts:bV,OutPorts:bW,Data:bX,RunnerContext:bY});};t.allInPorts=function(bT){return t.allPorts(bT,function(bU){return bU.InPorts;});};t.allOutPorts=function(bT){return t.allPorts(bT,function(bU){return bU.OutPorts;});};t.allPorts=function(bT,bU){return _9.concat(_9.map(bU,bT));};u.New=function(bT,bU,bV){return{InPortKey:bT,OutPortKey:bU,WorkerKey:bV};};v.New=function(bT){return{RuleChain:bT};};w=d.RuleContainer=_4.Class({Reconnect:function(bT){var bU,bV,bW,bX;bU=e.Log();bV=t.allOutPorts(bT);bW=t.allInPorts(bT);_9.iter(function(bY){(e.Log())((((_4.Curried3(function(bZ,b0,b1){return bZ("InPort: "+be.toSafe(b0)+" "+be.toSafe(b1));}))(a.id))(bY.get_Name()))(bY.Data.Key));},bW);_9.iter(function(bY){(e.Log())((((_4.Curried3(function(bZ,b0,b1){return bZ("outPort: "+be.toSafe(b0)+" "+be.toSafe(b1));}))(a.id))(bY.Name))(bY.Key));},bV);bX=h.Agent();bX.mailbox.AddLast(l.Clear);bX.resume();_9.iter(function(bY){var bZ,b0,b1;bZ=_9.ofSeq(bY.RuleChain);b0=_9.ofSeq(_5.range(1,bZ.get_Length()-1));b1=bo.Get(b0);try{while(b1.MoveNext())(function(){var b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc;b7=b1.Current();b8=bZ.get_Item(b7-1);b9=bZ.get_Item(b7);b_=bd.tryFind(function(cd){return cd.Key===b8.OutPortKey;},bV);if(b_==null)null;else{b$=b_.$0;bU((((_4.Curried3(function(cd,ce,cf){return cd("Found outPort "+be.toSafe(ce)+" try to find inPort:"+be.toSafe(cf));}))(a.id))(b8.OutPortKey))(b9.InPortKey));ca=bd.tryFind(function(cd){return cd.Data.Key===b9.InPortKey;},bW);if(ca==null)b2=null;else{cb=ca.$0;bU("Found inPort");cb.PortValue.c.Key!==cb.Data.Key?bi.Set(cb.PortValue,cb.PortValue.c.WithKey(cb.Data.Key)):null;cc=cb.PortValue.c.Value;if(cc.$==0)b5=j.Create(new i({$:0,$0:0}));else if(cc.$==1)b5=j.Create(new i({$:1,$0:""}));else if(cc.$==2)b5=j.Create(new i({$:2,$0:false}));else throw new bp.New("Rules.fs",37,106);b4=(b6=h.Agent(),(b6.mailbox.AddLast({$:2,$0:[k.Create(b$.Key,b$.Name+"->"+cb.get_Name(),cb.Data.CacheSize),b5,function(cd){cb.Receive(cd);}]}),b6.resume()));b2={$:1,$0:b4};}({$:1,$0:b2});}}());}finally{if("Dispose"in b1)b1.Dispose();}},_9.ofSeq(this.RuleContainer));}},null,w);w.New=function(bT){return new w({RuleContainer:bT});};x.Create=function(bT){return x.New(bq.Fresh(),bT);};x.New=function(bT,bU){return{Key:bT,Worker:bU};};y=d.Factory=_4.Class({RegisterEvent:function(bT){this.EventItems.Append(x.Create(bT));},RegisterWidget:function(bT){this.WidgetItems.Append(x.Create(bT));}},null,y);y.get_Create=function(){return y.New(br.Create(function(bT){return bT.Key;},_9.T.Empty),br.Create(function(bT){return bT.Key;},_9.T.Empty));};y.New=function(bT,bU){return new y({EventItems:bT,WidgetItems:bU});};z=d.RulesCellItem=_4.Class({Render:function(bT,bU){var bV,bW,bX,bY,bZ;bV=this;bh.Sink(function(b0){var b1;if(b0==null);else{b1=b0.$0;bs.log("Workitem selected");bi.Set(bV.OptInPort,_9.tryHead(b1.Worker.InPorts));bi.Set(bV.OptOutPort,_9.tryHead(b1.Worker.OutPorts));bU();}},this.OptWorker.v);bh.Sink(function(){bU();},this.OptInPort.v);bh.Sink(function(){bU();},this.OptOutPort.v);bW=(bX=bh.Map(function(b0){var b1;return b0==null?_9.ofArray([null]):(b1=_9.map(function(b2){return{$:1,$0:b2};},b0.$0.Worker.InPorts),b1.get_Length()>0?b1:_9.ofArray([null]));},this.OptWorker.v),(bY=bh.Map(function(b0){var b1;return b0==null?_9.ofArray([null]):(b1=_9.map(function(b2){return{$:1,$0:b2};},b0.$0.Worker.OutPorts),b1.get_Length()>0?b1:_9.ofArray([null]));},this.OptWorker.v),(bZ=bh.Map(function(b0){return new _9.T({$:1,$0:null,$1:_9.map(function(b1){return{$:1,$0:b1};},_9.ofSeq(b0))});},bT.v),bn.Element("table",[],[bn.Element("tr",[],[bn.Element("td",[],[bn.SelectDyn([bt.Class("form-control")],function(b0){return bu.fold(function(b1,b2){return b2.get_Name();}," ",b0);},bX,this.OptInPort)]),bn.Element("td",[],[bn.SelectDyn([bt.Class("form-control")],function(b0){return bu.fold(function(b1,b2){return b2.Worker.Name.c;}," ",b0);},bZ,this.OptWorker)]),bn.Element("td",[],[bn.SelectDyn([bt.Class("form-control")],function(b0){return bu.fold(function(b1,b2){return b2.Name;}," ",b0);},bY,this.OptOutPort)])])]))));return bn.Element("td",[bt.Class("td DshEditorCell")],[bn.Element("div",[bt.Class("div DshEditorCell")],[bn.Element("table",[],[bn.Element("tr",[],[bn.Element("td",[],[bW])])])])]);}},null,z);z.get_Create=function(){return z.New(bq.Fresh(),bi.Create$1(null),bi.Create$1(null),bi.Create$1(null));};z.New=function(bT,bU,bV,bW){return new z({Key:bT,OptInPort:bU,OptWorker:bV,OptOutPort:bW});};A=d.RulesRowItem=_4.Class({Render:function(bT,bU){var bV;bV=this;return bn.Element("tr",[],[bn.ConvertBy(function(bW){return bW.Key;},function(bW){return bW.Render(bT,bU);},this.CellItems.v),_7.IconNormal("add",function(){bV.CellItems.Append(z.get_Create());})]);}},null,A);A.Create=function(bT){return A.New(bq.Fresh(),br.Create(function(bU){return bU.Key;},bT));};A.New=function(bT,bU){return new A({Key:bT,CellItems:bU});};B=d.SelectorGroup=_4.Class({RenderMenu:function(bT,bU,bV){var bW,bX,bY,bZ,b0,b1;function b2(b3){return _9.ofArray([_7.IconSmall("keyboard_arrow_down",function(){(bX(true))(b3);(bW.ItemOnMove(b3))({$:1});}),_7.IconSmall("keyboard_arrow_up",function(){(bX(false))(b3);(bW.ItemOnMove(b3))({$:0});}),_7.IconSmall("clear",function(){bW.SelectorItems.Remove(b3);bW.ItemOnDelete(b3);})]);}bW=this;bX=(bY=this.SelectorItems,(_4.Curried3(_7.MoveItemInModelList))(bY));bZ=(b0=this.ItemCreatator,b0==null?bn.Element("tr",[],[]):(b1=b0.$0,bn.Element("tr",[],[bn.Element("td",[],[bn.Element("div",[bt.Style("margin-left","20px")],[_7.IconSmall("add",function(){var b3;b3=b1();bW.ItemOnCreated(b3);bW.SelectorItems.Append(b3);})])])])));return bn.Element("table",[],[bn.ConvertBy(function(b3){return b3.WebSharper_Community_Dashboard_ISelectorItem$get_Key();},function(b3){var b4,b5,b6,b7;b4=bh.Map(function(b8){return bT+b8;},b3.WebSharper_Community_Dashboard_ISelectorItem$get_Name().v);return bn.Element("tr",[],[bn.Element("td",[bt.DynamicStyle("Color",bh.Map(function(b8){return b8==null?"#7D4600":bm.Equals(b8.$0.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),b3.WebSharper_Community_Dashboard_ISelectorItem$get_Key())?"#FB8C00":"#7D4600";},bU.v))],[(b5=bn.Element("div",[bt.Style("margin-left","10px"),bt.Style("margin-right","5px"),bt.Style("cursor","pointer"),bt.Handler("click",function(){return function(){bW.ItemOnSelected(b3);return bi.Set(bU,{$:1,$0:b3});};})],[bn.TextView(b4)]),(bV?(b6=b2(b3),(b7=_6.WrapControlsAligment.Horizontal,function(b8){return bv.Render(b6,b7,b8);})):a.id)(b5))])]);},this.SelectorItems.v),bZ]);}},null,B);B.Create=function(bT,bU,bV,bW,bX,bY,bZ){var b0;b0=br.Create(function(b1){return b1.WebSharper_Community_Dashboard_ISelectorItem$get_Key();},bU);return B.New(bq.Fresh(),bi.Create$1(bT),b0,bV,bW,bX,bY,bZ);};B.New=function(bT,bU,bV,bW,bX,bY,bZ,b0){return new B({Key:bT,Name:bU,SelectorItems:bV,ItemCreatator:bW,ItemOnCreated:bX,ItemOnSelected:bY,ItemOnDelete:bZ,ItemOnMove:b0});};C=d.WindowSelector=_4.Class({get_RenderMenu:function(){var bT;bT=this;return this.SelectorGroups.get_Length()===1?_9.head(_9.ofSeq(this.SelectorGroups)).RenderMenu("",this.OptSelectedItem,this.IsWithControls):bn.Element("div",[],[bn.ConvertBy(function(bU){return bU.Key;},function(bU){return bn.Element("div",[],[bn.Element("div",[bt.Style("cursor","pointer"),bt.Handler("click",function(){return function(){return bT.GroupOnClick(bU);};})],[bn.TextView(bU.Name.v)]),bU.RenderMenu("    ",bT.OptSelectedItem,bT.IsWithControls)]);},this.SelectorGroups.v)]);},get_Render:function(){return bn.Element("div",[],[bn.BindView(function(bT){return bT==null?bn.Empty():bT.$0.WebSharper_Community_Dashboard_ISelectorItem$get_Render();},this.OptSelectedItem.v)]);},GroupByIndex:function(bT){return bd.nth(bT,_9.ofSeq(this.SelectorGroups));},get_SelectedIndex:function(){var bT;bT=this;return bd.findIndex(function(bU){return bm.Equals(bU.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bT.get_SelectedItem().WebSharper_Community_Dashboard_ISelectorItem$get_Key());},_9.concat(_9.map(function(bU){return _9.ofSeq(bU.SelectorItems);},_9.ofSeq(this.SelectorGroups))));},get_SelectedIndexInGroup:function(){var bT;bT=this;return bd.findIndex(function(bU){return bm.Equals(bU.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bT.get_SelectedItem().WebSharper_Community_Dashboard_ISelectorItem$get_Key());},_9.ofSeq(this.get_SelectedGroup().SelectorItems));},get_SelectedGroupIndex:function(){var bT;bT=this;return bd.findIndex(function(bU){return bm.Equals(bU.Key,bT.get_SelectedGroup().Key);},_9.ofSeq(this.SelectorGroups));},get_SelectedGroup:function(){return this.GroupFromItem(this.get_SelectedItem());},GroupFromItem:function(bT){return bd.find(function(bU){return _9.exists(function(bV){return bm.Equals(bV.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bT.WebSharper_Community_Dashboard_ISelectorItem$get_Key());},_9.ofSeq(bU.SelectorItems));},_9.ofSeq(this.SelectorGroups));},AppenGroup:function(bT,bU,bV){var bW;bW=this.SelectorGroups.get_Length();this.SelectorGroups.Append(B.Create(bT,bU,bV,this.ItemOnCreated(bW),this.ItemOnSelected,this.ItemOnDeleted(bW),this.ItemOnMove(bW)));},get_SelectedItem:function(){var bT;bT=this.OptSelectedItem.c;return bT==null?_5.FailWith("Something really wrong with WindowSelector"):bT.$0;},ClearGroups:function(){bi.Set(this.OptSelectedItem,null);_9.iter(function(bT){bT.SelectorItems.Clear();},_9.ofSeq(this.SelectorGroups));},WithControls:function(bT){return C.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,bT);},WithItemOnMove:function(bT){return C.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,bT,this.IsWithControls);},WithItemOnDeleted:function(bT){return C.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,bT,this.ItemOnMove,this.IsWithControls);},WithItemOnSelected:function(bT){return C.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,bT,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);},WithGroupOnClick:function(bT){return C.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,bT,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);},WithItemOnCreated:function(bT){return C.New(this.OptSelectedItem,this.SelectorGroups,bT,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);}},null,C);C.get_Create=function(){var bT;bT=br.Create(function(bU){return bU.Key;},_9.T.Empty);return C.New(bi.Create$1(null),bT,function(){return function(){return null;};},a.ignore,a.ignore,function(){return function(){return null;};},_4.Curried3(function(bU,bV,bW){return null;}),false);};C.New=function(bT,bU,bV,bW,bX,bY,bZ,b0){return new C({OptSelectedItem:bT,SelectorGroups:bU,ItemOnCreated:bV,GroupOnClick:bW,ItemOnSelected:bX,ItemOnDeleted:bY,ItemOnMove:bZ,IsWithControls:b0});};D.Create=function(bT,bU){return D.New(bq.Fresh(),bT,bU);};D.New=function(bT,bU,bV){return{Key:bT,Panel:bU,Widget:bV};};E=d.EventsGroupItem=_4.Class({get_Render:function(){var bT,bU,bV;function bW(bX){return _9.ofArray([_7.IconSmall("keyboard_arrow_down",function(){(bU(true))(bX);}),_7.IconSmall("keyboard_arrow_up",function(){(bU(false))(bX);}),_7.IconSmall("clear",function(){bT.EventItems.Remove(bX);})]);}bT=this;bU=(bV=this.EventItems,(_4.Curried3(_7.MoveItemInModelList))(bV));return bn.Element("table",[],[bn.ConvertBy(function(bX){return bX.Key;},function(bX){var bY;return bn.Element("tr",[],[(bY=bn.Element("div",_7.AttrsClick(function(){bT.PropertyGrid.Edit(bX.Worker.get_Properties());}),[bn.TextView(bX.Worker.Name.v)]),bv.Render(bW(bX),_6.WrapControlsAligment.Horizontal,bY))]);},this.EventItems.v)]);},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,E);E.Create=function(bT,bU){return E.New(bq.Fresh(),bi.Create$1(bT),br.Create(function(bV){return bV.Key;},_9.T.Empty),bU);};E.New=function(bT,bU,bV,bW){return new E({Key:bT,Name:bU,EventItems:bV,PropertyGrid:bW});};F=d.WidgetsGroupItem=_4.Class({get_Render:function(){return this.PanelContainer.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,F);F.Create=function(bT,bU){return F.New(bq.Fresh(),bi.Create$1(bT),br.Create(function(bV){return bV.Key;},_9.T.Empty),bU);};F.New=function(bT,bU,bV,bW){return new F({Key:bT,Name:bU,WidgetItems:bV,PanelContainer:bW});};G=d.RulesGroupItem=_4.Class({Equals:function(bT){return bT instanceof G&&bm.Equals(this.Key,bT.Key);},get_Render:function(){return this.Renderer(this.RulesRowItems);},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,G);G.Create=function(bT,bU){return G.New(bq.Fresh(),bi.Create$1(bT),br.Create(function(bV){return bV.Key;},_9.T.Empty),bU);};G.New=function(bT,bU,bV,bW){return new G({Key:bT,Name:bU,RulesRowItems:bV,Renderer:bW});};H=d.DshData=_4.Class({RegisterWidget:function(bT,bU,bV,bW){var bX;bX=bW.WithKey(bT);bU.WidgetItems.Append(D.Create(bV,bX));this.WorkItems.Append(x.Create(bX));},RegisterEvent:function(bT,bU,bV){var bW;bW=x.Create(bV.WithKey(bT));bU.EventItems.Append(bW);this.WorkItems.Append(bW);},get_Clear:function(){this.WorkItems.Clear();this.WidgetGroups.Clear();this.EventGroups.Clear();this.RulesGroups.Clear();}},null,H);H.get_Create=function(){return H.New(br.Create(function(bT){return bT.Key;},_9.T.Empty),br.Create(function(bT){return bT.Key;},_9.T.Empty),br.Create(function(bT){return bT.Key;},_9.T.Empty),br.Create(function(bT){return bT.Key;},_9.T.Empty));};H.New=function(bT,bU,bV,bW){return new H({WorkItems:bT,WidgetGroups:bU,EventGroups:bV,RulesGroups:bW});};I.Render=function(bT,bU){function bV(bY,bZ){return _7.MoveItemInModelList(bU,bY,bZ);}function bW(bY){return _9.ofArray([_7.IconSmall("keyboard_arrow_down",function(){bV(true,bY);}),_7.IconSmall("keyboard_arrow_up",function(){bV(false,bY);}),_7.IconSmall("clear",function(){bU.Remove(bY);})]);}function bX(){var bY;bY=_9.map(function(bZ){return bZ.Worker;},_9.ofSeq(bT.WorkItems));I.CopyToRules(bU).Reconnect(bY);}return bn.Element("table",[],[bn.ConvertBy(function(bY){return bY.Key;},function(bY){var bZ;return bn.Element("tr",[],[(bZ=bY.Render(bT.WorkItems,function(){bX();}),bv.Render(bW(bY),_6.WrapControlsAligment.Horizontal,bZ))]);},bU.v)]);};I.Restore=function(bT,bU,bV){var bW,bX,bY;bU.Clear();bW=_9.map(function(bZ){return bZ.Worker;},_9.ofSeq(bT.WorkItems));bX=t.allOutPorts(bW);bY=t.allInPorts(bW);_9.iter(function(bZ){var b0;b0=A.Create([]);_9.iter(function(b1){var b2;b2=z.get_Create();bi.Set(b2.OptWorker,bd.tryFind(function(b3){return b3.Worker.Key===b1.WorkerKey;},_9.ofSeq(bT.WorkItems)));bi.Set(b2.OptInPort,bd.tryFind(function(b3){return b3.get_Key()===b1.InPortKey;},bY));bi.Set(b2.OptOutPort,bd.tryFind(function(b3){return b3.Key===b1.OutPortKey;},bX));b0.CellItems.Append(b2);},bZ.RuleChain);bU.Append(b0);},bV.RuleContainer);bV.Reconnect(bW);};I.CopyToRules=function(bT){return w.New(_9.map(function(bU){return v.New(_9.map(function(bV){var bW,bX,bY;return u.New((bW=bV.OptInPort.c,bW==null?"":bW.$0.get_Key()),(bX=bV.OptOutPort.c,bX==null?"":bX.$0.Key),(bY=bV.OptWorker.c,bY==null?"":bY.$0.Worker.Key));},_9.ofSeq(bU.CellItems)));},_9.ofSeq(bT)));};J.RulesGroupCreator=function(bT,bU){var bV;bV=G.Create("rules"+a.String(_9.length(_9.ofSeq(bT.RulesGroups))+1),function(bW){return I.Render(bT,bW);});bT.RulesGroups.Append(bV);return bV;};J.EventsGroupCreator=function(bT,bU,bV){var bW;bW=E.Create("event"+a.String(_9.length(_9.ofSeq(bT.EventGroups))+1),bU);bT.EventGroups.Append(bW);return bW;};J.PanelGroupCreator=function(bT,bU,bV){var bW;bW=F.Create("panel"+a.String(_9.length(_9.ofSeq(bT.WidgetGroups))+1),bU());bT.WidgetGroups.Append(bW);return bW;};K=d.Dashboard=_4.Class({Render:function(bT){var bU;bU=this;return bn.EmbedView(bh.Map(function(bV){return bV.$==1?bn.Element("div",[],[bn.Element("table",[],[bn.Element("tr",[],[bn.Element("td",[bt.Style("vertical-align","top")],[bn.Element("table",[],bd.concat([_9.ofArray([bn.Element("tr",[],[bn.Element("td",[],[_7.IconNormal("dehaze",function(){bi.Set(bU.PanelTitleVisibility,false);bi.Set(bU.Mode,{$:0});})])])]),_9.ofArray([bU.EditorSelectorEdit.get_RenderMenu()]),_9.ofArray([bn.Element("tr",[],[bn.Element("td",[],[])]),bn.Element("tr",[],[bn.Element("td",[],[bU.PropertyGrid.get_Render()])])])]))]),bn.Element("td",[bt.Style("vertical-align","top")],[bT,_7.IconNormal("add",function(){var bW,bX,bY,bZ,b0;bW=bU.EditorSelectorEdit.get_SelectedGroupIndex();bW===1?(bX=_9.ofSeq(bU.Factory.EventItems),bY=bi.Create$1(_9.head(bX)),bU.Dialog.ShowDialog("Select source",bn.Element("div",[],[bn.Select([bt.Class("form-control")],function(b1){return b1.Worker.Name.c;},bX,bY)]),function(){var b1,b2,b3;b1=bY.c.Worker.get_Clone();b1.StartRunner();b2=(b3=_9.ofSeq(bU.Data.EventGroups),bd.nth(bU.EditorSelectorEdit.get_SelectedIndexInGroup(),b3));bU.Data.RegisterEvent(_7.UniqueKey(),b2,b1);})):bW===0?bU.CreatePanel((bZ=_9.ofSeq(bU.Data.WidgetGroups),bd.nth(bU.EditorSelectorEdit.get_SelectedIndexInGroup(),bZ)),"Panel",700,null):bW===2?(b0=_9.ofSeq(bU.Data.RulesGroups),bd.nth(bU.EditorSelectorEdit.get_SelectedIndexInGroup(),b0)).RulesRowItems.Append(A.Create([z.get_Create(),z.get_Create()])):void 0;}),bU.EditorSelectorEdit.get_Render()])])]),bn.Element("div",[],[bU.Dialog.get_Render()])]):bn.Element("div",[],[bn.Element("table",[],[bn.Element("tr",[],[bn.Element("td",[bt.Style("vertical-align","top")],[_7.IconNormal("dehaze",function(){bi.Set(bU.PanelTitleVisibility,true);bi.Set(bU.Mode,{$:1});}),bU.EditorSelectorRun.GroupByIndex(0).SelectorItems.get_Length()>1?bU.EditorSelectorRun.get_RenderMenu():bn.Element("div",[],[])]),bn.Element("td",[],[bU.EditorSelectorRun.get_Render()])])])]);},this.Mode.v));},Restore:function(bT,bU,bV,bW){var bX,bY,bZ,b0,b1;bX=this;this.EditorSelectorRun.ClearGroups();this.EditorSelectorEdit.ClearGroups();this.Data.get_Clear();bY=this.EditorSelectorRun.GroupByIndex(0);bZ=this.EditorSelectorEdit.GroupByIndex(0);b0=this.EditorSelectorEdit.GroupByIndex(1);b1=this.EditorSelectorEdit.GroupByIndex(2);_9.iteri(function(b2,b3){var b4,b5;function b6(b7,b8,b9){bX.RegisterWidget(b7,b5,b8,bd.find(function(b_){return b_.Key===b8;},_9.ofSeq(b5.PanelContainer.PanelItems)).Children,(b9.StartRunner(),b9));}b4=J.PanelGroupCreator(bX.Data,bT,null);bi.Set(b4.WebSharper_Community_Dashboard_ISelectorItem$get_Name(),b3[0]);bZ.SelectorItems.Append(b4);bY.SelectorItems.Append(b4);b5=bd.nth(b2,_9.ofSeq(bX.Data.WidgetGroups));_9.iter(function(b7){var b8;b8=bX.CreatePanel(b5,"Panel",700,{$:1,$0:b7.Key});bi.Set(b8.Left,b7.Left);bi.Set(b8.Top,b7.Top);},b3[1]);return _9.iter(function(b7){return b6(b7[0],b7[1],b7[2]);},b3[2]);},bV);bs.log("Widgets restored");_9.iteri(function(b2,b3){var b4,b5;function b6(b7,b8){bX.Data.RegisterEvent(b7,b5,b8);}b4=J.EventsGroupCreator(bX.Data,bX.PropertyGrid,null);bi.Set(b4.WebSharper_Community_Dashboard_ISelectorItem$get_Name(),b3[0]);b0.SelectorItems.Append(b4);b5=bd.nth(b2,_9.ofSeq(bX.Data.EventGroups));return _9.iter(function(b7){return b6(b7[0],b7[1]);},b3[1]);},bU);bs.log("Events restored");_9.iteri(function(b2,b3){var b4;b4=J.RulesGroupCreator(bX.Data,null);bi.Set(b4.WebSharper_Community_Dashboard_ISelectorItem$get_Name(),b3[0]);b1.SelectorItems.Append(b4);return I.Restore(bX.Data,bd.nth(b2,_9.ofSeq(bX.Data.RulesGroups)).RulesRowItems,b3[1]);},bW);this.Data.WidgetGroups.get_Length()>0?(bi.Set(this.EditorSelectorEdit.OptSelectedItem,{$:1,$0:_9.head(_9.ofSeq(this.EditorSelectorEdit.GroupByIndex(0).SelectorItems))}),bi.Set(this.EditorSelectorRun.OptSelectedItem,{$:1,$0:_9.head(_9.ofSeq(this.EditorSelectorRun.GroupByIndex(0).SelectorItems))})):(bi.Set(this.EditorSelectorEdit.OptSelectedItem,null),bi.Set(this.EditorSelectorRun.OptSelectedItem,null));bs.log("Connectors restored");return[_9.concat(_9.map(function(b2){return _9.map(function(b3){return b3.Worker;},_9.ofSeq(b2.EventItems));},_9.ofSeq(this.Data.EventGroups))),_9.concat(_9.map(function(b2){return _9.map(function(b3){return b3.Widget;},_9.ofSeq(b2.WidgetItems));},_9.ofSeq(this.Data.WidgetGroups)))];},Store:function(bT){function bU(bW,bX){var bY;bY=bT(bX);return bY==null?bW:new _9.T({$:1,$0:[bX.Key,bY.$0],$1:bW});}function bV(bW,bX,bY){var bZ;bZ=bT(bY);return bZ==null?bW:new _9.T({$:1,$0:[bY.Key,bX,bZ.$0],$1:bW});}return[_9.map(function(bW){return[bW.Name.c,_9.rev(bd.fold(function(bX,bY){return bU(bX,bY.Worker);},_9.T.Empty,_9.ofSeq(bW.EventItems)))];},_9.ofSeq(this.Data.EventGroups)),_9.map(function(bW){return[bW.Name.c,_9.map(function(bX){return bX.get_PanelData();},_9.ofSeq(bW.PanelContainer.PanelItems)),_9.rev(bd.fold(function(bX,bY){return bV(bX,bY.Panel,bY.Widget);},_9.T.Empty,_9.ofSeq(bW.WidgetItems)))];},_9.ofSeq(this.Data.WidgetGroups)),_9.map(function(bW){return[bW.Name.c,I.CopyToRules(bW.RulesRowItems)];},_9.ofSeq(this.Data.RulesGroups))];},CreatePanel:function(bT,bU,bV,bW){var bX,bY,bZ,b0,b1,b2;bX=this;bn.ConvertBy(bT.WidgetItems.key,function(b3){return bn.Element("div",[],[bn.TextView(b3.Widget.Name.v)]);},bT.WidgetItems.v);bY=(bZ=(b0=bl.NewGuid(),a.String(b0)),bW==null?bZ:bW.$0);b1=bw.get_Create().WithLayoutManager(bx.StackPanelLayoutManager()).WithAttributes([bt.Style("border","1px solid white"),bt.Style("display","flex")]);b2=by.get_Create().WithKey(bY).WithPannelAttrs([bt.Style("Width",a.String(bV)+"px"),bt.Style("position","absolute")]).WithTitle(this.PanelTitleVisibility).WithTitleContent(bn.TextNode(bU)).WithTitleButtons(_9.ofArray([bz.New("add",function(b3){var b4,b5;b4=_9.ofSeq(bX.Factory.WidgetItems);b5=bi.Create$1(_9.head(b4));bX.Dialog.ShowDialog("Select widget",bn.Element("div",[],[bn.Select([bt.Class("form-control")],function(b6){return b6.Worker.Name.c;},b4,b5)]),function(){var b6;bs.log("Dialog.IsOK");b6=b5.c.Worker.get_Clone();b6.StartRunner();bX.RegisterWidget(_7.UniqueKey(),bT,b3.Key,b3.Children,b6);});}),bz.New("edit",function(b3){bs.log("Edit");bX.PropertyGrid.Edit(_9.concat(_9.map(function(b4){return b4.Widget.get_Properties();},_9.filter(function(b4){return b4.Panel===b3.Key;},_9.ofSeq(bT.WidgetItems)))));}),bz.New("clear",function(b3){bT.PanelContainer.PanelItems.Remove(bT.PanelContainer.FindPanelItem(b3));bT.WidgetItems.RemoveBy(function(b4){return b4.Panel===b3.Key;});})])).WithChildPanelContainer(b1);bT.PanelContainer.AddPanel(b2);return b2;},RegisterWidget:function(bT,bU,bV,bW,bX){var bY;this.Data.RegisterWidget(bT,bU,bV,bX);bY=by.get_Create().WithPanelContent(bX.get_Render());bi.Set(bY.IsWithTitle,false);bW.AddPanel(bY);}},null,K);K.Create=function(bT){var bU,bV,bW,bX,bY,bZ;function b0(){return J.PanelGroupCreator(bV,bT,void 0);}function b1(){return J.EventsGroupCreator(bV,bW,void 0);}function b2(){return J.RulesGroupCreator(bV,void 0);}bU=bA.get_Create();bV=H.get_Create();bW=bB.get_Create();bX=C.get_Create();bY=C.get_Create().WithGroupOnClick(function(b3){bW.Edit(_9.mapi(function(b4,b5){var b6;return bk.string((b6=b4+1,a.String(b6)),b5.WebSharper_Community_Dashboard_ISelectorItem$get_Name());},_9.ofSeq(b3.SelectorItems)));}).WithItemOnSelected(function(){bW.Edit(_9.T.Empty);}).WithItemOnCreated(function(b3){return function(b4){return b3===0?_9.head(_9.ofSeq(bX.SelectorGroups)).SelectorItems.Append(b4):null;};}).WithItemOnDeleted(function(){return function(){return null;};}).WithItemOnDeleted(function(b3){return function(b4){b4 instanceof F?bV.WidgetGroups.Remove(b4):b4 instanceof E?bV.EventGroups.Remove(b4):b4 instanceof G?bV.RulesGroups.Remove(b4):_5.FailWith("WithItemOnDeleted, type unknown");return b3===0?_9.head(_9.ofSeq(bX.SelectorGroups)).SelectorItems.Remove(b4):null;};}).WithItemOnMove(_4.Curried3(function(b3,b4,b5){var b6;b6=b5.$==1&&true;return b4 instanceof F?(_7.MoveItemInModelList(bV.WidgetGroups,b6,b4),_7.MoveItemInModelList(_9.head(_9.ofSeq(bX.SelectorGroups)).SelectorItems,b6,b4)):b4 instanceof E?_7.MoveItemInModelList(bV.EventGroups,b6,b4):b4 instanceof G?_7.MoveItemInModelList(bV.RulesGroups,b6,b4):_5.FailWith("WithItemOnDeleted, type unknown");})).WithControls(true);bZ=b0();bY.AppenGroup("Panels",_9.ofArray([bZ]),{$:1,$0:b0});bX.AppenGroup("Panels",_9.ofArray([bZ]),null);bY.AppenGroup("Events",_9.ofArray([b1()]),{$:1,$0:b1});bY.AppenGroup("Rules",_9.ofArray([b2()]),{$:1,$0:b2});bi.Set(bY.OptSelectedItem,{$:1,$0:_9.head(_9.ofSeq(bY.GroupByIndex(0).SelectorItems))});bi.Set(bX.OptSelectedItem,{$:1,$0:_9.head(_9.ofSeq(bX.GroupByIndex(0).SelectorItems))});return K.New(y.get_Create(),bV,bW,bU,bX,bY,bi.Create$1({$:0}),bi.Create$1(false));};K.New=function(bT,bU,bV,bW,bX,bY,bZ,b0){return new K({Factory:bT,Data:bU,PropertyGrid:bV,Dialog:bW,EditorSelectorRun:bX,EditorSelectorEdit:bY,Mode:bZ,PanelTitleVisibility:b0});};M=L.RandomEvent=_4.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bT){var bU;new bC.New();_.Start((bU=null,_.Delay(function(){return _.While(function(){return true;},_.Delay(function(){return _.Bind(_.Sleep(bT.InPorts.get_Item(2).get_Number()*1000>>0),function(){var bV,bW,bX;bV=bT.InPorts.get_Item(0).get_Number();bW=bT.InPorts.get_Item(1).get_Number();bX=bD.random()*bW+bV;bT.OutPorts.get_Item(0).Trigger(new i({$:0,$0:bX}));return _.Zero();});}));})),null);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.RandomEventData;}},null,M);M.get_FromWorker=function(){return function(bT){return M.New(bT.get_ToData());};};M.get_Create=function(){return M.New(r.Create("Random",_9.ofArray([["Middle value",h.NumberMessage(100)],["Dispersion",h.NumberMessage(10)],["Delay sec.",h.NumberMessage(2)]]),_9.ofArray([["Random value",h.NumberMessage(0)]])));};M.New=function(bT){return new M({RandomEventData:bT});};N.New=function(bT){return{DatabaseEventRun:bT};};O=L.DatabaseEvent=_4.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bT){var bU;bU=true;bh.Sink(function(bV){bU?(_9.iter(function(bW){var bX;bX=h.Agent();bX.mailbox.AddLast({$:0,$0:bW});bX.resume();},(new ba.New()).Sync("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.Events.ServerDatabase.ReadAllMessages:965639103",[bT.InPorts.get_Item(1).get_String()])),bU=false):((new ba.New()).Send("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.Events.ServerDatabase.WriteMessage:-353093100",[bT.InPorts.get_Item(1).get_String(),bV.WithKey(bT.OutPorts.get_Item(0).Key)]),bT.OutPorts.get_Item(0).Trigger(bV.Value));},bT.InPorts.get_Item(0).PortValue.v);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.DatabaseEventData;}},null,O);O.get_FromWorker=function(){return function(bT){return O.New(bT.get_ToData());};};O.get_Create=function(){return O.New(r.Create("Database",_9.ofArray([[" in Value",h.NumberMessage(100)],["Database name",h.StringMessage("Database.txt")]]),_9.ofArray([["Number value",h.NumberMessage(0)]])));};O.New=function(bT){return new O({DatabaseEventData:bT});};Q.New=function(bT,bU,bV,bW,bX){return{Title:bT,Description:bU,ImageUrl:bV,Temperature:bW,TemparatureMinMax:bX};};P.get=function(bT,bU){var bV;bV=null;return _.Delay(function(){var bW;bW=(((_4.Curried3(function(bX,bY,bZ){return bX("http://api.openweathermap.org/data/2.5/weather?q="+be.toSafe(bY)+"&units=metric&appid="+be.toSafe(bZ));}))(a.id))(bU))(bT);(e.Log())("get key city "+bW);return _.TryWith(_.Delay(function(){return _.Bind(bF.AsyncMap(bJ.asyncReadTextAtRuntime(false,"C:\\AEAFrame\\WebSharper.Community.Dashboard\\WebSharper.Community.Dashboard","","JSON","",bW),function(bX){return bm.Equals(typeof bX,"string")?bK.parse(bX):bX;}),function(bX){var bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci;(e.Log())("get key city 2");return _.Return((bY=bL.tryHead(bX.weather),bY==null?null:{$:1,$0:(bZ=bY.$0,Q.New((((_4.Curried3(function(cj,ck,cl){return cj(be.toSafe(ck)+", "+be.toSafe(cl));}))(a.id))((b1=(b0="name",b0 in bX?{$:1,$0:bX[b0]}:null),b1==null?null:b1.$0)))((b4=(b2=bX.sys,(b3="country",b3 in b2?{$:1,$0:b2[b3]}:null)),b4==null?null:b4.$0)),(b6=(b5="main",b5 in bZ?{$:1,$0:bZ[b5]}:null),b6==null?null:b6.$0),(function(cj){return function(ck){return cj("http://openweathermap.org/img/w/"+be.toSafe(ck)+".png");};}(a.id))((b8=(b7="icon",b7 in bZ?{$:1,$0:bZ[b7]}:null),b8==null?null:b8.$0)),(b9=(b_=bX.main,(b$="temp",b$ in b_?{$:1,$0:b_[b$]}:null)),(ca=b9==null?null:{$:1,$0:1*b9.$0},ca==null?null:ca.$0)),[(cb=(cc=bX.main,(cd="temp_min",cd in cc?{$:1,$0:cc[cd]}:null)),(ce=cb==null?null:{$:1,$0:1*cb.$0},ce==null?null:ce.$0)),(cf=(cg=bX.main,(ch="temp_max",ch in cg?{$:1,$0:cg[ch]}:null)),(ci=cf==null?null:{$:1,$0:1*cf.$0},ci==null?null:ci.$0))]))}));});}),function(bX){(e.Log())(bX.message);return _.Return(null);});});};R=L.OpenWeatherEvent=_4.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bT){var bU;_.Start((bU=null,_.Delay(function(){return _.While(function(){return true;},_.Delay(function(){var bV,bW,bX;bV=bT.InPorts.get_Item(0);bW=bT.InPorts.get_Item(1);bX=bT.OutPorts.get_Item(0);return _.Bind(P.get(bW.get_String(),bV.get_String()),function(bY){return _.Combine(bY==null?_.Zero():((e.Log())("Value generated:"+bY.$0.Title),bX.Trigger(new i({$:0,$0:+bY.$0.Temperature})),_.Zero()),_.Delay(function(){return _.Bind(_.Sleep(1000*15),function(){return _.Return(null);});}));});}));})),null);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.OpenWeatherEventData;}},null,R);R.get_FromWorker=function(){return function(bT){return R.New(bT.get_ToData());};};R.Create=function(bT,bU){return R.New(r.Create("OpenWeatherMap",_9.ofArray([["City",h.StringMessage(bT)],["ApiKey",h.StringMessage(bU)]]),_9.ofArray([["Temperature",h.NumberMessage(0)]])));};R.New=function(bT){return new R({OpenWeatherEventData:bT});};S=L.ClockEvent=_4.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bT){var bU;_.Start((bU=null,_.Delay(function(){return _.While(function(){return true;},_.Delay(function(){var bV,bW,bX;bV=(bT.InPorts.get_Item(0).PortValue.c.Value.get_AsSelect())[0];bW=_8.now();bX=bV===0?bM.LongTime(bW):bV===1?bM.ShortTime(bW):bV===2?bM.LongDate(bW):bV===3?(new _8(bW)).toLocaleDateString():"";bT.OutPorts.get_Item(0).Trigger(new i({$:1,$0:bX}));return _.Bind(_.Sleep(bT.InPorts.get_Item(1).get_Number()*1000>>0),function(){var bY;bY=(function(bZ){return function(b0){return bZ("Time value generated "+be.toSafe(b0));};}(a.id))(bX);(e.Log())(bY);return _.Zero();});}));})),null);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.ClockEventData;}},null,S);S.get_FromWorker=function(){return function(bT){return S.New(bT.get_ToData());};};S.get_Create=function(){return S.New(r.Create("Clock",_9.ofArray([["Format",h.SelectMessage(0,_9.ofArray(["long time","short time","long date","short date"]))],["Delay sec.",h.NumberMessage(1)]]),_9.ofArray([["Date Time",h.StringMessage("")]])));};S.New=function(bT){return new S({ClockEventData:bT});};U=T.TextBoxWidget=_4.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bT){var bU;bU=bh.Map(function(bV){var bW,bX;bW=bV.Value;return bW.$==0?(bX=bW.$0>>0,a.String(bX)):bW.$==1?bW.$0:bW.$==2?a.String(bW.$0):"Wrong port value format";},bT.InPorts.get_Item(0).PortValue.v);return bn.Element("div",[bt.Class("bigvalue")],[bn.TextView(bU)]);}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.TextBoxWidgetData;}},null,U);U.get_FromWorker=function(){return function(bT){return U.New(bT.get_ToData());};};U.get_Create=function(){return U.New(r.Create("Text",_9.ofArray([["in Value",h.NumberMessage(0)]]),_9.T.Empty));};U.New=function(bT){return new U({TextBoxWidgetData:bT});};V.New=function(bT,bU){return{LineChart:bT,Source:bU};};W=T.ChartWidget=_4.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bT){var bU,bV,bW,bX,bY,bZ,b0,b1,b2;bU=bT.InPorts.get_Item(3).get_Number()>>0;bV=bT.RunnerContext.c.$0;bW=(bX={},bX.title=(bY={},bY.display=false,bY),bX.legend=(bZ={},bZ.display=false,bZ),bX.elements=(b0={},b0.point=(b1={},b1.radius=0,b1),b0.line=(b2={},b2.borderWidth=1,b2),b0),bX);return bP.Render$8(bV.LineChart,{$:1,$0:{$:0,$0:bT.InPorts.get_Item(1).get_Number()>>0,$1:bT.InPorts.get_Item(2).get_Number()>>0}},{$:1,$0:bW},{$:1,$0:bU});}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bT){var bU;bT.InPorts.get_Item(3).get_Number();bU=new bQ.New();bh.Sink(function(bV){var bW;bW=(bT.InPorts.get_Item(4).PortValue.c.Value.get_AsSelect())[0];bU.event.Trigger([bW===0?bM.LongTime(bV.Time):bW===1?bM.ShortTime(bV.Time):bW===2?bM.LongDate(bV.Time):bW===3?(new _8(bV.Time)).toLocaleDateString():"",bV.Value.get_AsNumber()]);},bT.InPorts.get_Item(0).PortValue.v);return{$:1,$0:V.New(bR.Line$1(bU.event).WithFill(false).__WithStrokeColor(new bS.Color({$:1,$0:"#FB8C00"})).__WithPointColor(new bS.Color({$:2,$0:"black"})),bU)};}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.ChartWidgetData;}},null,W);W.get_FromWorker=function(){return function(bT){return W.New(bT.get_ToData());};};W.get_Create=function(){var bT;bT=20;return W.New(r.CreateWithCache("Chart",_9.ofArray([[" in Value",h.NumberMessage(100),bT],["cx",h.NumberMessage(300),1],["cy",h.NumberMessage(150),1],["BufferSize",h.NumberMessage(bT),1],["X-Axis",h.SelectMessage(0,_9.ofArray(["long time","short time","long date","short date"])),1]]),_9.T.Empty));};W.New=function(bT){return new W({ChartWidgetData:bT});};X=T.ButtonWidget=_4.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bT){return bn.ButtonView(bT.InPorts.get_Item(0).get_String(),[],bT.InPorts.get_Item(1).get_BooleanView(),function(bU){bT.OutPorts.get_Item(0).Trigger(new i({$:2,$0:bU}));});}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.ButtonWidgetData;}},null,X);X.get_FromWorker=function(){return function(bT){return X.New(bT.get_ToData());};};X.get_Create=function(){return X.New(r.Create("Button",_9.ofArray([["Caption",h.StringMessage("Button")],["State",h.NumberMessage(0)]]),_9.ofArray([["Button value",h.NumberMessage(0)]])));};X.New=function(bT){return new X({ButtonWidgetData:bT});};Y.FromWorker=function(bT){var bU;bU=bT.Data;return bU instanceof M?{$:1,$0:{$:0,$0:(M.get_FromWorker())(bT)}}:bU instanceof S?{$:1,$0:{$:1,$0:(S.get_FromWorker())(bT)}}:bU instanceof R?{$:1,$0:{$:2,$0:(R.get_FromWorker())(bT)}}:bU instanceof O?{$:1,$0:{$:3,$0:(O.get_FromWorker())(bT)}}:bU instanceof U?{$:1,$0:{$:4,$0:(U.get_FromWorker())(bT)}}:bU instanceof W?{$:1,$0:{$:5,$0:(W.get_FromWorker())(bT)}}:bU instanceof X?{$:1,$0:{$:6,$0:(X.get_FromWorker())(bT)}}:null;};Y.ToWorker=function(bT){return bT.$==1?s.Create(bT.$0):bT.$==2?s.Create(bT.$0):bT.$==3?s.Create(bT.$0):bT.$==4?s.Create(bT.$0):bT.$==5?s.Create(bT.$0):bT.$==6?s.Create(bT.$0):s.Create(bT.$0);};Z.CreateDashboard=function(){_0.$cctor();return _0.CreateDashboard;};Z.PanelContainerCreator=function(bT){return bw.get_Create().WithLayoutManager(bx.FloatingPanelLayoutManager(5)).WithWidth(800).WithHeight(420).WithAttributes([bt.Style("border","1px solid white")]);};Z.RegisterAppModelLib=function(bT){function bU(bW){Z.RegisterEventGeneral(bT,bW);}function bV(bW){Z.RegisterWidgetGeneral(bT,bW);}bU(R.Create("London",""));bU(M.get_Create());bU(S.get_Create());bU(O.get_Create());bV(U.get_Create());bV(W.get_Create());bV(X.get_Create());return bT;};Z.RegisterWidgetGeneral=function(bT,bU){var bV;Z.Register((bV=bT.Factory,function(bW){bV.RegisterWidget(bW);}),bU);};Z.RegisterEventGeneral=function(bT,bU){var bV;Z.Register((bV=bT.Factory,function(bW){bV.RegisterEvent(bW);}),bU);};Z.Register=function(bT,bU){return bT(s.Create(bU));};_0.$cctor=_4.Cctor(function(){_0.CreateDashboard=Z.RegisterAppModelLib(K.Create(function(){return Z.PanelContainerCreator();}));_0.$cctor=a.ignore;});_1.RecreatWidgetsOnServer=function(bT,bU){function bV(bX,bY,bZ){return bZ;}function bW(bX,bY,bZ){return bZ;}return _9.map(function(bX){return bV(bX[0],bX[1],bX[2]);},_9.concat(_9.map(function(bX){return bW(bX[0],bX[1],bX[2]);},_1.RecreateWidgets(bT,bU))));};_1.RecreateEventsOnServer=function(bT,bU){function bV(bX,bY){return bY;}function bW(bX,bY){return bY;}return _9.map(function(bX){return bV(bX[0],bX[1]);},_9.concat(_9.map(function(bX){return bW(bX[0],bX[1]);},_1.RecreateEvents(bT,bU))));};_1.RecreateOnClient=function(bT,bU,bV,bW,bX,bY,bZ){var b0;e.set_Role(f.Client);b0=h.Agent();b0.mailbox.AddLast({$:3,$0:function(b1){(new ba.New()).Send("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.MessageBus.SendToServer:-1358505674",[b1]);}});b0.resume();_9.iter(bT,(bU.Restore(bV,_1.RecreateEvents(bW,bX),_1.RecreateWidgets(bW,bY),bZ))[0]);};_1.RecreateWidgets=function(bT,bU){function bV(bW,bX,bY){function bZ(b0,b1,b2){return[b0,b1,bT(b2)];}return[bW,bX,_9.map(function(b0){return bZ(b0[0],b0[1],b0[2]);},bY)];}return _9.map(function(bW){return bV(bW[0],bW[1],bW[2]);},bU);};_1.RecreateEvents=function(bT,bU){function bV(bW,bX){function bY(bZ,b0){return[bZ,bT(b0)];}return[bW,_9.map(function(bZ){return bY(bZ[0],bZ[1]);},bX)];}return _9.map(function(bW){return bV(bW[0],bW[1]);},bU);};_2=d.AppData=_4.Class({RecreateOnServer:function(bT){var bU,bV;function bW(bX,bY){bY.Reconnect(bV);}bU=_1.RecreateEventsOnServer(bT,this.Events);bV=_9.append(bU,_1.RecreatWidgetsOnServer(bT,this.Widgets));_9.iter(function(bX){return bW(bX[0],bX[1]);},this.Rules);_9.iter(function(bX){bX.StartRunner();},bV);return bU;},RecreateOnClientEventsRunning:function(bT,bU,bV){_1.RecreateOnClient(function(bW){bW.StartRunner();},bT,bU,bV,this.Events,this.Widgets,this.Rules);},RecreateOnClientEventsNotRunning:function(bT,bU,bV){_1.RecreateOnClient(a.ignore,bT,bU,bV,this.Events,this.Widgets,this.Rules);}},null,_2);_2.Create=function(bT,bU){var bV;bV=bT.Store(bU);return _2.New(bV[0],bV[1],bV[2]);};_2.empty=function(){return _2.New(_9.T.Empty,_9.T.Empty,_9.T.Empty);};_2.New=function(bT,bU,bV){return new _2({Events:bT,Widgets:bU,Rules:bV});};}());
