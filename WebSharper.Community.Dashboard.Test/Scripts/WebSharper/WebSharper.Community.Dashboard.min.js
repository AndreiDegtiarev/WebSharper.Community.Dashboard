(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk;a=window.WebSharper=window.WebSharper||{};b=a.Community=a.Community||{};c=b.Dashboard=b.Dashboard||{};d=c.EmptyTrigger=c.EmptyTrigger||{};e=c.NumberTrigger=c.NumberTrigger||{};f=c.NumberValue=c.NumberValue||{};g=c.StringValue=c.StringValue||{};h=c.InPort=c.InPort||{};i=c.OutPort=c.OutPort||{};j=c.PortConnectorData=c.PortConnectorData||{};k=c.PortConnector=c.PortConnector||{};l=c.Ports=c.Ports||{};m=c.Worker=c.Worker||{};n=c.RandomRunner=c.RandomRunner||{};o=c.OpenWeather=c.OpenWeather||{};p=o.Forecast=o.Forecast||{};q=c.OpenWeatherRunner=c.OpenWeatherRunner||{};r=c.ChartRunnerContext=c.ChartRunnerContext||{};s=c.ChartRenderer=c.ChartRenderer||{};t=c.TextBoxRenderer=c.TextBoxRenderer||{};u=c.WorkerItem=c.WorkerItem||{};v=c.Factory=c.Factory||{};w=c.PortConnectorItem=c.PortConnectorItem||{};x=c.DshData=c.DshData||{};y=c.DshEditorCellItem=c.DshEditorCellItem||{};z=c.DshEditorRowItem=c.DshEditorRowItem||{};A=c.DshEditor=c.DshEditor||{};B=c.Dashboard=c.Dashboard||{};C=window.IntelliFactory;D=C&&C.Runtime;E=a&&a.Guid;F=a&&a.Operators;G=b&&b.PropertyGrid;H=G&&G.Properties;I=a&&a.UI;J=I&&I.Next;K=J&&J.Var;L=a&&a.Control;M=L&&L.FSharpEvent;N=window.console;O=a&&a.Unchecked;P=a&&a.List;Q=J&&J.Doc;R=a&&a.Random;S=a&&a.Concurrency;T=window.Math;U=a&&a.PrintfHelpers;V=a&&a.Data;W=V&&V.TxtRuntime;X=window.FSharp;Y=X&&X.Data;Z=Y&&Y.Runtime;_0=Z&&Z.IO;_1=window.JSON;_2=a&&a.Arrays;_3=a&&a.Charting;_4=_3&&_3.Renderers;_5=_4&&_4.ChartJs;_6=a&&a.Seq;_7=_3&&_3.Chart;_8=_3&&_3.Pervasives;_9=J&&J.View;_=J&&J.AttrModule;$=J&&J.Key;ba=J&&J.ListModel;bb=a&&a.Option;bc=b&&b.Panel;bd=bc&&bc.Helper;be=a&&a.Enumerator;bf=bc&&bc.PanelContainer;bg=bc&&bc.LayoutManagers;bh=bc&&bc.Panel;bi=bc&&bc.TitleButton;bj=bc&&bc.Dialog;bk=G&&G.PropertyGrid;d.New=function(bl){return{EmptyTrigger:bl};};e=c.NumberTrigger=D.Class({Trigger:function(bl){this.NumberEvent.event.Trigger(bl);}},null,e);e.New=function(bl){return new e({NumberEvent:bl});};f.Create=function(bl){var bm;return f.New((bm=E.NewGuid(),window.String(bm)),bl);};f.New=function(bl,bm){return{Key:bl,NumberValue:bm};};g.Create=function(bl){var bm;return g.New((bm=E.NewGuid(),window.String(bm)),bl);};g.New=function(bl,bm){return{Key:bl,StringValue:bm};};h=c.InPort=D.Class({Equals:function(bl){return bl instanceof h&&this.Name===bl.Name;},get_StringValue:function(){var bl;bl=this;return this.ExtractPortStringValue(function(bm){return g.New(bl.Key,bm.c);});},get_StringVar:function(){return this.ExtractPortStringValue(window.id);},get_String:function(){return this.ExtractPortStringValue(function(bl){return bl.c;});},ExtractPortStringValue:function(bl){var bm;bm=this.PortValue;return bm.$==2?bl(bm.$0.StrValue):F.FailWith("unexpected type");},get_NumberValue:function(){var bl;bl=this;return this.ExtractPortNumberValue(function(bm){return f.New(bl.Key,bm.c);});},get_NumberVar:function(){return this.ExtractPortNumberValue(window.id);},get_Number:function(){return this.ExtractPortNumberValue(function(bl){return bl.c;});},ExtractPortNumberValue:function(bl){var bm;bm=this.PortValue;return bm.$==1?bl(bm.$0.NumValue):F.FailWith("unexpected type");},get_Property:function(){var bl;bl=this.PortValue;return bl.$==1?H["double"](this.Name,bl.$0.NumValue):bl.$==2?H.string(this.Name,bl.$0.StrValue):H.group(this.Name);},get_Clone:function(){var bl,bm;return h.New((bl=E.NewGuid(),window.String(bl)),this.Name,this.Disconnector,this.Disconnect,this.OutPort,(bm=this.PortValue,bm.$==1?{$:1,$0:{NumValue:K.Create$1(bm.$0.NumValue.c)}}:bm.$==2?{$:2,$0:{StrValue:K.Create$1(bm.$0.StrValue.c)}}:{$:0,$0:bm.$0}));}},null,h);h.New=function(bl,bm,bn,bo,bp,bq){return new h({Key:bl,Name:bm,Disconnector:bn,Disconnect:bo,OutPort:bp,PortValue:bq});};i=c.OutPort=D.Class({Equals:function(bl){return bl instanceof i&&this.Name===bl.Name;}},null,i);i.New=function(bl,bm,bn,bo,bp){return new i({Key:bl,Name:bm,IsCompatible:bn,Connect:bo,Trigger:bp});};j.New=function(bl,bm){return{OutPortKey:bl,InPortKey:bm};};k=c.PortConnector=D.Class({get_Data:function(){return j.New(this.OutPort.Key,this.InPort.Key);}},null,k);k.Create=function(bl,bm){return k.New(bl.Name+"->"+bm.Name,bm,bl,bl.Connect(bm));};k.New=function(bl,bm,bn,bo){return new k({Name:bl,InPort:bm,OutPort:bn,Disconnect:bo});};l.Clone=function(bl){var bm;return bl.Trigger.$==1?l.OutPortNum((bm=E.NewGuid(),window.String(bm)),bl.Name):l.BaseOutPort((bm=E.NewGuid(),window.String(bm)),bl.Name);};l.OutPortNum=function(bl,bm){var bn,bo;bn=new M.New();bo=l.BaseOutPort(bl,bm);return i.New(bo.Key,bo.Name,function(bp){return bp.PortValue.$==1&&true;},function(bp){var bq,br,bs;bq=bp.PortValue;return bq.$==1?(br=bq.$0,(bp.Disconnect(),bs=function(bt,bu){return K.Set(br.NumValue,bu);},bn.event.AddHandler(bs),N.log("Port "+bm+" connected with "+bp.Name),function(){bn.event.RemoveHandler(bs);})):F.FailWith("Unexpected type");},{$:1,$0:e.New(bn)});};l.InPortStr=function(bl,bm){var bn;bn=l.BaseInPort(bm.Key,bl);return h.New(bn.Key,bn.Name,bn.Disconnector,bn.Disconnect,bn.OutPort,{$:2,$0:{StrValue:K.Create$1(bm.StringValue)}});};l.InPortNum=function(bl,bm){var bn;bn=l.BaseInPort(bm.Key,bl);return h.New(bn.Key,bn.Name,bn.Disconnector,bn.Disconnect,bn.OutPort,{$:1,$0:{NumValue:K.Create$1(bm.NumberValue)}});};l.BaseInPort=function(bl,bm){return h.New(bl,bm,function(){},function(){N.log("Port "+bm+" disconnected");},l.BaseOutPort("","Empty"),{$:0,$0:{Nothing:""}});};l.BaseOutPort=function(bl,bm){return i.New(bl,bm,function(){return false;},function(){return function(){return null;};},{$:0,$0:d.New("")});};l.NumTrigger=function(bl){var bm,bn;bm=bl.Trigger;return bm.$==1?(bn=bm.$0,function(bo){bn.Trigger(bo);}):F.FailWith("unexpected type");};m=c.Worker=D.Class({Equals:function(bl){return bl instanceof m&&O.Equals(this.Name,bl.Name);},get_Properties:function(){return new P.T({$:1,$0:H.string("Name",this.Name),$1:P.map(function(bl){return bl.get_Property();},this.InPorts)});},get_Render:function(){var bl;bl=this.Renderer;return bl==null?Q.Empty():(bl.$0.WebSharper_Community_Dashboard_IRenderer$get_Render())(this);},get_CloneAndRun:function(){var bl,bm;bl=m.New(K.Create$1(this.Name.c),P.map(function(bn){return bn.get_Clone();},this.InPorts),P.map(l.Clone,this.OutPorts),this.Runner,this.Renderer,this.DataContext,null);bm=bl.Runner;return bm==null?bl:m.New(bl.Name,bl.InPorts,bl.OutPorts,bl.Runner,bl.Renderer,bl.DataContext,(bm.$0.WebSharper_Community_Dashboard_IRunner$get_Run())(bl));}},null,m);m.CreateRenderer=function(bl){return m.CreateNative(bl,null,{$:1,$0:bl});};m.CreateRunner=function(bl){return m.CreateNative(bl,{$:1,$0:bl},null);};m.Create=function(bl){return m.CreateNative(bl,{$:1,$0:bl},{$:1,$0:bl});};m.CreateNative=function(bl,bm,bn){return m.New(K.Create$1(bl.WebSharper_Community_Dashboard_IWorkerContext$get_Name()),bl.WebSharper_Community_Dashboard_IWorkerContext$get_InPorts(),bl.WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts(),bm,bn,bl,null);};m.New=function(bl,bm,bn,bo,bp,bq,br){return new m({Name:bl,InPorts:bm,OutPorts:bn,Runner:bo,Renderer:bp,DataContext:bq,RunnerContext:br});};n=c.RandomRunner=D.Class({WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bl){var bm;new R.New();S.Start((bm=null,S.Delay(function(){return S.While(function(){return true;},S.Delay(function(){return S.Bind(S.Sleep(600),function(){var bn,bo,bp;bn=bl.InPorts.get_Item(1).get_Number();bo=bl.InPorts.get_Item(0).get_Number();bp=T.random()*bn+bo;(l.NumTrigger(bl.OutPorts.get_Item(0)))(bp);return S.Zero();});}));})),null);return null;};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return P.ofArray([l.OutPortNum(this.OutPortKey,"Random value")]);},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return P.ofArray([l.InPortNum("Middle value",this.MiddleValue),l.InPortNum("Dispersion",this.Dispersion)]);},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return"Rundom";}},null,n);n.get_FromPorts=function(){return function(bl){return n.New(bl.InPorts.get_Item(0).get_NumberValue(),bl.InPorts.get_Item(1).get_NumberValue(),bl.OutPorts.get_Item(0).Key);};};n.Create=function(bl,bm){var bn;return n.New(f.Create(bl),f.Create(bm),(bn=E.NewGuid(),window.String(bn)));};n.New=function(bl,bm,bn){return new n({MiddleValue:bl,Dispersion:bm,OutPortKey:bn});};p.New=function(bl,bm,bn,bo,bp){return{Title:bl,Description:bm,ImageUrl:bn,Temperature:bo,TemparatureMinMax:bp};};o.get=function(bl,bm){var bn;bn=null;return S.Delay(function(){var bo;bo=(((D.Curried3(function(bp,bq,br){return bp("http://api.openweathermap.org/data/2.5/weather?q="+U.toSafe(bq)+"&units=metric&appid="+U.toSafe(br));}))(window.id))(bm))(bl);N.log("get key city "+bo);return S.TryWith(S.Delay(function(){return S.Bind(W.AsyncMap(_0.asyncReadTextAtRuntime(false,"C:\\Users\\Andrey\\Private\\VS_Projects\\WebSharper.Community.Dashboard\\WebSharper.Community.Dashboard","","JSON","",bo),function(bp){return O.Equals(typeof bp,"string")?_1.parse(bp):bp;}),function(bp){var bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM;N.log("get key city 2");return S.Return((bq=_2.tryHead(bp.weather),bq==null?null:{$:1,$0:(br=bq.$0,p.New((((D.Curried3(function(bN,bO,bP){return bN(U.toSafe(bO)+", "+U.toSafe(bP));}))(window.id))((bt=(bs="name",bs in bp?{$:1,$0:bp[bs]}:null),bt==null?null:bt.$0)))((bw=(bu=bp.sys,(bv="country",bv in bu?{$:1,$0:bu[bv]}:null)),bw==null?null:bw.$0)),(by=(bx="main",bx in br?{$:1,$0:br[bx]}:null),by==null?null:by.$0),(function(bN){return function(bO){return bN("http://openweathermap.org/img/w/"+U.toSafe(bO)+".png");};}(window.id))((bA=(bz="icon",bz in br?{$:1,$0:br[bz]}:null),bA==null?null:bA.$0)),(bB=(bC=bp.main,(bD="temp",bD in bC?{$:1,$0:bC[bD]}:null)),(bE=bB==null?null:{$:1,$0:1*bB.$0},bE==null?null:bE.$0)),[(bF=(bG=bp.main,(bH="temp_min",bH in bG?{$:1,$0:bG[bH]}:null)),(bI=bF==null?null:{$:1,$0:1*bF.$0},bI==null?null:bI.$0)),(bJ=(bK=bp.main,(bL="temp_max",bL in bK?{$:1,$0:bK[bL]}:null)),(bM=bJ==null?null:{$:1,$0:1*bJ.$0},bM==null?null:bM.$0))]))}));});}),function(bp){N.log(bp.message);return S.Return(null);});});};q=c.OpenWeatherRunner=D.Class({WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bl){var bm;S.Start((bm=null,S.Delay(function(){return S.While(function(){return true;},S.Delay(function(){var bn,bo,bp;bn=bl.InPorts.get_Item(0);bo=bl.InPorts.get_Item(1);bp=bl.OutPorts.get_Item(0);return S.Bind(o.get(bo.get_String(),bn.get_String()),function(bq){return S.Combine(bq==null?S.Zero():(N.log("Value generated:"+bq.$0.Title),(l.NumTrigger(bp))(+bq.$0.Temperature),S.Zero()),S.Delay(function(){return S.Bind(S.Sleep(1000*15),function(){return S.Return(null);});}));});}));})),null);return null;};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return P.ofArray([l.OutPortNum(this.OutPortKey,"Temperature")]);},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return P.ofArray([l.InPortStr("City",this.OpenWeatherCity),l.InPortStr("ApiKey",this.OpenWeatherApiKey)]);},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return"OpenWeatherMap";}},null,q);q.get_FromPorts=function(){return function(bl){return q.New(bl.InPorts.get_Item(0).get_StringValue(),bl.InPorts.get_Item(1).get_StringValue(),bl.OutPorts.get_Item(0).Key);};};q.Create=function(bl,bm){var bn;return q.New(g.Create(bl),g.Create(bm),(bn=E.NewGuid(),window.String(bn)));};q.New=function(bl,bm,bn){return new q({OpenWeatherCity:bl,OpenWeatherApiKey:bm,OutPortKey:bn});};r.New=function(bl){return{LineChart:bl};};s=c.ChartRenderer=D.Class({WebSharper_Community_Dashboard_IRenderer$get_Render:function(){return function(bl){return _5.Render$8(bl.RunnerContext.$0.LineChart,{$:1,$0:{$:0,$0:bl.InPorts.get_Item(1).get_Number()<<0,$1:bl.InPorts.get_Item(2).get_Number()<<0}},null,null);};},WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bl){var bm,bn,bo,bp,bq;bm=bl.InPorts.get_Item(3).get_Number()<<0;bn=P.ofSeq(_6.delay(function(){return _6.map(function(){return 0;},F.range(0,bm-1));}));bo=(bp=[],(_6.iter(function(br){bp.push(br);},bn),bp));bq=_7.Line(bn).__WithFillColor(new _8.Color({$:2,$0:"white"}));_9.Sink(function(br){bo.push(br);bo.length>bm?bo.shift():void 0;_6.iteri(function(bs,bt){return bq.__UpdateData(bs,function(){return bt;});},bo);},bl.InPorts.get_Item(0).get_NumberVar().v);return{$:1,$0:r.New(bq)};};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return P.T.Empty;},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return P.ofArray([l.InPortNum("in Value",f.Create(0)),l.InPortNum("cx",this.Cx),l.InPortNum("cy",this.Cy),l.InPortNum("BufferSize",this.ChartBufferSize)]);},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return"Chart";}},null,s);s.get_FromPorts=function(){return function(bl){return s.New(bl.InPorts.get_Item(1).get_NumberValue(),bl.InPorts.get_Item(1).get_NumberValue(),bl.InPorts.get_Item(2).get_NumberValue(),bl.InPorts.get_Item(3).get_NumberValue());};};s.Create=function(bl,bm,bn){return s.New(f.Create(0),f.Create(bl),f.Create(bm),f.Create(bn));};s.New=function(bl,bm,bn,bo){return new s({Number:bl,Cx:bm,Cy:bn,ChartBufferSize:bo});};t=c.TextBoxRenderer=D.Class({WebSharper_Community_Dashboard_IRenderer$get_Render:function(){return function(bl){var bm;bm=_9.Map(function(bn){var bo;bo=bn<<0;return window.String(bo);},bl.InPorts.get_Item(0).get_NumberVar().v);return Q.Element("div",[_.Class("bigvalue")],[Q.TextView(bm)]);};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return P.T.Empty;},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return P.ofArray([l.InPortNum("in Value",this.TextBoxValue)]);},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return"Text";}},null,t);t.get_FromPorts=function(){return function(bl){return t.New(bl.InPorts.get_Item(0).get_NumberValue());};};t.get_Create=function(){return t.New(f.Create(0));};t.New=function(bl){return new t({TextBoxValue:bl});};u.Create=function(bl){return u.New($.Fresh(),bl);};u.New=function(bl,bm){return{Key:bl,Worker:bm};};v=c.Factory=D.Class({RegisterEvent:function(bl){this.EventItems.Append(u.Create(bl));},RegisterWidget:function(bl){this.WidgetItems.Append(u.Create(bl));}},null,v);v.get_Create=function(){return v.New(ba.Create(function(bl){return bl.Key;},P.T.Empty),ba.Create(function(bl){return bl.Key;},P.T.Empty));};v.New=function(bl,bm){return new v({EventItems:bl,WidgetItems:bm});};w.Create=function(bl){return w.New($.Fresh(),bl);};w.New=function(bl,bm){return{Key:bl,PortConnector:bm};};x=c.DshData=D.Class({ConnectPorts:function(bl,bm){N.log("Connect ports:"+bl.Name+" "+bm.Name);this.PortConnectorItems.Append(w.Create(k.Create(bl,bm)));},RegisterWidget:function(bl){var bm;bm=u.Create(bl);this.WidgetItems.Append(bm);this.WorkItems.Append(bm);},RegisterEvent:function(bl){var bm;bm=u.Create(bl);this.EventItems.Append(bm);this.WorkItems.Append(bm);}},null,x);x.get_Create=function(){return x.New(ba.Create(function(bl){return bl.Key;},P.T.Empty),ba.Create(function(bl){return bl.Key;},P.T.Empty),ba.Create(function(bl){return bl.Key;},P.T.Empty),ba.Create(function(bl){return bl.Key;},P.T.Empty));};x.New=function(bl,bm,bn,bo){return new x({WorkItems:bl,WidgetItems:bm,EventItems:bn,PortConnectorItems:bo});};y=c.DshEditorCellItem=D.Class({Render:function(bl,bm){var bn,bo,bp,bq,br;bn=this;_9.Sink(function(bs){var bt;if(bs==null);else{bt=bs.$0;N.log("Workitem selected");K.Set(bn.OptInPort,P.tryHead(bt.Worker.InPorts));K.Set(bn.OptOutPort,P.tryHead(bt.Worker.OutPorts));bm();}},this.OptWorker.v);_9.Sink(function(){bm();},this.OptInPort.v);_9.Sink(function(){bm();},this.OptOutPort.v);bo=(bp=_9.Map(function(bs){var bt;return bs==null?P.ofArray([null]):(bt=P.map(function(bu){return{$:1,$0:bu};},bs.$0.Worker.InPorts),bt.get_Length()>0?bt:P.ofArray([null]));},this.OptWorker.v),(bq=_9.Map(function(bs){var bt;return bs==null?P.ofArray([null]):(bt=P.map(function(bu){return{$:1,$0:bu};},bs.$0.Worker.OutPorts),bt.get_Length()>0?bt:P.ofArray([null]));},this.OptWorker.v),(br=_9.Map(function(bs){return new P.T({$:1,$0:null,$1:P.map(function(bt){return{$:1,$0:bt};},P.ofSeq(bs))});},bl.WorkItems.v),Q.Element("table",[],[Q.Element("tr",[],[Q.Element("td",[],[Q.SelectDyn([_.Class("form-control")],function(bs){return bb.fold(function(bt,bu){return bu.Name;}," ",bs);},bp,this.OptInPort)]),Q.Element("td",[],[Q.SelectDyn([_.Class("form-control")],function(bs){return bb.fold(function(bt,bu){return bu.Worker.Name.c;}," ",bs);},br,this.OptWorker)]),Q.Element("td",[],[Q.SelectDyn([_.Class("form-control")],function(bs){return bb.fold(function(bt,bu){return bu.Name;}," ",bs);},bq,this.OptOutPort)])])]))));return Q.Element("td",[_.Class("td DshEditorCell")],[Q.Element("div",[_.Class("div DshEditorCell")],[Q.Element("table",[],[Q.Element("tr",[],[Q.Element("td",[],[bd.IconNormal("add",function(){})]),Q.Element("td",[],[bo])])])])]);}},null,y);y.get_Create=function(){return y.New($.Fresh(),K.Create$1(null),K.Create$1(null),K.Create$1(null));};y.New=function(bl,bm,bn,bo){return new y({Key:bl,OptInPort:bm,OptWorker:bn,OptOutPort:bo});};z=c.DshEditorRowItem=D.Class({Render:function(bl,bm){var bn;bn=this;return Q.Element("tr",[],[Q.ConvertBy(function(bo){return bo.Key;},function(bo){return bo.Render(bl,bm);},this.CellItems.v),bd.IconNormal("add",function(){bn.CellItems.Append(y.get_Create());})]);}},null,z);z.get_Create=function(){return z.New($.Fresh(),ba.Create(function(bl){return bl.Key;},P.T.Empty));};z.New=function(bl,bm){return new z({Key:bl,CellItems:bm});};A=c.DshEditor=D.Class({Render:function(bl){var bm;bm=this;return Q.Element("table",[],[Q.ConvertBy(function(bn){return bn.Key;},function(bn){return Q.Element("tr",[],[bn.Render(bl,function(){bm.Reconnect(bl,void 0);})]);},this.RowItems.v),Q.Element("tr",[],[Q.Element("td",[],[bd.IconNormal("add",function(){bm.RowItems.Append(z.get_Create());})])])]);},Reconnect:function(bl,bm){_6.iter(function(bn){bn.PortConnector.Disconnect();},bl.PortConnectorItems);bl.PortConnectorItems.Clear();P.iter(function(bn){var bo,bp,bq;bo=P.ofSeq(bn.CellItems);bp=P.ofSeq(F.range(1,bo.get_Length()-1));bq=be.Get(bp);try{while(bq.MoveNext())(function(){var br,bs,bt,bu,bv;br=bq.Current();bs=bo.get_Item(br-1);bt=bo.get_Item(br);bu=bs.OptOutPort.c,bu==null?null:{$:1,$0:(bv=bt.OptInPort.c,bv==null?null:{$:1,$0:bl.ConnectPorts(bu.$0,bv.$0)})};}());}finally{if("Dispose"in bq)bq.Dispose();}},P.ofSeq(this.RowItems));}},null,A);A.get_Create=function(){return A.New(ba.Create(function(bl){return bl.Key;},P.T.Empty));};A.New=function(bl){return new A({RowItems:bl});};B=c.Dashboard=D.Class({get_Render:function(){var bl,bm,bn,bo,bp,bq,br;function bs(bt,bu){var bv;bv=K.Create$1(bt);return[bv,Q.Element("div",[_.DynamicStyle("display",_9.Map(function(bw){return bw?"initial":"none";},bv.v))],[bu])];}bl=this;bm=Q.Element("table",[],[Q.ConvertBy(function(bt){return bt.Key;},function(bt){return Q.Element("tr",[],[Q.Element("i",bd.AttrsClick(function(){bl.PropertyGrid.Edit(bt.Worker.get_Properties());}),[Q.TextView(bt.Worker.Name.v)])]);},this.Data.EventItems.v)]);bn=P.ofArray([["Board",bs(true,this.PanelContainer.get_Render())],["Events",bs(false,bm)],["Rules",bs(false,this.DshEditor.Render(this.Data))]]);bo=(bp=function(bt,bu){var bv;bv=bu[0];return Q.Element("tr",[],[Q.Element("td",[_.DynamicStyle("Color",_9.Map(function(bw){return bw?"#FB8C00":"#7D4600";},bv.v)),_.Style("cursor","pointer"),_.Handler("click",function(){return function(){var bw;bl.PropertyGrid.Edit(P.T.Empty);bw=function(bx,by){var bz;bz=by[0];!O.Equals(bz,bv)?K.Set(bz,false):K.Set(bz,true);};return P.iter(function(bx){return bw(bx[0],bx[1]);},bn);};})],[Q.TextNode(bt)])]);},P.map(function(bt){return bp(bt[0],bt[1]);},bn));bq=(br=function(bt,bu){return bu[1];},P.map(function(bt){return br(bt[0],bt[1]);},bn));return Q.Element("div",[],[Q.Element("table",[],[Q.Element("tr",[],[Q.Element("td",[_.Style("vertical-align","top")],[Q.Element("table",[],_6.concat([P.ofArray([Q.Element("tr",[],[Q.Element("td",[],[bd.IconNormal("dehaze",function(){})])]),Q.Element("tr",[],[Q.Element("td",[],[bd.IconNormal("add",function(){var bt,bu,bv;bt=(bn.get_Item(0))[1][0];(bn.get_Item(1))[1][0].c?(bu=P.ofSeq(bl.Factory.EventItems),bv=K.Create$1(P.head(bu)),bl.Dialog.ShowDialog("Select source",Q.Element("div",[],[Q.Select([_.Class("form-control")],function(bw){return bw.Worker.Name.c;},bu,bv)]),function(){bl.Data.RegisterEvent(bv.c.Worker.get_CloneAndRun());})):bt.c?bl.CreatePanel("Panel",700,{$:1,$0:function(){}}):void 0;})])]),Q.Element("tr",[],[Q.Element("td",[],[])]),Q.Element("tr",[],[Q.Element("td",[],[this.PropertyGrid.get_Render()])])]),bo]))]),Q.Element("td",[],bq)])]),Q.Element("div",[],[this.Dialog.get_Render()])]);},CreatePanel:function(bl,bm,bn){var bo,bp;bo=this;Q.ConvertBy(this.Data.WidgetItems.key,function(bq){return Q.Element("div",[],[Q.TextView(bq.Worker.Name.v)]);},this.Factory.WidgetItems.v);bp=bf.get_Create().WithLayoutManager(bg.StackPanelLayoutManager()).WithAttributes([_.Style("border","1px solid white"),_.Style("display","flex")]);this.PanelContainer.AddPanel(bh.get_Create().WithPannelAttrs([_.Style("Width",window.String(bm)+"px"),_.Style("position","absolute")]).WithTitleContent(Q.TextNode(bl)).WithTitleButtons(P.ofArray([bi.New("add",function(bq){var br,bs;br=P.ofSeq(bo.Factory.WidgetItems);bs=K.Create$1(P.head(br));bo.Dialog.ShowDialog("Select widget",Q.Element("div",[],[Q.Select([_.Class("form-control")],function(bt){return bt.Worker.Name.c;},br,bs)]),function(){N.log("Dialog.IsOK");bo.RegisterWidget(bq.Children,bs.c.Worker.get_CloneAndRun());});}),bi.New("edit",function(bq){N.log("Edit");bq.EditProperties(bo.PropertyGrid);}),bi.New("clear",function(bq){bo.PanelContainer.PanelItems.Remove(bo.PanelContainer.FindPanelItem(bq));})])).WithChildPanelContainer(bp).WithOnAfterRender(bn==null?function(){}:bn.$0));return bp;},RegisterWidget:function(bl,bm){this.Data.RegisterWidget(bm);bl.AddPanel(bh.get_Create().WithTitle(false).WithPanelContent(bm.get_Render()));}},null,B);B.Create=function(bl){var bm;bm=bj.get_Create();return B.New(v.get_Create(),x.get_Create(),bl,A.get_Create(),bk.get_Create(),bm);};B.New=function(bl,bm,bn,bo,bp,bq){return new B({Factory:bl,Data:bm,PanelContainer:bn,DshEditor:bo,PropertyGrid:bp,Dialog:bq});};}());
