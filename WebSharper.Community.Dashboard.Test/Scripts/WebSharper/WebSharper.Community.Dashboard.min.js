(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw;a=window.WebSharper=window.WebSharper||{};b=a.Community=a.Community||{};c=b.Dashboard=b.Dashboard||{};d=c.MessageBus=c.MessageBus||{};e=d.Value=d.Value||{};f=d.KeyValue=d.KeyValue||{};g=d.ListenerInfo=d.ListenerInfo||{};h=d.Message=d.Message||{};i=d.AgentState=d.AgentState||{};j=window.StartupCode$WebSharper_Community_Dashboard$MessageBus=window.StartupCode$WebSharper_Community_Dashboard$MessageBus||{};k=c.InPort=c.InPort||{};l=c.OutPortType=c.OutPortType||{};m=c.OutPort=c.OutPort||{};n=c.Ports=c.Ports||{};o=c.Worker=c.Worker||{};p=c.Workers=c.Workers||{};q=c.RandomRunner=c.RandomRunner||{};r=c.OpenWeather=c.OpenWeather||{};s=r.Forecast=r.Forecast||{};t=c.OpenWeatherRunner=c.OpenWeatherRunner||{};u=c.ChartRunnerContext=c.ChartRunnerContext||{};v=c.ChartRenderer=c.ChartRenderer||{};w=c.TextBoxRenderer=c.TextBoxRenderer||{};x=c.RuleEntry=c.RuleEntry||{};y=c.RuleChain=c.RuleChain||{};z=c.RuleContainer=c.RuleContainer||{};A=c.WorkerItem=c.WorkerItem||{};B=c.Factory=c.Factory||{};C=c.WidgetItem=c.WidgetItem||{};D=c.DshData=c.DshData||{};E=c.DshEditorCellItem=c.DshEditorCellItem||{};F=c.DshEditorRowItem=c.DshEditorRowItem||{};G=c.DshEditor=c.DshEditor||{};H=c.Dashboard=c.Dashboard||{};I=c.AppModelLib=c.AppModelLib||{};J=c.App=c.App||{};K=window.StartupCode$WebSharper_Community_Dashboard$AppModelLib=window.StartupCode$WebSharper_Community_Dashboard$AppModelLib||{};L=window.IntelliFactory;M=L&&L.Runtime;N=a&&a.Operators;O=b&&b.Panel;P=O&&O.Helper;Q=window.Date;R=a&&a.List;S=a&&a.Concurrency;T=a&&a.Remoting;U=T&&T.AjaxRemotingProvider;V=a&&a.Control;W=V&&V.MailboxProcessor;X=a&&a.PrintfHelpers;Y=a&&a.Seq;Z=a&&a.UI;_0=Z&&Z.Next;_1=_0&&_0.Var;_2=b&&b.PropertyGrid;_3=_2&&_2.Properties;_4=a&&a.Guid;_5=a&&a.Unchecked;_6=_0&&_0.Doc;_7=a&&a.Random;_8=window.Math;_9=window.console;_=a&&a.Data;$=_&&_.TxtRuntime;ba=window.FSharp;bb=ba&&ba.Data;bc=bb&&bb.Runtime;bd=bc&&bc.IO;be=window.JSON;bf=a&&a.Arrays;bg=_0&&_0.View;bh=a&&a.Charting;bi=bh&&bh.Renderers;bj=bi&&bi.ChartJs;bk=bh&&bh.Chart;bl=bh&&bh.Pervasives;bm=_0&&_0.AttrModule;bn=a&&a.Enumerator;bo=_0&&_0.Key;bp=_0&&_0.ListModel;bq=a&&a.Option;br=O&&O.PanelContainer;bs=O&&O.LayoutManagers;bt=O&&O.Panel;bu=O&&O.TitleButton;bv=O&&O.Dialog;bw=_2&&_2.PropertyGrid;e=d.Value=M.Class({get_AsNumber:function(){return this.$==0?this.$0:N.FailWith("MessageBus.Value: unexpected type");}},null,e);f.Create=function(bx){return f.New(P.UniqueKey(),Q.now(),bx);};f.New=function(bx,by,bz){return{Key:bx,Time:by,Value:bz};};g.Create=function(bx,by,bz){return g.New(bx,by,bz);};g.New=function(bx,by,bz){return{Key:bx,Name:by,CacheSize:bz};};h.Clear={$:2};i.get_empty=function(){return i.New(R.T.Empty);};i.New=function(bx){return{Listeners:bx};};d.RunServerRequests=function(){var bx;S.Start((bx=null,S.Delay(function(){return S.While(function(){return true;},S.Delay(function(){return S.Bind(S.Sleep(10*1000),function(){return S.Bind(d.Agent().PostAndAsyncReply(function(by){return{$:4,$0:by};},null),function(by){return S.Bind((new U.New()).Async("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.MessageBus.GetMessages:-745577628",[by]),function(bz){R.iter(function(bA){var bB;bB=d.Agent();bB.mailbox.AddLast({$:0,$0:bA});bB.resume();},bz);(d.Log())((function(bA){return function(bB){return bA("Values from server requested messages received:"+window.String(bB));};}(window.id))(bz.get_Length()));return S.Zero();});});});}));})),null);};d.Agent=function(){j.$cctor();return j.Agent;};d.CreateString=function(bx){return d.CreateStrPair(P.UniqueKey(),bx);};d.CreateNumber=function(bx){return d.CreateNumPair(P.UniqueKey(),bx);};d.CreateStrPair=function(bx,by){return d.CreateKeyValue(bx,new e({$:1,$0:by}));};d.CreateNumPair=function(bx,by){return d.CreateKeyValue(bx,new e({$:0,$0:by}));};d.CreateKeyValue=function(bx,by){return f.New(bx,Q.now(),by);};d.Log=function(){j.$cctor();return j.Log;};d.set_Log=function(bx){j.$cctor();j.Log=bx;};j.$cctor=M.Cctor(function(){j.Log=function(){};j.Agent=W.Start(function(bx){var by,bz,bA;function bB(bC){var bD;bD=null;return S.Delay(function(){return S.Bind(bx.Receive(null),function(bE){var bF,bG,bH,bI,bJ,bK,bL;return bE.$==1?(bF=bE.$0[0],((d.Log())((function(bM){return function(bN){return bM("RegisterListener:"+X.toSafe(bN));};}(window.id))(bF.Name)),bB(i.New(new R.T({$:1,$0:[bF,bE.$0[2],R.T.Empty],$1:bC.Listeners}))))):bE.$==3?(bG=bE.$0[0],(bE.$0[1](Y.fold(function(bM,bN){return!R.contains(bN,bM)?new R.T({$:1,$0:bN,$1:bM}):bM;},R.T.Empty,R.concat((bH=function(bM,bN,bO){return by(bG,bO);},R.map(function(bM){return bH(bM[0],bM[1],bM[2]);},bC.Listeners))))),bB(bC))):bE.$==4?(bI=(bJ=function(bM,bN,bO){return bO.$==0?(new Q(0,0-1,0)).getTime():R.maxBy(function(bP){return bP.Time;},bO).Time;},R.map(function(bM){return bJ(bM[0],bM[1],bM[2]);},bC.Listeners)),(bE.$0(bI.$==0?(new Q(0,0-1,0)).getTime():R.max(bI)),bB(bC))):bE.$==0?(bK=bE.$0,bB(i.New((bL=function(bM,bN,bO){var bP;bP=window.Array.prototype.slice.call(arguments);return bM.Key===bK.Key?(bN(bK.Value),[bM,bN,bA(bM.CacheSize,bO,bK)]):bP;},R.map(function(bM){return bL(bM[0],bM[1],bM[2]);},bC.Listeners))))):bB(i.get_empty());});});}by=function(bC,bD){return Y.fold(function(bE,bF){return bF.Time>=bC?new R.T({$:1,$0:bF,$1:bE}):bE;},R.T.Empty,bD);};bz=function(bC,bD){return bC<bD.get_Length()?(R.splitAt(bC,bD))[0]:bD;};bA=function(bC,bD,bE){return bC===1?R.ofArray([bE]):bz(bC,new R.T({$:1,$0:bE,$1:bD}));};return bB(i.get_empty());},null);j.$cctor=window.ignore;});k=c.InPort=M.Class({Equals:function(bx){return bx instanceof k&&this.Name===bx.Name;},get_StringValue:function(){var bx;bx=this;return this.ExtractPortStringValue(function(by){return d.CreateStrPair(bx.Key,by.c);});},get_StringVar:function(){return this.ExtractPortStringValue(window.id);},get_String:function(){return this.ExtractPortStringValue(function(bx){return bx.c;});},ExtractPortStringValue:function(bx){var by;by=this.PortValue;return by.$==1?bx(by.$0):N.FailWith("unexpected type");},get_NumberValue:function(){var bx;bx=this;return this.ExtractPortNumberValue(function(by){return d.CreateNumPair(bx.Key,by.c);});},get_NumberVar:function(){return this.ExtractPortNumberValue(window.id);},get_Number:function(){return this.ExtractPortNumberValue(function(bx){return bx.c;});},ExtractPortNumberValue:function(bx){var by;by=this.PortValue;return by.$==0?bx(by.$0):N.FailWith("unexpected type");},Receive:function(bx){var by;by=this.PortValue;by.$==1?bx.$==1?_1.Set(by.$0,bx.$0):N.FailWith("incompatible types"):bx.$==0?_1.Set(by.$0,bx.$0):N.FailWith("incompatible types");},get_Property:function(){var bx;bx=this.PortValue;return bx.$==1?_3.string(this.Name,bx.$0):_3["double"](this.Name,bx.$0);},get_Clone:function(){var bx,by;return k.New((bx=_4.NewGuid(),window.String(bx)),this.Name,(by=this.PortValue,by.$==1?{$:1,$0:_1.Create$1(by.$0.c)}:{$:0,$0:_1.Create$1(by.$0.c)}),this.CacheSize);}},null,k);k.Create=function(bx,by,bz,bA){return k.New(bx,by,bz,bA);};k.New=function(bx,by,bz,bA){return new k({Key:bx,Name:by,PortValue:bz,CacheSize:bA});};l=c.OutPortType=M.Class({IsCompatible:function(bx){return this.$==1?bx.PortValue.$==1&&true:bx.PortValue.$==0&&true;}},null,l);l.StringOutPort=new l({$:1});l.NumberOutPort=new l({$:0});m=c.OutPort=M.Class({Equals:function(bx){return bx instanceof m&&this.Name===bx.Name;},Trigger:function(bx){var by;by=d.Agent();by.mailbox.AddLast({$:0,$0:d.CreateKeyValue(this.Key,bx)});by.resume();},get_Clone:function(){return m.New(P.UniqueKey(),this.Name,this.Type);}},null,m);m.CreateString=function(bx,by){return m.Create(bx,by,l.StringOutPort);};m.CreateNumber=function(bx,by){return m.Create(bx,by,l.NumberOutPort);};m.Create=function(bx,by,bz){return m.New(bx,by,bz);};m.New=function(bx,by,bz){return new m({Key:bx,Name:by,Type:bz});};n.Create=function(bx){var by;return n.CreateWithCache((by=function(bz,bA){return[bz,bA,1];},R.map(function(bz){return by(bz[0],bz[1]);},bx)));};n.CreateWithCache=function(bx){var by;by=function(bz,bA,bB){var bC;bC=bA.Value;return bC.$==1?k.Create(bA.Key,bz,{$:1,$0:_1.Create$1(bC.$0)},bB):k.Create(bA.Key,bz,{$:0,$0:_1.Create$1(bC.$0)},bB);};return R.map(function(bz){return by(bz[0],bz[1],bz[2]);},bx);};o=c.Worker=M.Class({Equals:function(bx){return bx instanceof o&&_5.Equals(this.Name,bx.Name);},get_Properties:function(){return new R.T({$:1,$0:_3.string("Name",this.Name),$1:R.map(function(bx){return bx.get_Property();},this.InPorts)});},get_Render:function(){var bx;bx=this.Renderer;return bx==null?_6.Empty():(bx.$0.WebSharper_Community_Dashboard_IRenderer$get_Render())(this);},get_CloneAndRun:function(){var bx,by,bz;bx=_1.Create$1(this.Name.c);by=R.map(function(bA){return bA.get_Clone();},this.InPorts);bz=R.map(function(bA){return bA.get_Clone();},this.OutPorts);return o.New(P.UniqueKey(),bx,by,bz,this.Runner,this.Renderer,this.DataContext,null).WithStartRunner();},WithStartRunner:function(){var bx;bx=this.Runner;return bx==null?this:o.New(this.Key,this.Name,this.InPorts,this.OutPorts,this.Runner,this.Renderer,this.DataContext,(bx.$0.WebSharper_Community_Dashboard_IRunner$get_Run())(this));},WithRenderer:function(bx){return o.New(this.Key,this.Name,this.InPorts,this.OutPorts,this.Runner,{$:1,$0:bx},this.DataContext,this.RunnerContext);},WithRunner:function(bx){return o.New(this.Key,this.Name,this.InPorts,this.OutPorts,{$:1,$0:bx},this.Renderer,this.DataContext,this.RunnerContext);},WithKey:function(bx){return o.New(bx,this.Name,this.InPorts,this.OutPorts,this.Runner,this.Renderer,this.DataContext,this.RunnerContext);}},null,o);o.CreateWithRenderer=function(bx){return o.Create(bx).WithRenderer(bx);};o.CreateWithRunner=function(bx){return o.Create(bx).WithRunner(bx);};o.Create=function(bx){return o.New(P.UniqueKey(),_1.Create$1(bx.WebSharper_Community_Dashboard_IWorkerContext$get_Name()),bx.WebSharper_Community_Dashboard_IWorkerContext$get_InPorts(),bx.WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts(),null,null,bx,null);};o.New=function(bx,by,bz,bA,bB,bC,bD,bE){return new o({Key:bx,Name:by,InPorts:bz,OutPorts:bA,Runner:bB,Renderer:bC,DataContext:bD,RunnerContext:bE});};p.allInPorts=function(bx){return p.allPorts(bx,function(by){return by.InPorts;});};p.allOutPorts=function(bx){return p.allPorts(bx,function(by){return by.OutPorts;});};p.allPorts=function(bx,by){return R.concat(R.map(by,bx));};q=c.RandomRunner=M.Class({WithMiddleValue:function(bx){return q.New(this.Name,d.CreateNumber(bx),this.Dispersion,this.OutPortKey);},WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bx){var by;new _7.New();S.Start((by=null,S.Delay(function(){return S.While(function(){return true;},S.Delay(function(){return S.Bind(S.Sleep(600),function(){var bz,bA,bB;bz=bx.InPorts.get_Item(1).get_Number();bA=bx.InPorts.get_Item(0).get_Number();bB=_8.random()*bz+bA;bx.OutPorts.get_Item(0).Trigger(new e({$:0,$0:bB}));return S.Zero();});}));})),null);return null;};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return R.ofArray([m.CreateNumber(this.OutPortKey,"Random value")]);},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return n.Create(R.ofArray([["Middle value",this.MiddleValue],["Dispersion",this.Dispersion]]));},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return this.Name;}},null,q);q.get_FromPorts=function(){return function(bx){return q.New(bx.Name.c,bx.InPorts.get_Item(0).get_NumberValue(),bx.InPorts.get_Item(1).get_NumberValue(),bx.OutPorts.get_Item(0).Key);};};q.Create=function(bx,by){var bz;return q.New("Random",d.CreateNumber(bx),d.CreateNumber(by),(bz=_4.NewGuid(),window.String(bz)));};q.New=function(bx,by,bz,bA){return new q({Name:bx,MiddleValue:by,Dispersion:bz,OutPortKey:bA});};s.New=function(bx,by,bz,bA,bB){return{Title:bx,Description:by,ImageUrl:bz,Temperature:bA,TemparatureMinMax:bB};};r.get=function(bx,by){var bz;bz=null;return S.Delay(function(){var bA;bA=(((M.Curried3(function(bB,bC,bD){return bB("http://api.openweathermap.org/data/2.5/weather?q="+X.toSafe(bC)+"&units=metric&appid="+X.toSafe(bD));}))(window.id))(by))(bx);_9.log("get key city "+bA);return S.TryWith(S.Delay(function(){return S.Bind($.AsyncMap(bd.asyncReadTextAtRuntime(false,"C:\\Users\\Andrey\\Private\\VS_Projects\\WebSharper.Community.Dashboard\\WebSharper.Community.Dashboard","","JSON","",bA),function(bB){return _5.Equals(typeof bB,"string")?be.parse(bB):bB;}),function(bB){var bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY;_9.log("get key city 2");return S.Return((bC=bf.tryHead(bB.weather),bC==null?null:{$:1,$0:(bD=bC.$0,s.New((((M.Curried3(function(bZ,b0,b1){return bZ(X.toSafe(b0)+", "+X.toSafe(b1));}))(window.id))((bF=(bE="name",bE in bB?{$:1,$0:bB[bE]}:null),bF==null?null:bF.$0)))((bI=(bG=bB.sys,(bH="country",bH in bG?{$:1,$0:bG[bH]}:null)),bI==null?null:bI.$0)),(bK=(bJ="main",bJ in bD?{$:1,$0:bD[bJ]}:null),bK==null?null:bK.$0),(function(bZ){return function(b0){return bZ("http://openweathermap.org/img/w/"+X.toSafe(b0)+".png");};}(window.id))((bM=(bL="icon",bL in bD?{$:1,$0:bD[bL]}:null),bM==null?null:bM.$0)),(bN=(bO=bB.main,(bP="temp",bP in bO?{$:1,$0:bO[bP]}:null)),(bQ=bN==null?null:{$:1,$0:1*bN.$0},bQ==null?null:bQ.$0)),[(bR=(bS=bB.main,(bT="temp_min",bT in bS?{$:1,$0:bS[bT]}:null)),(bU=bR==null?null:{$:1,$0:1*bR.$0},bU==null?null:bU.$0)),(bV=(bW=bB.main,(bX="temp_max",bX in bW?{$:1,$0:bW[bX]}:null)),(bY=bV==null?null:{$:1,$0:1*bV.$0},bY==null?null:bY.$0))]))}));});}),function(bB){_9.log(bB.message);return S.Return(null);});});};t=c.OpenWeatherRunner=M.Class({WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bx){var by;S.Start((by=null,S.Delay(function(){return S.While(function(){return true;},S.Delay(function(){var bz,bA,bB;bz=bx.InPorts.get_Item(0);bA=bx.InPorts.get_Item(1);bB=bx.OutPorts.get_Item(0);return S.Bind(r.get(bA.get_String(),bz.get_String()),function(bC){return S.Combine(bC==null?S.Zero():(_9.log("Value generated:"+bC.$0.Title),bB.Trigger(new e({$:0,$0:+bC.$0.Temperature})),S.Zero()),S.Delay(function(){return S.Bind(S.Sleep(1000*15),function(){return S.Return(null);});}));});}));})),null);return null;};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return R.ofArray([m.CreateNumber(this.OutPortKey,"Temperature")]);},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return n.Create(R.ofArray([["City",this.OpenWeatherCity],["ApiKey",this.OpenWeatherApiKey]]));},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return this.Name;}},null,t);t.get_FromPorts=function(){return function(bx){return t.New(bx.Name.c,bx.InPorts.get_Item(0).get_StringValue(),bx.InPorts.get_Item(1).get_StringValue(),bx.OutPorts.get_Item(0).Key);};};t.Create=function(bx,by){var bz;return t.New("OpenWeatherMap",d.CreateString(bx),d.CreateString(by),(bz=_4.NewGuid(),window.String(bz)));};t.New=function(bx,by,bz,bA){return new t({Name:bx,OpenWeatherCity:by,OpenWeatherApiKey:bz,OutPortKey:bA});};u.New=function(bx,by){return{LineChart:bx,Queue:by};};v=c.ChartRenderer=M.Class({WebSharper_Community_Dashboard_IRenderer$get_Render:function(){return function(bx){var by,bz;by=bx.InPorts.get_Item(3).get_Number()<<0;bz=bx.RunnerContext.$0;bg.Sink(function(bA){bz.Queue.push(bA);bz.Queue.length>by?bz.Queue.shift():void 0;Y.iteri(function(bB,bC){return bz.LineChart.__UpdateData(bB,function(){return bC;});},bz.Queue);},bx.InPorts.get_Item(0).get_NumberVar().v);return bj.Render$8(bx.RunnerContext.$0.LineChart,{$:1,$0:{$:0,$0:bx.InPorts.get_Item(1).get_Number()<<0,$1:bx.InPorts.get_Item(2).get_Number()<<0}},null,null);};},WebSharper_Community_Dashboard_IRunner$get_Run:function(){return function(bx){var by,bz,bA,bB;by=bx.InPorts.get_Item(3).get_Number()<<0;bz=R.ofSeq(Y.delay(function(){return Y.map(function(){return 0;},N.range(0,by-1));}));bA=(bB=[],(Y.iter(function(bC){bB.push(bC);},bz),bB));return{$:1,$0:u.New(bk.Line(bz).__WithFillColor(new bl.Color({$:2,$0:"white"})),bA)};};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return R.T.Empty;},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return n.CreateWithCache(R.ofArray([[" in Value",this.Number,this.ChartBufferSize.Value.get_AsNumber()<<0],["cx",this.Cx,1],["cy",this.Cy,1],["BufferSize",this.ChartBufferSize,1]]));},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return this.Name;}},null,v);v.get_FromPorts=function(){return function(bx){return v.New(bx.Name.c,bx.InPorts.get_Item(0).get_NumberValue(),bx.InPorts.get_Item(1).get_NumberValue(),bx.InPorts.get_Item(2).get_NumberValue(),bx.InPorts.get_Item(3).get_NumberValue());};};v.Create=function(bx,by,bz){return v.New("Chart",d.CreateNumber(0),d.CreateNumber(bx),d.CreateNumber(by),d.CreateNumber(bz));};v.New=function(bx,by,bz,bA,bB){return new v({Name:bx,Number:by,Cx:bz,Cy:bA,ChartBufferSize:bB});};w=c.TextBoxRenderer=M.Class({WebSharper_Community_Dashboard_IRenderer$get_Render:function(){return function(bx){var by;by=bg.Map(function(bz){var bA;bA=bz<<0;return window.String(bA);},bx.InPorts.get_Item(0).get_NumberVar().v);return _6.Element("div",[bm.Class("bigvalue")],[_6.TextView(by)]);};},WebSharper_Community_Dashboard_IWorkerContext$get_OutPorts:function(){return R.T.Empty;},WebSharper_Community_Dashboard_IWorkerContext$get_InPorts:function(){return n.Create(R.ofArray([["in Value",this.TextBoxValue]]));},WebSharper_Community_Dashboard_IWorkerContext$get_Name:function(){return this.Name;}},null,w);w.get_FromPorts=function(){return function(bx){return w.New(bx.Name.c,bx.InPorts.get_Item(0).get_NumberValue());};};w.get_Create=function(){return w.New("Text",d.CreateNumber(0));};w.New=function(bx,by){return new w({Name:bx,TextBoxValue:by});};x.New=function(bx,by,bz){return{InPortKey:bx,OutPortKey:by,WorkerKey:bz};};y.New=function(bx){return{RuleChain:bx};};z=c.RuleContainer=M.Class({Reconnect:function(bx){var by,bz,bA;by=p.allOutPorts(bx);bz=p.allInPorts(bx);R.iter(function(bB){(d.Log())((((M.Curried3(function(bC,bD,bE){return bC(X.toSafe(bD)+" "+X.toSafe(bE));}))(window.id))(bB.Name))(bB.Key));},bz);bA=d.Agent();bA.mailbox.AddLast(h.Clear);bA.resume();R.iter(function(bB){var bC,bD,bE;bC=R.ofSeq(bB.RuleChain);bD=R.ofSeq(N.range(1,bC.get_Length()-1));bE=bn.Get(bD);try{while(bE.MoveNext())(function(){var bF,bG,bH,bI,bJ,bK,bL,bM,bN;bF=bE.Current();bG=bC.get_Item(bF-1);bH=bC.get_Item(bF);bI=Y.tryFind(function(bO){return bO.Key===bG.OutPortKey;},by),bI==null?null:{$:1,$0:(bJ=bI.$0,((d.Log())((function(bO){return function(bP){return bO("Found out port "+X.toSafe(bP));};}(window.id))(bH.InPortKey)),bK=Y.tryFind(function(bO){return bO.Key===bH.InPortKey;},bz),bK==null?null:{$:1,$0:(bL=bK.$0,((d.Log())("Found int port"),bM=bL.PortValue.$==1?f.Create(new e({$:1,$0:""})):f.Create(new e({$:0,$0:0})),bN=d.Agent(),bN.mailbox.AddLast({$:1,$0:[g.Create(bJ.Key,bJ.Name+"->"+bL.Name,bL.CacheSize),bM,function(bO){bL.Receive(bO);}]}),bN.resume()))}))};}());}finally{if("Dispose"in bE)bE.Dispose();}},R.ofSeq(this.RuleContainer));}},null,z);z.New=function(bx){return new z({RuleContainer:bx});};A.Create=function(bx){return A.New(bo.Fresh(),bx);};A.New=function(bx,by){return{Key:bx,Worker:by};};B=c.Factory=M.Class({RegisterEvent:function(bx){this.EventItems.Append(A.Create(bx));},RegisterWidget:function(bx){this.WidgetItems.Append(A.Create(bx));}},null,B);B.get_Create=function(){return B.New(bp.Create(function(bx){return bx.Key;},R.T.Empty),bp.Create(function(bx){return bx.Key;},R.T.Empty));};B.New=function(bx,by){return new B({EventItems:bx,WidgetItems:by});};C.Create=function(bx,by){return C.New(bo.Fresh(),bx,by);};C.New=function(bx,by,bz){return{Key:bx,Panel:by,Widget:bz};};D=c.DshData=M.Class({RegisterWidget:function(bx,by,bz){var bA;bA=bz.WithKey(bx);this.WidgetItems.Append(C.Create(by,bA));this.WorkItems.Append(A.Create(bA));},RegisterEvent:function(bx,by){var bz;bz=A.Create(by.WithKey(bx));this.EventItems.Append(bz);this.WorkItems.Append(bz);},get_Clear:function(){this.WorkItems.Clear();this.WidgetItems.Clear();this.EventItems.Clear();}},null,D);D.get_Create=function(){return D.New(bp.Create(function(bx){return bx.Key;},R.T.Empty),bp.Create(function(bx){return bx.Key;},R.T.Empty),bp.Create(function(bx){return bx.Key;},R.T.Empty));};D.New=function(bx,by,bz){return new D({WorkItems:bx,WidgetItems:by,EventItems:bz});};E=c.DshEditorCellItem=M.Class({Render:function(bx,by){var bz,bA,bB,bC,bD;bz=this;bg.Sink(function(bE){var bF;if(bE==null);else{bF=bE.$0;_9.log("Workitem selected");_1.Set(bz.OptInPort,R.tryHead(bF.Worker.InPorts));_1.Set(bz.OptOutPort,R.tryHead(bF.Worker.OutPorts));by();}},this.OptWorker.v);bg.Sink(function(){by();},this.OptInPort.v);bg.Sink(function(){by();},this.OptOutPort.v);bA=(bB=bg.Map(function(bE){var bF;return bE==null?R.ofArray([null]):(bF=R.map(function(bG){return{$:1,$0:bG};},bE.$0.Worker.InPorts),bF.get_Length()>0?bF:R.ofArray([null]));},this.OptWorker.v),(bC=bg.Map(function(bE){var bF;return bE==null?R.ofArray([null]):(bF=R.map(function(bG){return{$:1,$0:bG};},bE.$0.Worker.OutPorts),bF.get_Length()>0?bF:R.ofArray([null]));},this.OptWorker.v),(bD=bg.Map(function(bE){return new R.T({$:1,$0:null,$1:R.map(function(bF){return{$:1,$0:bF};},R.ofSeq(bE))});},bx.WorkItems.v),_6.Element("table",[],[_6.Element("tr",[],[_6.Element("td",[],[_6.SelectDyn([bm.Class("form-control")],function(bE){return bq.fold(function(bF,bG){return bG.Name;}," ",bE);},bB,this.OptInPort)]),_6.Element("td",[],[_6.SelectDyn([bm.Class("form-control")],function(bE){return bq.fold(function(bF,bG){return bG.Worker.Name.c;}," ",bE);},bD,this.OptWorker)]),_6.Element("td",[],[_6.SelectDyn([bm.Class("form-control")],function(bE){return bq.fold(function(bF,bG){return bG.Name;}," ",bE);},bC,this.OptOutPort)])])]))));return _6.Element("td",[bm.Class("td DshEditorCell")],[_6.Element("div",[bm.Class("div DshEditorCell")],[_6.Element("table",[],[_6.Element("tr",[],[_6.Element("td",[],[bA])])])])]);}},null,E);E.get_Create=function(){return E.New(bo.Fresh(),_1.Create$1(null),_1.Create$1(null),_1.Create$1(null));};E.New=function(bx,by,bz,bA){return new E({Key:bx,OptInPort:by,OptWorker:bz,OptOutPort:bA});};F=c.DshEditorRowItem=M.Class({Render:function(bx,by){var bz;bz=this;return _6.Element("tr",[],[_6.ConvertBy(function(bA){return bA.Key;},function(bA){return bA.Render(bx,by);},this.CellItems.v),P.IconNormal("add",function(){bz.CellItems.Append(E.get_Create());})]);}},null,F);F.Create=function(bx){return F.New(bo.Fresh(),bp.Create(function(by){return by.Key;},bx));};F.New=function(bx,by){return new F({Key:bx,CellItems:by});};G=c.DshEditor=M.Class({Render:function(bx){var by,bz;by=this;bz=function(){var bA;bA=R.map(function(bB){return bB.Worker;},R.ofSeq(bx.WorkItems));by.get_CopyToRules().Reconnect(bA);};return _6.Element("table",[],[_6.ConvertBy(function(bA){return bA.Key;},function(bA){return _6.Element("tr",[],[bA.Render(bx,function(){bz();})]);},this.RowItems.v)]);},Restore:function(bx,by){var bz,bA,bB,bC;bz=this;this.RowItems.Clear();bA=R.map(function(bD){return bD.Worker;},R.ofSeq(bx.WorkItems));bB=p.allOutPorts(bA);bC=p.allInPorts(bA);R.iter(function(bD){var bE;bE=F.Create([]);R.iter(function(bF){var bG;bG=E.get_Create();_1.Set(bG.OptWorker,Y.tryFind(function(bH){return bH.Worker.Key===bF.WorkerKey;},R.ofSeq(bx.WorkItems)));_1.Set(bG.OptInPort,Y.tryFind(function(bH){return bH.Key===bF.InPortKey;},bC));_1.Set(bG.OptOutPort,Y.tryFind(function(bH){return bH.Key===bF.OutPortKey;},bB));bE.CellItems.Append(bG);},bD.RuleChain);bz.RowItems.Append(bE);},by.RuleContainer);by.Reconnect(bA);},get_CopyToRules:function(){return z.New(R.map(function(bx){return y.New(R.map(function(by){var bz,bA,bB;return x.New((bz=by.OptInPort.c,bz==null?"":bz.$0.Key),(bA=by.OptOutPort.c,bA==null?"":bA.$0.Key),(bB=by.OptWorker.c,bB==null?"":bB.$0.Worker.Key));},R.ofSeq(bx.CellItems)));},R.ofSeq(this.RowItems)));}},null,G);G.get_Create=function(){return G.New(bp.Create(function(bx){return bx.Key;},R.T.Empty));};G.New=function(bx){return new G({RowItems:bx});};H=c.Dashboard=M.Class({get_Render:function(){var bx,by,bz,bA,bB,bC,bD;function bE(bF,bG){var bH;bH=_1.Create$1(bF);return[bH,_6.Element("div",[bm.DynamicStyle("display",bg.Map(function(bI){return bI?"initial":"none";},bH.v))],[bG])];}bx=this;by=_6.Element("table",[],[_6.ConvertBy(function(bF){return bF.Key;},function(bF){return _6.Element("tr",[],[_6.Element("i",P.AttrsClick(function(){bx.PropertyGrid.Edit(bF.Worker.get_Properties());}),[_6.TextView(bF.Worker.Name.v)])]);},this.Data.EventItems.v)]);bz=R.ofArray([["Board",bE(true,this.PanelContainer.get_Render())],["Events",bE(false,by)],["Rules",bE(false,this.Editor.Render(this.Data))]]);bA=(bB=function(bF,bG){var bH;bH=bG[0];return _6.Element("tr",[],[_6.Element("td",[bm.DynamicStyle("Color",bg.Map(function(bI){return bI?"#FB8C00":"#7D4600";},bH.v)),bm.Style("cursor","pointer"),bm.Handler("click",function(){return function(){var bI;bx.PropertyGrid.Edit(R.T.Empty);bI=function(bJ,bK){var bL;bL=bK[0];!_5.Equals(bL,bH)?_1.Set(bL,false):_1.Set(bL,true);};return R.iter(function(bJ){return bI(bJ[0],bJ[1]);},bz);};})],[_6.TextNode(bF)])]);},R.map(function(bF){return bB(bF[0],bF[1]);},bz));bC=(bD=function(bF,bG){return bG[1];},R.map(function(bF){return bD(bF[0],bF[1]);},bz));return _6.Element("div",[],[_6.Element("table",[],[_6.Element("tr",[],[_6.Element("td",[bm.Style("vertical-align","top")],[_6.Element("table",[],Y.concat([R.ofArray([_6.Element("tr",[],[_6.Element("td",[],[P.IconNormal("dehaze",function(){})])]),_6.Element("tr",[],[_6.Element("td",[],[P.IconNormal("add",function(){var bF,bG,bH,bI,bJ;bF=(bz.get_Item(0))[1][0];bG=(bz.get_Item(1))[1][0];bH=(bz.get_Item(2))[1][0];bG.c?(bI=R.ofSeq(bx.Factory.EventItems),bJ=_1.Create$1(R.head(bI)),bx.Dialog.ShowDialog("Select source",_6.Element("div",[],[_6.Select([bm.Class("form-control")],function(bK){return bK.Worker.Name.c;},bI,bJ)]),function(){var bK;bK=bJ.c.Worker.get_CloneAndRun();bx.Data.RegisterEvent(P.UniqueKey(),bK);})):bF.c?bx.CreatePanel("Panel",700,null):bH.c?bx.Editor.RowItems.Append(F.Create([E.get_Create()])):void 0;})])])]),bA,R.ofArray([_6.Element("tr",[],[_6.Element("td",[],[])]),_6.Element("tr",[],[_6.Element("td",[],[this.PropertyGrid.get_Render()])])])]))]),_6.Element("td",[],bC)])]),_6.Element("div",[],[this.Dialog.get_Render()])]);},Restore:function(bx,by,bz,bA){var bB,bC,bD;bB=this;this.PanelContainer.PanelItems.Clear();this.Data.get_Clear();R.iter(function(bE){var bF;bF=bB.CreatePanel("Panel",700,{$:1,$0:bE.Key});_1.Set(bF.Left,bE.Left);_1.Set(bF.Top,bE.Top);},bx);bC=function(bE,bF){bB.Data.RegisterEvent(bE,bF);};R.iter(function(bE){return bC(bE[0],bE[1]);},by);_9.log("Events restored");bD=function(bE,bF,bG){bB.RegisterWidget(bE,bF,Y.find(function(bH){return bH.Key===bF;},R.ofSeq(bB.PanelContainer.PanelItems)).Children,bG.WithStartRunner());};R.iter(function(bE){return bD(bE[0],bE[1],bE[2]);},bz);_9.log("Widgets restored");this.Editor.Restore(this.Data,bA);_9.log("Connectors restored");},Store:function(bx){return[R.map(function(by){return by.get_PanelData();},R.ofSeq(this.PanelContainer.PanelItems)),R.map(function(by){return[by.Worker.Key,bx(by.Worker)];},R.ofSeq(this.Data.EventItems)),R.map(function(by){return[by.Widget.Key,by.Panel,bx(by.Widget)];},R.ofSeq(this.Data.WidgetItems)),this.Editor.get_CopyToRules()];},CreatePanel:function(bx,by,bz){var bA,bB,bC,bD,bE,bF;bA=this;_6.ConvertBy(this.Data.WidgetItems.key,function(bG){return _6.Element("div",[],[_6.TextView(bG.Widget.Name.v)]);},this.Data.WidgetItems.v);bB=(bC=(bD=_4.NewGuid(),window.String(bD)),bz==null?bC:bz.$0);bE=br.get_Create().WithLayoutManager(bs.StackPanelLayoutManager()).WithAttributes([bm.Style("border","1px solid white"),bm.Style("display","flex")]);bF=bt.get_Create().WithKey(bB).WithPannelAttrs([bm.Style("Width",window.String(by)+"px"),bm.Style("position","absolute")]).WithTitleContent(_6.TextNode(bx)).WithTitleButtons(R.ofArray([bu.New("add",function(bG){var bH,bI;bH=R.ofSeq(bA.Factory.WidgetItems);bI=_1.Create$1(R.head(bH));bA.Dialog.ShowDialog("Select widget",_6.Element("div",[],[_6.Select([bm.Class("form-control")],function(bJ){return bJ.Worker.Name.c;},bH,bI)]),function(){_9.log("Dialog.IsOK");bA.RegisterWidget(P.UniqueKey(),bG.Key,bG.Children,bI.c.Worker.get_CloneAndRun());});}),bu.New("edit",function(bG){_9.log("Edit");bA.PropertyGrid.Edit(R.concat(R.map(function(bH){return bH.Widget.get_Properties();},R.filter(function(bH){return bH.Panel===bG.Key;},R.ofSeq(bA.Data.WidgetItems)))));}),bu.New("clear",function(bG){bA.PanelContainer.PanelItems.Remove(bA.PanelContainer.FindPanelItem(bG));})])).WithChildPanelContainer(bE);this.PanelContainer.AddPanel(bF);return bF;},RegisterWidget:function(bx,by,bz,bA){this.Data.RegisterWidget(bx,by,bA);bz.AddPanel(bt.get_Create().WithTitle(false).WithPanelContent(bA.get_Render()));}},null,H);H.Create=function(bx){var by;by=bv.get_Create();return H.New(B.get_Create(),D.get_Create(),bx,G.get_Create(),bw.get_Create(),by);};H.New=function(bx,by,bz,bA,bB,bC){return new H({Factory:bx,Data:by,PanelContainer:bz,Editor:bA,PropertyGrid:bB,Dialog:bC});};I=c.AppModelLib=M.Class({get_Worker:function(){var bx;return this.$==1?o.CreateWithRunner(this.$0):this.$==2?o.CreateWithRenderer(this.$0):this.$==3?(bx=this.$0,o.Create(bx).WithRunner(bx).WithRenderer(bx)):o.CreateWithRunner(this.$0);}},null,I);I.FromWorker=function(bx){var by;by=bx.DataContext;return by instanceof q?{$:1,$0:new I({$:0,$0:(q.get_FromPorts())(bx)})}:by instanceof t?{$:1,$0:new I({$:1,$0:(t.get_FromPorts())(bx)})}:by instanceof w?{$:1,$0:new I({$:2,$0:(w.get_FromPorts())(bx)})}:by instanceof v?{$:1,$0:new I({$:3,$0:(v.get_FromPorts())(bx)})}:null;};I.FromDataContext=function(bx){return bx instanceof q?{$:1,$0:new I({$:0,$0:bx})}:bx instanceof t?{$:1,$0:new I({$:1,$0:bx})}:bx instanceof w?{$:1,$0:new I({$:2,$0:bx})}:bx instanceof v?{$:1,$0:new I({$:3,$0:bx})}:null;};J.CreateDashboard=function(){K.$cctor();return K.CreateDashboard;};J.Register=function(bx){var by;function bz(bB){var bC;by((bC=bx.Factory,function(bD){bC.RegisterEvent(bD);}),bB);}function bA(bB){var bC;by((bC=bx.Factory,function(bD){bC.RegisterWidget(bD);}),bB);}by=function(bB,bC){var bD;bD=I.FromDataContext(bC),bD==null?null:{$:1,$0:bB(bD.$0.get_Worker())};};bz(t.Create("London",""));bz(q.Create(50,5));bA(w.get_Create());bA(v.Create(300,100,50));};K.$cctor=M.Cctor(function(){var bx;K.CreateDashboard=(bx=H.Create(br.get_Create().WithLayoutManager(bs.FloatingPanelLayoutManager(5)).WithWidth(800).WithHeight(420).WithAttributes([bm.Style("border","1px solid white")])),(J.Register(bx),bx));K.$cctor=window.ignore;});}());
