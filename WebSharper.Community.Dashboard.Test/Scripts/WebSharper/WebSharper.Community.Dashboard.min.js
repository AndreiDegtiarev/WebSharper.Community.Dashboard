(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Community=b.Community||{};d=c.Dashboard=c.Dashboard||{};e=d.Environment=d.Environment||{};f=e.Role=e.Role||{};g=a.StartupCode$WebSharper_Community_Dashboard$Environment=a.StartupCode$WebSharper_Community_Dashboard$Environment||{};h=d.MessageBus=d.MessageBus||{};i=h.Value=h.Value||{};j=h.Message=h.Message||{};k=h.ListenerInfo=h.ListenerInfo||{};l=h.AgentMessage=h.AgentMessage||{};m=h.AgentState=h.AgentState||{};n=a.StartupCode$WebSharper_Community_Dashboard$MessageBus=a.StartupCode$WebSharper_Community_Dashboard$MessageBus||{};o=d.InPortData=d.InPortData||{};p=d.InPort=d.InPort||{};q=d.OutPort=d.OutPort||{};r=d.WorkerData=d.WorkerData||{};s=d.Worker=d.Worker||{};t=d.Workers=d.Workers||{};u=d.RuleEntry=d.RuleEntry||{};v=d.RuleChain=d.RuleChain||{};w=d.RuleContainer=d.RuleContainer||{};x=d.WorkerItem=d.WorkerItem||{};y=d.Factory=d.Factory||{};z=d.RulesCellItem=d.RulesCellItem||{};A=d.RulesRowItem=d.RulesRowItem||{};B=d.SelectorGroup=d.SelectorGroup||{};C=d.WindowSelector=d.WindowSelector||{};D=d.WidgetItem=d.WidgetItem||{};E=d.EventsGroupItem=d.EventsGroupItem||{};F=d.WidgetsGroupItem=d.WidgetsGroupItem||{};G=d.RulesGroupItem=d.RulesGroupItem||{};H=d.DshData=d.DshData||{};I=d.RulesEditor=d.RulesEditor||{};J=d.DshHelper=d.DshHelper||{};K=d.Dashboard=d.Dashboard||{};L=d.Events=d.Events||{};M=L.RandomEvent=L.RandomEvent||{};N=L.DatabaseEventContext=L.DatabaseEventContext||{};O=L.DatabaseEvent=L.DatabaseEvent||{};P=L.OpenWeather=L.OpenWeather||{};Q=P.Forecast=P.Forecast||{};R=L.OpenWeatherEvent=L.OpenWeatherEvent||{};S=L.ClockEvent=L.ClockEvent||{};T=d.Widgets=d.Widgets||{};U=T.TextBoxWidget=T.TextBoxWidget||{};V=T.ChartWidgetContext=T.ChartWidgetContext||{};W=T.ChartWidget=T.ChartWidget||{};X=T.ButtonWidget=T.ButtonWidget||{};Y=d.AppModelLib=d.AppModelLib||{};Z=d.App=d.App||{};_0=a.StartupCode$WebSharper_Community_Dashboard$AppModelLib=a.StartupCode$WebSharper_Community_Dashboard$AppModelLib||{};_1=d.AppDataHelper=d.AppDataHelper||{};_2=d.AppData=d.AppData||{};_3=a.IntelliFactory;_4=_3&&_3.Runtime;_5=b&&b.Operators;_6=c&&c.Panel;_7=_6&&_6.Helper;_8=a.Date;_9=b&&b.List;_=b&&b.Concurrency;$=b&&b.Remoting;ba=$&&$.AjaxRemotingProvider;bb=b&&b.Control;bc=bb&&bb.MailboxProcessor;bd=b&&b.Seq;be=b&&b.Utils;bf=b&&b.UI;bg=bf&&bf.Next;bh=bg&&bg.View;bi=bg&&bg.Var;bj=c&&c.PropertyGrid;bk=bj&&bj.Properties;bl=b&&b.Guid;bm=bg&&bg.Doc;bn=b&&b.Enumerator;bo=bg&&bg.Key;bp=bg&&bg.ListModel;bq=a.console;br=bg&&bg.AttrModule;bs=b&&b.Option;bt=b&&b.Unchecked;bu=_6&&_6.WrapControls;bv=_6&&_6.PanelContainer;bw=_6&&_6.LayoutManagers;bx=_6&&_6.Panel;by=_6&&_6.TitleButton;bz=_6&&_6.Dialog;bA=bj&&bj.PropertyGrid;bB=b&&b.Random;bC=a.Math;bD=b&&b.Data;bE=bD&&bD.TxtRuntime;bF=a.FSharp;bG=bF&&bF.Data;bH=bG&&bG.Runtime;bI=bH&&bH.IO;bJ=a.JSON;bK=b&&b.Arrays;bL=b&&b.DateUtil;bM=b&&b.Charting;bN=bM&&bM.Renderers;bO=bN&&bN.ChartJs;bP=bb&&bb.FSharpEvent;bQ=bM&&bM.LiveChart;bR=bM&&bM.Pervasives;f.Server={$:1};f.Client={$:0};e.DataDirectory=function(){g.$cctor();return g.DataDirectory;};e.set_DataDirectory=function(bS){g.$cctor();g.DataDirectory=bS;};e.Log=function(){g.$cctor();return g.Log;};e.set_Log=function(bS){g.$cctor();g.Log=bS;};e.Role$1=function(){g.$cctor();return g.Role;};e.set_Role=function(bS){g.$cctor();g.Role=bS;};g.$cctor=_4.Cctor(function(){g.Role=f.Server;g.Log=a.ignore;g.DataDirectory="";g.$cctor=a.ignore;});i=h.Value=_4.Class({get_AsSelect:function(){return this.$==3?this.$0:_5.FailWith("MessageBus.Value: unexpected type");},get_AsBoolean:function(){return this.$==2?this.$0:_5.FailWith("MessageBus.Value: unexpected type");},get_AsString:function(){return this.$==1?this.$0:_5.FailWith("MessageBus.Value: unexpected type");},get_AsNumber:function(){return this.$==0?this.$0:_5.FailWith("MessageBus.Value: unexpected type");}},null,i);j=h.Message=_4.Class({WithTime:function(bS){return j.New(this.Key,bS,this.Value);},WithKey:function(bS){return j.New(bS,this.Time,this.Value);}},null,j);j.Create=function(bS){return j.New(_7.UniqueKey(),_8.now(),bS);};j.New=function(bS,bT,bU){return new j({Key:bS,Time:bT,Value:bU});};k.Create=function(bS,bT,bU){return k.New(bS,bT,bU);};k.New=function(bS,bT,bU){return{Key:bS,Name:bT,CacheSize:bU};};l.Clear={$:4};m.get_empty=function(){return m.New(null,_9.T.Empty);};m.New=function(bS,bT){return{ServerCallback:bS,Listeners:bT};};h.RunServerRequests=function(){var bS;_.Start((bS=null,_.Delay(function(){return _.While(function(){return true;},_.Delay(function(){return _.Bind(_.Sleep(2*1000),function(){return _.Bind(h.Agent().PostAndAsyncReply(function(bT){return{$:6,$0:bT};},null),function(bT){return _.Bind((new ba.New()).Async("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.MessageBus.GetMessages:1550733476",[bT]),function(bU){var bV;_9.iter(function(bW){var bX;bX=h.Agent();bX.mailbox.AddLast({$:1,$0:bW});bX.resume();},bU);return bU.get_Length()>0?(bV=(function(bW){return function(bX){return bW("Values from server requested messages received:"+a.String(bX));};}(a.id))(bU.get_Length()),(h.log())(bV),_.Zero()):_.Zero();});});});}));})),null);};h.Agent=function(){n.$cctor();return n.Agent;};h.SelectMessage=function(bS,bT){return h.CreateMessage(_7.UniqueKey(),new i({$:3,$0:[bS,bT]}));};h.StringMessage=function(bS){return h.StringKeyMessage(_7.UniqueKey(),bS);};h.NumberMessage=function(bS){return h.NumberKeyMessage(_7.UniqueKey(),bS);};h.BooleanKeyMesage=function(bS,bT){return h.CreateMessage(bS,new i({$:2,$0:bT}));};h.StringKeyMessage=function(bS,bT){return h.CreateMessage(bS,new i({$:1,$0:bT}));};h.NumberKeyMessage=function(bS,bT){return h.CreateMessage(bS,new i({$:0,$0:bT}));};h.CreateMessage=function(bS,bT){return j.New(bS,_8.now(),bT);};h.log=function(){n.$cctor();return n.log;};n.$cctor=_4.Cctor(function(){n.log=e.Log();n.Agent=bc.Start(function(bS){function bT(bY,bZ){return bd.fold(function(b0,b1){var b2;return(b2=b1.Time-bY,b2/1000)>0.01?new _9.T({$:1,$0:b1,$1:b0}):b0;},_9.T.Empty,bZ);}function bU(bY,bZ){return bY<bZ.get_Length()?(_9.splitAt(bY,bZ))[0]:bZ;}function bV(bY,bZ,b0){return bY===1?_9.ofArray([b0]):bU(bY,new _9.T({$:1,$0:b0,$1:bZ}));}function bW(bY,bZ){function b0(b1,b2,b3){var b4,b5;b4=a.Array.prototype.slice.call(arguments);if(b1.Key===bY.Key){try{b2(bY);}catch(b6){b5=(function(b7){return function(b8){return b7("Fails send message. It might be that receiver doesn't expect message of this type: "+be.toSafe(b8));};}(a.id))(b1.Name);(h.log())(b5);}return[b1,b2,bV(b1.CacheSize,b3,bY)];}else return b4;}return _9.map(function(b1){return b0(b1[0],b1[1],b1[2]);},bZ);}function bX(bY){var bZ;bZ=null;return _.Delay(function(){return _.Bind(bS.Receive(null),function(b0){var b1,b2,b3,b4,b5,b6;function b7(b9,b_,b$){return bT(b3,b$);}function b8(b9,b_,b$){return b$.$==0?(new _8(0,0-1,0)).getTime():_9.maxBy(function(ca){return ca.Time;},b$).Time;}return b0.$==2?(b1=b0.$0[0],(b2=(((_4.Curried3(function(b9,b_,b$){return b9("RegisterListener:"+be.toSafe(b_)+" "+be.toSafe(b$));}))(a.id))(b1.Name))(b1.Key),(h.log())(b2),bX(m.New(bY.ServerCallback,new _9.T({$:1,$0:[b1,b0.$0[2],_9.T.Empty],$1:bY.Listeners}))))):b0.$==3?bX(m.New({$:1,$0:b0.$0},bY.Listeners)):b0.$==5?(b3=b0.$0[0],(b0.$0[1](bd.fold(function(b9,b_){return!_9.contains(b_,b9)?new _9.T({$:1,$0:b_,$1:b9}):b9;},_9.T.Empty,_9.concat(_9.map(function(b9){return b7(b9[0],b9[1],b9[2]);},bY.Listeners)))),bX(bY))):b0.$==6?(b4=_9.map(function(b9){return b8(b9[0],b9[1],b9[2]);},bY.Listeners),(b0.$0(b4.$==0?(new _8(0,0-1,0)).getTime():_9.max(b4)),bX(bY))):b0.$==1?bX(m.New(bY.ServerCallback,bW(b0.$0,bY.Listeners))):b0.$==0?(b5=b0.$0,(b6=bY.ServerCallback,b6==null?void 0:b6.$0(b5),bX(m.New(bY.ServerCallback,bW(b5,bY.Listeners))))):bX(m.get_empty());});});}return bX(m.get_empty());},null);n.$cctor=a.ignore;});o.Create=function(bS,bT,bU){return o.New(bT.Key,bS,bT,bU);};o.New=function(bS,bT,bU,bV){return{Key:bS,Name:bT,Value:bU,CacheSize:bV};};p=d.InPort=_4.Class({get_SelectView:function(){return bh.Map(function(bS){return bS.Value.get_AsSelect();},this.PortValue.v);},get_Select:function(){return this.PortValue.c.Value.get_AsSelect();},get_BooleanView:function(){return bh.Map(function(bS){return bS.Value.get_AsBoolean();},this.PortValue.v);},get_Boolean:function(){return this.PortValue.c.Value.get_AsBoolean();},get_StringView:function(){return bh.Map(function(bS){return bS.Value.get_AsString();},this.PortValue.v);},get_String:function(){return this.PortValue.c.Value.get_AsString();},get_NumberView:function(){return bh.Map(function(bS){return bS.Value.get_AsNumber();},this.PortValue.v);},get_Number:function(){return this.PortValue.c.Value.get_AsNumber();},Receive:function(bS){bi.Set(this.PortValue,bS);},get_Property:function(){var bS,bT,bU,bV,bW,bX,bY;bS=this;bT=this.PortValue.c.Value;return bT.$==1?(bU=bi.Create$1(this.get_String()),(bh.Sink(function(bZ){var b0;bi.Set(bS.PortValue,(b0=bS.PortValue.c,j.New(b0.Key,b0.Time,new i({$:1,$0:bZ}))));},bU.v),bk.string(this.Data.Name,bU))):bT.$==2?(bV=bi.Create$1(this.get_Boolean()),(bh.Sink(function(bZ){var b0;bi.Set(bS.PortValue,(b0=bS.PortValue.c,j.New(b0.Key,b0.Time,new i({$:2,$0:bZ}))));},bV.v),bk.check(this.Data.Name,bV))):bT.$==3?(bW=bT.$0[1],(bX=bi.Create$1(bW.get_Item(bT.$0[0])),(bh.Sink(function(bZ){var b0;bi.Set(bS.PortValue,(b0=bS.PortValue.c,j.New(b0.Key,b0.Time,new i({$:3,$0:[bd.findIndex(function(b1){return b1===bZ;},bW),bW]}))));},bX.v),bk.select(this.Data.Name,a.id,bW,bX)))):(bY=bi.Create$1(this.get_Number()),(bh.Sink(function(bZ){var b0;bi.Set(bS.PortValue,(b0=bS.PortValue.c,j.New(b0.Key,b0.Time,new i({$:0,$0:bZ}))));},bY.v),bk["double"](this.Data.Name,bY)));},get_Key:function(){return this.Data.Key;},get_Name:function(){return this.Data.Name;}},null,p);p.Clone=function(bS){var bT,bU;return p.New((bT=bS.Data,o.New((bU=bl.NewGuid(),a.String(bU)),bT.Name,bT.Value,bT.CacheSize)),bi.Create$1(bS.PortValue.c));};p.ToData=function(bS){var bT;bT=bS.Data;return o.New(bT.Key,bT.Name,bS.PortValue.c,bT.CacheSize);};p.FromData=function(bS){return p.New(bS,bi.Create$1(bS.Value));};p.New=function(bS,bT){return new p({Data:bS,PortValue:bT});};q=d.OutPort=_4.Class({Trigger:function(bS){var bT;bT=h.Agent();bT.mailbox.AddLast({$:0,$0:h.CreateMessage(this.Key,bS)});bT.resume();}},null,q);q.Clone=function(bS){return q.New(_7.UniqueKey(),bS.Name);};q.Create=function(bS){return q.New(_7.UniqueKey(),bS);};q.New=function(bS,bT){return new q({Key:bS,Name:bT});};r.CreateWithCache=function(bS,bT,bU){return r.New(bS,_9.map(function(bV){return o.Create(bV[0],bV[1],bV[2]);},bT),bU);};r.Create=function(bS,bT,bU){function bV(bW,bX){return o.Create(bW,bX,1);}return r.New(bS,_9.map(function(bW){return bV(bW[0],bW[1]);},bT),bU);};r.New=function(bS,bT,bU){return{WorkerName:bS,InPorts:bT,OutPorts:bU};};s=d.Worker=_4.Class({get_Properties:function(){return new _9.T({$:1,$0:bk.string("Name",this.Name),$1:_9.map(function(bS){return bS.get_Property();},this.InPorts)});},get_Render:function(){var bS;bS=this.Data.WebSharper_Community_Dashboard_IWorkerData$get_Render();return bS==null?bm.Empty():bS.$0(this);},get_Clone:function(){return s.New(_7.UniqueKey(),bi.Create$1(this.Name.c),_9.map(p.Clone,this.InPorts),_9.map(q.Clone,this.OutPorts),this.Data,bi.Create$1(null));},get_ToData:function(){return r.New(this.Name.c,_9.map(p.ToData,this.InPorts),this.OutPorts);},StartRunner:function(){var bS;bS=this.Data.WebSharper_Community_Dashboard_IWorkerData$get_Run();bS==null?void 0:bi.Set(this.RunnerContext,bS.$0(this));},WithKey:function(bS){return s.New(bS,this.Name,this.InPorts,this.OutPorts,this.Data,this.RunnerContext);}},null,s);s.Create=function(bS){return s.New(_7.UniqueKey(),bi.Create$1(bS.WebSharper_Community_Dashboard_IWorkerData$get_Data().WorkerName),_9.map(p.FromData,bS.WebSharper_Community_Dashboard_IWorkerData$get_Data().InPorts),bS.WebSharper_Community_Dashboard_IWorkerData$get_Data().OutPorts,bS,bi.Create$1(null));};s.New=function(bS,bT,bU,bV,bW,bX){return new s({Key:bS,Name:bT,InPorts:bU,OutPorts:bV,Data:bW,RunnerContext:bX});};t.allInPorts=function(bS){return t.allPorts(bS,function(bT){return bT.InPorts;});};t.allOutPorts=function(bS){return t.allPorts(bS,function(bT){return bT.OutPorts;});};t.allPorts=function(bS,bT){return _9.concat(_9.map(bT,bS));};u.New=function(bS,bT,bU){return{InPortKey:bS,OutPortKey:bT,WorkerKey:bU};};v.New=function(bS){return{RuleChain:bS};};w=d.RuleContainer=_4.Class({Reconnect:function(bS){var bT,bU,bV,bW;bT=e.Log();bU=t.allOutPorts(bS);bV=t.allInPorts(bS);_9.iter(function(bX){(e.Log())((((_4.Curried3(function(bY,bZ,b0){return bY("InPort: "+be.toSafe(bZ)+" "+be.toSafe(b0));}))(a.id))(bX.get_Name()))(bX.Data.Key));},bV);_9.iter(function(bX){(e.Log())((((_4.Curried3(function(bY,bZ,b0){return bY("outPort: "+be.toSafe(bZ)+" "+be.toSafe(b0));}))(a.id))(bX.Name))(bX.Key));},bU);bW=h.Agent();bW.mailbox.AddLast(l.Clear);bW.resume();_9.iter(function(bX){var bY,bZ,b0;bY=_9.ofSeq(bX.RuleChain);bZ=_9.ofSeq(_5.range(1,bY.get_Length()-1));b0=bn.Get(bZ);try{while(b0.MoveNext())(function(){var b1,b2,b3,b4,b5,b6,b7,b8,b9,b_;b1=b0.Current();b2=bY.get_Item(b1-1);b3=bY.get_Item(b1);bT((function(b$){return function(ca){return b$("Try to find outPort:"+be.toSafe(ca)+" ");};}(a.id))(b2.OutPortKey));{b4=bd.tryFind(function(b$){return b$.Key===b2.OutPortKey;},bU),b4==null?null:{$:1,$0:(b5=b4.$0,(bT((((_4.Curried3(function(b$,ca,cb){return b$("Found outPort "+be.toSafe(ca)+" try to find inPort:"+be.toSafe(cb));}))(a.id))(b2.OutPortKey))(b3.InPortKey)),b6=bd.tryFind(function(b$){return b$.Data.Key===b3.InPortKey;},bV),b6==null?null:{$:1,$0:(b7=b6.$0,(bT("Found inPort"),b7.PortValue.c.Key!==b7.Data.Key?bi.Set(b7.PortValue,b7.PortValue.c.WithKey(b7.Data.Key)):void 0,b8=(b9=b7.PortValue.c.Value,b9.$==1?j.Create(new i({$:1,$0:""})):b9.$==2?j.Create(new i({$:2,$0:false})):b9.$==3?j.Create(new i({$:3,$0:[0,_9.T.Empty]})):j.Create(new i({$:0,$0:0}))),b_=h.Agent(),b_.mailbox.AddLast({$:2,$0:[k.Create(b5.Key,b5.Name+"->"+b7.get_Name(),b7.Data.CacheSize),b8,function(b$){b7.Receive(b$);}]}),b_.resume()))}))};return;}}());}finally{if("Dispose"in b0)b0.Dispose();}},_9.ofSeq(this.RuleContainer));}},null,w);w.New=function(bS){return new w({RuleContainer:bS});};x.Create=function(bS){return x.New(bo.Fresh(),bS);};x.New=function(bS,bT){return{Key:bS,Worker:bT};};y=d.Factory=_4.Class({RegisterEvent:function(bS){this.EventItems.Append(x.Create(bS));},RegisterWidget:function(bS){this.WidgetItems.Append(x.Create(bS));}},null,y);y.get_Create=function(){return y.New(bp.Create(function(bS){return bS.Key;},_9.T.Empty),bp.Create(function(bS){return bS.Key;},_9.T.Empty));};y.New=function(bS,bT){return new y({EventItems:bS,WidgetItems:bT});};z=d.RulesCellItem=_4.Class({Render:function(bS,bT){var bU,bV,bW,bX,bY;bU=this;bh.Sink(function(bZ){var b0;if(bZ==null);else{b0=bZ.$0;bq.log("Workitem selected");bi.Set(bU.OptInPort,_9.tryHead(b0.Worker.InPorts));bi.Set(bU.OptOutPort,_9.tryHead(b0.Worker.OutPorts));bT();}},this.OptWorker.v);bh.Sink(function(){bT();},this.OptInPort.v);bh.Sink(function(){bT();},this.OptOutPort.v);bV=(bW=bh.Map(function(bZ){var b0;return bZ==null?_9.ofArray([null]):(b0=_9.map(function(b1){return{$:1,$0:b1};},bZ.$0.Worker.InPorts),b0.get_Length()>0?b0:_9.ofArray([null]));},this.OptWorker.v),(bX=bh.Map(function(bZ){var b0;return bZ==null?_9.ofArray([null]):(b0=_9.map(function(b1){return{$:1,$0:b1};},bZ.$0.Worker.OutPorts),b0.get_Length()>0?b0:_9.ofArray([null]));},this.OptWorker.v),(bY=bh.Map(function(bZ){return new _9.T({$:1,$0:null,$1:_9.map(function(b0){return{$:1,$0:b0};},_9.ofSeq(bZ))});},bS.v),bm.Element("table",[],[bm.Element("tr",[],[bm.Element("td",[],[bm.SelectDyn([br.Class("form-control")],function(bZ){return bs.fold(function(b0,b1){return b1.get_Name();}," ",bZ);},bW,this.OptInPort)]),bm.Element("td",[],[bm.SelectDyn([br.Class("form-control")],function(bZ){return bs.fold(function(b0,b1){return b1.Worker.Name.c;}," ",bZ);},bY,this.OptWorker)]),bm.Element("td",[],[bm.SelectDyn([br.Class("form-control")],function(bZ){return bs.fold(function(b0,b1){return b1.Name;}," ",bZ);},bX,this.OptOutPort)])])]))));return bm.Element("td",[br.Class("td DshEditorCell")],[bm.Element("div",[br.Class("div DshEditorCell")],[bm.Element("table",[],[bm.Element("tr",[],[bm.Element("td",[],[bV])])])])]);}},null,z);z.get_Create=function(){return z.New(bo.Fresh(),bi.Create$1(null),bi.Create$1(null),bi.Create$1(null));};z.New=function(bS,bT,bU,bV){return new z({Key:bS,OptInPort:bT,OptWorker:bU,OptOutPort:bV});};A=d.RulesRowItem=_4.Class({Render:function(bS,bT){var bU;bU=this;return bm.Element("tr",[],[bm.ConvertBy(function(bV){return bV.Key;},function(bV){return bV.Render(bS,bT);},this.CellItems.v),_7.IconNormal("add",function(){bU.CellItems.Append(z.get_Create());})]);}},null,A);A.Create=function(bS){return A.New(bo.Fresh(),bp.Create(function(bT){return bT.Key;},bS));};A.New=function(bS,bT){return new A({Key:bS,CellItems:bT});};B=d.SelectorGroup=_4.Class({RenderMenu:function(bS,bT,bU){var bV,bW,bX,bY,bZ,b0;function b1(b2){return _9.ofArray([_7.IconSmall("keyboard_arrow_down",function(){(bW(true))(b2);(bV.ItemOnMove(b2))({$:1});}),_7.IconSmall("keyboard_arrow_up",function(){(bW(false))(b2);(bV.ItemOnMove(b2))({$:0});}),_7.IconSmall("clear",function(){bV.SelectorItems.Remove(b2);bV.ItemOnDelete(b2);})]);}bV=this;bW=(bX=this.SelectorItems,(_4.Curried3(_7.MoveItemInModelList))(bX));bY=(bZ=this.ItemCreatator,bZ==null?bm.Element("tr",[],[]):(b0=bZ.$0,bm.Element("tr",[],[bm.Element("td",[],[bm.Element("div",[br.Style("margin-left","20px")],[_7.IconSmall("add",function(){var b2;b2=b0();bV.ItemOnCreated(b2);bV.SelectorItems.Append(b2);})])])])));return bm.Element("table",[],[bm.ConvertBy(function(b2){return b2.WebSharper_Community_Dashboard_ISelectorItem$get_Key();},function(b2){var b3,b4,b5,b6;b3=bh.Map(function(b7){return bS+b7;},b2.WebSharper_Community_Dashboard_ISelectorItem$get_Name().v);return bm.Element("tr",[],[bm.Element("td",[br.DynamicStyle("Color",bh.Map(function(b7){return b7==null?"#7D4600":bt.Equals(b7.$0.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),b2.WebSharper_Community_Dashboard_ISelectorItem$get_Key())?"#FB8C00":"#7D4600";},bT.v))],[(b4=bm.Element("div",[br.Style("margin-left","10px"),br.Style("margin-right","5px"),br.Style("cursor","pointer"),br.Handler("click",function(){return function(){bV.ItemOnSelected(b2);return bi.Set(bT,{$:1,$0:b2});};})],[bm.TextView(b3)]),(bU?(b5=b1(b2),(b6=_6.WrapControlsAligment.Horizontal,function(b7){return bu.Render(b5,b6,b7);})):a.id)(b4))])]);},this.SelectorItems.v),bY]);}},null,B);B.Create=function(bS,bT,bU,bV,bW,bX,bY){var bZ;bZ=bp.Create(function(b0){return b0.WebSharper_Community_Dashboard_ISelectorItem$get_Key();},bT);return B.New(bo.Fresh(),bi.Create$1(bS),bZ,bU,bV,bW,bX,bY);};B.New=function(bS,bT,bU,bV,bW,bX,bY,bZ){return new B({Key:bS,Name:bT,SelectorItems:bU,ItemCreatator:bV,ItemOnCreated:bW,ItemOnSelected:bX,ItemOnDelete:bY,ItemOnMove:bZ});};C=d.WindowSelector=_4.Class({get_RenderMenu:function(){var bS;bS=this;return this.SelectorGroups.get_Length()===1?_9.head(_9.ofSeq(this.SelectorGroups)).RenderMenu("",this.OptSelectedItem,this.IsWithControls):bm.Element("div",[],[bm.ConvertBy(function(bT){return bT.Key;},function(bT){return bm.Element("div",[],[bm.Element("div",[br.Style("cursor","pointer"),br.Handler("click",function(){return function(){return bS.GroupOnClick(bT);};})],[bm.TextView(bT.Name.v)]),bT.RenderMenu("    ",bS.OptSelectedItem,bS.IsWithControls)]);},this.SelectorGroups.v)]);},get_Render:function(){return bm.Element("div",[],[bm.BindView(function(bS){return bS==null?bm.Empty():bS.$0.WebSharper_Community_Dashboard_ISelectorItem$get_Render();},this.OptSelectedItem.v)]);},GroupByIndex:function(bS){return bd.nth(bS,_9.ofSeq(this.SelectorGroups));},get_SelectedIndex:function(){var bS;bS=this;return bd.findIndex(function(bT){return bt.Equals(bT.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bS.get_SelectedItem().WebSharper_Community_Dashboard_ISelectorItem$get_Key());},_9.concat(_9.map(function(bT){return _9.ofSeq(bT.SelectorItems);},_9.ofSeq(this.SelectorGroups))));},get_SelectedIndexInGroup:function(){var bS;bS=this;return bd.findIndex(function(bT){return bt.Equals(bT.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bS.get_SelectedItem().WebSharper_Community_Dashboard_ISelectorItem$get_Key());},_9.ofSeq(this.get_SelectedGroup().SelectorItems));},get_SelectedGroupIndex:function(){var bS;bS=this;return bd.findIndex(function(bT){return bt.Equals(bT.Key,bS.get_SelectedGroup().Key);},_9.ofSeq(this.SelectorGroups));},get_SelectedGroup:function(){return this.GroupFromItem(this.get_SelectedItem());},GroupFromItem:function(bS){return bd.find(function(bT){return _9.exists(function(bU){return bt.Equals(bU.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bS.WebSharper_Community_Dashboard_ISelectorItem$get_Key());},_9.ofSeq(bT.SelectorItems));},_9.ofSeq(this.SelectorGroups));},AppenGroup:function(bS,bT,bU){var bV;bV=this.SelectorGroups.get_Length();this.SelectorGroups.Append(B.Create(bS,bT,bU,this.ItemOnCreated(bV),this.ItemOnSelected,this.ItemOnDeleted(bV),this.ItemOnMove(bV)));},get_SelectedItem:function(){var bS;bS=this.OptSelectedItem.c;return bS==null?_5.FailWith("Something really wrong with WindowSelector"):bS.$0;},ClearGroups:function(){bi.Set(this.OptSelectedItem,null);_9.iter(function(bS){bS.SelectorItems.Clear();},_9.ofSeq(this.SelectorGroups));},WithControls:function(bS){return C.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,bS);},WithItemOnMove:function(bS){return C.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,bS,this.IsWithControls);},WithItemOnDeleted:function(bS){return C.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,bS,this.ItemOnMove,this.IsWithControls);},WithItemOnSelected:function(bS){return C.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,bS,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);},WithGroupOnClick:function(bS){return C.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,bS,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);},WithItemOnCreated:function(bS){return C.New(this.OptSelectedItem,this.SelectorGroups,bS,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);}},null,C);C.get_Create=function(){var bS;bS=bp.Create(function(bT){return bT.Key;},_9.T.Empty);return C.New(bi.Create$1(null),bS,function(){return function(){return null;};},a.ignore,a.ignore,function(){return function(){return null;};},_4.Curried3(function(bT,bU,bV){return null;}),false);};C.New=function(bS,bT,bU,bV,bW,bX,bY,bZ){return new C({OptSelectedItem:bS,SelectorGroups:bT,ItemOnCreated:bU,GroupOnClick:bV,ItemOnSelected:bW,ItemOnDeleted:bX,ItemOnMove:bY,IsWithControls:bZ});};D.Create=function(bS,bT){return D.New(bo.Fresh(),bS,bT);};D.New=function(bS,bT,bU){return{Key:bS,Panel:bT,Widget:bU};};E=d.EventsGroupItem=_4.Class({get_Render:function(){var bS,bT,bU;function bV(bW){return _9.ofArray([_7.IconSmall("keyboard_arrow_down",function(){(bT(true))(bW);}),_7.IconSmall("keyboard_arrow_up",function(){(bT(false))(bW);}),_7.IconSmall("clear",function(){bS.EventItems.Remove(bW);})]);}bS=this;bT=(bU=this.EventItems,(_4.Curried3(_7.MoveItemInModelList))(bU));return bm.Element("table",[],[bm.ConvertBy(function(bW){return bW.Key;},function(bW){var bX;return bm.Element("tr",[],[(bX=bm.Element("div",_7.AttrsClick(function(){bS.PropertyGrid.Edit(bW.Worker.get_Properties());}),[bm.TextView(bW.Worker.Name.v)]),bu.Render(bV(bW),_6.WrapControlsAligment.Horizontal,bX))]);},this.EventItems.v)]);},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,E);E.Create=function(bS,bT){return E.New(bo.Fresh(),bi.Create$1(bS),bp.Create(function(bU){return bU.Key;},_9.T.Empty),bT);};E.New=function(bS,bT,bU,bV){return new E({Key:bS,Name:bT,EventItems:bU,PropertyGrid:bV});};F=d.WidgetsGroupItem=_4.Class({get_Render:function(){return this.PanelContainer.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,F);F.Create=function(bS,bT){return F.New(bo.Fresh(),bi.Create$1(bS),bp.Create(function(bU){return bU.Key;},_9.T.Empty),bT);};F.New=function(bS,bT,bU,bV){return new F({Key:bS,Name:bT,WidgetItems:bU,PanelContainer:bV});};G=d.RulesGroupItem=_4.Class({Equals:function(bS){return bS instanceof G&&bt.Equals(this.Key,bS.Key);},get_Render:function(){return this.Renderer(this.RulesRowItems);},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,G);G.Create=function(bS,bT){return G.New(bo.Fresh(),bi.Create$1(bS),bp.Create(function(bU){return bU.Key;},_9.T.Empty),bT);};G.New=function(bS,bT,bU,bV){return new G({Key:bS,Name:bT,RulesRowItems:bU,Renderer:bV});};H=d.DshData=_4.Class({RegisterWidget:function(bS,bT,bU,bV){var bW;bW=bV.WithKey(bS);bT.WidgetItems.Append(D.Create(bU,bW));this.WorkItems.Append(x.Create(bW));},RegisterEvent:function(bS,bT,bU){var bV;bV=x.Create(bU.WithKey(bS));bT.EventItems.Append(bV);this.WorkItems.Append(bV);},get_Clear:function(){this.WorkItems.Clear();this.WidgetGroups.Clear();this.EventGroups.Clear();this.RulesGroups.Clear();}},null,H);H.get_Create=function(){return H.New(bp.Create(function(bS){return bS.Key;},_9.T.Empty),bp.Create(function(bS){return bS.Key;},_9.T.Empty),bp.Create(function(bS){return bS.Key;},_9.T.Empty),bp.Create(function(bS){return bS.Key;},_9.T.Empty));};H.New=function(bS,bT,bU,bV){return new H({WorkItems:bS,WidgetGroups:bT,EventGroups:bU,RulesGroups:bV});};I.Render=function(bS,bT){function bU(bX,bY){return _7.MoveItemInModelList(bT,bX,bY);}function bV(bX){return _9.ofArray([_7.IconSmall("keyboard_arrow_down",function(){bU(true,bX);}),_7.IconSmall("keyboard_arrow_up",function(){bU(false,bX);}),_7.IconSmall("clear",function(){bT.Remove(bX);})]);}function bW(){var bX;bX=_9.map(function(bY){return bY.Worker;},_9.ofSeq(bS.WorkItems));I.CopyToRules(bT).Reconnect(bX);}return bm.Element("table",[],[bm.ConvertBy(function(bX){return bX.Key;},function(bX){var bY;return bm.Element("tr",[],[(bY=bX.Render(bS.WorkItems,function(){bW();}),bu.Render(bV(bX),_6.WrapControlsAligment.Horizontal,bY))]);},bT.v)]);};I.Restore=function(bS,bT,bU){var bV,bW,bX;bT.Clear();bV=_9.map(function(bY){return bY.Worker;},_9.ofSeq(bS.WorkItems));bW=t.allOutPorts(bV);bX=t.allInPorts(bV);_9.iter(function(bY){var bZ;bZ=A.Create([]);_9.iter(function(b0){var b1;b1=z.get_Create();bi.Set(b1.OptWorker,bd.tryFind(function(b2){return b2.Worker.Key===b0.WorkerKey;},_9.ofSeq(bS.WorkItems)));bi.Set(b1.OptInPort,bd.tryFind(function(b2){return b2.get_Key()===b0.InPortKey;},bX));bi.Set(b1.OptOutPort,bd.tryFind(function(b2){return b2.Key===b0.OutPortKey;},bW));bZ.CellItems.Append(b1);},bY.RuleChain);bT.Append(bZ);},bU.RuleContainer);bU.Reconnect(bV);};I.CopyToRules=function(bS){return w.New(_9.map(function(bT){return v.New(_9.map(function(bU){var bV,bW,bX;return u.New((bV=bU.OptInPort.c,bV==null?"":bV.$0.get_Key()),(bW=bU.OptOutPort.c,bW==null?"":bW.$0.Key),(bX=bU.OptWorker.c,bX==null?"":bX.$0.Worker.Key));},_9.ofSeq(bT.CellItems)));},_9.ofSeq(bS)));};J.RulesGroupCreator=function(bS,bT){var bU;bU=G.Create("rules"+a.String(_9.length(_9.ofSeq(bS.RulesGroups))+1),function(bV){return I.Render(bS,bV);});bS.RulesGroups.Append(bU);return bU;};J.EventsGroupCreator=function(bS,bT,bU){var bV;bV=E.Create("event"+a.String(_9.length(_9.ofSeq(bS.EventGroups))+1),bT);bS.EventGroups.Append(bV);return bV;};J.PanelGroupCreator=function(bS,bT,bU){var bV;bV=F.Create("panel"+a.String(_9.length(_9.ofSeq(bS.WidgetGroups))+1),bT());bS.WidgetGroups.Append(bV);return bV;};K=d.Dashboard=_4.Class({Render:function(bS){var bT;bT=this;return bm.EmbedView(bh.Map(function(bU){return bU.$==1?bm.Element("div",[],[bm.Element("table",[],[bm.Element("tr",[],[bm.Element("td",[br.Style("vertical-align","top")],[bm.Element("table",[],bd.concat([_9.ofArray([bm.Element("tr",[],[bm.Element("td",[],[_7.IconNormal("dehaze",function(){bi.Set(bT.PanelTitleVisibility,false);bi.Set(bT.Mode,{$:0});})])])]),_9.ofArray([bT.EditorSelectorEdit.get_RenderMenu()]),_9.ofArray([bm.Element("tr",[],[bm.Element("td",[],[])]),bm.Element("tr",[],[bm.Element("td",[],[bT.PropertyGrid.get_Render()])])])]))]),bm.Element("td",[br.Style("vertical-align","top")],[bS,_7.IconNormal("add",function(){var bV,bW,bX,bY,bZ;bV=bT.EditorSelectorEdit.get_SelectedGroupIndex();bV===1?(bW=_9.ofSeq(bT.Factory.EventItems),bX=bi.Create$1(_9.head(bW)),bT.Dialog.ShowDialog("Select source",bm.Element("div",[],[bm.Select([br.Class("form-control")],function(b0){return b0.Worker.Name.c;},bW,bX)]),function(){var b0,b1,b2;b0=bX.c.Worker.get_Clone();b0.StartRunner();b1=(b2=_9.ofSeq(bT.Data.EventGroups),bd.nth(bT.EditorSelectorEdit.get_SelectedIndexInGroup(),b2));bT.Data.RegisterEvent(_7.UniqueKey(),b1,b0);})):bV===0?bT.CreatePanel((bY=_9.ofSeq(bT.Data.WidgetGroups),bd.nth(bT.EditorSelectorEdit.get_SelectedIndexInGroup(),bY)),"Panel",700,null):bV===2?(bZ=_9.ofSeq(bT.Data.RulesGroups),bd.nth(bT.EditorSelectorEdit.get_SelectedIndexInGroup(),bZ)).RulesRowItems.Append(A.Create([z.get_Create(),z.get_Create()])):void 0;}),bT.EditorSelectorEdit.get_Render()])])]),bm.Element("div",[],[bT.Dialog.get_Render()])]):bm.Element("div",[],[bm.Element("table",[],[bm.Element("tr",[],[bm.Element("td",[br.Style("vertical-align","top")],[_7.IconNormal("dehaze",function(){bi.Set(bT.PanelTitleVisibility,true);bi.Set(bT.Mode,{$:1});}),bT.EditorSelectorRun.GroupByIndex(0).SelectorItems.get_Length()>1?bT.EditorSelectorRun.get_RenderMenu():bm.Element("div",[],[])]),bm.Element("td",[],[bT.EditorSelectorRun.get_Render()])])])]);},this.Mode.v));},Restore:function(bS,bT,bU,bV){var bW,bX,bY,bZ,b0;bW=this;this.EditorSelectorRun.ClearGroups();this.EditorSelectorEdit.ClearGroups();this.Data.get_Clear();bX=this.EditorSelectorRun.GroupByIndex(0);bY=this.EditorSelectorEdit.GroupByIndex(0);bZ=this.EditorSelectorEdit.GroupByIndex(1);b0=this.EditorSelectorEdit.GroupByIndex(2);_9.iteri(function(b1,b2){var b3,b4;function b5(b6,b7,b8){bW.RegisterWidget(b6,b4,b7,bd.find(function(b9){return b9.Key===b7;},_9.ofSeq(b4.PanelContainer.PanelItems)).Children,(b8.StartRunner(),b8));}b3=J.PanelGroupCreator(bW.Data,bS,null);bi.Set(b3.WebSharper_Community_Dashboard_ISelectorItem$get_Name(),b2[0]);bY.SelectorItems.Append(b3);bX.SelectorItems.Append(b3);b4=bd.nth(b1,_9.ofSeq(bW.Data.WidgetGroups));_9.iter(function(b6){var b7;b7=bW.CreatePanel(b4,"Panel",700,{$:1,$0:b6.Key});bi.Set(b7.Left,b6.Left);bi.Set(b7.Top,b6.Top);},b2[1]);return _9.iter(function(b6){return b5(b6[0],b6[1],b6[2]);},b2[2]);},bU);bq.log("Widgets restored");_9.iteri(function(b1,b2){var b3,b4;function b5(b6,b7){bW.Data.RegisterEvent(b6,b4,b7);}b3=J.EventsGroupCreator(bW.Data,bW.PropertyGrid,null);bi.Set(b3.WebSharper_Community_Dashboard_ISelectorItem$get_Name(),b2[0]);bZ.SelectorItems.Append(b3);b4=bd.nth(b1,_9.ofSeq(bW.Data.EventGroups));return _9.iter(function(b6){return b5(b6[0],b6[1]);},b2[1]);},bT);bq.log("Events restored");_9.iteri(function(b1,b2){var b3;b3=J.RulesGroupCreator(bW.Data,null);bi.Set(b3.WebSharper_Community_Dashboard_ISelectorItem$get_Name(),b2[0]);b0.SelectorItems.Append(b3);return I.Restore(bW.Data,bd.nth(b1,_9.ofSeq(bW.Data.RulesGroups)).RulesRowItems,b2[1]);},bV);this.Data.WidgetGroups.get_Length()>0?(bi.Set(this.EditorSelectorEdit.OptSelectedItem,{$:1,$0:_9.head(_9.ofSeq(this.EditorSelectorEdit.GroupByIndex(0).SelectorItems))}),bi.Set(this.EditorSelectorRun.OptSelectedItem,{$:1,$0:_9.head(_9.ofSeq(this.EditorSelectorRun.GroupByIndex(0).SelectorItems))})):(bi.Set(this.EditorSelectorEdit.OptSelectedItem,null),bi.Set(this.EditorSelectorRun.OptSelectedItem,null));bq.log("Connectors restored");return[_9.concat(_9.map(function(b1){return _9.map(function(b2){return b2.Worker;},_9.ofSeq(b1.EventItems));},_9.ofSeq(this.Data.EventGroups))),_9.concat(_9.map(function(b1){return _9.map(function(b2){return b2.Widget;},_9.ofSeq(b1.WidgetItems));},_9.ofSeq(this.Data.WidgetGroups)))];},Store:function(bS){function bT(bV,bW){var bX;bX=bS(bW);return bX==null?bV:new _9.T({$:1,$0:[bW.Key,bX.$0],$1:bV});}function bU(bV,bW,bX){var bY;bY=bS(bX);return bY==null?bV:new _9.T({$:1,$0:[bX.Key,bW,bY.$0],$1:bV});}return[_9.map(function(bV){return[bV.Name.c,_9.rev(bd.fold(function(bW,bX){return bT(bW,bX.Worker);},_9.T.Empty,_9.ofSeq(bV.EventItems)))];},_9.ofSeq(this.Data.EventGroups)),_9.map(function(bV){return[bV.Name.c,_9.map(function(bW){return bW.get_PanelData();},_9.ofSeq(bV.PanelContainer.PanelItems)),_9.rev(bd.fold(function(bW,bX){return bU(bW,bX.Panel,bX.Widget);},_9.T.Empty,_9.ofSeq(bV.WidgetItems)))];},_9.ofSeq(this.Data.WidgetGroups)),_9.map(function(bV){return[bV.Name.c,I.CopyToRules(bV.RulesRowItems)];},_9.ofSeq(this.Data.RulesGroups))];},CreatePanel:function(bS,bT,bU,bV){var bW,bX,bY,bZ,b0,b1;bW=this;bm.ConvertBy(bS.WidgetItems.key,function(b2){return bm.Element("div",[],[bm.TextView(b2.Widget.Name.v)]);},bS.WidgetItems.v);bX=(bY=(bZ=bl.NewGuid(),a.String(bZ)),bV==null?bY:bV.$0);b0=bv.get_Create().WithLayoutManager(bw.StackPanelLayoutManager()).WithAttributes([br.Style("border","1px solid white"),br.Style("display","flex")]);b1=bx.get_Create().WithKey(bX).WithPannelAttrs([br.Style("Width",a.String(bU)+"px"),br.Style("position","absolute")]).WithTitle(this.PanelTitleVisibility).WithTitleContent(bm.TextNode(bT)).WithTitleButtons(_9.ofArray([by.New("add",function(b2){var b3,b4;b3=_9.ofSeq(bW.Factory.WidgetItems);b4=bi.Create$1(_9.head(b3));bW.Dialog.ShowDialog("Select widget",bm.Element("div",[],[bm.Select([br.Class("form-control")],function(b5){return b5.Worker.Name.c;},b3,b4)]),function(){var b5;bq.log("Dialog.IsOK");b5=b4.c.Worker.get_Clone();b5.StartRunner();bW.RegisterWidget(_7.UniqueKey(),bS,b2.Key,b2.Children,b5);});}),by.New("edit",function(b2){bq.log("Edit");bW.PropertyGrid.Edit(_9.concat(_9.map(function(b3){return b3.Widget.get_Properties();},_9.filter(function(b3){return b3.Panel===b2.Key;},_9.ofSeq(bS.WidgetItems)))));}),by.New("clear",function(b2){bS.PanelContainer.PanelItems.Remove(bS.PanelContainer.FindPanelItem(b2));bS.WidgetItems.RemoveBy(function(b3){return b3.Panel===b2.Key;});})])).WithChildPanelContainer(b0);bS.PanelContainer.AddPanel(b1);return b1;},RegisterWidget:function(bS,bT,bU,bV,bW){var bX;this.Data.RegisterWidget(bS,bT,bU,bW);bX=bx.get_Create().WithPanelContent(bW.get_Render());bi.Set(bX.IsWithTitle,false);bV.AddPanel(bX);}},null,K);K.Create=function(bS){var bT,bU,bV,bW,bX,bY;function bZ(){return J.PanelGroupCreator(bU,bS,void 0);}function b0(){return J.EventsGroupCreator(bU,bV,void 0);}function b1(){return J.RulesGroupCreator(bU,void 0);}bT=bz.get_Create();bU=H.get_Create();bV=bA.get_Create();bW=C.get_Create();bX=C.get_Create().WithGroupOnClick(function(b2){bV.Edit(_9.mapi(function(b3,b4){var b5;return bk.string((b5=b3+1,a.String(b5)),b4.WebSharper_Community_Dashboard_ISelectorItem$get_Name());},_9.ofSeq(b2.SelectorItems)));}).WithItemOnSelected(function(){bV.Edit(_9.T.Empty);}).WithItemOnCreated(function(b2){return function(b3){return b2===0?_9.head(_9.ofSeq(bW.SelectorGroups)).SelectorItems.Append(b3):null;};}).WithItemOnDeleted(function(){return function(){return null;};}).WithItemOnDeleted(function(b2){return function(b3){b3 instanceof F?bU.WidgetGroups.Remove(b3):b3 instanceof E?bU.EventGroups.Remove(b3):b3 instanceof G?bU.RulesGroups.Remove(b3):_5.FailWith("WithItemOnDeleted, type unknown");return b2===0?_9.head(_9.ofSeq(bW.SelectorGroups)).SelectorItems.Remove(b3):null;};}).WithItemOnMove(_4.Curried3(function(b2,b3,b4){var b5;b5=b4.$==1&&true;return b3 instanceof F?(_7.MoveItemInModelList(bU.WidgetGroups,b5,b3),_7.MoveItemInModelList(_9.head(_9.ofSeq(bW.SelectorGroups)).SelectorItems,b5,b3)):b3 instanceof E?_7.MoveItemInModelList(bU.EventGroups,b5,b3):b3 instanceof G?_7.MoveItemInModelList(bU.RulesGroups,b5,b3):_5.FailWith("WithItemOnDeleted, type unknown");})).WithControls(true);bY=bZ();bX.AppenGroup("Panels",_9.ofArray([bY]),{$:1,$0:bZ});bW.AppenGroup("Panels",_9.ofArray([bY]),null);bX.AppenGroup("Events",_9.ofArray([b0()]),{$:1,$0:b0});bX.AppenGroup("Rules",_9.ofArray([b1()]),{$:1,$0:b1});bi.Set(bX.OptSelectedItem,{$:1,$0:_9.head(_9.ofSeq(bX.GroupByIndex(0).SelectorItems))});bi.Set(bW.OptSelectedItem,{$:1,$0:_9.head(_9.ofSeq(bW.GroupByIndex(0).SelectorItems))});return K.New(y.get_Create(),bU,bV,bT,bW,bX,bi.Create$1({$:0}),bi.Create$1(false));};K.New=function(bS,bT,bU,bV,bW,bX,bY,bZ){return new K({Factory:bS,Data:bT,PropertyGrid:bU,Dialog:bV,EditorSelectorRun:bW,EditorSelectorEdit:bX,Mode:bY,PanelTitleVisibility:bZ});};M=L.RandomEvent=_4.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bS){var bT;new bB.New();_.Start((bT=null,_.Delay(function(){return _.While(function(){return true;},_.Delay(function(){return _.Bind(_.Sleep(bS.InPorts.get_Item(2).get_Number()*1000>>0),function(){var bU,bV,bW;bU=bS.InPorts.get_Item(0).get_Number();bV=bS.InPorts.get_Item(1).get_Number();bW=bC.random()*bV+bU;bS.OutPorts.get_Item(0).Trigger(new i({$:0,$0:bW}));return _.Zero();});}));})),null);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.RandomEventData;}},null,M);M.get_FromWorker=function(){return function(bS){return M.New(bS.get_ToData());};};M.get_Create=function(){return M.New(r.Create("Random",_9.ofArray([["Middle value",h.NumberMessage(100)],["Dispersion",h.NumberMessage(10)],["Delay sec.",h.NumberMessage(2)]]),_9.ofArray([q.Create("Random value")])));};M.New=function(bS){return new M({RandomEventData:bS});};N.New=function(bS){return{DatabaseEventRun:bS};};O=L.DatabaseEvent=_4.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bS){var bT;bT=true;bh.Sink(function(bU){bT?(_9.iter(function(bV){var bW;bW=h.Agent();bW.mailbox.AddLast({$:0,$0:bV});bW.resume();},(new ba.New()).Sync("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.Events.ServerDatabase.ReadAllMessages:965639103",[bS.InPorts.get_Item(1).get_String()])),bT=false):((new ba.New()).Send("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.Events.ServerDatabase.WriteMessage:-353093100",[bS.InPorts.get_Item(1).get_String(),bU.WithKey(bS.OutPorts.get_Item(0).Key)]),bS.OutPorts.get_Item(0).Trigger(bU.Value));},bS.InPorts.get_Item(0).PortValue.v);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.DatabaseEventData;}},null,O);O.get_FromWorker=function(){return function(bS){return O.New(bS.get_ToData());};};O.get_Create=function(){return O.New(r.Create("Database",_9.ofArray([[" in Value",h.NumberMessage(100)],["Database name",h.StringMessage("Database.txt")]]),_9.ofArray([q.Create("Number value")])));};O.New=function(bS){return new O({DatabaseEventData:bS});};Q.New=function(bS,bT,bU,bV,bW){return{Title:bS,Description:bT,ImageUrl:bU,Temperature:bV,TemparatureMinMax:bW};};P.get=function(bS,bT){var bU;bU=null;return _.Delay(function(){var bV;bV=(((_4.Curried3(function(bW,bX,bY){return bW("http://api.openweathermap.org/data/2.5/weather?q="+be.toSafe(bX)+"&units=metric&appid="+be.toSafe(bY));}))(a.id))(bT))(bS);(e.Log())("get key city "+bV);return _.TryWith(_.Delay(function(){return _.Bind(bE.AsyncMap(bI.asyncReadTextAtRuntime(false,"C:\\AEAFrame\\WebSharper.Community.Dashboard\\WebSharper.Community.Dashboard","","JSON","",bV),function(bW){return bt.Equals(typeof bW,"string")?bJ.parse(bW):bW;}),function(bW){var bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch;(e.Log())("get key city 2");return _.Return((bX=bK.tryHead(bW.weather),bX==null?null:{$:1,$0:(bY=bX.$0,Q.New((((_4.Curried3(function(ci,cj,ck){return ci(be.toSafe(cj)+", "+be.toSafe(ck));}))(a.id))((b0=(bZ="name",bZ in bW?{$:1,$0:bW[bZ]}:null),b0==null?null:b0.$0)))((b3=(b1=bW.sys,(b2="country",b2 in b1?{$:1,$0:b1[b2]}:null)),b3==null?null:b3.$0)),(b5=(b4="main",b4 in bY?{$:1,$0:bY[b4]}:null),b5==null?null:b5.$0),(function(ci){return function(cj){return ci("http://openweathermap.org/img/w/"+be.toSafe(cj)+".png");};}(a.id))((b7=(b6="icon",b6 in bY?{$:1,$0:bY[b6]}:null),b7==null?null:b7.$0)),(b8=(b9=bW.main,(b_="temp",b_ in b9?{$:1,$0:b9[b_]}:null)),(b$=b8==null?null:{$:1,$0:1*b8.$0},b$==null?null:b$.$0)),[(ca=(cb=bW.main,(cc="temp_min",cc in cb?{$:1,$0:cb[cc]}:null)),(cd=ca==null?null:{$:1,$0:1*ca.$0},cd==null?null:cd.$0)),(ce=(cf=bW.main,(cg="temp_max",cg in cf?{$:1,$0:cf[cg]}:null)),(ch=ce==null?null:{$:1,$0:1*ce.$0},ch==null?null:ch.$0))]))}));});}),function(bW){(e.Log())(bW.message);return _.Return(null);});});};R=L.OpenWeatherEvent=_4.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bS){var bT;_.Start((bT=null,_.Delay(function(){return _.While(function(){return true;},_.Delay(function(){var bU,bV,bW;bU=bS.InPorts.get_Item(0);bV=bS.InPorts.get_Item(1);bW=bS.OutPorts.get_Item(0);return _.Bind(P.get(bV.get_String(),bU.get_String()),function(bX){return _.Combine(bX==null?_.Zero():((e.Log())("Value generated:"+bX.$0.Title),bW.Trigger(new i({$:0,$0:+bX.$0.Temperature})),_.Zero()),_.Delay(function(){return _.Bind(_.Sleep(1000*15),function(){return _.Return(null);});}));});}));})),null);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.OpenWeatherEventData;}},null,R);R.get_FromWorker=function(){return function(bS){return R.New(bS.get_ToData());};};R.Create=function(bS,bT){return R.New(r.Create("OpenWeatherMap",_9.ofArray([["City",h.StringMessage(bS)],["ApiKey",h.StringMessage(bT)]]),_9.ofArray([q.Create("Temperature")])));};R.New=function(bS){return new R({OpenWeatherEventData:bS});};S=L.ClockEvent=_4.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bS){var bT;_.Start((bT=null,_.Delay(function(){return _.While(function(){return true;},_.Delay(function(){var bU,bV,bW;bU=(bS.InPorts.get_Item(0).PortValue.c.Value.get_AsSelect())[0];bV=_8.now();bW=bU===0?bL.LongTime(bV):bU===1?bL.ShortTime(bV):bU===2?bL.LongDate(bV):bU===3?(new _8(bV)).toLocaleDateString():"";bS.OutPorts.get_Item(0).Trigger(new i({$:1,$0:bW}));return _.Bind(_.Sleep(bS.InPorts.get_Item(1).get_Number()*1000>>0),function(){var bX;bX=(function(bY){return function(bZ){return bY("Time value generated "+be.toSafe(bZ));};}(a.id))(bW);(e.Log())(bX);return _.Zero();});}));})),null);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.ClockEventData;}},null,S);S.get_FromWorker=function(){return function(bS){return S.New(bS.get_ToData());};};S.get_Create=function(){return S.New(r.Create("Clock",_9.ofArray([["Format",h.SelectMessage(0,_9.ofArray(["long time","short time","long date","short date"]))],["Delay sec.",h.NumberMessage(1)]]),_9.ofArray([q.Create("Date Time")])));};S.New=function(bS){return new S({ClockEventData:bS});};U=T.TextBoxWidget=_4.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bS){var bT;bT=bh.Map(function(bU){var bV,bW;bV=bU.Value;return bV.$==0?(bW=bV.$0>>0,a.String(bW)):bV.$==1?bV.$0:bV.$==2?a.String(bV.$0):"Wrong port value format";},bS.InPorts.get_Item(0).PortValue.v);return bm.Element("div",[br.Class("bigvalue")],[bm.TextView(bT)]);}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.TextBoxWidgetData;}},null,U);U.get_FromWorker=function(){return function(bS){return U.New(bS.get_ToData());};};U.get_Create=function(){return U.New(r.Create("Text",_9.ofArray([["in Value",h.NumberMessage(0)]]),_9.T.Empty));};U.New=function(bS){return new U({TextBoxWidgetData:bS});};V.New=function(bS,bT){return{LineChart:bS,Source:bT};};W=T.ChartWidget=_4.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bS){var bT,bU,bV,bW,bX,bY,bZ,b0,b1;bT=bS.InPorts.get_Item(3).get_Number()>>0;bU=bS.RunnerContext.c.$0;bV=(bW={},bW.title=(bX={},bX.display=false,bX),bW.legend=(bY={},bY.display=false,bY),bW.elements=(bZ={},bZ.point=(b0={},b0.radius=0,b0),bZ.line=(b1={},b1.borderWidth=1,b1),bZ),bW);return bO.Render$8(bU.LineChart,{$:1,$0:{$:0,$0:bS.InPorts.get_Item(1).get_Number()>>0,$1:bS.InPorts.get_Item(2).get_Number()>>0}},{$:1,$0:bV},{$:1,$0:bT});}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bS){var bT;bS.InPorts.get_Item(3).get_Number();bT=new bP.New();bh.Sink(function(bU){var bV;bV=(bS.InPorts.get_Item(4).PortValue.c.Value.get_AsSelect())[0];bT.event.Trigger([bV===0?bL.LongTime(bU.Time):bV===1?bL.ShortTime(bU.Time):bV===2?bL.LongDate(bU.Time):bV===3?(new _8(bU.Time)).toLocaleDateString():"",bU.Value.get_AsNumber()]);},bS.InPorts.get_Item(0).PortValue.v);return{$:1,$0:V.New(bQ.Line$1(bT.event).WithFill(false).__WithStrokeColor(new bR.Color({$:1,$0:"#FB8C00"})).__WithPointColor(new bR.Color({$:2,$0:"black"})),bT)};}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.ChartWidgetData;}},null,W);W.get_FromWorker=function(){return function(bS){return W.New(bS.get_ToData());};};W.get_Create=function(){var bS;bS=20;return W.New(r.CreateWithCache("Chart",_9.ofArray([[" in Value",h.NumberMessage(100),bS],["cx",h.NumberMessage(300),1],["cy",h.NumberMessage(150),1],["BufferSize",h.NumberMessage(bS),1],["X-Axis",h.SelectMessage(0,_9.ofArray(["long time","short time","long date","short date"])),1]]),_9.T.Empty));};W.New=function(bS){return new W({ChartWidgetData:bS});};X=T.ButtonWidget=_4.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bS){return bm.ButtonView(bS.InPorts.get_Item(0).get_String(),[],bS.InPorts.get_Item(1).get_BooleanView(),function(bT){bS.OutPorts.get_Item(0).Trigger(new i({$:2,$0:bT}));});}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.ButtonWidgetData;}},null,X);X.get_FromWorker=function(){return function(bS){return X.New(bS.get_ToData());};};X.get_Create=function(){return X.New(r.Create("Button",_9.ofArray([["Caption",h.StringMessage("Button")],["State",h.NumberMessage(0)]]),_9.ofArray([q.Create("Button value")])));};X.New=function(bS){return new X({ButtonWidgetData:bS});};Y.FromWorker=function(bS){var bT;bT=bS.Data;return bT instanceof M?{$:1,$0:{$:0,$0:(M.get_FromWorker())(bS)}}:bT instanceof S?{$:1,$0:{$:1,$0:(S.get_FromWorker())(bS)}}:bT instanceof R?{$:1,$0:{$:2,$0:(R.get_FromWorker())(bS)}}:bT instanceof O?{$:1,$0:{$:3,$0:(O.get_FromWorker())(bS)}}:bT instanceof U?{$:1,$0:{$:4,$0:(U.get_FromWorker())(bS)}}:bT instanceof W?{$:1,$0:{$:5,$0:(W.get_FromWorker())(bS)}}:bT instanceof X?{$:1,$0:{$:6,$0:(X.get_FromWorker())(bS)}}:null;};Y.ToWorker=function(bS){return bS.$==1?s.Create(bS.$0):bS.$==2?s.Create(bS.$0):bS.$==3?s.Create(bS.$0):bS.$==4?s.Create(bS.$0):bS.$==5?s.Create(bS.$0):bS.$==6?s.Create(bS.$0):s.Create(bS.$0);};Z.CreateDashboard=function(){_0.$cctor();return _0.CreateDashboard;};Z.PanelContainerCreator=function(bS){return bv.get_Create().WithLayoutManager(bw.FloatingPanelLayoutManager(5)).WithWidth(800).WithHeight(420).WithAttributes([br.Style("border","1px solid white")]);};Z.RegisterAppModelLib=function(bS){function bT(bV){Z.RegisterEventGeneral(bS,bV);}function bU(bV){Z.RegisterWidgetGeneral(bS,bV);}bT(R.Create("London",""));bT(M.get_Create());bT(S.get_Create());bT(O.get_Create());bU(U.get_Create());bU(W.get_Create());bU(X.get_Create());return bS;};Z.RegisterWidgetGeneral=function(bS,bT){var bU;Z.Register((bU=bS.Factory,function(bV){bU.RegisterWidget(bV);}),bT);};Z.RegisterEventGeneral=function(bS,bT){var bU;Z.Register((bU=bS.Factory,function(bV){bU.RegisterEvent(bV);}),bT);};Z.Register=function(bS,bT){return bS(s.Create(bT));};_0.$cctor=_4.Cctor(function(){_0.CreateDashboard=Z.RegisterAppModelLib(K.Create(function(){return Z.PanelContainerCreator();}));_0.$cctor=a.ignore;});_1.RecreatWidgetsOnServer=function(bS,bT){function bU(bW,bX,bY){return bY;}function bV(bW,bX,bY){return bY;}return _9.map(function(bW){return bU(bW[0],bW[1],bW[2]);},_9.concat(_9.map(function(bW){return bV(bW[0],bW[1],bW[2]);},_1.RecreateWidgets(bS,bT))));};_1.RecreateEventsOnServer=function(bS,bT){function bU(bW,bX){return bX;}function bV(bW,bX){return bX;}return _9.map(function(bW){return bU(bW[0],bW[1]);},_9.concat(_9.map(function(bW){return bV(bW[0],bW[1]);},_1.RecreateEvents(bS,bT))));};_1.RecreateOnClient=function(bS,bT,bU,bV,bW,bX,bY){var bZ;e.set_Role(f.Client);bZ=h.Agent();bZ.mailbox.AddLast({$:3,$0:function(b0){(new ba.New()).Send("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.MessageBus.SendToServer:-1358505674",[b0]);}});bZ.resume();_9.iter(bS,(bT.Restore(bU,_1.RecreateEvents(bV,bW),_1.RecreateWidgets(bV,bX),bY))[0]);};_1.RecreateWidgets=function(bS,bT){function bU(bV,bW,bX){function bY(bZ,b0,b1){return[bZ,b0,bS(b1)];}return[bV,bW,_9.map(function(bZ){return bY(bZ[0],bZ[1],bZ[2]);},bX)];}return _9.map(function(bV){return bU(bV[0],bV[1],bV[2]);},bT);};_1.RecreateEvents=function(bS,bT){function bU(bV,bW){function bX(bY,bZ){return[bY,bS(bZ)];}return[bV,_9.map(function(bY){return bX(bY[0],bY[1]);},bW)];}return _9.map(function(bV){return bU(bV[0],bV[1]);},bT);};_2=d.AppData=_4.Class({RecreateOnServer:function(bS){var bT,bU;function bV(bW,bX){bX.Reconnect(bU);}bT=_1.RecreateEventsOnServer(bS,this.Events);bU=_9.append(bT,_1.RecreatWidgetsOnServer(bS,this.Widgets));_9.iter(function(bW){return bV(bW[0],bW[1]);},this.Rules);_9.iter(function(bW){bW.StartRunner();},bU);return bT;},RecreateOnClientEventsRunning:function(bS,bT,bU){_1.RecreateOnClient(function(bV){bV.StartRunner();},bS,bT,bU,this.Events,this.Widgets,this.Rules);},RecreateOnClientEventsNotRunning:function(bS,bT,bU){_1.RecreateOnClient(a.ignore,bS,bT,bU,this.Events,this.Widgets,this.Rules);}},null,_2);_2.Create=function(bS,bT){var bU;bU=bS.Store(bT);return _2.New(bU[0],bU[1],bU[2]);};_2.empty=function(){return _2.New(_9.T.Empty,_9.T.Empty,_9.T.Empty);};_2.New=function(bS,bT,bU){return new _2({Events:bS,Widgets:bT,Rules:bU});};}());
