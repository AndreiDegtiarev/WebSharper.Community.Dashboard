(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Community=b.Community||{};d=c.Dashboard=c.Dashboard||{};e=d.IInPort=d.IInPort||{};f=d.IOutPort=d.IOutPort||{};g=d.IInPortNumber=d.IInPortNumber||{};h=d.IOutPortNumber=d.IOutPortNumber||{};i=d.Sources=d.Sources||{};j=i.RandomValueSource=i.RandomValueSource||{};k=d.SrcOpenWeather=d.SrcOpenWeather||{};l=k.Forecast=k.Forecast||{};m=k.Create=k.Create||{};n=d.Widgets=d.Widgets||{};o=n.TextBox=n.TextBox||{};p=n.Chart=n.Chart||{};q=d.SourceItem=d.SourceItem||{};r=d.ReceiverItem=d.ReceiverItem||{};s=d.Factory=d.Factory||{};t=d.Dashboard=d.Dashboard||{};u=d.SourceProperty=d.SourceProperty||{};v=a.IntelliFactory;w=v&&v.Runtime;x=b&&b.Control;y=x&&x.FSharpEvent;z=b&&b.Random;A=b&&b.Concurrency;B=b&&b.List;C=c&&c.PropertyGrid;D=C&&C.Properties;E=b&&b.UI;F=E&&E.Next;G=F&&F.Var;H=b&&b.PrintfHelpers;I=b&&b.Data;J=I&&I.TxtRuntime;K=a.FSharp;L=K&&K.Data;M=L&&L.Runtime;N=M&&M.IO;O=b&&b.Unchecked;P=b&&b.Arrays;Q=F&&F.AttrProxy;R=F&&F.Doc;S=b&&b.Charting;T=S&&S.Renderers;U=T&&T.ChartJs;V=b&&b.Seq;W=b&&b.Operators;X=S&&S.Chart;Y=S&&S.Pervasives;Z=F&&F.Key;_0=F&&F.ListModel;_1=F&&F.AttrModule;_2=F&&F.View;_3=c&&c.Panel;_4=_3&&_3.PanelContainer;_5=_3&&_3.LayoutManagers;_6=_3&&_3.Panel;_7=_3&&_3.TitleButton;_8=C&&C.PropertyGrid;_9=_3&&_3.Dialog;e=d.IInPort=w.Class({Disconnect:function(){var _;this.Disconnector();_="Port "+this.name+" disconnected";a.console.log(_);this.Disconnector=function(){};},RegisterDisconnector:function(_,$){this._outPort=_;this.Disconnector=$;},get_OutPort:function(){return this._outPort;},get_Name:function(){return this.name;}},null,e);e.New=w.Ctor(function(_){this.name=_;this.Disconnector=function(){};this._outPort=new f.New("No connection");},e);f=d.IOutPort=w.Class({IsCompatible:function(_){return false;},Connect:function(_){},get_Name:function(){return this.name;}},null,f);f.New=w.Ctor(function(_){this.name=_;},f);g=d.IInPortNumber=w.Class({get_Callback:function(){return this.callback;}},e,g);g.New=w.Ctor(function(_,$){e.New.call(this,_);this.callback=$;},g);h=d.IOutPortNumber=w.Class({Trigger:function(_){this.event.event.Trigger(_);},Connect:function(_){var $,ba,bb;$=this;ba="Port "+this.name$1+" connect";a.console.log(ba);_.Disconnect();bb=function(bc,bd){return(_.get_Callback())(bd);};this.event.event.AddHandler(bb);_.RegisterDisconnector(this,function(){$.event.event.RemoveHandler(bb);});},IsCompatible:function(_){return _ instanceof g;}},f,h);h.New=w.Ctor(function(_){f.New.call(this,_);this.name$1=_;this.event=new y.New();},h);j=i.RandomValueSource=w.Class({WebSharper_Community_Dashboard_ISource$Run:function(){var _,$;_=this;$=new z.New();A.Start(A.Delay(function(){return A.While(function(){return true;},A.Delay(function(){return A.Bind(A.Sleep(600),function(){var ba;ba=a.Math.random()*_.varDispersion.c+_.varMiddleValue.c;_.outRandomNumber.Trigger(ba);return A.Return(null);});}));}),null);},WebSharper_Community_Dashboard_ISource$Clone:function(){return new j.New(this.middleValue,this.dispersion);},WebSharper_Community_Dashboard_ISource$get_Properties:function(){return B.ofArray([D.string("Name",this.name),D["double"]("Middle value",this.varMiddleValue),D["double"]("Dispersion value",this.varDispersion)]);},WebSharper_Community_Dashboard_ISource$get_OutPorts:function(){return B.ofArray([this.outRandomNumber]);},WebSharper_Community_Dashboard_ISource$get_Name:function(){return this.name;}},null,j);j.New=w.Ctor(function(_,$){this.middleValue=_;this.dispersion=$;this.outRandomNumber=new h.New("Random value");this.varMiddleValue=G.Create$1(this.middleValue);this.varDispersion=G.Create$1(this.dispersion);this.name=G.Create$1("Random");},j);l.New=function(_,$,ba,bb,bc){return{Title:_,Description:$,ImageUrl:ba,Temperature:bb,TemparatureMinMax:bc};};m=k.Create=w.Class({WebSharper_Community_Dashboard_ISource$Run:function(){var _,$;_=this;$=new z.New();A.Start(A.Delay(function(){return A.While(function(){return true;},A.Delay(function(){var ba;ba=k.get(_.apiKey.c,_.cityVar.c);return A.Bind(ba,function(bb){var bc;bc="Value generated:"+bb.$0.Title;a.console.log(bc);_.outTempearatur.Trigger(+bb.$0.Temperature);return A.Bind(A.Sleep(1000*15),function(){return A.Return(null);});});}));}),null);},WebSharper_Community_Dashboard_ISource$Clone:function(){return new m.New(this.city);},WebSharper_Community_Dashboard_ISource$get_Properties:function(){return B.ofArray([D.string("Name",this.name),D.string("ApiKey",this.apiKey),D.string("City",this.cityVar)]);},WebSharper_Community_Dashboard_ISource$get_OutPorts:function(){return B.ofArray([this.outTempearatur]);},WebSharper_Community_Dashboard_ISource$get_Name:function(){return this.name;}},null,m);m.New=w.Ctor(function(_){this.city=_;this.outTempearatur=new h.New("Temperature");this.apiKey=G.Create$1("");this.cityVar=G.Create$1(this.city);this.name=G.Create$1("OpenWeatherMap");},m);k.get=function(_,$){return A.Delay(function(){var ba,bb,bc;ba=((bb=function(bd,be,bf){return bd("http://api.openweathermap.org/data/2.5/weather?q="+H.toSafe(be)+"&units=metric&appid="+H.toSafe(bf));},(w.Curried3(bb))(a.id))($))(_);a.console.log("get key city "+ba);bc=J.AsyncMap(N.asyncReadTextAtRuntime(false,"C:\\Users\\Andrey\\Private\\VS_Projects\\WebSharper.Community.Dashboard\\WebSharper.Community.Dashboard","","JSON","",ba),function(bd){return O.Equals(typeof bd,"string")?a.JSON.parse(bd):bd;});return A.Bind(bc,function(bd){var be;a.console.log("get key city 2");return A.Return((be=function(bf){var bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC;return l.New(((bg=function(bD,bE,bF){return bD(H.toSafe(bE)+", "+H.toSafe(bF));},(w.Curried3(bg))(a.id))((bh=(bi="name",bi in bd?{$:1,$0:bd[bi]}:null),bh==null?null:bh.$0)))((bj=bd.sys,(bk=(bl="country",bl in bj?{$:1,$0:bj[bl]}:null),bk==null?null:bk.$0))),(bm=(bn="main",bn in bf?{$:1,$0:bf[bn]}:null),bm==null?null:bm.$0),(bo=function(bD,bE){return bD("http://openweathermap.org/img/w/"+H.toSafe(bE)+".png");},(function(bD){return function(bE){return bo(bD,bE);};}(a.id))((bp=(bq="icon",bq in bf?{$:1,$0:bf[bq]}:null),bp==null?null:bp.$0))),(br=bd.main,(bs=(bt="temp",bt in br?{$:1,$0:br[bt]}:null),(bu=bs==null?null:{$:1,$0:1*bs.$0},bu==null?null:bu.$0))),[(bv=bd.main,(bw=(bx="temp_min",bx in bv?{$:1,$0:bv[bx]}:null),(by=bw==null?null:{$:1,$0:1*bw.$0},by==null?null:by.$0))),(bz=bd.main,(bA=(bB="temp_max",bB in bz?{$:1,$0:bz[bB]}:null),(bC=bA==null?null:{$:1,$0:1*bA.$0},bC==null?null:bC.$0)))]);},function(bf){return bf==null?null:{$:1,$0:be(bf.$0)};}(P.tryHead(bd.weather))));});});};o=n.TextBox=w.Class({WebSharper_Community_Dashboard_IReceiver$get_Properties:function(){return B.T.Empty;},WebSharper_Community_Dashboard_IReceiver$Clone:function(){return new o.New();},WebSharper_Community_Dashboard_IReceiver$Render:function(){var _,$;_=[Q.Create("class","bigvalue")];$=[R.TextView(this.varText.v)];return R.Element("div",_,$);},WebSharper_Community_Dashboard_IReceiver$get_InPorts:function(){return B.ofArray([this.inPortNumber]);},WebSharper_Community_Dashboard_IReceiver$get_Name:function(){return G.Create$1("Text");}},null,o);o.New=w.Ctor(function(){var _;_=this;this.varText=G.Create$1("");this.inPortNumber=new g.New("in Value",function($){var ba,bb,bc;ba=_.varText;bb=(bc=$<<0,a.String(bc));G.Set(ba,bb);});},o);p=n.Chart=w.Class({WebSharper_Community_Dashboard_IReceiver$Clone:function(){return new p.New(this.cx,this.cy,this.chartBufferSize);},WebSharper_Community_Dashboard_IReceiver$get_Properties:function(){return B.T.Empty;},WebSharper_Community_Dashboard_IReceiver$Render:function(){return U.Render$8(this.chart,{$:1,$0:{$:0,$0:this.cx,$1:this.cy}},null,null);},WebSharper_Community_Dashboard_IReceiver$get_InPorts:function(){return B.ofArray([this.inPortNumber]);},WebSharper_Community_Dashboard_IReceiver$get_Name:function(){return G.Create$1("Chart");}},null,p);p.New=w.Ctor(function(_,$,ba){var bb,bc,bd,be,bf;bb=this;this.cx=_;this.cy=$;this.chartBufferSize=ba;bc=B.ofSeq(V.delay(function(){return V.map(function(){return 0;},W.range(0,bb.chartBufferSize-1));}));bd=(be=[],(bf=function(bg){be.push(bg);},function(bg){V.iter(bf,bg);}(bc),be));this.chart=X.Line(bc).__WithFillColor(new Y.Color({$:2,$0:"white"}));this.inPortNumber=new g.New("in Value",function(bg){var bh,bi;bd.push(bg);bd.length>bb.chartBufferSize?bh=bd.shift():void 0;bi=function(bj,bk){return bb.chart.__UpdateData(bj,function(){return bk;});};(function(bj){V.iteri(bi,bj);}(bd));});},p);q.Create=function(_){return q.New(Z.Fresh(),_);};q.New=function(_,$){return{Key:_,Source:$};};r.Create=function(_){return r.New(Z.Fresh(),_);};r.New=function(_,$){return{Key:_,Receiver:$};};s=d.Factory=w.Class({RegisterSource:function(_){this.SourceItems.Append(q.Create(_));},RegisterReceiver:function(_){this.ReceiverItems.Append(r.Create(_));}},null,s);s.get_Create=function(){var _,$;return s.New((_=B.T.Empty,_0.Create(function(ba){return ba.Key;},_)),($=B.T.Empty,_0.Create(function(ba){return ba.Key;},$)));};s.New=function(_,$){return new s({SourceItems:_,ReceiverItems:$});};t=d.Dashboard=w.Class({get_Render:function(){var _,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw;function bx(bz,bA){var bB,bC;bB=new B.T({$:1,$0:_1.Class("material-icons orange600"),$1:$(bA)});bC=[R.TextNode(bz)];return R.Element("i",bB,bC);}function by(bz,bA){var bB,bC,bD;bB=G.Create$1(bz);return[bB,(bC=[_1.DynamicStyle("display",(bD=bB.v,_2.Map(function(bE){return bE?"initial":"none";},bD)))],R.Element("div",bC,[bA]))];}_=this;$=function(bz){return B.ofArray([_1.Style("Color","#FB8C00"),_1.Style("cursor","pointer"),_1.Handler("click",function(){return function(){return bz();};})]);};ba=(bb=[(bc=function(bz){return bz.Key;},(bd=function(bz){var bA,bB,bC;bA=[(bB=$(function(){_.PropertyGrid.Edit(bz.Source.WebSharper_Community_Dashboard_ISource$get_Properties());}),(bC=[R.TextView(bz.Source.WebSharper_Community_Dashboard_ISource$get_Name().v)],R.Element("i",bB,bC)))];return R.Element("tr",[],bA);},function(bz){return R.ConvertBy(bc,bd,bz);})(this.SourceItems.v))],R.Element("table",[],bb));be=B.ofArray([["Board",by(true,this.PanelContainer.get_Render())],["Sources",by(false,ba)]]);bf=(bg=function(bz,bA){var bB,bC,bD,bE,bF;bB=bA[0];bC=[(bD=[_1.DynamicStyle("Color",(bE=bB.v,_2.Map(function(bG){return bG?"#FB8C00":"#7D4600";},bE))),_1.Style("cursor","pointer"),_1.Handler("click",function(){return function(){var bG;bG=function(bH,bI){var bJ;bJ=bI[0];!O.Equals(bJ,bB)?G.Set(bJ,false):G.Set(bJ,true);};return function(bH){B.iter(function(bI){return bG(bI[0],bI[1]);},bH);}(be);};})],(bF=[R.TextNode(bz)],R.Element("td",bD,bF)))];return R.Element("tr",[],bC);},function(bz){return B.map(function(bA){return bg(bA[0],bA[1]);},bz);}(be));bh=(bi=function(bz,bA){return bA[1];},function(bz){return B.map(function(bA){return bi(bA[0],bA[1]);},bz);}(be));bj=[(bk=[(bl=[(bm=[_1.Style("vertical-align","top")],(bn=[(bo=V.concat([B.ofArray([(bp=[(bq=[bx("dehaze",function(){})],R.Element("td",[],bq))],R.Element("tr",[],bp)),(br=[(bs=[bx("add",function(){var bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ;bz=be.get_Item(0);bA=bz[1][0];bB=be.get_Item(1);bC=bB[1][0];bC.c?(bD=B.ofSeq(_.Factory.SourceItems),bE=G.Create$1(B.head(bD)),bF=_.Dialog,bG=(bH=[(bI=[_1.Class("form-control")],R.Select(bI,function(bK){return bK.Source.WebSharper_Community_Dashboard_ISource$get_Name().c;},bD,bE))],R.Element("div",[],bH)),bF.ShowDialog("Select source",bG,function(){bE.c.Source.WebSharper_Community_Dashboard_ISource$Run();_.RegisterSource(bE.c.Source.WebSharper_Community_Dashboard_ISource$Clone());})):bA.c?bJ=_.CreatePanel("Panel",700,{$:1,$0:function(){}}):void 0;})],R.Element("td",[],bs))],R.Element("tr",[],br)),(bt=[R.Element("td",[],[])],R.Element("tr",[],bt)),(bu=[(bv=[this.PropertyGrid.get_Render()],R.Element("td",[],bv))],R.Element("tr",[],bu))]),bf]),R.Element("table",[],bo))],R.Element("td",bm,bn))),R.Element("td",[],bh)],R.Element("tr",[],bl))],R.Element("table",[],bk)),(bw=[this.Dialog.get_Render()],R.Element("div",[],bw))];return R.Element("div",[],bj);},CreatePanel:function(_,$,ba){var bb,bc,bd,be,bf;bb=this;bc=(bd=this.Factory.ReceiverItems.v,(be=this.ReceiverItems.key,R.ConvertBy(be,function(bg){var bh;bh=[R.TextView(bg.Receiver.WebSharper_Community_Dashboard_IReceiver$get_Name().v)];return R.Element("div",[],bh);},bd)));bf=_4.get_Create().WithLayoutManager(_5.StackPanelLayoutManager()).WithAttributes([_1.Style("border","1px solid white"),_1.Style("display","flex")]);this.PanelContainer.AddPanel(_6.get_Create().WithPannelAttrs([_1.Style("Width",a.String($)+"px"),_1.Style("position","absolute")]).WithTitleContent(R.TextNode(_)).WithTitleButtons(B.ofArray([_7.New("add",function(bg){var bh,bi,bj,bk,bl,bm;bh=B.ofSeq(bb.Factory.ReceiverItems);bi=G.Create$1(B.head(bh));bj=bb.Dialog;bk=(bl=[(bm=[_1.Class("form-control")],R.Select(bm,function(bn){return bn.Receiver.WebSharper_Community_Dashboard_IReceiver$get_Name().c;},bh,bi))],R.Element("div",[],bl));bj.ShowDialog("Select widget",bk,function(){a.console.log("Dialog.IsOK");bb.RegisterReceiver(bg.Children,bi.c.Receiver.WebSharper_Community_Dashboard_IReceiver$Clone());});}),_7.New("edit",function(bg){a.console.log("Edit");bg.EditProperties(bb.PropertyGrid);}),_7.New("clear",function(bg){bb.PanelContainer.PanelItems.Remove(bb.PanelContainer.FindPanelItem(bg));})])).WithChildPanelContainer(bf).WithOnAfterRender(W.DefaultArg(ba,function(){})));return bf;},RegisterReceiver:function(_,$){this.ReceiverItems.Append(r.Create($));_.AddPanel(_6.get_Create().WithTitle(false).WithPanelContent($.WebSharper_Community_Dashboard_IReceiver$Render()).WithProperties(new B.T({$:1,$0:new u.New(this,$),$1:$.WebSharper_Community_Dashboard_IReceiver$get_Properties()})));},RegisterSource:function(_){this.SourceItems.Append(q.Create(_));_.WebSharper_Community_Dashboard_ISource$Run();}},null,t);t.Create=function(_){var $,ba;return t.New(s.get_Create(),($=B.T.Empty,_0.Create(function(bb){return bb.Key;},$)),(ba=B.T.Empty,_0.Create(function(bb){return bb.Key;},ba)),_,_8.get_Create(),_9.get_Create());};t.New=function(_,$,ba,bb,bc,bd){return new t({Factory:_,SourceItems:$,ReceiverItems:ba,PanelContainer:bb,PropertyGrid:bc,Dialog:bd});};u=d.SourceProperty=w.Class({WebSharper_Community_PropertyGrid_IProperty$get_Render:function(){var _,$,ba,bb,bc,bd,be,bf,bg,bh,bi;_=this;$=B.concat((ba=function(bj){var bk;bk=function(bl){return[bj,bl];};return function(bl){return B.map(bk,bl);}(bj.Source.WebSharper_Community_Dashboard_ISource$get_OutPorts());},function(bj){return B.map(ba,bj);}(B.ofSeq(this.dashboard.SourceItems))));return $.get_Length()>0?(bb=(bc=(bd=function(bj,bk){return O.Equals(bk,_.receiver.WebSharper_Community_Dashboard_IReceiver$get_InPorts().get_Item(0).get_OutPort());},function(bj){return V.tryFind(function(bk){return bd(bk[0],bk[1]);},bj);}($)),(bc!=null?bc.$==1:false)?bc.$0:B.head($)),(be=G.Create$1(bb),(bf=function(bj,bk){bk.Connect(_.receiver.WebSharper_Community_Dashboard_IReceiver$get_InPorts().get_Item(0));},(bg=be.v,_2.Sink(function(bj){return bf(bj[0],bj[1]);},bg),bh=[_1.Class("form-control")],bi=function(bj,bk){return bj.Source.WebSharper_Community_Dashboard_ISource$get_Name().c+"\\"+bk.get_Name();},R.Select(bh,function(bj){return bi(bj[0],bj[1]);},$,be))))):R.TextNode("No sources defined");},WebSharper_Community_PropertyGrid_IProperty$get_Name:function(){return"Source";}},null,u);u.New=w.Ctor(function(_,$){this.dashboard=_;this.receiver=$;},u);}());
