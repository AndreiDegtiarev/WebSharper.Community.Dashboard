(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP;a=window;b=a.WebSharper=a.WebSharper||{};c=b.Community=b.Community||{};d=c.Dashboard=c.Dashboard||{};e=d.Environment=d.Environment||{};f=e.Role=e.Role||{};g=a.StartupCode$WebSharper_Community_Dashboard$Environment=a.StartupCode$WebSharper_Community_Dashboard$Environment||{};h=d.MessageBus=d.MessageBus||{};i=h.Value=h.Value||{};j=h.Message=h.Message||{};k=h.ListenerInfo=h.ListenerInfo||{};l=h.AgentMessage=h.AgentMessage||{};m=h.AgentState=h.AgentState||{};n=a.StartupCode$WebSharper_Community_Dashboard$MessageBus=a.StartupCode$WebSharper_Community_Dashboard$MessageBus||{};o=d.InPortData=d.InPortData||{};p=d.InPort=d.InPort||{};q=d.OutPort=d.OutPort||{};r=d.WorkerData=d.WorkerData||{};s=d.Worker=d.Worker||{};t=d.Workers=d.Workers||{};u=d.RuleEntry=d.RuleEntry||{};v=d.RuleChain=d.RuleChain||{};w=d.RuleContainer=d.RuleContainer||{};x=d.WorkerItem=d.WorkerItem||{};y=d.Factory=d.Factory||{};z=d.RulesCellItem=d.RulesCellItem||{};A=d.RulesRowItem=d.RulesRowItem||{};B=d.SelectorGroup=d.SelectorGroup||{};C=d.WindowSelector=d.WindowSelector||{};D=d.WidgetItem=d.WidgetItem||{};E=d.EventsGroupItem=d.EventsGroupItem||{};F=d.WidgetsGroupItem=d.WidgetsGroupItem||{};G=d.RulesGroupItem=d.RulesGroupItem||{};H=d.DshData=d.DshData||{};I=d.RulesEditor=d.RulesEditor||{};J=d.DshHelper=d.DshHelper||{};K=d.Dashboard=d.Dashboard||{};L=d.Events=d.Events||{};M=L.RandomEvent=L.RandomEvent||{};N=L.DatabaseEventContext=L.DatabaseEventContext||{};O=L.DatabaseEvent=L.DatabaseEvent||{};P=L.OpenWeather=L.OpenWeather||{};Q=P.Forecast=P.Forecast||{};R=L.OpenWeatherEvent=L.OpenWeatherEvent||{};S=d.Widgets=d.Widgets||{};T=S.TextBoxWidget=S.TextBoxWidget||{};U=S.ChartWidgetContext=S.ChartWidgetContext||{};V=S.ChartWidget=S.ChartWidget||{};W=S.ButtonWidget=S.ButtonWidget||{};X=d.AppModelLib=d.AppModelLib||{};Y=d.App=d.App||{};Z=a.StartupCode$WebSharper_Community_Dashboard$AppModelLib=a.StartupCode$WebSharper_Community_Dashboard$AppModelLib||{};_0=d.AppDataHelper=d.AppDataHelper||{};_1=d.AppData=d.AppData||{};_2=a.IntelliFactory;_3=_2&&_2.Runtime;_4=b&&b.Operators;_5=c&&c.Panel;_6=_5&&_5.Helper;_7=a.Date;_8=b&&b.List;_9=b&&b.Concurrency;_=b&&b.Remoting;$=_&&_.AjaxRemotingProvider;ba=b&&b.Control;bb=ba&&ba.MailboxProcessor;bc=b&&b.Seq;bd=b&&b.Utils;be=b&&b.UI;bf=be&&be.Next;bg=bf&&bf.View;bh=bf&&bf.Var;bi=c&&c.PropertyGrid;bj=bi&&bi.Properties;bk=b&&b.Guid;bl=b&&b.Unchecked;bm=bf&&bf.Doc;bn=b&&b.Enumerator;bo=bf&&bf.Key;bp=bf&&bf.ListModel;bq=a.console;br=bf&&bf.AttrModule;bs=b&&b.Option;bt=_5&&_5.WrapControls;bu=_5&&_5.PanelContainer;bv=_5&&_5.LayoutManagers;bw=_5&&_5.Panel;bx=_5&&_5.TitleButton;by=_5&&_5.Dialog;bz=bi&&bi.PropertyGrid;bA=b&&b.Random;bB=a.Math;bC=b&&b.Data;bD=bC&&bC.TxtRuntime;bE=a.FSharp;bF=bE&&bE.Data;bG=bF&&bF.Runtime;bH=bG&&bG.IO;bI=a.JSON;bJ=b&&b.Arrays;bK=b&&b.Charting;bL=bK&&bK.Renderers;bM=bL&&bL.ChartJs;bN=ba&&ba.FSharpEvent;bO=bK&&bK.LiveChart;bP=bK&&bK.Pervasives;f.Server={$:1};f.Client={$:0};e.DataDirectory=function(){g.$cctor();return g.DataDirectory;};e.set_DataDirectory=function(bQ){g.$cctor();g.DataDirectory=bQ;};e.Log=function(){g.$cctor();return g.Log;};e.set_Log=function(bQ){g.$cctor();g.Log=bQ;};e.Role$1=function(){g.$cctor();return g.Role;};e.set_Role=function(bQ){g.$cctor();g.Role=bQ;};g.$cctor=_3.Cctor(function(){g.Role=f.Server;g.Log=a.ignore;g.DataDirectory="";g.$cctor=a.ignore;});i=h.Value=_3.Class({get_AsBoolean:function(){return this.$==2?this.$0:_4.FailWith("MessageBus.Value: unexpected type");},get_AsString:function(){return this.$==1?this.$0:_4.FailWith("MessageBus.Value: unexpected type");},get_AsNumber:function(){return this.$==0?this.$0:_4.FailWith("MessageBus.Value: unexpected type");}},null,i);j=h.Message=_3.Class({WithTime:function(bQ){return j.New(this.Key,bQ,this.Value);},WithKey:function(bQ){return j.New(bQ,this.Time,this.Value);}},null,j);j.Create=function(bQ){return j.New(_6.UniqueKey(),_7.now(),bQ);};j.New=function(bQ,bR,bS){return new j({Key:bQ,Time:bR,Value:bS});};k.Create=function(bQ,bR,bS){return k.New(bQ,bR,bS);};k.New=function(bQ,bR,bS){return{Key:bQ,Name:bR,CacheSize:bS};};l.Clear={$:4};m.get_empty=function(){return m.New(null,_8.T.Empty);};m.New=function(bQ,bR){return{ServerCallback:bQ,Listeners:bR};};h.RunServerRequests=function(){var bQ;_9.Start((bQ=null,_9.Delay(function(){return _9.While(function(){return true;},_9.Delay(function(){return _9.Bind(_9.Sleep(2*1000),function(){return _9.Bind(h.Agent().PostAndAsyncReply(function(bR){return{$:6,$0:bR};},null),function(bR){return _9.Bind((new $.New()).Async("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.MessageBus.GetMessages:1550733476",[bR]),function(bS){var bT;_8.iter(function(bU){var bV;bV=h.Agent();bV.mailbox.AddLast({$:1,$0:bU});bV.resume();},bS);return bS.get_Length()>0?(bT=(function(bU){return function(bV){return bU("Values from server requested messages received:"+a.String(bV));};}(a.id))(bS.get_Length()),(h.log())(bT),_9.Zero()):_9.Zero();});});});}));})),null);};h.Agent=function(){n.$cctor();return n.Agent;};h.StringMessage=function(bQ){return h.StringKeyMessage(_6.UniqueKey(),bQ);};h.NumberMessage=function(bQ){return h.NumberKeyMessage(_6.UniqueKey(),bQ);};h.BooleanKeyMesage=function(bQ,bR){return h.CreateMessage(bQ,new i({$:2,$0:bR}));};h.StringKeyMessage=function(bQ,bR){return h.CreateMessage(bQ,new i({$:1,$0:bR}));};h.NumberKeyMessage=function(bQ,bR){return h.CreateMessage(bQ,new i({$:0,$0:bR}));};h.CreateMessage=function(bQ,bR){return j.New(bQ,_7.now(),bR);};h.log=function(){n.$cctor();return n.log;};n.$cctor=_3.Cctor(function(){n.log=e.Log();n.Agent=bb.Start(function(bQ){function bR(bW,bX){return bc.fold(function(bY,bZ){var b0;return(b0=bZ.Time-bW,b0/1000)>0.01?new _8.T({$:1,$0:bZ,$1:bY}):bY;},_8.T.Empty,bX);}function bS(bW,bX){return bW<bX.get_Length()?(_8.splitAt(bW,bX))[0]:bX;}function bT(bW,bX,bY){return bW===1?_8.ofArray([bY]):bS(bW,new _8.T({$:1,$0:bY,$1:bX}));}function bU(bW,bX){function bY(bZ,b0,b1){var b2;b2=a.Array.prototype.slice.call(arguments);return bZ.Key===bW.Key?(b0(bW),[bZ,b0,bT(bZ.CacheSize,b1,bW)]):b2;}return _8.map(function(bZ){return bY(bZ[0],bZ[1],bZ[2]);},bX);}function bV(bW){var bX;bX=null;return _9.Delay(function(){return _9.Bind(bQ.Receive(null),function(bY){var bZ,b0,b1,b2,b3,b4,b5;function b6(b8,b9,b_){return bR(b1,b_);}function b7(b8,b9,b_){return b_.$==0?(new _7(0,0-1,0)).getTime():_8.maxBy(function(b$){return b$.Time;},b_).Time;}return bY.$==2?(bZ=bY.$0[0],(b0=(((_3.Curried3(function(b8,b9,b_){return b8("RegisterListener:"+bd.toSafe(b9)+" "+bd.toSafe(b_));}))(a.id))(bZ.Name))(bZ.Key),(h.log())(b0),bV(m.New(bW.ServerCallback,new _8.T({$:1,$0:[bZ,bY.$0[2],_8.T.Empty],$1:bW.Listeners}))))):bY.$==3?bV(m.New({$:1,$0:bY.$0},bW.Listeners)):bY.$==5?(b1=bY.$0[0],(bY.$0[1](bc.fold(function(b8,b9){return!_8.contains(b9,b8)?new _8.T({$:1,$0:b9,$1:b8}):b8;},_8.T.Empty,_8.concat(_8.map(function(b8){return b6(b8[0],b8[1],b8[2]);},bW.Listeners)))),bV(bW))):bY.$==6?(b2=_8.map(function(b8){return b7(b8[0],b8[1],b8[2]);},bW.Listeners),(bY.$0(b2.$==0?(new _7(0,0-1,0)).getTime():_8.max(b2)),bV(bW))):bY.$==1?bV(m.New(bW.ServerCallback,bU(bY.$0,bW.Listeners))):bY.$==0?(b3=bY.$0,(b4=(((_3.Curried3(function(b8,b9,b_){return b8("Num listeners:"+a.String(b9)+" msg:"+bd.toSafe(b_));}))(a.id))(bW.Listeners.get_Length()))(b3.Key),(h.log())(b4),(b5=bW.ServerCallback,b5==null?void 0:b5.$0(b3)),bV(m.New(bW.ServerCallback,bU(b3,bW.Listeners))))):bV(m.get_empty());});});}return bV(m.get_empty());},null);n.$cctor=a.ignore;});o.Create=function(bQ,bR,bS){return o.New(bR.Key,bQ,bR,bS);};o.New=function(bQ,bR,bS,bT){return{Key:bQ,Name:bR,Value:bS,CacheSize:bT};};p=d.InPort=_3.Class({Equals:function(bQ){return bQ instanceof p&&this.Data.Name===bQ.Data.Name;},get_BooleanView:function(){return bg.Map(function(bQ){return bQ.Value.get_AsBoolean();},this.PortValue.v);},get_Boolean:function(){return this.PortValue.c.Value.get_AsBoolean();},get_StringView:function(){return bg.Map(function(bQ){return bQ.Value.get_AsString();},this.PortValue.v);},get_String:function(){return this.PortValue.c.Value.get_AsString();},get_NumberView:function(){return bg.Map(function(bQ){return bQ.Value.get_AsNumber();},this.PortValue.v);},get_Number:function(){return this.PortValue.c.Value.get_AsNumber();},Receive:function(bQ){bh.Set(this.PortValue,bQ);},get_Property:function(){var bQ,bR,bS,bT,bU;bQ=this;bR=this.PortValue.c.Value;return bR.$==1?(bS=bh.Create$1(this.get_String()),(bg.Sink(function(bV){var bW;bh.Set(bQ.PortValue,(bW=bQ.PortValue.c,j.New(bW.Key,bW.Time,new i({$:1,$0:bV}))));},bS.v),bj.string(this.Data.Name,bS))):bR.$==2?(bT=bh.Create$1(this.get_Boolean()),(bg.Sink(function(bV){var bW;bh.Set(bQ.PortValue,(bW=bQ.PortValue.c,j.New(bW.Key,bW.Time,new i({$:2,$0:bV}))));},bT.v),bj.check(this.Data.Name,bT))):(bU=bh.Create$1(this.get_Number()),(bg.Sink(function(bV){var bW;bh.Set(bQ.PortValue,(bW=bQ.PortValue.c,j.New(bW.Key,bW.Time,new i({$:0,$0:bV}))));},bU.v),bj["double"](this.Data.Name,bU)));},get_Key:function(){return this.Data.Key;},get_Name:function(){return this.Data.Name;}},null,p);p.Clone=function(bQ){var bR,bS;return p.New((bR=bQ.Data,o.New((bS=bk.NewGuid(),a.String(bS)),bR.Name,bR.Value,bR.CacheSize)),bh.Create$1(bQ.PortValue.c));};p.ToData=function(bQ){var bR;bR=bQ.Data;return o.New(bR.Key,bR.Name,bQ.PortValue.c,bR.CacheSize);};p.FromData=function(bQ){return p.New(bQ,bh.Create$1(bQ.Value));};p.New=function(bQ,bR){return new p({Data:bQ,PortValue:bR});};q=d.OutPort=_3.Class({Equals:function(bQ){return bQ instanceof q&&this.Name===bQ.Name;},Trigger:function(bQ){var bR;bR=h.Agent();bR.mailbox.AddLast({$:0,$0:h.CreateMessage(this.Key,bQ)});bR.resume();}},null,q);q.Clone=function(bQ){return q.New(_6.UniqueKey(),bQ.Name,bQ.Type);};q.ToData=function(bQ){return[bQ.Name,bQ.Type];};q.FromData=function(bQ,bR){return q.New(bR.Key,bQ,bR);};q.New=function(bQ,bR,bS){return new q({Key:bQ,Name:bR,Type:bS});};r.CreateWithCache=function(bQ,bR,bS){return r.New(bQ,_8.map(function(bT){return o.Create(bT[0],bT[1],bT[2]);},bR),bS);};r.Create=function(bQ,bR,bS){function bT(bU,bV){return o.Create(bU,bV,1);}return r.New(bQ,_8.map(function(bU){return bT(bU[0],bU[1]);},bR),bS);};r.New=function(bQ,bR,bS){return{WorkerName:bQ,InPorts:bR,OutPorts:bS};};s=d.Worker=_3.Class({Equals:function(bQ){return bQ instanceof s&&bl.Equals(this.Name,bQ.Name);},get_Properties:function(){return new _8.T({$:1,$0:bj.string("Name",this.Name),$1:_8.map(function(bQ){return bQ.get_Property();},this.InPorts)});},get_Render:function(){var bQ;bQ=this.Data.WebSharper_Community_Dashboard_IWorkerData$get_Render();return bQ==null?bm.Empty():bQ.$0(this);},get_Clone:function(){return s.New(_6.UniqueKey(),bh.Create$1(this.Name.c),_8.map(p.Clone,this.InPorts),_8.map(q.Clone,this.OutPorts),this.Data,bh.Create$1(null));},get_ToData:function(){return r.New(this.Name.c,_8.map(p.ToData,this.InPorts),_8.map(q.ToData,this.OutPorts));},StartRunner:function(){var bQ;bQ=this.Data.WebSharper_Community_Dashboard_IWorkerData$get_Run();bQ==null?void 0:bh.Set(this.RunnerContext,bQ.$0(this));},WithKey:function(bQ){return s.New(bQ,this.Name,this.InPorts,this.OutPorts,this.Data,this.RunnerContext);}},null,s);s.Create=function(bQ){return s.New(_6.UniqueKey(),bh.Create$1(bQ.WebSharper_Community_Dashboard_IWorkerData$get_Data().WorkerName),_8.map(p.FromData,bQ.WebSharper_Community_Dashboard_IWorkerData$get_Data().InPorts),_8.map(function(bR){return q.FromData(bR[0],bR[1]);},bQ.WebSharper_Community_Dashboard_IWorkerData$get_Data().OutPorts),bQ,bh.Create$1(null));};s.New=function(bQ,bR,bS,bT,bU,bV){return new s({Key:bQ,Name:bR,InPorts:bS,OutPorts:bT,Data:bU,RunnerContext:bV});};t.allInPorts=function(bQ){return t.allPorts(bQ,function(bR){return bR.InPorts;});};t.allOutPorts=function(bQ){return t.allPorts(bQ,function(bR){return bR.OutPorts;});};t.allPorts=function(bQ,bR){return _8.concat(_8.map(bR,bQ));};u.New=function(bQ,bR,bS){return{InPortKey:bQ,OutPortKey:bR,WorkerKey:bS};};v.New=function(bQ){return{RuleChain:bQ};};w=d.RuleContainer=_3.Class({Reconnect:function(bQ){var bR,bS,bT,bU;bR=e.Log();bS=t.allOutPorts(bQ);bT=t.allInPorts(bQ);_8.iter(function(bV){(e.Log())((((_3.Curried3(function(bW,bX,bY){return bW("InPort: "+bd.toSafe(bX)+" "+bd.toSafe(bY));}))(a.id))(bV.get_Name()))(bV.Data.Key));},bT);_8.iter(function(bV){(e.Log())((((_3.Curried3(function(bW,bX,bY){return bW("outPort: "+bd.toSafe(bX)+" "+bd.toSafe(bY));}))(a.id))(bV.Name))(bV.Key));},bS);bU=h.Agent();bU.mailbox.AddLast(l.Clear);bU.resume();_8.iter(function(bV){var bW,bX,bY;bW=_8.ofSeq(bV.RuleChain);bX=_8.ofSeq(_4.range(1,bW.get_Length()-1));bY=bn.Get(bX);try{while(bY.MoveNext())(function(){var bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8;bZ=bY.Current();b0=bW.get_Item(bZ-1);b1=bW.get_Item(bZ);{b2=bc.tryFind(function(b9){return b9.Key===b0.OutPortKey;},bS),b2==null?null:{$:1,$0:(b3=b2.$0,(bR((((_3.Curried3(function(b9,b_,b$){return b9("Found outPort "+bd.toSafe(b_)+" try to find inPort:"+bd.toSafe(b$));}))(a.id))(b0.OutPortKey))(b1.InPortKey)),b4=bc.tryFind(function(b9){return b9.Data.Key===b1.InPortKey;},bT),b4==null?null:{$:1,$0:(b5=b4.$0,(bR("Found inPort"),b5.PortValue.c.Key!==b5.Data.Key?bh.Set(b5.PortValue,b5.PortValue.c.WithKey(b5.Data.Key)):void 0,b6=(b7=b5.PortValue.c.Value,b7.$==1?j.Create(new i({$:1,$0:""})):b7.$==2?j.Create(new i({$:2,$0:false})):j.Create(new i({$:0,$0:0}))),b8=h.Agent(),b8.mailbox.AddLast({$:2,$0:[k.Create(b3.Key,b3.Name+"->"+b5.get_Name(),b5.Data.CacheSize),b6,function(b9){b5.Receive(b9);}]}),b8.resume()))}))};return;}}());}finally{if("Dispose"in bY)bY.Dispose();}},_8.ofSeq(this.RuleContainer));}},null,w);w.New=function(bQ){return new w({RuleContainer:bQ});};x.Create=function(bQ){return x.New(bo.Fresh(),bQ);};x.New=function(bQ,bR){return{Key:bQ,Worker:bR};};y=d.Factory=_3.Class({RegisterEvent:function(bQ){this.EventItems.Append(x.Create(bQ));},RegisterWidget:function(bQ){this.WidgetItems.Append(x.Create(bQ));}},null,y);y.get_Create=function(){return y.New(bp.Create(function(bQ){return bQ.Key;},_8.T.Empty),bp.Create(function(bQ){return bQ.Key;},_8.T.Empty));};y.New=function(bQ,bR){return new y({EventItems:bQ,WidgetItems:bR});};z=d.RulesCellItem=_3.Class({Render:function(bQ,bR){var bS,bT,bU,bV,bW;bS=this;bg.Sink(function(bX){var bY;if(bX==null);else{bY=bX.$0;bq.log("Workitem selected");bh.Set(bS.OptInPort,_8.tryHead(bY.Worker.InPorts));bh.Set(bS.OptOutPort,_8.tryHead(bY.Worker.OutPorts));bR();}},this.OptWorker.v);bg.Sink(function(){bR();},this.OptInPort.v);bg.Sink(function(){bR();},this.OptOutPort.v);bT=(bU=bg.Map(function(bX){var bY;return bX==null?_8.ofArray([null]):(bY=_8.map(function(bZ){return{$:1,$0:bZ};},bX.$0.Worker.InPorts),bY.get_Length()>0?bY:_8.ofArray([null]));},this.OptWorker.v),(bV=bg.Map(function(bX){var bY;return bX==null?_8.ofArray([null]):(bY=_8.map(function(bZ){return{$:1,$0:bZ};},bX.$0.Worker.OutPorts),bY.get_Length()>0?bY:_8.ofArray([null]));},this.OptWorker.v),(bW=bg.Map(function(bX){return new _8.T({$:1,$0:null,$1:_8.map(function(bY){return{$:1,$0:bY};},_8.ofSeq(bX))});},bQ.v),bm.Element("table",[],[bm.Element("tr",[],[bm.Element("td",[],[bm.SelectDyn([br.Class("form-control")],function(bX){return bs.fold(function(bY,bZ){return bZ.get_Name();}," ",bX);},bU,this.OptInPort)]),bm.Element("td",[],[bm.SelectDyn([br.Class("form-control")],function(bX){return bs.fold(function(bY,bZ){return bZ.Worker.Name.c;}," ",bX);},bW,this.OptWorker)]),bm.Element("td",[],[bm.SelectDyn([br.Class("form-control")],function(bX){return bs.fold(function(bY,bZ){return bZ.Name;}," ",bX);},bV,this.OptOutPort)])])]))));return bm.Element("td",[br.Class("td DshEditorCell")],[bm.Element("div",[br.Class("div DshEditorCell")],[bm.Element("table",[],[bm.Element("tr",[],[bm.Element("td",[],[bT])])])])]);}},null,z);z.get_Create=function(){return z.New(bo.Fresh(),bh.Create$1(null),bh.Create$1(null),bh.Create$1(null));};z.New=function(bQ,bR,bS,bT){return new z({Key:bQ,OptInPort:bR,OptWorker:bS,OptOutPort:bT});};A=d.RulesRowItem=_3.Class({Render:function(bQ,bR){var bS;bS=this;return bm.Element("tr",[],[bm.ConvertBy(function(bT){return bT.Key;},function(bT){return bT.Render(bQ,bR);},this.CellItems.v),_6.IconNormal("add",function(){bS.CellItems.Append(z.get_Create());})]);}},null,A);A.Create=function(bQ){return A.New(bo.Fresh(),bp.Create(function(bR){return bR.Key;},bQ));};A.New=function(bQ,bR){return new A({Key:bQ,CellItems:bR});};B=d.SelectorGroup=_3.Class({RenderMenu:function(bQ,bR,bS){var bT,bU,bV,bW,bX,bY;function bZ(b0){return _8.ofArray([_6.IconSmall("keyboard_arrow_down",function(){(bU(true))(b0);(bT.ItemOnMove(b0))({$:1});}),_6.IconSmall("keyboard_arrow_up",function(){(bU(false))(b0);(bT.ItemOnMove(b0))({$:0});}),_6.IconSmall("clear",function(){bT.SelectorItems.Remove(b0);bT.ItemOnDelete(b0);})]);}bT=this;bU=(bV=this.SelectorItems,(_3.Curried3(_6.MoveItemInModelList))(bV));bW=(bX=this.ItemCreatator,bX==null?bm.Element("tr",[],[]):(bY=bX.$0,bm.Element("tr",[],[bm.Element("td",[],[bm.Element("div",[br.Style("margin-left","20px")],[_6.IconSmall("add",function(){var b0;b0=bY();bT.ItemOnCreated(b0);bT.SelectorItems.Append(b0);})])])])));return bm.Element("table",[],[bm.ConvertBy(function(b0){return b0.WebSharper_Community_Dashboard_ISelectorItem$get_Key();},function(b0){var b1,b2,b3,b4;b1=bg.Map(function(b5){return bQ+b5;},b0.WebSharper_Community_Dashboard_ISelectorItem$get_Name().v);return bm.Element("tr",[],[bm.Element("td",[br.DynamicStyle("Color",bg.Map(function(b5){return b5==null?"#7D4600":bl.Equals(b5.$0.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),b0.WebSharper_Community_Dashboard_ISelectorItem$get_Key())?"#FB8C00":"#7D4600";},bR.v))],[(b2=bm.Element("div",[br.Style("margin-left","10px"),br.Style("margin-right","5px"),br.Style("cursor","pointer"),br.Handler("click",function(){return function(){bT.ItemOnSelected(b0);return bh.Set(bR,{$:1,$0:b0});};})],[bm.TextView(b1)]),(bS?(b3=bZ(b0),(b4=_5.WrapControlsAligment.Horizontal,function(b5){return bt.Render(b3,b4,b5);})):a.id)(b2))])]);},this.SelectorItems.v),bW]);}},null,B);B.Create=function(bQ,bR,bS,bT,bU,bV,bW){var bX;bX=bp.Create(function(bY){return bY.WebSharper_Community_Dashboard_ISelectorItem$get_Key();},bR);return B.New(bo.Fresh(),bh.Create$1(bQ),bX,bS,bT,bU,bV,bW);};B.New=function(bQ,bR,bS,bT,bU,bV,bW,bX){return new B({Key:bQ,Name:bR,SelectorItems:bS,ItemCreatator:bT,ItemOnCreated:bU,ItemOnSelected:bV,ItemOnDelete:bW,ItemOnMove:bX});};C=d.WindowSelector=_3.Class({get_RenderMenu:function(){var bQ;bQ=this;return this.SelectorGroups.get_Length()===1?_8.head(_8.ofSeq(this.SelectorGroups)).RenderMenu("",this.OptSelectedItem,this.IsWithControls):bm.Element("div",[],[bm.ConvertBy(function(bR){return bR.Key;},function(bR){return bm.Element("div",[],[bm.Element("div",[br.Style("cursor","pointer"),br.Handler("click",function(){return function(){return bQ.GroupOnClick(bR);};})],[bm.TextView(bR.Name.v)]),bR.RenderMenu("    ",bQ.OptSelectedItem,bQ.IsWithControls)]);},this.SelectorGroups.v)]);},get_Render:function(){return bm.Element("div",[],[bm.BindView(function(bQ){return bQ==null?bm.Empty():bQ.$0.WebSharper_Community_Dashboard_ISelectorItem$get_Render();},this.OptSelectedItem.v)]);},GroupByIndex:function(bQ){return bc.nth(bQ,_8.ofSeq(this.SelectorGroups));},get_SelectedIndex:function(){var bQ;bQ=this;return bc.findIndex(function(bR){return bl.Equals(bR.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bQ.get_SelectedItem().WebSharper_Community_Dashboard_ISelectorItem$get_Key());},_8.concat(_8.map(function(bR){return _8.ofSeq(bR.SelectorItems);},_8.ofSeq(this.SelectorGroups))));},get_SelectedIndexInGroup:function(){var bQ;bQ=this;return bc.findIndex(function(bR){return bl.Equals(bR.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bQ.get_SelectedItem().WebSharper_Community_Dashboard_ISelectorItem$get_Key());},_8.ofSeq(this.get_SelectedGroup().SelectorItems));},get_SelectedGroupIndex:function(){var bQ;bQ=this;return bc.findIndex(function(bR){return bl.Equals(bR.Key,bQ.get_SelectedGroup().Key);},_8.ofSeq(this.SelectorGroups));},get_SelectedGroup:function(){return this.GroupFromItem(this.get_SelectedItem());},GroupFromItem:function(bQ){return bc.find(function(bR){return _8.exists(function(bS){return bl.Equals(bS.WebSharper_Community_Dashboard_ISelectorItem$get_Key(),bQ.WebSharper_Community_Dashboard_ISelectorItem$get_Key());},_8.ofSeq(bR.SelectorItems));},_8.ofSeq(this.SelectorGroups));},AppenGroup:function(bQ,bR,bS){var bT;bT=this.SelectorGroups.get_Length();this.SelectorGroups.Append(B.Create(bQ,bR,bS,this.ItemOnCreated(bT),this.ItemOnSelected,this.ItemOnDeleted(bT),this.ItemOnMove(bT)));},get_SelectedItem:function(){var bQ;bQ=this.OptSelectedItem.c;return bQ==null?_4.FailWith("Something really wrong with WindowSelector"):bQ.$0;},ClearGroups:function(){bh.Set(this.OptSelectedItem,null);_8.iter(function(bQ){bQ.SelectorItems.Clear();},_8.ofSeq(this.SelectorGroups));},WithControls:function(bQ){return C.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,bQ);},WithItemOnMove:function(bQ){return C.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,bQ,this.IsWithControls);},WithItemOnDeleted:function(bQ){return C.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,this.ItemOnSelected,bQ,this.ItemOnMove,this.IsWithControls);},WithItemOnSelected:function(bQ){return C.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,this.GroupOnClick,bQ,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);},WithGroupOnClick:function(bQ){return C.New(this.OptSelectedItem,this.SelectorGroups,this.ItemOnCreated,bQ,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);},WithItemOnCreated:function(bQ){return C.New(this.OptSelectedItem,this.SelectorGroups,bQ,this.GroupOnClick,this.ItemOnSelected,this.ItemOnDeleted,this.ItemOnMove,this.IsWithControls);}},null,C);C.get_Create=function(){var bQ;bQ=bp.Create(function(bR){return bR.Key;},_8.T.Empty);return C.New(bh.Create$1(null),bQ,function(){return function(){return null;};},a.ignore,a.ignore,function(){return function(){return null;};},_3.Curried3(function(bR,bS,bT){return null;}),false);};C.New=function(bQ,bR,bS,bT,bU,bV,bW,bX){return new C({OptSelectedItem:bQ,SelectorGroups:bR,ItemOnCreated:bS,GroupOnClick:bT,ItemOnSelected:bU,ItemOnDeleted:bV,ItemOnMove:bW,IsWithControls:bX});};D.Create=function(bQ,bR){return D.New(bo.Fresh(),bQ,bR);};D.New=function(bQ,bR,bS){return{Key:bQ,Panel:bR,Widget:bS};};E=d.EventsGroupItem=_3.Class({get_Render:function(){var bQ,bR,bS;function bT(bU){return _8.ofArray([_6.IconSmall("keyboard_arrow_down",function(){(bR(true))(bU);}),_6.IconSmall("keyboard_arrow_up",function(){(bR(false))(bU);}),_6.IconSmall("clear",function(){bQ.EventItems.Remove(bU);})]);}bQ=this;bR=(bS=this.EventItems,(_3.Curried3(_6.MoveItemInModelList))(bS));return bm.Element("table",[],[bm.ConvertBy(function(bU){return bU.Key;},function(bU){var bV;return bm.Element("tr",[],[(bV=bm.Element("div",_6.AttrsClick(function(){bQ.PropertyGrid.Edit(bU.Worker.get_Properties());}),[bm.TextView(bU.Worker.Name.v)]),bt.Render(bT(bU),_5.WrapControlsAligment.Horizontal,bV))]);},this.EventItems.v)]);},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,E);E.Create=function(bQ,bR){return E.New(bo.Fresh(),bh.Create$1(bQ),bp.Create(function(bS){return bS.Key;},_8.T.Empty),bR);};E.New=function(bQ,bR,bS,bT){return new E({Key:bQ,Name:bR,EventItems:bS,PropertyGrid:bT});};F=d.WidgetsGroupItem=_3.Class({get_Render:function(){return this.PanelContainer.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,F);F.Create=function(bQ,bR){return F.New(bo.Fresh(),bh.Create$1(bQ),bp.Create(function(bS){return bS.Key;},_8.T.Empty),bR);};F.New=function(bQ,bR,bS,bT){return new F({Key:bQ,Name:bR,WidgetItems:bS,PanelContainer:bT});};G=d.RulesGroupItem=_3.Class({Equals:function(bQ){return bQ instanceof G&&bl.Equals(this.Key,bQ.Key);},get_Render:function(){return this.Renderer(this.RulesRowItems);},WebSharper_Community_Dashboard_ISelectorItem$get_Render:function(){return this.get_Render();},WebSharper_Community_Dashboard_ISelectorItem$get_Name:function(){return this.Name;},WebSharper_Community_Dashboard_ISelectorItem$get_Key:function(){return this.Key;}},null,G);G.Create=function(bQ,bR){return G.New(bo.Fresh(),bh.Create$1(bQ),bp.Create(function(bS){return bS.Key;},_8.T.Empty),bR);};G.New=function(bQ,bR,bS,bT){return new G({Key:bQ,Name:bR,RulesRowItems:bS,Renderer:bT});};H=d.DshData=_3.Class({RegisterWidget:function(bQ,bR,bS,bT){var bU;bU=bT.WithKey(bQ);bR.WidgetItems.Append(D.Create(bS,bU));this.WorkItems.Append(x.Create(bU));},RegisterEvent:function(bQ,bR,bS){var bT;bT=x.Create(bS.WithKey(bQ));bR.EventItems.Append(bT);this.WorkItems.Append(bT);},get_Clear:function(){this.WorkItems.Clear();this.WidgetGroups.Clear();this.EventGroups.Clear();this.RulesGroups.Clear();}},null,H);H.get_Create=function(){return H.New(bp.Create(function(bQ){return bQ.Key;},_8.T.Empty),bp.Create(function(bQ){return bQ.Key;},_8.T.Empty),bp.Create(function(bQ){return bQ.Key;},_8.T.Empty),bp.Create(function(bQ){return bQ.Key;},_8.T.Empty));};H.New=function(bQ,bR,bS,bT){return new H({WorkItems:bQ,WidgetGroups:bR,EventGroups:bS,RulesGroups:bT});};I.Render=function(bQ,bR){function bS(bV,bW){return _6.MoveItemInModelList(bR,bV,bW);}function bT(bV){return _8.ofArray([_6.IconSmall("keyboard_arrow_down",function(){bS(true,bV);}),_6.IconSmall("keyboard_arrow_up",function(){bS(false,bV);}),_6.IconSmall("clear",function(){bR.Remove(bV);})]);}function bU(){var bV;bV=_8.map(function(bW){return bW.Worker;},_8.ofSeq(bQ.WorkItems));I.CopyToRules(bR).Reconnect(bV);}return bm.Element("table",[],[bm.ConvertBy(function(bV){return bV.Key;},function(bV){var bW;return bm.Element("tr",[],[(bW=bV.Render(bQ.WorkItems,function(){bU();}),bt.Render(bT(bV),_5.WrapControlsAligment.Horizontal,bW))]);},bR.v)]);};I.Restore=function(bQ,bR,bS){var bT,bU,bV;bR.Clear();bT=_8.map(function(bW){return bW.Worker;},_8.ofSeq(bQ.WorkItems));bU=t.allOutPorts(bT);bV=t.allInPorts(bT);_8.iter(function(bW){var bX;bX=A.Create([]);_8.iter(function(bY){var bZ;bZ=z.get_Create();bh.Set(bZ.OptWorker,bc.tryFind(function(b0){return b0.Worker.Key===bY.WorkerKey;},_8.ofSeq(bQ.WorkItems)));bh.Set(bZ.OptInPort,bc.tryFind(function(b0){return b0.get_Key()===bY.InPortKey;},bV));bh.Set(bZ.OptOutPort,bc.tryFind(function(b0){return b0.Key===bY.OutPortKey;},bU));bX.CellItems.Append(bZ);},bW.RuleChain);bR.Append(bX);},bS.RuleContainer);bS.Reconnect(bT);};I.CopyToRules=function(bQ){return w.New(_8.map(function(bR){return v.New(_8.map(function(bS){var bT,bU,bV;return u.New((bT=bS.OptInPort.c,bT==null?"":bT.$0.get_Key()),(bU=bS.OptOutPort.c,bU==null?"":bU.$0.Key),(bV=bS.OptWorker.c,bV==null?"":bV.$0.Worker.Key));},_8.ofSeq(bR.CellItems)));},_8.ofSeq(bQ)));};J.RulesGroupCreator=function(bQ,bR){var bS;bS=G.Create("rules"+a.String(_8.length(_8.ofSeq(bQ.RulesGroups))+1),function(bT){return I.Render(bQ,bT);});bQ.RulesGroups.Append(bS);return bS;};J.EventsGroupCreator=function(bQ,bR,bS){var bT;bT=E.Create("event"+a.String(_8.length(_8.ofSeq(bQ.EventGroups))+1),bR);bQ.EventGroups.Append(bT);return bT;};J.PanelGroupCreator=function(bQ,bR,bS){var bT;bT=F.Create("panel"+a.String(_8.length(_8.ofSeq(bQ.WidgetGroups))+1),bR());bQ.WidgetGroups.Append(bT);return bT;};K=d.Dashboard=_3.Class({Render:function(bQ){var bR;bR=this;return bm.EmbedView(bg.Map(function(bS){return bS.$==1?bm.Element("div",[],[bm.Element("table",[],[bm.Element("tr",[],[bm.Element("td",[br.Style("vertical-align","top")],[bm.Element("table",[],bc.concat([_8.ofArray([bm.Element("tr",[],[bm.Element("td",[],[_6.IconNormal("dehaze",function(){bh.Set(bR.PanelTitleVisibility,false);bh.Set(bR.Mode,{$:0});})])])]),_8.ofArray([bR.EditorSelectorEdit.get_RenderMenu()]),_8.ofArray([bm.Element("tr",[],[bm.Element("td",[],[])]),bm.Element("tr",[],[bm.Element("td",[],[bR.PropertyGrid.get_Render()])])])]))]),bm.Element("td",[br.Style("vertical-align","top")],[bQ,_6.IconNormal("add",function(){var bT,bU,bV,bW,bX;bT=bR.EditorSelectorEdit.get_SelectedGroupIndex();bT===1?(bU=_8.ofSeq(bR.Factory.EventItems),bV=bh.Create$1(_8.head(bU)),bR.Dialog.ShowDialog("Select source",bm.Element("div",[],[bm.Select([br.Class("form-control")],function(bY){return bY.Worker.Name.c;},bU,bV)]),function(){var bY,bZ,b0;bY=bV.c.Worker.get_Clone();bY.StartRunner();bZ=(b0=_8.ofSeq(bR.Data.EventGroups),bc.nth(bR.EditorSelectorEdit.get_SelectedIndexInGroup(),b0));bR.Data.RegisterEvent(_6.UniqueKey(),bZ,bY);})):bT===0?bR.CreatePanel((bW=_8.ofSeq(bR.Data.WidgetGroups),bc.nth(bR.EditorSelectorEdit.get_SelectedIndexInGroup(),bW)),"Panel",700,null):bT===2?(bX=_8.ofSeq(bR.Data.RulesGroups),bc.nth(bR.EditorSelectorEdit.get_SelectedIndexInGroup(),bX)).RulesRowItems.Append(A.Create([z.get_Create(),z.get_Create()])):void 0;}),bR.EditorSelectorEdit.get_Render()])])]),bm.Element("div",[],[bR.Dialog.get_Render()])]):bm.Element("div",[],[bm.Element("table",[],[bm.Element("tr",[],[bm.Element("td",[br.Style("vertical-align","top")],[_6.IconNormal("dehaze",function(){bh.Set(bR.PanelTitleVisibility,true);bh.Set(bR.Mode,{$:1});}),bR.EditorSelectorRun.GroupByIndex(0).SelectorItems.get_Length()>1?bR.EditorSelectorRun.get_RenderMenu():bm.Element("div",[],[])]),bm.Element("td",[],[bR.EditorSelectorRun.get_Render()])])])]);},this.Mode.v));},Restore:function(bQ,bR,bS,bT){var bU,bV,bW,bX,bY;bU=this;this.EditorSelectorRun.ClearGroups();this.EditorSelectorEdit.ClearGroups();this.Data.get_Clear();bV=this.EditorSelectorRun.GroupByIndex(0);bW=this.EditorSelectorEdit.GroupByIndex(0);bX=this.EditorSelectorEdit.GroupByIndex(1);bY=this.EditorSelectorEdit.GroupByIndex(2);_8.iteri(function(bZ,b0){var b1,b2;function b3(b4,b5,b6){bU.RegisterWidget(b4,b2,b5,bc.find(function(b7){return b7.Key===b5;},_8.ofSeq(b2.PanelContainer.PanelItems)).Children,(b6.StartRunner(),b6));}b1=J.PanelGroupCreator(bU.Data,bQ,null);bh.Set(b1.WebSharper_Community_Dashboard_ISelectorItem$get_Name(),b0[0]);bW.SelectorItems.Append(b1);bV.SelectorItems.Append(b1);b2=bc.nth(bZ,_8.ofSeq(bU.Data.WidgetGroups));_8.iter(function(b4){var b5;b5=bU.CreatePanel(b2,"Panel",700,{$:1,$0:b4.Key});bh.Set(b5.Left,b4.Left);bh.Set(b5.Top,b4.Top);},b0[1]);return _8.iter(function(b4){return b3(b4[0],b4[1],b4[2]);},b0[2]);},bS);bq.log("Widgets restored");_8.iteri(function(bZ,b0){var b1,b2;function b3(b4,b5){bU.Data.RegisterEvent(b4,b2,b5);}b1=J.EventsGroupCreator(bU.Data,bU.PropertyGrid,null);bh.Set(b1.WebSharper_Community_Dashboard_ISelectorItem$get_Name(),b0[0]);bX.SelectorItems.Append(b1);b2=bc.nth(bZ,_8.ofSeq(bU.Data.EventGroups));return _8.iter(function(b4){return b3(b4[0],b4[1]);},b0[1]);},bR);bq.log("Events restored");_8.iteri(function(bZ,b0){var b1;b1=J.RulesGroupCreator(bU.Data,null);bh.Set(b1.WebSharper_Community_Dashboard_ISelectorItem$get_Name(),b0[0]);bY.SelectorItems.Append(b1);return I.Restore(bU.Data,bc.nth(bZ,_8.ofSeq(bU.Data.RulesGroups)).RulesRowItems,b0[1]);},bT);this.Data.WidgetGroups.get_Length()>0?(bh.Set(this.EditorSelectorEdit.OptSelectedItem,{$:1,$0:_8.head(_8.ofSeq(this.EditorSelectorEdit.GroupByIndex(0).SelectorItems))}),bh.Set(this.EditorSelectorRun.OptSelectedItem,{$:1,$0:_8.head(_8.ofSeq(this.EditorSelectorRun.GroupByIndex(0).SelectorItems))})):(bh.Set(this.EditorSelectorEdit.OptSelectedItem,null),bh.Set(this.EditorSelectorRun.OptSelectedItem,null));bq.log("Connectors restored");return[_8.concat(_8.map(function(bZ){return _8.map(function(b0){return b0.Worker;},_8.ofSeq(bZ.EventItems));},_8.ofSeq(this.Data.EventGroups))),_8.concat(_8.map(function(bZ){return _8.map(function(b0){return b0.Widget;},_8.ofSeq(bZ.WidgetItems));},_8.ofSeq(this.Data.WidgetGroups)))];},Store:function(bQ){function bR(bT,bU){var bV;bV=bQ(bU);return bV==null?bT:new _8.T({$:1,$0:[bU.Key,bV.$0],$1:bT});}function bS(bT,bU,bV){var bW;bW=bQ(bV);return bW==null?bT:new _8.T({$:1,$0:[bV.Key,bU,bW.$0],$1:bT});}return[_8.map(function(bT){return[bT.Name.c,_8.rev(bc.fold(function(bU,bV){return bR(bU,bV.Worker);},_8.T.Empty,_8.ofSeq(bT.EventItems)))];},_8.ofSeq(this.Data.EventGroups)),_8.map(function(bT){return[bT.Name.c,_8.map(function(bU){return bU.get_PanelData();},_8.ofSeq(bT.PanelContainer.PanelItems)),_8.rev(bc.fold(function(bU,bV){return bS(bU,bV.Panel,bV.Widget);},_8.T.Empty,_8.ofSeq(bT.WidgetItems)))];},_8.ofSeq(this.Data.WidgetGroups)),_8.map(function(bT){return[bT.Name.c,I.CopyToRules(bT.RulesRowItems)];},_8.ofSeq(this.Data.RulesGroups))];},CreatePanel:function(bQ,bR,bS,bT){var bU,bV,bW,bX,bY,bZ;bU=this;bm.ConvertBy(bQ.WidgetItems.key,function(b0){return bm.Element("div",[],[bm.TextView(b0.Widget.Name.v)]);},bQ.WidgetItems.v);bV=(bW=(bX=bk.NewGuid(),a.String(bX)),bT==null?bW:bT.$0);bY=bu.get_Create().WithLayoutManager(bv.StackPanelLayoutManager()).WithAttributes([br.Style("border","1px solid white"),br.Style("display","flex")]);bZ=bw.get_Create().WithKey(bV).WithPannelAttrs([br.Style("Width",a.String(bS)+"px"),br.Style("position","absolute")]).WithTitle(this.PanelTitleVisibility).WithTitleContent(bm.TextNode(bR)).WithTitleButtons(_8.ofArray([bx.New("add",function(b0){var b1,b2;b1=_8.ofSeq(bU.Factory.WidgetItems);b2=bh.Create$1(_8.head(b1));bU.Dialog.ShowDialog("Select widget",bm.Element("div",[],[bm.Select([br.Class("form-control")],function(b3){return b3.Worker.Name.c;},b1,b2)]),function(){var b3;bq.log("Dialog.IsOK");b3=b2.c.Worker.get_Clone();b3.StartRunner();bU.RegisterWidget(_6.UniqueKey(),bQ,b0.Key,b0.Children,b3);});}),bx.New("edit",function(b0){bq.log("Edit");bU.PropertyGrid.Edit(_8.concat(_8.map(function(b1){return b1.Widget.get_Properties();},_8.filter(function(b1){return b1.Panel===b0.Key;},_8.ofSeq(bQ.WidgetItems)))));}),bx.New("clear",function(b0){bQ.PanelContainer.PanelItems.Remove(bQ.PanelContainer.FindPanelItem(b0));bQ.WidgetItems.RemoveBy(function(b1){return b1.Panel===b0.Key;});})])).WithChildPanelContainer(bY);bQ.PanelContainer.AddPanel(bZ);return bZ;},RegisterWidget:function(bQ,bR,bS,bT,bU){var bV;this.Data.RegisterWidget(bQ,bR,bS,bU);bV=bw.get_Create().WithPanelContent(bU.get_Render());bh.Set(bV.IsWithTitle,false);bT.AddPanel(bV);}},null,K);K.Create=function(bQ){var bR,bS,bT,bU,bV,bW;function bX(){return J.PanelGroupCreator(bS,bQ,void 0);}function bY(){return J.EventsGroupCreator(bS,bT,void 0);}function bZ(){return J.RulesGroupCreator(bS,void 0);}bR=by.get_Create();bS=H.get_Create();bT=bz.get_Create();bU=C.get_Create();bV=C.get_Create().WithGroupOnClick(function(b0){bT.Edit(_8.mapi(function(b1,b2){var b3;return bj.string((b3=b1+1,a.String(b3)),b2.WebSharper_Community_Dashboard_ISelectorItem$get_Name());},_8.ofSeq(b0.SelectorItems)));}).WithItemOnSelected(function(){bT.Edit(_8.T.Empty);}).WithItemOnCreated(function(b0){return function(b1){return b0===0?_8.head(_8.ofSeq(bU.SelectorGroups)).SelectorItems.Append(b1):null;};}).WithItemOnDeleted(function(){return function(){return null;};}).WithItemOnDeleted(function(b0){return function(b1){b1 instanceof F?bS.WidgetGroups.Remove(b1):b1 instanceof E?bS.EventGroups.Remove(b1):b1 instanceof G?bS.RulesGroups.Remove(b1):_4.FailWith("WithItemOnDeleted, type unknown");return b0===0?_8.head(_8.ofSeq(bU.SelectorGroups)).SelectorItems.Remove(b1):null;};}).WithItemOnMove(_3.Curried3(function(b0,b1,b2){var b3;b3=b2.$==1&&true;return b1 instanceof F?(_6.MoveItemInModelList(bS.WidgetGroups,b3,b1),_6.MoveItemInModelList(_8.head(_8.ofSeq(bU.SelectorGroups)).SelectorItems,b3,b1)):b1 instanceof E?_6.MoveItemInModelList(bS.EventGroups,b3,b1):b1 instanceof G?_6.MoveItemInModelList(bS.RulesGroups,b3,b1):_4.FailWith("WithItemOnDeleted, type unknown");})).WithControls(true);bW=bX();bV.AppenGroup("Panels",_8.ofArray([bW]),{$:1,$0:bX});bU.AppenGroup("Panels",_8.ofArray([bW]),null);bV.AppenGroup("Events",_8.ofArray([bY()]),{$:1,$0:bY});bV.AppenGroup("Rules",_8.ofArray([bZ()]),{$:1,$0:bZ});bh.Set(bV.OptSelectedItem,{$:1,$0:_8.head(_8.ofSeq(bV.GroupByIndex(0).SelectorItems))});bh.Set(bU.OptSelectedItem,{$:1,$0:_8.head(_8.ofSeq(bU.GroupByIndex(0).SelectorItems))});return K.New(y.get_Create(),bS,bT,bR,bU,bV,bh.Create$1({$:0}),bh.Create$1(false));};K.New=function(bQ,bR,bS,bT,bU,bV,bW,bX){return new K({Factory:bQ,Data:bR,PropertyGrid:bS,Dialog:bT,EditorSelectorRun:bU,EditorSelectorEdit:bV,Mode:bW,PanelTitleVisibility:bX});};M=L.RandomEvent=_3.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bQ){var bR;new bA.New();_9.Start((bR=null,_9.Delay(function(){return _9.While(function(){return true;},_9.Delay(function(){return _9.Bind(_9.Sleep(bQ.InPorts.get_Item(2).get_Number()*1000>>0),function(){var bS,bT,bU;bS=bQ.InPorts.get_Item(0).get_Number();bT=bQ.InPorts.get_Item(1).get_Number();bU=bB.random()*bT+bS;bQ.OutPorts.get_Item(0).Trigger(new i({$:0,$0:bU}));return _9.Zero();});}));})),null);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.RandomEventData;}},null,M);M.get_FromWorker=function(){return function(bQ){return M.New(bQ.get_ToData());};};M.get_Create=function(){return M.New(r.Create("Random",_8.ofArray([["Middle value",h.NumberMessage(100)],["Dispersion",h.NumberMessage(10)],["Delay sec.",h.NumberMessage(2)]]),_8.ofArray([["Random value",h.NumberMessage(0)]])));};M.New=function(bQ){return new M({RandomEventData:bQ});};N.New=function(bQ){return{DatabaseEventRun:bQ};};O=L.DatabaseEvent=_3.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bQ){var bR;bR=true;bg.Sink(function(bS){bR?(_8.iter(function(bT){var bU;bU=h.Agent();bU.mailbox.AddLast({$:0,$0:bT});bU.resume();},(new $.New()).Sync("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.Events.ServerDatabase.ReadAllMessages:965639103",[bQ.InPorts.get_Item(1).get_String()])),bR=false):((new $.New()).Send("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.Events.ServerDatabase.WriteMessage:-353093100",[bQ.InPorts.get_Item(1).get_String(),bS.WithKey(bQ.OutPorts.get_Item(0).Key)]),bQ.OutPorts.get_Item(0).Trigger(bS.Value));},bQ.InPorts.get_Item(0).PortValue.v);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.DatabaseEventData;}},null,O);O.get_FromWorker=function(){return function(bQ){return O.New(bQ.get_ToData());};};O.get_Create=function(){return O.New(r.Create("Database",_8.ofArray([[" in Value",h.NumberMessage(100)],["Database name",h.StringMessage("Database.txt")]]),_8.ofArray([["Number value",h.NumberMessage(0)]])));};O.New=function(bQ){return new O({DatabaseEventData:bQ});};Q.New=function(bQ,bR,bS,bT,bU){return{Title:bQ,Description:bR,ImageUrl:bS,Temperature:bT,TemparatureMinMax:bU};};P.get=function(bQ,bR){var bS;bS=null;return _9.Delay(function(){var bT;bT=(((_3.Curried3(function(bU,bV,bW){return bU("http://api.openweathermap.org/data/2.5/weather?q="+bd.toSafe(bV)+"&units=metric&appid="+bd.toSafe(bW));}))(a.id))(bR))(bQ);(e.Log())("get key city "+bT);return _9.TryWith(_9.Delay(function(){return _9.Bind(bD.AsyncMap(bH.asyncReadTextAtRuntime(false,"C:\\AEAFrame\\WebSharper.Community.Dashboard\\WebSharper.Community.Dashboard","","JSON","",bT),function(bU){return bl.Equals(typeof bU,"string")?bI.parse(bU):bU;}),function(bU){var bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf;(e.Log())("get key city 2");return _9.Return((bV=bJ.tryHead(bU.weather),bV==null?null:{$:1,$0:(bW=bV.$0,Q.New((((_3.Curried3(function(cg,ch,ci){return cg(bd.toSafe(ch)+", "+bd.toSafe(ci));}))(a.id))((bY=(bX="name",bX in bU?{$:1,$0:bU[bX]}:null),bY==null?null:bY.$0)))((b1=(bZ=bU.sys,(b0="country",b0 in bZ?{$:1,$0:bZ[b0]}:null)),b1==null?null:b1.$0)),(b3=(b2="main",b2 in bW?{$:1,$0:bW[b2]}:null),b3==null?null:b3.$0),(function(cg){return function(ch){return cg("http://openweathermap.org/img/w/"+bd.toSafe(ch)+".png");};}(a.id))((b5=(b4="icon",b4 in bW?{$:1,$0:bW[b4]}:null),b5==null?null:b5.$0)),(b6=(b7=bU.main,(b8="temp",b8 in b7?{$:1,$0:b7[b8]}:null)),(b9=b6==null?null:{$:1,$0:1*b6.$0},b9==null?null:b9.$0)),[(b_=(b$=bU.main,(ca="temp_min",ca in b$?{$:1,$0:b$[ca]}:null)),(cb=b_==null?null:{$:1,$0:1*b_.$0},cb==null?null:cb.$0)),(cc=(cd=bU.main,(ce="temp_max",ce in cd?{$:1,$0:cd[ce]}:null)),(cf=cc==null?null:{$:1,$0:1*cc.$0},cf==null?null:cf.$0))]))}));});}),function(bU){(e.Log())(bU.message);return _9.Return(null);});});};R=L.OpenWeatherEvent=_3.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bQ){var bR;_9.Start((bR=null,_9.Delay(function(){return _9.While(function(){return true;},_9.Delay(function(){var bS,bT,bU;bS=bQ.InPorts.get_Item(0);bT=bQ.InPorts.get_Item(1);bU=bQ.OutPorts.get_Item(0);return _9.Bind(P.get(bT.get_String(),bS.get_String()),function(bV){return _9.Combine(bV==null?_9.Zero():((e.Log())("Value generated:"+bV.$0.Title),bU.Trigger(new i({$:0,$0:+bV.$0.Temperature})),_9.Zero()),_9.Delay(function(){return _9.Bind(_9.Sleep(1000*15),function(){return _9.Return(null);});}));});}));})),null);return null;}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.OpenWeatherEventData;}},null,R);R.get_FromWorker=function(){return function(bQ){return R.New(bQ.get_ToData());};};R.Create=function(bQ,bR){return R.New(r.Create("OpenWeatherMap",_8.ofArray([["City",h.StringMessage(bQ)],["ApiKey",h.StringMessage(bR)]]),_8.ofArray([["Temperature",h.NumberMessage(0)]])));};R.New=function(bQ){return new R({OpenWeatherEventData:bQ});};T=S.TextBoxWidget=_3.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bQ){var bR;bR=bg.Map(function(bS){var bT;bT=bS>>0;return a.String(bT);},bQ.InPorts.get_Item(0).get_NumberView());return bm.Element("div",[br.Class("bigvalue")],[bm.TextView(bR)]);}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.TextBoxWidgetData;}},null,T);T.get_FromWorker=function(){return function(bQ){return T.New(bQ.get_ToData());};};T.get_Create=function(){return T.New(r.Create("Text",_8.ofArray([["in Value",h.NumberMessage(0)]]),_8.T.Empty));};T.New=function(bQ){return new T({TextBoxWidgetData:bQ});};U.New=function(bQ,bR,bS){return{LineChart:bQ,Queue:bR,Source:bS};};V=S.ChartWidget=_3.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bQ){var bR,bS,bT,bU,bV,bW,bX,bY,bZ;bR=bQ.InPorts.get_Item(3).get_Number()>>0;bS=bQ.RunnerContext.c.$0;bT=(bU={},bU.title=(bV={},bV.display=false,bV),bU.legend=(bW={},bW.display=false,bW),bU.elements=(bX={},bX.point=(bY={},bY.radius=0,bY),bX.line=(bZ={},bZ.borderWidth=1,bZ),bX),bU);return bM.Render$8(bS.LineChart,{$:1,$0:{$:0,$0:bQ.InPorts.get_Item(1).get_Number()>>0,$1:bQ.InPorts.get_Item(2).get_Number()>>0}},{$:1,$0:bT},{$:1,$0:bR});}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return{$:1,$0:function(bQ){var bR,bS,bT,bU;bR=bQ.InPorts.get_Item(3).get_Number()>>0;bS=(bT=[],(bc.iter(function(bV){bT.push(bV);},_8.ofSeq(bc.delay(function(){return bc.map(function(){return 0;},_4.range(0,bR-1));}))),bT));bU=new bN.New();bg.Sink(function(bV){bU.event.Trigger(bV);},bQ.InPorts.get_Item(0).get_NumberView());return{$:1,$0:U.New(bO.Line(bU.event).WithFill(false).__WithStrokeColor(new bP.Color({$:1,$0:"#FB8C00"})).__WithPointColor(new bP.Color({$:2,$0:"black"})),bS,bU)};}};},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.ChartWidgetData;}},null,V);V.get_FromWorker=function(){return function(bQ){return V.New(bQ.get_ToData());};};V.get_Create=function(){var bQ;bQ=20;return V.New(r.CreateWithCache("Chart",_8.ofArray([[" in Value",h.NumberMessage(100),bQ],["cx",h.NumberMessage(300),1],["cy",h.NumberMessage(150),1],["BufferSize",h.NumberMessage(bQ),1]]),_8.T.Empty));};V.New=function(bQ){return new V({ChartWidgetData:bQ});};W=S.ButtonWidget=_3.Class({WebSharper_Community_Dashboard_IWorkerData$get_Render:function(){return{$:1,$0:function(bQ){return bm.ButtonView(bQ.InPorts.get_Item(0).get_String(),[],bQ.InPorts.get_Item(1).get_BooleanView(),function(bR){bQ.OutPorts.get_Item(0).Trigger(new i({$:2,$0:bR}));});}};},WebSharper_Community_Dashboard_IWorkerData$get_Run:function(){return null;},WebSharper_Community_Dashboard_IWorkerData$get_Data:function(){return this.ButtonWidgetData;}},null,W);W.get_FromWorker=function(){return function(bQ){return W.New(bQ.get_ToData());};};W.get_Create=function(){return W.New(r.Create("Button",_8.ofArray([["Caption",h.StringMessage("Button")],["State",h.NumberMessage(0)]]),_8.ofArray([["Button value",h.NumberMessage(0)]])));};W.New=function(bQ){return new W({ButtonWidgetData:bQ});};X.FromWorker=function(bQ){var bR;bR=bQ.Data;return bR instanceof M?{$:1,$0:{$:0,$0:(M.get_FromWorker())(bQ)}}:bR instanceof R?{$:1,$0:{$:1,$0:(R.get_FromWorker())(bQ)}}:bR instanceof O?{$:1,$0:{$:2,$0:(O.get_FromWorker())(bQ)}}:bR instanceof T?{$:1,$0:{$:3,$0:(T.get_FromWorker())(bQ)}}:bR instanceof V?{$:1,$0:{$:4,$0:(V.get_FromWorker())(bQ)}}:bR instanceof W?{$:1,$0:{$:5,$0:(W.get_FromWorker())(bQ)}}:null;};X.ToWorker=function(bQ){return bQ.$==1?s.Create(bQ.$0):bQ.$==2?s.Create(bQ.$0):bQ.$==3?s.Create(bQ.$0):bQ.$==4?s.Create(bQ.$0):bQ.$==5?s.Create(bQ.$0):s.Create(bQ.$0);};Y.CreateDashboard=function(){Z.$cctor();return Z.CreateDashboard;};Y.PanelContainerCreator=function(bQ){return bu.get_Create().WithLayoutManager(bv.FloatingPanelLayoutManager(5)).WithWidth(800).WithHeight(420).WithAttributes([br.Style("border","1px solid white")]);};Y.RegisterAppModelLib=function(bQ){function bR(bT){Y.RegisterEventGeneral(bQ,bT);}function bS(bT){Y.RegisterWidgetGeneral(bQ,bT);}bR(R.Create("London",""));bR(M.get_Create());bR(O.get_Create());bS(T.get_Create());bS(V.get_Create());bS(W.get_Create());return bQ;};Y.RegisterWidgetGeneral=function(bQ,bR){var bS;Y.Register((bS=bQ.Factory,function(bT){bS.RegisterWidget(bT);}),bR);};Y.RegisterEventGeneral=function(bQ,bR){var bS;Y.Register((bS=bQ.Factory,function(bT){bS.RegisterEvent(bT);}),bR);};Y.Register=function(bQ,bR){return bQ(s.Create(bR));};Z.$cctor=_3.Cctor(function(){Z.CreateDashboard=Y.RegisterAppModelLib(K.Create(function(){return Y.PanelContainerCreator();}));Z.$cctor=a.ignore;});_0.RecreatWidgetsOnServer=function(bQ,bR){function bS(bU,bV,bW){return bW;}function bT(bU,bV,bW){return bW;}return _8.map(function(bU){return bS(bU[0],bU[1],bU[2]);},_8.concat(_8.map(function(bU){return bT(bU[0],bU[1],bU[2]);},_0.RecreateWidgets(bQ,bR))));};_0.RecreateEventsOnServer=function(bQ,bR){function bS(bU,bV){return bV;}function bT(bU,bV){return bV;}return _8.map(function(bU){return bS(bU[0],bU[1]);},_8.concat(_8.map(function(bU){return bT(bU[0],bU[1]);},_0.RecreateEvents(bQ,bR))));};_0.RecreateOnClient=function(bQ,bR,bS,bT,bU,bV,bW){var bX;e.set_Role(f.Client);bX=h.Agent();bX.mailbox.AddLast({$:3,$0:function(bY){(new $.New()).Send("WebSharper.Community.Dashboard:WebSharper.Community.Dashboard.MessageBus.SendToServer:-1358505674",[bY]);}});bX.resume();_8.iter(bQ,(bR.Restore(bS,_0.RecreateEvents(bT,bU),_0.RecreateWidgets(bT,bV),bW))[0]);};_0.RecreateWidgets=function(bQ,bR){function bS(bT,bU,bV){function bW(bX,bY,bZ){return[bX,bY,bQ(bZ)];}return[bT,bU,_8.map(function(bX){return bW(bX[0],bX[1],bX[2]);},bV)];}return _8.map(function(bT){return bS(bT[0],bT[1],bT[2]);},bR);};_0.RecreateEvents=function(bQ,bR){function bS(bT,bU){function bV(bW,bX){return[bW,bQ(bX)];}return[bT,_8.map(function(bW){return bV(bW[0],bW[1]);},bU)];}return _8.map(function(bT){return bS(bT[0],bT[1]);},bR);};_1=d.AppData=_3.Class({RecreateOnServer:function(bQ){var bR,bS;function bT(bU,bV){bV.Reconnect(bS);}bR=_0.RecreateEventsOnServer(bQ,this.Events);bS=_8.append(bR,_0.RecreatWidgetsOnServer(bQ,this.Widgets));_8.iter(function(bU){return bT(bU[0],bU[1]);},this.Rules);_8.iter(function(bU){bU.StartRunner();},bS);return bR;},RecreateOnClientEventsRunning:function(bQ,bR,bS){_0.RecreateOnClient(function(bT){bT.StartRunner();},bQ,bR,bS,this.Events,this.Widgets,this.Rules);},RecreateOnClientEventsNotRunning:function(bQ,bR,bS){_0.RecreateOnClient(a.ignore,bQ,bR,bS,this.Events,this.Widgets,this.Rules);}},null,_1);_1.Create=function(bQ,bR){var bS;bS=bQ.Store(bR);return _1.New(bS[0],bS[1],bS[2]);};_1.empty=function(){return _1.New(_8.T.Empty,_8.T.Empty,_8.T.Empty);};_1.New=function(bQ,bR,bS){return new _1({Events:bQ,Widgets:bR,Rules:bS});};}());
